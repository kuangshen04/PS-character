import{get as e,game as t,lib as r,_status as a,ui as n}from"noname";import{c as i}from"./convert.js";import{o as s}from"./extension.js";const o={PSsp_character_celebrity:["PSsp_character_celebrity",'<span style="color:#22a5f1;font-family:xingkai;font-size:24px">群英荟萃</span>'],PSsp_character_meme:["PSsp_character_meme",'<span style="color:#f4326f;font-family:xingkai;font-size:24px">梗系列</span>']},l={rare:["rare","稀有"],epic:["epic","史诗"]},u={name:"PSsp_character",translate:"PS特殊武将"},c={PSsp_jiugeshadiao:{info:{sex:"male",group:"shen",hp:4,skills:["PSsp_jiuzhuan","PSsp_shadiao"],dieAudios:[],trashBin:[]},intro:"由“九个鲨雕”设计<br>九个鲨雕，创群之初就已加入，目前是Q群里最高头衔的存在，曾声称已跟作者本人姓。",skills:{PSsp_jiuzhuan:{trigger:{player:"phaseBegin"},direct:!0,content:function(){var e=player.chooseToMove("九转",!0);if(e.set("list",[["调整任意阶段顺序",[trigger.phaseList,"vcard"]]]),e.set("filterOk",function(e){return!0}),e.set("processAI",function(e){let t=e[0][1][0].slice(0);t.randomSort();return[t.map(e=>[void 0,"",e])]}),result.bool){const e=result.moved[0].map(e=>e[2]);trigger.phaseList=e}},_priority:0},PSsp_shadiao:{audio:2,enable:["chooseToUse","chooseToRespond"],filter:function(t,a){let n=a.getCards("he").reduce(function(t,r){return t.add(e.suit(r,a)),t},[]).length;if(a.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length>n)return!1;for(var i of r.inpile){var s=e.type(i);if(("basic"==s||"trick"==s)&&t.filterCard({name:i},a,t))return!0}return!1},chooseButton:{dialog:function(t,a){for(var i=[],s=0;s<r.inpile.length;s++){var o=r.inpile[s];if("sha"==o)for(var l of(t.filterCard({name:o},a,t)&&i.push(["基本","","sha"]),r.inpile_nature))t.filterCard({name:o,nature:l},a,t)&&i.push(["基本","","sha",l]);else"trick"==e.type(o)&&t.filterCard({name:o},a,t)?i.push(["锦囊","",o]):"basic"==e.type(o)&&t.filterCard({name:o},a,t)&&i.push(["基本","",o])}return n.create.dialog("鲨雕",[i,"vcard"])},filter:function(e,t){return a.event.getParent().filterCard({name:e.link[2]},t,a.event.getParent())},check:function(e){if("phase"!=a.event.getParent().type)return 1;var t=a.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:t.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(t,r){return{audio:2,filterCard:()=>!1,selectCard:-1,popname:!0,viewAs:{name:t[0][2],nature:t[0][3]},precontent:function(){let t=r.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length;t>0&&r.chooseToDiscard("he",!0,t,function(t,r){if(!n.selected.cards.length)return!0;var a=e.suit(t,r);for(var i of n.selected.cards)if(e.suit(i,r)==a)return!1;return!0}).set("complexCard",!0).set("ai",function(t){return 1/e.value(t)}).set("prompt",`弃置${e.cnNumber(t)}张花色不同的牌`)}}},prompt:function(t,r){return"视为使用"+(e.translation(t[0][3])||"")+e.translation(t[0][2])}},hiddenCard:function(t,a){let n=t.getCards("he").reduce(function(r,a){return r.add(e.suit(a,t)),r},[]).length;if(t.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length>n)return!1;if(!r.inpile.includes(a))return!1;var i=e.type(a);return"basic"==i||"trick"==i},ai:{fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(t){let r=t.getCards("he").reduce(function(r,a){return r.add(e.suit(a,t)),r},[]).length;if(t.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length>r)return!1},order:1,result:{player:function(t){return a.event.dying?e.attitude(t,a.event.dying):1}}},_priority:0,group:"PSsp_shadiao_clear",subSkill:{clear:{trigger:{player:"logSkill"},filter:function(e,t){return"PSsp_shadiao_backup"==e.skill&&t.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length>=4},forced:!0,direct:!0,clearSkill:function(e){for(let t=0;t<e.actionHistory.length;t++)e.actionHistory[t].useSkill=e.actionHistory[t].useSkill.filter(e=>"PSsp_shadiao_backup"!=e.skill)},content:function(){if(4==player.getAllHistory("useSkill",e=>"PSsp_shadiao_backup"==e.skill).length?player.chooseBool("是否摸两张牌，重置技能〖鲨雕〗的发动次数").set("ai",function(e,t){return!0}):(r.skill.PSsp_shadiao_clear.clearSkill(player),event.goto(2)),result.bool&&(player.draw(2),r.skill.PSsp_shadiao_clear.clearSkill(player)),event.finish(),event.targets=t.filterPlayer(),event.targets.remove(player),event.targets.sort(r.sort.seat),player.line(event.targets,"green"),event.targets2=event.targets.slice(0),event.targets2.length)event.targets2.shift().damage("nocard"),event.redo();else{let e=0;player.getHistory("sourceDamage",function(t){"PSsp_shadiao_clear"==t.getParent().name&&(e+=t.num)}),player.draw(e)}}}}}},sort:o.PSsp_character_celebrity,title:"鲨鱼中的老雕",translate:{PSsp_jiugeshadiao:"九个鲨雕",PSsp_jiuzhuan:"九转",PSsp_jiuzhuan_info:"回合开始时，你可以调整本回合所有阶段的执行顺序。",PSsp_shadiao:"鲨雕",PSsp_shadiao_info:"你可以弃置X张花色不同的牌视为使用或打出任意即时牌（X为此技能发动的次数）。当X=4时，你可以摸两张牌，然后重置X的发动次数。锁定技，当X>4时，你对所有其他角色各造成1点伤害并摸造成伤害数的牌，然后重置X的发动次数。"},rank:l.epic},PSsp_yebai:{info:{sex:"male",group:"qun",hp:4,skills:["PSsp_xiemen","rewenji"],dieAudios:[],trashBin:[]},intro:"由“九个夜白”设计",skills:{PSsp_xiemen:{audio:2,zhuanhuanji:!0,trigger:{player:"phaseBegin"},mark:!0,marktext:"☯",mod:{cardUsable:function(e,t,r){if("sha"==e.name)return r+t.storage.PSsp_xiemen_count[0]}},init:function(e){e.storage.PSsp_xiemen_count||(e.storage.PSsp_xiemen_count=[0,""])},intro:{markcount:function(e,t){return t.storage.PSsp_xiemen_count[0]},content:function(e,t){let r="回合开始，你可以展示并标记任意张花色各不相同的牌，若如此做，";return 1==t.storage.PSsp_xiemen?r+="本回合你将前等量个非出牌阶段改为出牌阶段":r+="本回合你将前等量个非摸牌阶段改为摸牌阶段",t.storage.PSsp_xiemen_count[0]&&(r+=`<br>出牌阶段使用【杀】次数上限+${t.storage.PSsp_xiemen_count[0]}`),r}},prompt2:function(e,t){return 1==t.storage.PSsp_xiemen?"展示并标记任意张花色各不相同的牌,然后你本回合前等量个非出牌阶段改为出牌阶段":"展示并标记任意张花色各不相同的牌,然后你本回合前等量个非摸牌阶段改为摸牌阶段"},filter:function(e,t){return t.countCards("h")},content:function(){let t=player.getCards("h").reduce(function(t,r){return t.add(e.suit(r,player)),t},[]).length;player.chooseCard([1,t],"h",!0,function(t,r){if(!n.selected.cards.length)return!0;var a=e.suit(t,r);for(var i of n.selected.cards)if(e.suit(i,r)==a)return!1;return!0}).set("complexCard",!0).set("ai",function(e){return!0}).set("prompt","邪门：请展示任意张花色不同的手牌"),result.bool&&result.cards&&(player.showCards(result.cards,e.translation(player)+"发动了【邪门】"),player.addGaintag(result.cards,"PSsp_xiemen"),result.cards.forEach(e=>e.storage.PSsp_xiemen=!0),player.storage.PSsp_xiemen_count[0]=result.cards.length,player.addTempSkill("PSsp_xiemen_next"),1==player.storage.PSsp_xiemen?player.storage.PSsp_xiemen_count[1]="phaseUse":player.storage.PSsp_xiemen_count[1]="phaseDraw"),player.changeZhuanhuanji("PSsp_xiemen")},group:"PSsp_xiemen_lose",subSkill:{next:{trigger:{player:"phaseChange"},filter:function(e,t,r){if(e.phaseList[e.num].startsWith(t.storage.PSsp_xiemen_count[1]))return!1;let a=t.getHistory("useSkill",e=>"PSsp_xiemen_next"===e.skill).length;return t.storage.PSsp_xiemen_count[0]>a},forced:!0,charlotte:!0,content:function(){t.log(player,"将",`#g${trigger.phaseList[trigger.num]}`,"改为了",`#g${player.storage.PSsp_xiemen_count[1]}`),trigger.phaseList[trigger.num]=`${player.storage.PSsp_xiemen_count[1]}|PSsp_xiemen_next`,t.delayx()},ai:{effect:{target:function(t,r,a){if("delay"==e.type(t))return"zerotarget"}}}},lose:{trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},forced:!0,filter:function(e,t){if("gain"==e.name&&e.player==t)return!1;var r=e.getl(t);return r&&r.hs&&r.hs.length&&r.hs.some(e=>e.storage&&e.storage.PSsp_xiemen)},content:function(){trigger.getl(player).hs.forEach(e=>{e.storage&&e.storage.PSsp_xiemen&&(e.storage.PSsp_xiemen=void 0)}),player.draw()}}},_priority:0}},title:"代码糕手",sort:o.PSsp_character_celebrity,translate:{PSsp_yebai:"夜白",PSsp_xiemen:"邪门",PSsp_xiemen_info:"①转换技，回合开始时，你可以展示并标记任意张花色各不相同的牌，若如此做，阴：本回合你将前等量个非摸牌阶段改为摸牌阶段；阳：本回合你将前等量个非出牌阶段改为出牌阶段。<br>②当你失去因此标记的牌时，你摸一张牌。<br>③你的出牌阶段使用杀次数上限+X（X为你因此展示的牌数）"},dynamicTranslate:{PSsp_xiemen:function(e){return 1==e.storage.PSsp_xiemen?'①转换技，回合开始时，你可以展示并标记任意张花色各不相同的牌，若如此做，阴：本回合你将前等量个非摸牌阶段改为摸牌阶段；<span class="bluetext">阳：本回合你将前等量个非出牌阶段改为出牌阶段。</span><br>②当你失去因此标记的牌时，你摸一张牌。<br>③你的出牌阶段使用杀次数上限+X（X为你因此展示的牌数）':'①转换技，回合开始时，你可以展示并标记任意张花色各不相同的牌，若如此做，<span class="bluetext">阴：本回合你将前等量个非摸牌阶段改为摸牌阶段；</span>阳：本回合你将前等量个非出牌阶段改为出牌阶段。<br>②当你失去因此标记的牌时，你摸一张牌。<br>③你的出牌阶段使用杀次数上限+X（X为你因此展示的牌数）'}},rank:l.rare},PSsp_yeshou:{info:{sex:"male",group:"qun",hp:4,skills:["PSsp_echou","PSsp_juexing"],dieAudios:[],trashBin:[]},intro:"由“sc蓝晨跃”设计",skills:{PSsp_echou:{audio:"ext:PS武将/audio/skill:2",trigger:{source:"damageBegin1"},check:function(t,r){return e.attitude(r,t.player)<=0},prompt2:function(t,r){return r.storage.PSsp_juexing?"将伤害值改为1919810，且"+e.translation(t.player)+"的防具和非锁定技失效直到伤害结算完毕":"将伤害值改为114514"},content:function(){player.chat("哼~哼~哼~啊啊啊啊啊————"),player.storage.PSsp_juexing?(trigger.num=1919810,trigger.player.addTempSkill("fengyin","damageEnd"),trigger.player.addTempSkill("PSsp_echou_targeted","damageEnd")):trigger.num=114514},subSkill:{targeted:{locked:!0,ai:{unequip2:!0},sub:!0}}},PSsp_echou_1:{audio:"PSsp_echou"},PSsp_juexing:{skillAnimation:!0,animationColor:"metal",audio:"ext:PS武将/audio/skill:2",juexingji:!0,derivation:"PSsp_echou_1",unique:!0,forced:!0,trigger:{source:"dieAfter"},filter:function(e,t){return e.player!=t},mark:!0,content:function(){player.awakenSkill(event.name),player.storage[event.name]=!0},ai:{threaten:2}}},sort:o.PSsp_character_meme,translate:{PSsp_yeshou:"野兽先辈",PSsp_echou:"恶臭",PSsp_echou_info:"当你造成伤害时，你可以将伤害值改为114514。",PSsp_juexing:"撅醒",PSsp_juexing_info:"撅醒技，当你击杀一名角色后，你升级〖恶臭〗。",PSsp_echou_1:"恶臭·升级",PSsp_echou_1_info:"当你造成伤害时，你可以将伤害值改为1919810，然后令目标角色的非锁定技和防具失效，直到伤害结算完毕。","#ext:PS武将/audio/skill/PSsp_echou1":"哼~哼~哼~啊啊啊啊啊————","#ext:PS武将/audio/skill/PSsp_echou2":"哼——哼——啊啊~~啊——啊~~","#ext:PS武将/audio/skill/PSsp_juexing1":"イキスギ","#ext:PS武将/audio/skill/PSsp_juexing2":"来いよ"},dynamicTranslate:{PSsp_echou:function(e){return e.storage.PSsp_juexing?"当你造成伤害时，你可以将伤害值改为1919810，然后令目标角色的非锁定技和防具失效，直到伤害结算完毕。":"当你造成伤害时，你可以将伤害值改为114514。"}},rank:l.rare},PSsp_jiugemangguo:{info:{sex:"male",group:"wu",hp:4,skills:["PSsp_sucai","PSsp_linggan","PSsp_nagao","PSsp_chongzu"],dieAudios:[],trashBin:[]},intro:"由“铝宝”设计",skills:{PSsp_sucai:{trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,charlotte:!0,filter:function(e,r){return"phase"!=e.name||0==t.phaseNumber},content:function(){player.storage.PSsp_sucai=[["spade","heart","diamond","club"],[1,2,3,4,5,6,7,8,9,10,11,12,13],["sha","shan","tao","jiu"]];let e=[];for(var t=0;t<3;t++){let t=n.create.card(n.special);t.storage.vanish=void 0,t.init([null,null,"PSsp_blank",null]),e.push(t)}player.gain(e,"gain2")}},PSsp_linggan:{trigger:{player:"useCardAfter"},filter:function(t,r){return!0===t.card.PSsp_chongzu&&(t.card.PSsp_chongzu=void 0),!!["basic","trick"].includes(e.type(t.card))&&(r.storage.PSsp_sucai&&(!r.storage.PSsp_sucai[0].includes(e.suit(t.card))||!r.storage.PSsp_sucai[1].includes(e.number(t.card))||!r.storage.PSsp_sucai[2].includes(e.name(t.card))))},usable:1,prompt2:function(t,r){let a="获得";return r.storage.PSsp_sucai[0].includes(e.suit(t.card))||(a+=`一枚花色为${convertSuitToHTML(e.suit(t.card))}的徽章，`),r.storage.PSsp_sucai[1].includes(e.number(t.card))||(a+=`一枚点数为<span class = "greentext">${e.translation(e.number(t.card))}</span>的徽章，`),r.storage.PSsp_sucai[2].includes(e.name(t.card))||(a+=`一枚牌名为<span class = "greentext">${e.translation(e.name(t.card))}</span>的徽章。`),"，"===a.at(-1)&&(a=a.slice(0,-1)+"。"),a},content:function(){player.storage.PSsp_sucai[0].includes(e.suit(trigger.card))||player.storage.PSsp_sucai[0].add(e.suit(trigger.card)),player.storage.PSsp_sucai[1].includes(e.number(trigger.card))||player.storage.PSsp_sucai[1].add(e.number(trigger.card)),player.storage.PSsp_sucai[2].includes(e.name(trigger.card))||player.storage.PSsp_sucai[2].add(e.name(trigger.card)),player.storage.PSsp_sucai[0].sort((e,t)=>-e.localeCompare(t)),player.storage.PSsp_sucai[1].sort((e,t)=>e-t)}},PSsp_nagao:{trigger:{player:["phaseZhunbeiBegin","damageEnd"]},frequent:!0,content:function(){if(player.countCards("h",t=>"PSsp_blank"===e.name(t))<5){player.draw();let e=n.create.card(n.special);e.storage.vanish=void 0,e.init([null,null,"PSsp_blank",null]),player.gain(e,"gain2")}else player.draw(2)}},PSsp_chongzu:{enable:"phaseUse",filter:function(t,r){return!!r.storage.PSsp_sucai&&(r.countCards("h",t=>"PSsp_blank"===e.name(t))&&r.storage.PSsp_sucai[0].length&&r.storage.PSsp_sucai[1].length&&r.storage.PSsp_sucai[2].length)},filterCard:function(t){return"PSsp_blank"===e.name(t)},discard:!1,lose:!1,delay:!1,silent:!0,popup:!1,check:function(t){return 8-e.value(t)},prompt:"请选择一张白板卡进行【重组】",content:function(){player.isUnderControl()&&t.swapPlayerAuto(player);if(event.isMine()?function(i){var s=a.event;i=i||s.player,s._result||(s._result={});var o=n.create.dialog("重组：请选择创生牌的花色、点数和牌名","forcebutton","hidden");s.dialog=o,o.addText("花色");var l=document.createElement("div");l.classList.add("add-setting"),l.style.margin="0",l.style.width="100%",l.style.position="relative";for(var u=i.storage.PSsp_sucai[0],c=0;c<u.length;c++)(_=n.create.div(".shadowed.reduce_radius.pointerdiv.tdnode")).link=u[c],l.appendChild(_),_.innerHTML="<span>"+convertSuitToHTML(u[c])+"</span>",_.addEventListener(r.config.touchscreen?"touchend":"click",function(){if(!a.dragged&&!a.justdragged){a.tempNoButton=!0,setTimeout(function(){a.tempNoButton=!1},500);var e=this.link,t=this.parentNode.querySelector(".bluebg");t&&t.classList.remove("bluebg"),this.classList.add("bluebg"),s._result.suit=e}});o.content.appendChild(l),o.addText("点数");var p=document.createElement("div");p.classList.add("add-setting"),p.style.margin="0",p.style.width="100%",p.style.position="relative";var g=i.storage.PSsp_sucai[1];for(c=0;c<g.length;c++)(_=n.create.div(".shadowed.reduce_radius.pointerdiv.tdnode")).link=g[c],p.appendChild(_),_.innerHTML="<span>"+e.strNumber(g[c])+"</span>",_.addEventListener(r.config.touchscreen?"touchend":"click",function(){if(!a.dragged&&!a.justdragged){a.tempNoButton=!0,setTimeout(function(){a.tempNoButton=!1},500);var e=this.link,t=this.parentNode.querySelector(".bluebg");t&&t.classList.remove("bluebg"),this.classList.add("bluebg"),s._result.number=e}});o.content.appendChild(p),o.addText("牌名");var d=document.createElement("div");d.classList.add("add-setting"),d.style.margin="0",d.style.width="100%",d.style.position="relative";var h=i.storage.PSsp_sucai[2];for(c=0;c<h.length;c++){var _;(_=n.create.div(".shadowed.reduce_radius.pointerdiv.tdnode")).link=h[c],d.appendChild(_),_.innerHTML="<span>"+e.translation(h[c])+"</span>",_.addEventListener(r.config.touchscreen?"touchend":"click",function(){if(!a.dragged&&!a.justdragged){a.tempNoButton=!0,setTimeout(function(){a.tempNoButton=!1},500);var e=this.link,t=this.parentNode.querySelector(".bluebg");t&&t.classList.remove("bluebg"),this.classList.add("bluebg"),s._result.name=e}})}for(o.content.appendChild(d),o.add("　　"),s.dialog.open(),s.switchToAuto=function(){s._result={bool:!1},s.dialog.close(),s.control.close(),t.resume(),a.imchoosing=!1},s.control=n.create.control("ok","cancel2",function(e){var r=s._result;if("cancel2"==e)r.bool=!1;else{if(!r.number||!r.suit||!r.name)return;r.bool=!0}s.dialog.close(),s.control.close(),t.resume(),a.imchoosing=!1}),c=0;c<s.dialog.buttons.length;c++)s.dialog.buttons[c].classList.add("selectable");t.pause(),t.countChoose()}(player):event.isOnline()?(event.player.wait(),t.pause()):(a.imchoosing=!1,event._result={bool:!1},event.dialog&&event.dialog.close(),event.control&&event.control.close()),(event.result||result).bool){var i=cards[0];i.init([result.suit,result.number,result.name]),i.storage.PSsp_chongzu=!0,player.addGaintag([i],"PSsp_chongzu_tag"),player.storage.PSsp_sucai[0].splice(player.storage.PSsp_sucai[0].indexOf(result.suit),1),player.storage.PSsp_sucai[1].splice(player.storage.PSsp_sucai[1].indexOf(result.number),1),player.storage.PSsp_sucai[2].splice(player.storage.PSsp_sucai[2].indexOf(result.name),1)}},group:["PSsp_chongzu_else","PSsp_chongzu_guess"],subSkill:{else:{trigger:{player:["chooseToUseBegin","chooseToRespondBegin"]},direct:!0,silent:!0,popup:!1,filter:function(e,t){return("phaseUse"!==e.getParent().name||!t.isPhaseUsing())&&r.skill.PSsp_chongzu.filter(e,t)},content:function(){if(player.chooseCard(!1,"h").set("filterCard",function(e){return"PSsp_blank"==e.name}).set("ai",function(e){return 1}).set("prompt","是否请选择一张白板卡进行【重组】"),result.bool){var e=t.createEvent("PSsp_chongzu");e.player=player,e.cards=result.cards,e.setContent(r.skill.PSsp_chongzu.content)}}},guess:{trigger:{player:"useCardBefore"},forced:!0,silent:!0,popup:!1,charlotte:!0,firstDo:!0,filter:function(t,r){return["basic","trick"].includes(e.type(t.card))&&t.targets.filter(e=>e.isAlive()&&e.isIn()&&e!==r).length},content:function(){event.card=trigger.cards[0],event.fake=event.card.storage.PSsp_chongzu||!1,player.line(trigger.targets),player.popup(e.name(event.card),"metal"),event.prompt="是否质疑"+e.translation(player)+"使用的"+e.translation(event.card)+"为创生牌？",event.targets=trigger.targets.filter(e=>e.isAlive()&&e.isIn()&&e!==player).sortBySeat(),event.targets2=event.targets.slice(0),event.targets.length?a.connectMode&&event.goto(3):event.goto(5),event.betrays=[],event.target=targets.shift(),event.target.chooseButton([event.prompt,[["reguhuo_ally","reguhuo_betray"],"vcard"]],!0,function(t){var r=a.event.player,n=a.event.getParent("PSsp_chongzu_guess");return n&&"reguhuo_ally"==t.link[2]&&(r.hp<=1||e.attitude(r,n.player)>=0)?1.1:Math.random()}),"reguhuo_betray"==result.links[0][2]&&(event.betrays.push(target),target.addExpose(.2)),event.goto(targets.length?1:5);var n=event.targets.map(function(e){return[e,[event.prompt,[["reguhuo_ally","reguhuo_betray"],"vcard"]],!0]});for(var i in player.chooseButtonOL(n).set("switchToAuto",function(){a.event.result="ai"}).set("processAI",function(){var t=Math.random()>.5?"reguhuo_ally":"reguhuo_betray",r=a.event.player,n=a.event.getParent("PSsp_chongzu_guess");return(r.hp<=1||n&&(e.realAttitude||e.attitude)(r,n.player)>=0)&&(t="reguhuo_ally"),{bool:!0,links:[["","",t]]}}),result)"reguhuo_betray"==result[i].links[0][2]&&(event.betrays.push(r.playerOL[i]),r.playerOL[i].addExpose(.2));for(var i of event.targets2){var s=event.betrays.includes(i);i.popup(s?"质疑":"不质疑",s?"fire":"wood"),t.log(i,s?"#y质疑":"#g不质疑")}if(t.delay(),event.betrays.length)if(event.betrays.sortBySeat(),event.fake)t.asyncDraw(event.betrays),trigger.cancel(),trigger.getParent().goto(0),t.log(player,"使用的","#y"+e.translation(event.card),"作废了");else{var o=t.createEvent("PSsp_chongzu_final",!1);event.next.remove(o),trigger.after.push(o),o.player=player,o.targets=event.betrays,o.setContent(r.skill.PSsp_chongzu_guess.contentx),event.finish()}else event.finish();t.delayx()},contentx:function(){event.target=targets.shift(),event.target.countCards("he")&&player.gainPlayerCard(event.target,1,"he",!1).set("prompt",`获得${e.translation(event.target)}一张牌，或点击“取消”摸一张牌`),result.bool||player.draw(),targets.length&&event.goto(0)},_priority:1}}}},sort:o.PSsp_character_celebrity,translate:{PSsp_jiugemangguo:"九个芒果",PSsp_sucai:"素材",PSsp_sucai_info:"游戏开始时，你获得四枚花色徽章（每花色各一枚），十三枚点数徽章（每点数各一枚），三张白板卡，以及四枚牌名徽章（每基本牌各一枚）。",PSsp_linggan:"灵感",PSsp_linggan_info:"每回合限一次，一张你参与的即时牌结算后，你获得对应牌名/花色/点数的徽章各一枚。（每个牌名/花色/点数的徽章最多持有一枚）",PSsp_nagao:"纳稿",PSsp_nagao_info:"准备阶段，或你受到伤害后，你可以摸一张牌并获得一张白板卡。（上限五张，已满则改为多摸一张牌）",PSsp_chongzu:"重组",PSsp_chongzu_info:"当你需要使用或打出牌时，可以用一张白板卡，以及其他每种徽章各一枚组成一张牌（以此法组成的牌称为“创生牌”）使用。目标角色可以依次质疑你使用的牌为创生牌。若有质疑的角色：若为且其猜对，此牌作废；若为且其猜错，你获得其一张牌或摸一张牌。",PSsp_chongzu_tag:"创生牌",PSsp_blank:"‍",PSsp_blank_info:"一张没有什么作用的牌。"},rank:l.rare},PSsp_jiugechenpi:{info:{sex:"male",group:"qun",hp:4,skills:["PSsp_pojin","PSsp_jiuchen"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSsp_pojin:{audio:2,enable:"phaseUse",filterCard:!0,selectCard:-1,position:"h",usable:1,mod:{targetInRange:function(e){if(e.storage&&e.storage.PSsp_pojin)return!0},cardUsable:function(e){if(e.storage&&e.storage.PSsp_pojin)return 1/0}},filter:function(e,r){var a=r.getCards("h");if(!a.length)return!1;for(var n of a){if(!1===t.checkMod(n,r,"unchanged","cardEnabled2",r))return!1}return!0},viewAs:{name:"sha",isCard:!1,storage:{PSsp_pojin:!0}},onuse:function(e,t){t.addTempSkill("PSsp_pojin_draw"),t.addTempSkill("PSsp_pojin_clear")},ai:{order:1,threaten:1.14,unequip:!0,unequip_ai:!0,skillTagFilter:function(e,t,r){return!!(r&&"sha"==r.name&&r.card&&r.card.storage&&r.card.storage.PSsp_pojin)},yingbian:function(a,n,i,s){if(e.attitude(s,n)<=0)return 0;var o=0,l=!1;return e.cardtag(a,"yingbian_hit")&&(l=!0,i.filter(function(t){return t.hasShan()&&e.attitude(s,t)<0&&e.damageEffect(t,n,s,e.nature(a))>0})&&(o+=5)),e.cardtag(a,"yingbian_all")&&t.hasPlayer(function(t){return!i.includes(t)&&r.filter.targetEnabled2(a,n,t)&&e.effect(t,a,n,n)>0})&&(o+=5),e.cardtag(a,"yingbian_damage")&&i.filter(function(t){return e.attitude(n,t)<0&&(l||!t.mayHaveShan()||n.hasSkillTag("directHit_ai",!0,{target:t,card:a},!0))&&!t.hasSkillTag("filterDamage",null,{player:n,card:a,jiu:!0})})&&(o+=5),o},canLink:function(e,t,r){return!(!t.isLinked()&&!e.hasSkill("wutiesuolian_skill"))&&(!(t.mayHaveShan()&&!e.hasSkillTag("directHit_ai",!0,{target:t,card:r},!0))&&!(e.hasSkill("jueqing")||e.hasSkill("gangzhi")||t.hasSkill("gangzhi")))},basic:{useful:[5,3,1],value:[5,3,1]},result:{target:function(t,r,a,n){var i=!n&&t.hasSkill("jiu")?r.hasSkillTag("filterDamage",null,{player:t,card:a,jiu:!0})?-.5:e.attitude(t,r)>0?-7:-4:-1.5;return n||!r.mayHaveShan()||t.hasSkillTag("directHit_ai",!0,{target:r,card:a},!0)?i:i/1.2}},tag:{respond:1,respondShan:1,damage:function(e){if(!t.hasNature(e,"poison"))return 1},natureDamage:function(e){if(t.hasNature(e))return 1},fireDamage:function(e,r){if(t.hasNature(e,"fire"))return 1},thunderDamage:function(e,r){if(t.hasNature(e,"thunder"))return 1},poisonDamage:function(e,r){if(t.hasNature(e,"poison"))return 1}}},subSkill:{draw:{shaRelated:!0,audio:2,frequent:!0,trigger:{player:"shaAfter"},filter:function(e,t){return"PSsp_pojin"===e.skill&&!t.hasHistory("sourceDamage",t=>t.parent===e)},content:function(){player.draw(trigger.cards.length)},_priority:0},clear:{trigger:{player:"useCard1"},forced:!0,silent:!0,charlotte:!0,filter:function(e,t){return"PSsp_pojin"===e.skill},content:function(){trigger.baseDamage=trigger.cards.length,!1!==trigger.addCount&&(trigger.addCount=!1,player.stat[player.stat.length-1].card.sha>0&&player.stat[player.stat.length-1].card.sha--)},popup:!1,sub:!0,_priority:1}}},PSsp_jiuchen:{audio:2,trigger:{player:"phaseJieshuBegin"},frequent:!0,filter:function(e,t){return t.isMinHandcard()},content:function(){player.draw(2)},_priority:0}},sort:o.PSsp_character_celebrity,translate:{PSsp_jiugechenpi:"九个陈皮",PSsp_pojin:"破筋",PSsp_pojin_info:"出牌阶段限一次，你可以将所有手牌当作无距离限制，无视防具，伤害基数为X，不计入次数且无次数限制的【杀】使用。若此【杀】对目标角色生效且未对其造成过伤害，你摸X张牌。（X为此【杀】对应的实体牌数）",PSsp_jiuchen:"九陈",PSsp_jiuchen_info:"结束阶段开始时，若你的手牌数为全场最少，你摸两张牌。"},rank:l.rare},PSsp_huli:{info:{sex:"female",group:"shen",hp:3,skills:["PSsp_jiuwei","PSsp_mingshu","PSsp_jiuming"],dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSsp_jiuwei:{trigger:{global:["loseAfter","loseAsyncAfter"]},forced:!0,filter:function(t,r){if("discard"!=t.type||!1===t.getlx)return!1;for(var a of t.cards){const r=e.number(a,!(!t.cards2||!t.cards2.includes(a))&&t.player);if("d"==e.position(a,!0)&&(r%3==0||7===r))return!0}return!1},async content(t,r,a){const n=r.cards.reduce((t,a)=>{const n=e.number(a,!(!r.cards2||!r.cards2.includes(a))&&r.player);return t+(n%3==0||7===n)},0);await a.draw(n)}},PSsp_mingshu:{trigger:{player:"damageBegin4"},filter:function(e,t){return e.num>0},check:()=>!0,marktext:"屑",intro:{name:"屑(命数)",name2:"屑",content:"mark"},content:async function(e,t,r){t.cancel(),r.addMark("PSsp_mingshu",1,!1)},group:"PSsp_mingshu_removeMark",subSkill:{removeMark:{trigger:{player:"phaseEnd"},forced:!0,filter:function(e,t){return t.hasMark("PSsp_mingshu")},content:async function(e,t,r){const a=r.countMark("PSsp_mingshu");r.removeMark("PSsp_mingshu",a),r.markAuto("PSsp_mingshu");const{cards:n}=await r.chooseToDiscard(a,"hes",!0).forResult();n.length<a&&await r.loseHp(a-n.length)}}},ai:{halfneg:!0,filterDamage:!0,nofire:!0}},PSsp_jiuming:{unique:!0,mark:!0,skillAnimation:!0,animationColor:"soil",limited:!0,intro:{content:"limited"},check:()=>!0,init:(e,t)=>e.storage[t]=!1,trigger:{player:"dying"},filer:function(e,t){return t.hasMark("PSsp_mingshu")||t.countCards("h")},content:async function(e,t,r){r.awakenSkill("PSsp_jiuming");const a=r.countMark("PSsp_mingshu");r.removeMark("PSsp_mingshu",a),await r.discard(r.getCards("h")),await r.gainMaxHp(),await r.recoverTo(r.maxHp),await r.draw(3)}}},title:"七只狐狸",sort:o.PSsp_character_celebrity,translate:{PSsp_huli:"狐狸",PSsp_jiuwei:"九尾",PSsp_jiuwei_info:"锁定技，当一张点数为3的倍数，或点数为7的牌进入弃牌堆时，你摸一张牌。",PSsp_mingshu:"命数",PSsp_mingshu_info:"狐狸技，当你即将受到伤害时，你可以获得一枚“屑”标记，并防止此次伤害。你的回合结束时，你移去所有的“屑”标记并弃置X张牌，然后若你弃置的牌数不足X，你失去Y点体力（X为“屑”标记数，Y为X与弃置牌数之差）。",PSsp_jiuming:"九命",PSsp_jiuming_info:"限定技，当你进入濒死状态时，你可以移去所有的“屑”标记并弃置所有手牌，然后增加一点体力上限，回复所有体力并摸三张牌。"},rank:l.epic}},{character:p,characterFilter:g,characterIntro:d,characterReplace:h,characterSubstitute:_,characterTitle:f,translate:S,dynamicTranslate:m,rank:{junk:y,rare:P,epic:v,legend:k},skill:b,characterSort:x}=i(u,c);await t.import("character",function(){return{name:u.name,character:p,characterFilter:g,characterIntro:d,characterReplace:h,characterTitle:f,characterSubstitute:_,translate:S,dynamicTranslate:m,skill:b,perfectPair:{},card:{PSsp_blank:{type:null,ai:{basic:{useful:0,value:.1}}}},characterSort:x}}),s(()=>{r.rank.rarity.junk.addArray(y||[]),r.rank.rarity.rare.addArray(P||[]),r.rank.rarity.epic.addArray(v||[]),r.rank.rarity.legend.addArray(k||[])});
//# sourceMappingURL=index2.js.map
