import{get as e,lib as a,game as n,_status as r,ui as t}from"noname";import{c as i}from"./convert.js";import{g as o,o as l}from"./extension.js";function s(n,r){const t=[];for(let i=0;i<n.length;i++){const o=e.suit(n[i],r);if(a.suit.includes(o)&&!t.includes(o)&&(t.add(o),a.suit.length===t.length))break}return t.length}const u={PScharacter_wei:["PScharacter_wei",'<span style="color:#0054ff;font-family:xingkai;font-size:24px">建安风骨</span>'],PScharacter_shu:["PScharacter_shu",'<span style="color:#ff453e;font-family:xingkai;font-size:24px">汉祚延绵</span>'],PScharacter_wu:["PScharacter_wu",'<span style="color:#338c00;font-family:xingkai;font-size:24px">江东铁壁</span>'],PScharacter_qun:["PScharacter_qun",'<span style="color:#8c8c8c;font-family:xingkai;font-size:24px">群雄并起</span>'],PScharacter_jin:["PScharacter_jin",'<span style="color:#991cff;font-family:xingkai;font-size:24px">三分归晋</span>'],PScharacter_shen:["PScharacter_shen",'<span style="color:#dc9e18;font-family:xingkai;font-size:24px">诸神降临</span>'],PScharacter_db:["PScharacter_db","<style>\n                        #双势力{\n                            animation:changeS 8s linear 4s infinite;\n                        }\n                        @keyframes changeS{\n                            0% { color: #0054ff; }\n                            35%{ color: #ff453e; }\n                            65%{ color: #338c00; }\n                            100% { color: #0054ff; }\n                        }\n                    </style>\n                    <body>\n                        <span id='双势力' style=\"display: block; position: unset; transition: unset;\">\n                            <span style='font-family:xingkai;font-size:24px'>双势力</span>\n                        </span>\n                    </body>"]},c={junk:["junk","垃圾"],rare:["rare","稀有"],epic:["epic","史诗"],legend:["legend","传说"]},g={name:"PScharacter",translate:"PS武将"},d={PSshouyige:{info:{sex:"male",group:"shen",hp:8,skills:["PSshuangquan"],dieAudios:["shen_lvbu"],isBossAllowed:!0,isBoss:!0,trashBin:[]},intro:"由“九个芒果”设计",skills:{PSshuangquan:{mod:{selectTarget:function(e,a,n){"sha"==e.name&&-1!=n[1]&&n[1]++,"tiesuo"==e.name&&-1!=n[1]&&(n[1]+=2)},cardUsable:function(e,a,n){if("sha"==e.name)return n+1},globalFrom:function(e,a,n){return n-1},globalTo:function(e,a,n){return n+1}},trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return("phase"!=e.name||0==n.phaseNumber)&&a.hasEnabledSlot(2)},content:function(){const e=["equip1","equip2","equip3","equip4","equip5"];let a,n;for(let r of e)for(n=0,a=player.countEnabledSlot(r)+player.countDisabledSlot(r);n<a;)player.expandEquip(r),n++},_priority:-1,group:["wushuang1","wushuang2","PSshuangquan_phase","PSshuangquan_niepan","PSshuangquan_damage","PSshuangquan_again","PSshuangquan_add","PSshuangquan_clear","PSshuangquan_more","PSshuangquan_use"],preHidden:["wushuang1","wushuang2","PSshuangquan_phase","PSshuangquan_niepan","PSshuangquan_damage","PSshuangquan_again","PSshuangquan_add","PSshuangquan_clear","PSshuangquan_more","PSshuangquan_use"],subSkill:{phase:{audio:"botu",trigger:{player:"phaseAfter"},filter:function(e,a){return 1!=a.storage.PSshuangquan_phase},priority:-50,forced:!0,content:function(){player.insertPhase(),player.storage.PSshuangquan_phase=1},sub:!0},clear:{trigger:{global:"phaseZhunbeiBegin"},filter:function(e,a){return 1==a.storage.PSshuangquan_phase&&e.player!=a},priority:-50,forced:!0,content:function(){player.storage.PSshuangquan_phase=0},sub:!0},use:{trigger:{player:"useCard1"},direct:!0,filter:function(r,t){var i=e.info(r.card,!1);return 0!=i.allowMultiple&&("trick"==e.type(r.card)&&("tiesuo"!=r.card.name&&!(!r.targets||i.multitarget||!n.hasPlayer(function(e){return!r.targets.includes(e)&&a.filter.targetEnabled2(r.card,t,e)&&a.filter.targetInRange(r.card,t,e)}))))},content:function(){n.countPlayer(function(e){return!trigger.targets.includes(e)&&a.filter.targetEnabled2(trigger.card,player,e)&&a.filter.targetInRange(trigger.card,player,e)}),player.chooseTarget("双全：是否为"+e.translation(trigger.card)+"增加一个目标？",1,function(e,n,t){var i=r.event.getTrigger();e=i.card;return!i.targets.includes(t)&&a.filter.targetEnabled2(e,n,t)&&a.filter.targetInRange(e,n,t)}).set("ai",function(a){var n=r.event.player,t=r.event.getTrigger().card;return e.effect(a,t,n,n)}),result.bool?player==n.me||player.isOnline()||n.delayx():event.finish();var t=result.targets.sortBySeat();trigger.targets.addArray(t)},sub:!0},niepan:{audio:"niepan",unique:!0,trigger:{player:"dieBefore"},forced:!0,mark:!0,skillAnimation:!0,animationStr:"涅槃",limited:!0,animationColor:"orange",filter:function(e,a){return!a.storage.PSshuangquan_niepan},content:function(){trigger.cancel(),player.awakenSkill("PSshuangquan_niepan"),player.storage.PSshuangquan_niepan=!0,player.maxHp=8,player.update(),player.hp<player.maxHp&&player.recoverTo(player.maxHp)},ai:{order:1,skillTagFilter:function(e,a,n){if(e!=n||e.storage.PSshuangquan_niepan)return!1},save:!0,result:{player:function(e){return e.hp<=0||e.hp<=2&&e.countCards("he")<=1?10:0}},threaten:function(e,a){if(!a.storage.PSshuangquan_niepan)return.6}},intro:{content:"limited"},sub:!0},more:{trigger:{global:"gameDrawBegin"},forced:!0,popup:!1,silent:!0,content:function(){var e="function"==typeof trigger.num?trigger.num(player):trigger.num;e*=2,event.num=trigger.num,trigger.num=function(a){return a==player?e:"function"==typeof event.num?event.num(a):event.num}},sub:!0},damage:{audio:"ol_wuqian",trigger:{source:"damageBegin1",player:["recoverBegin","damageBegin4"]},forced:!0,content:function(){"damageBegin4"==event.triggername?trigger.num=Math.floor(trigger.num/2):trigger.num+=trigger.num},sub:!0},again:{trigger:{player:"useCardAfter"},filter:function(r,t,i){return"PSshuangquan_again"!=r.getParent(2).name&&(!(!r.card||0==r.card.length)&&(e.type(r.card),!["shan","wuxie"].includes(r.card.name)&&n.findPlayer2(e=>{var n=a.card[r.card.name];if(n.autoViewAs){if(t.canUse({card:r.card,name:n.autoViewAs},e,!1))return!0}else if(t.canUse(r.card,e,!1))return!0;return!1})))},forced:!0,content:function(){var e=n.createCard2(trigger.card),r=a.card[e.name];r.autoViewAs?player.chooseUseTarget([e],{name:r.autoViewAs},!1):player.chooseUseTarget(e,!1)},ai:{threaten:2},sub:!0},add:{audio:"reyingzi",trigger:{player:"phaseDrawBegin"},forced:!0,filter:function(e,a){return!e.numFixed},content:function(){trigger.num+=trigger.num},ai:{threaten:1.3},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSshouyige:"双倍收益哥",PSshuangquan:"双全",PSshuangquan_info:"锁定技。<br/>①你视为拥有技能〖马术〗〖飞影〗和〖无双〗。<br/>②你使用【杀】可以额外指定一名目标。<br/>③你造成的所有伤害翻倍，你受到的所有伤害减半（向上取整）。<br/>④你拥有双倍的初始手牌。摸牌阶段，你额外摸等量的牌。<br/>⑤你使用牌后，额外使用对应实体卡牌（不嵌套触发）。<br/>⑥当你不因此技能获得的回合结束后，你执行一个额外的回合。<br/>⑦限定技，当你即将阵亡时，终止此次结算，然后你将体力上限调整为8，再将体力值回复至体力上限。<br/>⑧游戏开始时，你获得等量的装备区副类别栏。<br/>⑨你回复体力时，回复效果翻倍。<br/>⑩你使用【铁索连环】时可额外指定两名目标，使用单体普通锦囊牌时可额外指定一名目标。"},rank:c.legend},PSrexusheng:{info:{sex:"male",group:"wu",hp:4,skills:["PSpojun"],dieAudios:["re_xusheng"],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSpojun:{shaRelated:!0,audio:"repojun",trigger:{player:"useCardToPlayered"},direct:!0,filter:function(e,a){return"sha"==e.card.name&&e.target.hp>0&&e.target.countCards("he")>0},content:function(){player.say(["闹够了没有？","你犯大吴疆土了！"].randomGet());var a=player.gainPlayerCard(trigger.target,"he",[1,Math.min(trigger.target.hp,trigger.target.countCards("he"))],e.prompt("repojun",trigger.target),"visibleMove");a.set("ai",function(a){if(!r.event.goon)return 0;var n=e.value(a.link);return a.link==r.event.target.getEquip(2)?2*(n+3):n}),a.set("goon",e.attitude(player,trigger.target)<=0),a.set("forceAuto",!0)},group:"repojun3"}},sort:u.PScharacter_wu,translate:{PSrexusheng:"PS徐盛",PSpojun:"破军",PSpojun_info:"当你使用【杀】指定目标后，你可以获得其至多X张牌（X为其体力值）。当你因执行【杀】的效果而对一名角色造成伤害时，若该角色的手牌数和装备区内的牌数均不大于你，则此伤害+1。"},rank:c.rare},PSsunquan:{info:{sex:"male",group:"wu",hp:4,skills:["PSzhiheng","rejiuyuan"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",replace:["PSsunquan","PShw_sunquan","PSquansun","db_PSdaweiwuwang","PSxie_sunquan"],skills:{PSzhiheng:{audio:"rezhiheng",inherit:"rezhiheng",group:"PSzhiheng_else",subSkill:{else:{trigger:{target:"useCardToTarget"},popup:!1,log:!1,usable:1,prompt2:function(){return a.translate.PSzhiheng_info},check:function(){return!0},filter:function(e,a){return!e.addedTargets&&(1==e.targets.length&&a.countDiscardableCards(a,"he")>0)},async cost(a,n,r){const{cards:t,bool:i}=await r.chooseToDiscard([1,1/0],"he",!1).set("ai",()=>1).set("prompt",e.prompt("PSzhiheng")).forResult();a.result={bool:i,cards:t,cost_data:{hs:r.getCards("h")}}},async content(e,a,n){const r=e.cost_data.hs;n.logSkill("PSzhiheng");let t=0;r.every(a=>e.cards.includes(a))&&(t=1),await n.draw(e.cards.length+t)},sub:!0}},ai:{order:1,result:{player:1},threaten:1.55}}},sort:u.PScharacter_wu,translate:{PSsunquan:"PS孙权",PSzhiheng:"制衡",PSzhiheng_info:"①出牌阶段限一次/②每回合限一次，当你成为一名角色使用牌的唯一目标时，你可以弃置任意张牌并摸等量的牌，若你在发动此技能时弃置了所有手牌，则你多摸一张牌。"},rank:c.rare},PScaocao:{info:{sex:"male",group:"wei",hp:4,skills:["PSjianxiong","rehujia"],isZhugong:!0,dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",replace:["PScacao","PShr_caocao"],skills:{PSjianxiong:{audio:"rejianxiong",audioname:["shen_caopi"],trigger:{target:"useCardToAfter"},filter:function(a,n){return a.player!=n&&a.cards.length&&["o","d"].includes(e.position(a.cards[0]))},content:function(){"cards"==e.itemtype(trigger.cards)&&"o"==e.position(trigger.cards[0],!0)&&player.gain(trigger.cards,"gain2"),player.draw("nodelay")},ai:{maixie:!0,maixie_hp:!0,effect:{target:function(a,n,t){if(n.hasSkillTag("jueqing",!1,t))return[1,-1];if(e.tag(a,"damage")&&n!=t){var i=a.cards,o=r.event;if(o.player==t&&"damage"==a.name&&"card"==o.getParent().type&&(i=o.getParent().cards.filterInD()),t.hp<=1)return;if("cards"!=e.itemtype(i))return;for(var l of i)if("tao"==e.name(l,t))return[1,5];return e.value(i,t)>=7+t.getDamagedHp()?[1,3]:[1,.6]}}}}}},sort:u.PScharacter_wei,translate:{PScaocao:"PS曹操",PSjianxiong:"奸雄",PSjianxiong_info:"当一名其他角色使用牌指定你为目标，你可以于此牌对你结算后从处理区/弃牌堆中获得此牌并摸一张牌。"},rank:c.rare},PSdianwei:{info:{sex:"male",group:"wei",hp:4,skills:["PSqiangxi","PSsizhan"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSqiangxi:{audio:"qiangxi_ol_dianwei",enable:"phaseUse",usable:2,mark:!0,intro:{content:function(e,n){return`强袭造成${a.skill.PSqiangxi.getUseSkillTime(n)+1}点伤害`}},getUseSkillTime:e=>e.getAllHistory("useSkill",e=>"PSqiangxi"==e.skill).length,filter:function(e,r){return!(r.hp<1&&!r.hasCard(e=>a.skill.PSqiangxi.filterCard(e),"he"))&&n.hasPlayer(e=>a.skill.PSqiangxi.filterTarget(null,r,e))},filterCard:function(a){return"equip1"==e.subtype(a)},position:"he",filterTarget:function(e,a,n){if(n==a)return!1;var r=a.getStat()._PSqiangxi;return!r||!r.includes(n)},selectCard:function(){return r.event.player.hp<1?1:[0,1]},content:function(){var e=player.getStat();e._PSqiangxi||(e._PSqiangxi=[]),e._PSqiangxi.push(target),cards.length||player.damage("nosource","nocard");const n=a.skill.PSqiangxi.getUseSkillTime(player);target.damage("nocard",n),player.markSkill(event.name)},ai:{damage:!0,order:8,result:{player:function(a,n){return a.hasSkill("buqu")&&a.hasSkill("xinjuejing")||t.selected.cards.length?0:a.hp>=n.hp?-.9:a.hp<=2?-2:e.damageEffect(a,a,a)},target:function(n,r){const i=e.damageEffect(r,n,r)*a.skill.PSqiangxi.getUseSkillTime(n);return n.hasSkill("buqu")&&n.hasSkill("xinjuejing")?i:!t.selected.cards.length&&n.hp<2?0:i}},threaten:1.5}},PSsizhan:{audio:"cuijue",dutySkill:!0,locked:!1,derivation:["buqu","xinjuejing"],init:function(){n.changeSkillAudio("buqu","PSdianwei","juanjia"),n.changeSkillAudio("xinjuejing","PSdianwei","qiexie")},group:["PSsizhan_achieve","PSsizhan_fail","PSsizhan_defend"],subSkill:{defend:{audio:"cuijue",trigger:{player:"damageBegin4"},usable:1,filter:function(e,n){return a.skill.PSqiangxi.getUseSkillTime(n)>0},check:function(e,a){return e.num>1||a.hp<=1},prompt:"是否令此伤害-1，然后本局游戏〖强袭〗的发动次数-1？",content:function(){trigger.num--;const e=player.actionHistory;for(let a=e.length-1;a>=0;a--)if(e[a].useSkill.some(e=>e.skill.includes("PSqiangxi"))){const n=e[a].useSkill.findLastIndex(e=>e.skill.includes("PSqiangxi"));e[a].useSkill.splice(n,1);break}r.currentPhase===player&&player.getStat().skill.PSqiangxi--,player.markSkill("PSqiangxi")},sub:!0,_priority:0},achieve:{audio:"cuijue",trigger:{source:"dieAfter"},forced:!0,skillAnimation:!0,animationColor:"fire",filter:function(e,a){return!0},content:function(){n.log(player,"成功完成使命"),player.awakenSkill("PSsizhan"),player.loseMaxHp(2),player.addSkills(["buqu","xinjuejing"])},sub:!0,_priority:0},fail:{audio:"cuijue",trigger:{player:"dying"},forced:!0,content:function(){n.log(player,"使命失败"),player.awakenSkill("PSsizhan"),player.recoverTo(player.maxHp);for(let e=0;e<player.actionHistory.length;e++)player.actionHistory[e].useSkill=player.actionHistory[e].useSkill.filter(e=>"PSqiangxi"!=e.skill);r.currentPhase===player&&delete player.getStat().skill.PSqiangxi,player.markSkill("PSqiangxi")},sub:!0,_priority:0}},_priority:0}},sort:u.PScharacter_wei,translate:{PSdianwei:"PS典韦",PSqiangxi:"强袭",PSqiangxi_info:"出牌阶段限两次。你可以弃置一张武器牌或受到1点无来源伤害，然后对一名本回合内未成为过〖强袭〗目标的其他角色造成X点伤害。（X为你本局游戏发动此技能的次数）",PSsizhan:"死战",PSsizhan_info:"使命技。①每回合限一次，当你受到伤害时，若你本局发动过〖强袭〗的次数不为0，你可以令此伤害-1，然后本局游戏〖强袭〗发动次数-1。②使命:杀死一名角色。③成功：你减2点体力上限，然后获得技能〖不屈〗和〖绝境〗。④失败:当你于使命达成前进入濒死状态，你将体力值回复至体力上限，然后重置〖强袭〗的发动次数。"},rank:c.rare},PSzhangjiao:{info:{sex:"male",group:"qun",hp:3,skills:["PSleiji","guidao","huangtian"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSleiji:{audio:"releiji",audioname:["boss_qinglong"],trigger:{global:["useCard","respond"]},filter:function(e,a){return"shan"==e.card.name},direct:!0,content:function(){player.chooseTarget(e.prompt2("releiji"),function(e,a,n){return n!=a}).ai=function(a){return a.hasSkill("hongyan")?0:e.damageEffect(a,r.event.player,r.event.player,"thunder")},result.bool?(player.logSkill("releiji",result.targets,"thunder"),event.target=result.targets[0],event.target.judge(function(a){var n=e.suit(a);return"spade"==n?-4:"club"==n?-2:0}).judge2=function(e){return 0==e.bool}):event.finish(),"club"==result.suit?(event.target.damage("thunder"),player.recover()):"spade"==result.suit&&event.target.damage(2,"thunder")},ai:{useShan:!0,effect:{target:function(a,r,t,i){if(e.tag(a,"respondShan")){var o=n.hasPlayer(function(a){return e.attitude(t,a)<0}),l=t.countCards("e",{color:"black"});return t.countCards("h","shan")&&l?t.hasSkill("guidao")?[0,o?t.countCards("he")/2:0]:0:t.countCards("h","shan")&&t.countCards("h")>2?t.hasSkill("guidao")?[0,o?t.countCards("h")/4:0]:0:t.countCards("h")>3||l&&t.countCards("h")>=2?[0,0]:0==t.countCards("h")?[1.5,0]:1!=t.countCards("h")||l?t.hasSkill("guidao")?[1,Math.min(.5,(t.countCards("h")+l)/4)]:[1,.05]:[1.2,0]}}}}}},sort:u.PScharacter_qun,translate:{PSzhangjiao:"PS张角",PSleiji:"雷击",PSleiji_info:"当一名角色使用或打出一张【闪】时，你可令一名其他角色进行一次判定：若结果为梅花，其受到一点雷电伤害，然后你回复一点体力；若结果为黑桃，其受到两点雷电伤害。"},rank:c.rare},PSsunshangxiang:{info:{sex:"female",group:"wu",hp:3,skills:["PSxiaoji","PSjieyin"],dieAudios:[],trashBin:[]},intro:"由“九个鲨雕”设计",replace:["PSsunshangxiang","PSshu_sunshangxiang"],skills:{PSxiaoji:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},frequent:!0,filter:function(e,a,n){if("equipAfter"==n&&e.player==a)return!0;var r=e.getl(a);return r&&r.player==a&&r.es&&r.es.length>0},content:function(){"equipAfter"==event.triggername&&trigger.player==player&&player.draw(r.currentPhase==player?1:3),event.count=trigger.getl(player).es.length,event.count||event.finish(),event.count--,player.draw(r.currentPhase==player?1:3),event.count>0&&(player.chooseBool(e.prompt2("xiaoji")).set("frequentSkill","xiaoji").ai=a.filter.all),result.bool&&(player.logSkill("xiaoji"),event.goto(1))},ai:{noe:!0,reverseEquip:!0,effect:{target:function(a,n,r,t){if("equip"==e.type(a)&&!e.cardtag(a,"gifts"))return[1,3]}}},_priority:0},PSjieyin:{audio:"rejieyin",enable:"phaseUse",filterCard:!0,usable:1,position:"he",filter:function(e,a){return a.countCards("he")>0},check:function(a){var t=r.event.player;if("e"==e.position(a)){var i=e.subtype(a);return n.hasPlayer(function(a){return a!=t&&a.hp!=t.hp&&e.attitude(t,a)>0&&!a.countCards("e",{subtype:i})})?t.countCards("h",{subtype:i})?20-e.value(a):10-e.value(a):0}return t.countCards("e")||t.countCards("h",{type:"equip"})?0:8-e.value(a)},filterTarget:function(a,n,r){return!!r.hasSex("male")&&(!!(a=t.selected.cards[0])&&!("e"==e.position(a)&&!r.canEquip(a)))},discard:!1,delay:!1,lose:!1,content:function(){"e"==e.position(cards[0])?event._result={index:0}:"equip"==e.type(cards[0])&&target.canEquip(cards[0])?player.chooseControl().set("choiceList",["将"+e.translation(cards[0])+"置入"+e.translation(target)+"的装备区","弃置"+e.translation(cards[0])]).ai=function(){return 1}:event._result={index:1},0==result.index?(player.$give(cards,target,!1),target.equip(cards[0])):player.discard(cards),[player,target].forEach(e=>{e.hp<e.maxHp?e.recover():e.draw()})},ai:{order:function(){for(var a=r.event.player,n=a.getCards("e"),t=0;t<n.length;t++)if(a.countCards("h",{subtype:e.subtype(n[t])}))return 10;return 2},result:{target:function(a,n){var r=function(){for(var n=a.getCards("e"),r=0;r<n.length;r++)if(a.countCards("h",{subtype:e.subtype(n[r])}))return!0;return!1};return a.hp<n.hp?a.isHealthy()?!a.needsToDiscard(1)||r()?.1:0:1.5:a.hp>n.hp?n.isHealthy()?!a.needsToDiscard(1)||r()?.1:0:1:0}}},_priority:0}},sort:u.PScharacter_wu,translate:{PSsunshangxiang:"PS孙尚香",PSxiaoji:"枭姬",PSxiaoji_info:"当一张装备牌进入或离开你的装备区后，你可以摸一张牌，若当前回合角色不是你，你改为摸三张牌。",PSjieyin:"结姻",PSjieyin_info:"出牌阶段限一次，你可以选择一名男性角色并弃置一张手牌或将装备区内的一张装备牌置于其装备区，你与其之中体力值等于体力上限的角色摸一张牌，体力值小于体力上限的角色摸一张牌的角色回复1点体力。","#ext:PS武将/audio/skill/PSxiaoji1":"小女就爱这舞刀弄枪。","#ext:PS武将/audio/skill/PSxiaoji2":"小看我，你可是要吃亏的。"},rank:c.junk},PSliuzan:{info:{sex:"male",group:"wu",hp:4,skills:["PSfenyin"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSfenyin:{audio:"fenyin",trigger:{player:"useCard"},frequent:!0,locked:!1,preHidden:!0,filter:function(e,a){return r.currentPhase==a&&a.getHistory("useCard").length<=5},content:function(){player.draw(player.getHistory("useCard").length)}}},sort:u.PScharacter_wu,translate:{PSliuzan:"PS留赞",PSfenyin:"奋音",PSfenyin_info:" 你的回合内，当你使用第X张牌时，你摸X张牌。（X最多为5）"},rank:c.rare},PSyuanshu:{info:{sex:"male",group:"qun",hp:4,skills:["rewangzun","retongji","PSjiwei"],dieAudios:[],trashBin:[]},intro:"由“梦舞灬愁”设计",skills:{PSjiwei:{audio:"weidi",trigger:{source:"damageAfter"},forced:!0,skillAnimation:!0,animationColor:"thunder",filter:function(e,a){return"zhu"!=a.identity&&"zhu"==e.player.identity&&n.zhu&&n.zhu.isZhu&&"sha"==e.card.name},logTarget:function(){return[n.zhu]},content:function(){var e=player.identity;n.zhu.identity=e,n.zhu.setIdentity(e),n.zhu.identityShown=!1,n.zhu.update(),player.identity="zhu",player.showIdentity(),player.update(),delete n.zhu.isZhu,n.zhu=player,player.gainMaxHp(),player.recover()}},PSqifan:{mode:["identity"],trigger:{global:"gameStart"},forced:!0,content:function(){delete n.zhu.isZhu,player.identity="zhu",player.setIdentity("zhu"),player.identityShown=!0,n.zhu=player;for(var a=e.players(!1,!0),r=0;r<a.length;r++)a[r]!=player&&(a[r].identity="fan",a[r].setIdentity("fan"),a[r].identityShown=!0)}}},sort:u.PScharacter_qun,translate:{PSyuanshu:"骷髅王",PSjiwei:"继位",PSjiwei_info:"锁定技，当你对主公使用【杀】造成伤害后，若你的身份不是主公，你与主公交换身份，然后增加一点体力上限并回复一点体力。",PSqifan:"七反",PSqifan_info:"锁定技，游戏开始时，你的身份更改为主公，你令其他角色的身份更改为反贼且明置。"},rank:c.rare},PSzhanghe:{info:{sex:"male",group:"wei",hp:4,skills:["PSqiaobian"],dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSqiaobian:{audio:"reqiaobian",group:["PSqiaobian_judge","PSqiaobian_draw","PSqiaobian_use","PSqiaobian_discard"],preHidden:!0,subSkill:{judge:{audio:2,trigger:{player:"phaseJudgeBefore"},prompt:"###是否发动【巧变·判定】？###摸一张牌跳过判定阶段",filter:function(e,a){return!(!e.isOnline()&&!e.isMine())},content:function(){player.draw(),player.logSkill("qiaobian"),trigger.cancel()},sub:!0},draw:{audio:2,trigger:{player:"phaseDrawBegin1"},prompt:"###是否发动【巧变·摸牌】？###摸一张牌跳过摸牌阶段，并选择获得其他一至两名角色的各一张手牌",filter:function(e,a){return!e.numFixed},content:function(){var a;a=n.countPlayer(function(a){return a!=player&&a.countCards("h")&&e.attitude(player,a)<=0})>=2,player.draw(),player.chooseTarget("获得其他一至两名角色的各一张手牌",[1,2],function(e,a,n){return n.countCards("h")>0&&a!=n},function(a){if(!r.event.aicheck)return 0;var n=e.attitude(r.event.player,a);return a.hasSkill("tuntian")?n/10:1-n}).set("aicheck",a),result.bool?(player.logSkill("reqiaobian",result.targets),player.gainMultiple(result.targets),trigger.cancel()):event.finish(),n.delay()},ai:{threaten:2,expose:.3},sub:!0},use:{audio:2,trigger:{player:"phaseUseBefore"},prompt:"###是否发动【巧变·出牌】？###摸一张牌跳过出牌阶段，并选择移动场上一张牌",content:function(){player.canMoveCard()&&(n.hasPlayer(function(a){return e.attitude(player,a)>0&&a.countCards("j")})||!(player.countCards("h")>player.hp+1)&&player.countCards("h",{name:["wuzhong"]})),player.draw(),trigger.cancel(),player.moveCard(),player.logSkill("qiaobian")},ai:{expose:.2},sub:!0},discard:{audio:2,trigger:{player:"phaseDiscardBefore"},prompt:"###是否发动【巧变·弃牌】？###摸一张牌跳过弃牌阶段",content:function(){player.draw(),player.logSkill("reqiaobian"),trigger.cancel()},sub:!0}},ai:{threaten:3}}},sort:u.PScharacter_wei,translate:{PSzhanghe:"PS张郃",PSqiaobian:"巧变",PSqiaobian_info:"你可以摸一张牌并跳过自己的一个阶段(准备阶段和结束阶段除外)；若你以此法跳过了摸牌阶段，则你可以获得至多两名其他角色的各一张手牌；若你以此法跳过了出牌阶段，则你可以移动场上的一张牌。"},rank:c.rare},PSsh_zhangfei:{info:{sex:"male",group:"shu",hp:4,skills:["PSshihuang","PSpaoxiao"],dieAudios:["zhangfei"],trashBin:[]},intro:"由“风龙散人”设计",skills:{PSshihuang:{audio:"sbpaoxiao",trigger:{global:["loseAfter","loseAsyncAfter"]},frequent:!0,filter:function(a,n){if(a.player===n||["useCard","respond"].includes(a.getParent().name))return!1;for(var r of a.cards)if("d"==e.position(r,!0))return!0;return!1},content:function(){0==trigger.delay&&n.delay();for(var a=[],r=0;r<trigger.cards.length;r++)"d"==e.position(trigger.cards[r])&&a.push(trigger.cards[r]);a.length&&player.gain(a,"gain2","log")},ai:{effect:{target:function(a,n,r){if(e.tag(a,"respond")&&r.countCards("h")>1)return[1,.2]}}}},PSpaoxiao:{audio:"paoxiao",firstDo:!0,audioname:["re_zhangfei","guanzhang","xiahouba"],trigger:{player:"useCard1"},forced:!0,intro:{content:"本回合已使用#张杀"},onremove:!0,init:function(e,a){e.storage[a]||(e.storage[a]=1)},filter:function(e,a){return!e.audioed&&"sha"==e.card.name&&a.countUsed("sha",!0)>1&&"phase"==e.getParent().type},content:function(){player.addMark("PSpaoxiao",1),trigger.audioed=!0},mod:{cardUsable:function(e,a,n){if("sha"==e.name)return 1/0}},group:["PSpaoxiao_cancel","PSpaoxiao_remove"],subSkill:{cancel:{audio:"keji",audioname:["re_lvmeng","sp_lvmeng"],trigger:{player:"phaseDiscardBefore"},forced:!0,frequent:function(e,a){return a.needsToDiscard()},filter:function(e,a){return a.countUsed("sha",!0)<=n.countPlayer()},content:function(){trigger.cancel()},sub:!0},remove:{trigger:{player:"phaseJieshuBegin"},forced:!0,filter:function(e,a){return a.countMark("PSpaoxiao")>=1},content:function(){player.storage.PSpaoxiao=0},sub:!0}},ai:{unequip:!0,skillTagFilter:function(a,n,r){return!!e.zhu(a,"shouyue")&&!(!r||"sha"!=r.name)}}}},sort:u.PScharacter_shu,translate:{PSsh_zhangfei:"拾荒张飞",PSshihuang:"拾荒",PSshihuang_info:"每当其他角色有牌非因使用或打出进入弃牌堆时，你可以获得之。",PSpaoxiao:"咆哮",PSpaoxiao_info:"锁定技，出牌阶段，你使用【杀】没有数量限制。当你于回合内使用的【杀】数量不大于X，则你跳过你的弃牌阶段。（X为当前场上存活的人数）"},rank:c.epic},PStongxiangge:{info:{sex:"male",group:"shu",hp:4,skills:["PStongxiang"],dieAudios:["maliang"],trashBin:[]},intro:"由“九个芒果”设计",skills:{PStongxiang:{audio:"zishu",trigger:{global:"gainAfter"},frequent:!0,filter:function(e,a){var n=e.getParent("phaseDraw");return(!n||"phaseDraw"!=n.name)&&e.player!=a},content:function(){player.draw("nodelay",trigger.cards.length)},group:"PStongxiang_discard",subSkill:{discard:{audio:"zishu",frequent:!1,trigger:{player:"loseAfter"},filter:function(a,n){if("discard"!=a.type)return!1;for(var r of a.cards)if("d"==e.position(r,!0))return!0;return!1},filterTarget:function(e,a,n){return a!=n&&n.countCards("he")>=1},selectTarget:1,content:function(){player.chooseTarget("令一名其他角色弃置等量的牌",function(e,a,n){return a!=n&&n.countDiscardableCards(a,"he")}).set("ai",function(a){return e.attitude(r.event.player,a)<0}),result.bool?result.targets[0].chooseToDiscard(!0,"he",trigger.cards.length):event.finish()},sub:!0}}}},sort:u.PScharacter_shu,translate:{PStongxiangge:"同甘共苦哥",PStongxiang:"同享",PStongxiang_info:"当其他角色于摸牌阶段外获得牌后，你可以摸等量的牌；当你的牌因弃置进入弃牌堆时，你可以令一名其他角色弃置等量的牌。"},rank:c.epic},PSrs_wolong:{info:{sex:"male",group:"shu",hp:3,skills:["PSranshang","bazhen","rehuoji","rekanpo","cangzhuo"],dieAudios:["sp_zhugeliang"],trashBin:[]},intro:"由“宫愿合”设计",skills:{PSranshang:{audio:"ranshang",trigger:{source:"damageEnd"},filter:function(e,a){return e.hasNature("fire")&&e.player.isAlive()},prompt:"是否令目标获得等量的“燃”标记",check:function(a,n){return e.attitude(n,a.player)<0},content:function(){trigger.player.randomDiscard(),trigger.player.addMark("PSranshang",trigger.num),trigger.player.addSkill("PSranshang_lose",trigger.num)},intro:{name2:"燃",content:"mark"},ai:{effect:{player:function(a,r,t,i){return"sha"==a.name&&(n.hasNature(a,"fire")||r.hasSkill("zhuque_skill"))||e.tag(a,"fireDamage")&&i<0?2:void 0}}},marktext:"燃",subSkill:{lose:{audio:"ranshang2",trigger:{player:"phaseJieshuBegin"},forced:!0,filter:function(e,a){return a.countMark("PSranshang")>0},content:function(){player.loseHp(player.countMark("PSranshang"))},sub:!0}}}},sort:u.PScharacter_shu,translate:{PSrs_wolong:"燃伤卧龙",PSranshang:"燃伤",PSranshang_info:"当你对一名角色造成火焰伤害后，你可以令目标随机弃置一张牌，并获得等同于伤害数的“燃”标记；有“燃”的角色结束阶段开始时，其失去X点体力。（X为“燃”标记的数量）"},rank:c.junk},PShuanggai:{info:{sex:"male",group:"wu",hp:4,skills:["PSkurou","zhaxiang"],dieAudios:[],trashBin:[]},intro:"由“闹够没有界徐盛”设计",skills:{PSkurou:{audio:"rekurou",enable:"phaseUse",filterCard:!0,check:function(a){return 8-e.value(a)},position:"he",content:function(){player.loseHp()},ai:{order:8,result:{player:function(a){return e.effect(a,{name:"losehp"},a,a)}}}}},sort:u.PScharacter_wu,translate:{PShuanggai:"PS黄盖",PSkurou:"苦肉",PSkurou_info:"出牌阶段，你可以弃置一张牌，然后失去1点体力。"},rank:c.rare},PSxushao:{info:{sex:"male",group:"qun",hp:4,skills:["PSpingjian"],dieAudios:[],trashBin:[]},intro:"由“宫愿合”设计",replace:["PSsb_xushao","PSxushao"],skills:{PSpingjian:{audio:"pingjian",trigger:{player:["phaseZhunbeiBegin","phaseDrawBegin2","damageEnd","phaseJieshuBegin","dying"]},initList:function(){var t=[];if(r.connectMode)t=e.charactersOL();else{t=[];for(var i in a.character)a.filter.characterDisabled2(i)||a.filter.characterDisabled(i)||t.push(i)}n.countPlayer2(function(e){t.remove(e.name),t.remove(e.name1),t.remove(e.name2),e.storage.rehuashen&&e.storage.rehuashen.character&&t.removeArray(e.storage.rehuashen.character)}),r.characterlist=t},frequent:!0,content:function(){if(player.storage.PSpingjian||(player.storage.PSpingjian=[]),event._result={bool:!0},result.bool){r.characterlist||a.skill.PSpingjian.initList();var e=[],t=[],i=[];r.characterlist.randomSort();for(var o=event.triggername,l=0;l<r.characterlist.length;l++){var s=r.characterlist[l];if(-1==s.indexOf("zuoci")&&-1==s.indexOf("xushao")){for(var u=a.character[s][3],c=0;c<u.length;c++)if(!player.storage.PSpingjian.includes(u[c]))if(t.includes(u[c])&&a.skill.PSfushi.characterList().includes(s))e.add(s),i[s]||(i[s]=[]),i[s].push(u[c]),t.add(u[c]);else{var g=[u[c]];n.expandSkills(g);for(var d=0;d<g.length;d++){var h=a.skill[g[d]];if(!(!h||!h.trigger||!h.trigger.player||h.silent||h.limited||h.juexingji||h.zhuanhuanji||h.hiddenSkill||h.dutySkill)&&((h.trigger.player==o||Array.isArray(h.trigger.player)&&h.trigger.player.includes(o))&&a.skill.PSfushi.characterList().includes(s))){if(h.init||h.ai&&(h.ai.combo||h.ai.notemp||h.ai.neg))continue;if(h.filter)try{if(!h.filter(trigger,player,o))continue}catch(p){continue}e.add(s),i[s]||(i[s]=[]),i[s].push(u[c]),t.add(u[c]);break}}}if(e.length>2)break}}t.length?player.chooseControl(t).set("dialog",["请选择要发动的技能",[e,"character"]]).set("ai",function(){return 0}):event.finish()}else event.finish();"摸一张牌"!=result.control?(player.storage.PSpingjian.add(result.control),"phaseDrawBegin2"==event.triggername?player.addTempSkill(result.control,"phaseDrawEnd"):"phaseZhunbeiBegin"==event.triggername?player.addTempSkill(result.control,"phaseZhunbei"):"damageEnd"==event.triggername?player.addTempSkill(result.control,"damageAfter"):"phaseJieshuBegin"==event.triggername?player.addTempSkill(result.control,"phaseJieshu"):player.addTempSkill(result.control,"dyingAfter")):player.draw()},group:"pingjian_use",phaseUse_special:["xinfu_lingren"]}},sort:u.PScharacter_qun,translate:{PSxushao:"PS许劭",PSpingjian:"评荐",PSpingjian_info:"准备阶段开始时/摸牌阶段开始时/结束阶段开始时/当你受到伤害后/当你进入濒死状态时/出牌阶段限一次，你可以令系统随机从剩余武将牌堆中检索出三张拥有发动时机为准备阶段开始时/摸牌阶段开始时/结束阶段开始时/当你受到伤害后/进入濒死状态时/出牌阶段的技能的武将牌。然后你可以选择尝试发动其中一个技能。每个技能每局只能选择一次。",PSpingjian_use:"评荐"},rank:c.epic},PScaoxiu:{info:{sex:"male",group:"wei",hp:4,skills:["PSqianju","PSqingxi"],dieAudios:[],trashBin:[]},intro:"由“SC雁微凉”设计",skills:{PSqianju:{mod:{globalFrom:function(e,a,n){return n-Math.max(1,e.getDamagedHp())},globalTo:function(e,a,n){return n+Math.max(1,a.getDamagedHp())},cardname:function(e,n,r){if("equip3"==a.card[e.name].subtype||"equip4"==a.card[e.name].subtype||"equip6"==a.card[e.name].subtype)return"sha"},cardnature:function(e){if("equip3"==a.card[e.name].subtype||"equip4"==a.card[e.name].subtype||"equip6"==a.card[e.name].subtype)return!1}},trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},content:function(){player.hasEnabledSlot(3)&&player.disableEquip(3),player.hasEnabledSlot(4)&&player.disableEquip(4)}},PSqingxi:{audio:"reqingxi",trigger:{player:"useCardToPlayer"},intro:{content:"本回合已发动#次【倾袭】"},init:function(e){e.storage.PSqingxi_damage=[]},filter:function(a,n){return!(n.storage.PSqingxi>=n.getAttackRange())&&("sha"==a.card.name||"trick"==e.type(a.card,!1)&&e.tag(a.card,"damage")>0)},check:function(a,n){return e.attitude(n,a.target)<0},logTarget:"target",content:function(){for(var e=0;e<trigger.targets.length;e++)player.discardPlayerCard(trigger.targets[e],"he",!1);player.addMark("PSqingxi",1),player.storage.PSqingxi_damage.add(trigger.card),n.log(trigger.card,"对",trigger.target,"造成的伤害+1"),n.delayx()},group:["PSqingxi_remove","PSqingxi_damage","PSqingxi_summer"],subSkill:{damage:{trigger:{source:"damageBegin1"},forced:!0,filter:function(e,a){return e.card&&a.storage.PSqingxi_damage.includes(e.card)},content:function(){trigger.num++},sub:!0},remove:{trigger:{player:"phaseUseEnd"},filter:function(e,a){return a.hasMark("PSqingxi")&&a.isAlive()},forced:!0,content:function(){player.removeMark("PSqingxi",player.countMark("PSqingxi"))},sub:!0},summer:{sub:!0,trigger:{player:"useCardAfter"},silent:!0,filter:function(e,a){return a==r.currentPhase&&a.storage.PSqingxi_damage.includes(e.card)},content:function(){player.storage.PSqingxi_damage.remove(trigger.card)},forced:!0,popup:!1}}}},sort:u.PScharacter_wei,translate:{PScaoxiu:"PS曹休",PSqianju:"千驹",PSqianju_info:"锁定技，游戏开始时，废除你的一个攻击马栏和防御马栏；你计算与其他角色之间的距离减X，其他角色计算与你之间的距离+X；你的坐骑牌均视为杀。（X为你当前已损失的体力值且至少为1）",PSqingxi:"倾袭",PSqingxi_info:"当你使用伤害类锦囊或杀指定一名其他角色时，你可以弃置其1张牌，若此牌造成伤害，该伤害+1；若本回合此技能的发动次数等于你的攻击范围，你令此技能失效直到本回合结束。"},rank:c.rare},PSshen_zhuge:{info:{sex:"male",group:"shen",hp:3,skills:["PSqixing","PSkuangfeng","PSdawu"],dieAudios:["shen_zhugeliang"],trashBin:[]},intro:"由“欧文哈尔”设计",skills:{PSqixing:{audio:"qixing",unique:!0,trigger:{global:"phaseBefore",player:["enterGame","phaseZhunbeiBegin"]},forced:!0,filter:function(e,a){return a.getExpansions("PSqixing").length<7&&("phase"!=e.name||0==n.phaseNumber)},content:function(){var a=player.getExpansions("PSqixing").length;player.addToExpansion(e.cards(7-a),"draw").gaintag.add("PSqixing");var t=player.getExpansions("PSqixing");if(t.length&&player.countCards("h")){var i=player.chooseToMove("七星：是否交换“星”和手牌？");if(i.set("list",[[e.translation(player)+"（你）的星",t],["手牌区",player.getCards("h")]]),i.set("filterMove",function(e,a){return"number"!=typeof a}),i.set("processAI",function(a){var n=r.event.player,t=a[0][1].concat(a[1][1]).sort(function(a,n){return e.useful(a)-e.useful(n)});return[t.splice(0,n.getExpansions("PSqixing").length),t]}),result.bool){var o=result.moved[0],l=result.moved[1];if(o.removeArray(player.getExpansions("PSqixing")),l.removeArray(player.getCards("h")),!o.length||o.length!=l.length)return;player.addToExpansion(o,player,"giveAuto").gaintag.add("PSqixing"),n.log(player,"将",o,"作为“星”置于武将牌上"),player.gain(l,"gain2")}}else event.finish()},intro:{markcount:"expansion",mark:function(a,r,t){if((r=t.getExpansions("PSqixing"))&&r.length){if(t!=n.me&&!t.isUnderControl())return"共有"+e.cnNumber(r.length)+"张星";a.addAuto(r)}},content:function(a,r){if((a=r.getExpansions("PSqixing"))&&a.length)return r==n.me||r.isUnderControl()?e.translation(a):"共有"+e.cnNumber(a.length)+"张星"}},group:["PSqixing_draw"],ai:{combo:"PSdawu"},subSkill:{draw:{trigger:{player:"phaseDrawAfter"},direct:!0,filter:function(e,a){return a.getExpansions("PSqixing").length>0&&a.countCards("h")>0},content:function(){var a=player.getExpansions("PSqixing");if(a.length&&player.countCards("h")){var t=player.chooseToMove("七星：是否交换“星”和手牌？");if(t.set("list",[[e.translation(player)+"（你）的星",a],["手牌区",player.getCards("h")]]),t.set("filterMove",function(e,a){return"number"!=typeof a}),t.set("processAI",function(a){var n=r.event.player,t=a[0][1].concat(a[1][1]).sort(function(a,n){return e.value(a)-e.value(n)});return[t.splice(0,n.getExpansions("PSqixing").length),t]}),result.bool){var i=result.moved[0],o=result.moved[1];if(i.removeArray(player.getExpansions("PSqixing")),o.removeArray(player.getCards("h")),!i.length||i.length!=o.length)return;player.logSkill("PSqixing_draw"),player.addToExpansion(i,player,"giveAuto").gaintag.add("PSqixing"),n.log(player,"将",i,"作为“星”置于武将牌上"),player.gain(o,"gain2")}}else event.finish()},sub:!0}}},PSkuangfeng:{audio:"kuangfeng",trigger:{player:"phaseJieshuBegin"},direct:!0,filter:function(e,a){return a.getExpansions("PSqixing").length},content:function(){var a=Math.min(n.countPlayer(),player.getExpansions("PSqixing").length);if(player.chooseTarget(e.prompt("PSkuangfeng"),"令至多"+e.cnNumber(a)+"名角色获得“狂风”标记",[1,a]).ai=function(e){return-1},result.bool){var r=result.targets.sortBySeat();player.logSkill("PSkuangfeng",r,"fire");var t=r.length;r.forEach(e=>{e.addAdditionalSkill(`PSkuangfeng_${player.playerid}`,"PSkuangfeng_storage"),e.markAuto("PSkuangfeng_storage",[player])}),player.addTempSkill("PSkuangfeng_damage",{player:"phaseUseEnd"}),player.chooseCardButton("选择弃置"+e.cnNumber(t)+"张“星”",t,player.getExpansions("PSqixing"),!0)}else event.finish();player.loseToDiscardpile(result.links)},ai:{combo:"PSqixing"},subSkill:{storage:{charlotte:!0,intro:{content:function(e){return`共有${e.length}枚标记`}},ai:{effect:{target:function(a,n,r,t){if(e.tag(a,"fireDamage")&&t<0)return 1.5}}},_priority:0},damage:{trigger:{global:"damageBegin3"},filter:function(e,a){return e.hasNature("fire")&&e.player.getStorage("PSkuangfeng_storage").includes(a)},charlotte:!0,forced:!0,logTarget:"player",content:function(){trigger.num++},onremove:function(e){n.countPlayer2(a=>{a.getStorage("PSkuangfeng_storage").includes(e)&&(a.unmarkAuto("PSkuangfeng_storage",e),a.removeAdditionalSkill(`PSkuangfeng_${e.playerid}`))},!0)},_priority:0}}},PSdawu:{trigger:{player:"phaseJieshuBegin"},direct:!0,filter:function(e,a){return a.getExpansions("PSqixing").length},audio:"dawu",content:function(){var a=Math.min(n.countPlayer(),player.getExpansions("PSqixing").length);if(player.chooseTarget(e.prompt("PSdawu"),"令至多"+e.cnNumber(a)+"名角色获得“大雾”标记",[1,a]).set("ai",function(a){if(a.isMin())return 0;if(a.hasSkill("biantian2"))return 0;var n=e.attitude(player,a);return n>=4?r.event.allUse||1==a.hp?n:2==a.hp&&a.countCards("he")<=2?.7*n:0:-1}).set("allUse",player.getExpansions("PSqixing").length>=2*n.countPlayer(function(a){return e.attitude(player,a)>4})),result.bool){var t=result.targets.sortBySeat();player.logSkill("PSdawu",result.targets,"thunder");var i=t.length;t.forEach(e=>{e.addAdditionalSkill(`PSdawu_${player.playerid}`,"PSdawu_storage"),e.markAuto("PSdawu_storage",[player])}),player.addTempSkill("PSdawu_damage",{player:"phaseUseEnd"}),player.chooseCardButton("选择弃置"+e.cnNumber(i)+"张“星”",i,player.getExpansions("PSqixing"),!0)}else event.finish();player.loseToDiscardpile(result.links)},ai:{combo:"PSqixing"},subSkill:{storage:{charlotte:!0,ai:{nofire:!0,nodamage:!0,effect:{target:function(a,n,r,t){if(e.tag(a,"damage")&&!e.tag(a,"thunderDamage"))return"zeroplayertarget"}}},intro:{content:function(e){return`共有${e.length}枚标记`}},_priority:0},damage:{trigger:{global:"damageBegin4"},filter:function(e,a){return!e.hasNature("thunder")&&e.player.getStorage("PSdawu_storage").includes(a)},forced:!0,charlotte:!0,logTarget:"player",content:function(){trigger.cancel()},onremove:function(e){n.countPlayer2(a=>{a.getStorage("PSdawu_storage").includes(e)&&(a.unmarkAuto("PSdawu_storage",e),a.removeAdditionalSkill(`PSdawu_${e.playerid}`))},!0)},_priority:0}}}},sort:u.PScharacter_shen,translate:{PSshen_zhuge:"PS神诸葛亮",PSqixing:"七星",PSqixing_info:"游戏开始时/准备阶段开始时，若你的“星”少于7，你将牌堆顶的牌至于你的武将牌上，称之为“星”，你的“星”至多为7。然后/摸牌阶段结束后，你可用任意数量的手牌等量交换这些“星”。",PSkuangfeng:"狂风",PSkuangfeng_info:"结束阶段，你可以弃置X张“星”并指定等量的角色：直到你的出牌阶段结束，该角色受到火焰伤害时，此伤害+1。",PSdawu:"大雾",PSdawu_info:"结束阶段，你可以弃置X张“星”并指定等量的角色：直到你的出牌阶段结束，当这些角色受到非雷电伤害时，防止此伤害。"},rank:c.rare},PShuangyueying:{info:{sex:"female",group:"shu",hp:3,skills:["PSjizhi","PSqicai"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSjizhi:{audio:"rejizhi",audioname:["lukang"],locked:!1,trigger:{player:"useCard"},forced:!0,filter:function(a){return e.cardNameLength(a.card)>=3},content:function(){event.cards=e.cards(2),player.showCards(event.cards,"集智");let a=[cards[0]];for(var r=1;r<cards.length;r++)e.cardNameLength(cards[r])>e.cardNameLength(a[0])?a=[cards[r]]:e.cardNameLength(cards[r])==e.cardNameLength(a[0])&&a.push(cards[r]);const t=a.randomGet();player.gain(t,"gain2"),n.cardsDiscard(cards.filter(e=>e!==t))},ai:{threaten:1.4,noautowuxie:!0},mod:{aiOrder:function(a,n,r){if(e.cardNameLength(n)>=3)return 13}}},PSqicai:{isUse:function(e){if("cardsDiscard"!=e.name)return!1;var a=e.getParent();if("orderingDiscard"!=a.name)return!1;var n=a.relatedEvent||a.getParent();return"phaseJudge"==n.name||"useCard"==n.name},mod:{targetInRange:function(a,n,r,t){if(e.cardNameLength(a)>=2)return!0},cardUsable:function(a,n,r){if(e.cardNameLength(a)>=1)return 1/0},maxHandcard:function(e,r){for(var i=0,o=n.getGlobalHistory("cardMove",function(e){return"lose"==e.name?e.position==t.discardPile:"cardsDiscard"==e.name}),l=o.length-1;l>=0;l--){var s=o[l],u=s.cards;u.length&&!a.skill.PSqicai.isUse(s)&&(i+=u.length)}return r+i}}}},sort:u.PScharacter_shu,translate:{PShuangyueying:"PS黄月英",PSjizhi:"集智",PSjizhi_info:"锁定技，当你使用字数不小于3的牌时，你展示牌堆顶两张牌，获得其中字数较多的一张，若字数相同则改为随机获得其中一张，然后将其余的牌置入弃牌堆。",PSqicai:"奇才",PSqicai_info:"锁定技，你使用字数不小于2的牌无距离限制，使用字数不小于1的牌无次数限制，你的手牌上限+X。（X为本回合不因使用而进入弃牌堆的牌数）"},rank:c.rare},PSshen_ganning:{info:{sex:"male",group:"shen",hp:3,maxHp:6,skills:["drlt_poxi","PSjieying"],dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSjieying:{audio:"drlt_jieying",locked:!1,global:"PSjieying_mark",group:["PSjieying_1","PSjieying_2","PSjieying_3"],subSkill:{1:{audio:"drlt_jieying",trigger:{player:"phaseZhunbeiBegin"},forced:!0,filter:function(e,a){return!n.hasPlayer(function(e){return e.hasMark("PSjieying_mark")})},content:function(){player.addMark("PSjieying_mark",1)},sub:!0},2:{audio:"drlt_jieying",trigger:{player:"phaseJieshuBegin"},direct:!0,filter:function(e,a){return a.hasMark("PSjieying_mark")},content:function(){if(player.chooseTarget(e.prompt("drlt_jieying"),"将“营”交给一名角色；其摸牌阶段多摸一张牌，出牌阶段使用【杀】的次数上限+1且手牌上限+1。该角色回合结束后，其移去“营”标记，然后你获得其所有手牌。",function(e,a,n){return n!=a}).ai=function(a){return e.attitude(player,a)>0?.1:e.attitude(player,a)<1&&(a.isTurnedOver()||a.countCards("h")<1)?.2:e.attitude(player,a)<1&&a.countCards("h")>0&&a.countCards("j",{name:"lebu"})>0?.8*a.countCards("h")+.7*a.getHandcardLimit()+2:e.attitude(player,a)<1&&a.countCards("h")>0?.8*a.countCards("h")+.7*a.getHandcardLimit():1},result.bool){var a=result.targets[0];player.line(a),player.logSkill("drlt_jieying",a);var n=player.countMark("PSjieying_mark");player.removeMark("PSjieying_mark",n),a.addMark("PSjieying_mark",n)}},sub:!0},3:{audio:"drlt_jieying",trigger:{global:"phaseUseBegin"},forced:!0,filter:function(e,a){return a!=e.player&&e.player.hasMark("PSjieying_mark")&&e.player.isAlive()},logTarget:"player",content:function(){trigger.player.countCards("h")>0&&trigger.player.give(trigger.player.getCards("h"),player),trigger.player.removeMark("PSjieying_mark",trigger.player.countMark("PSjieying_mark"))},sub:!0},mark:{marktext:"营",intro:{name:"营",content:"mark"},mod:{cardUsable:function(e,a,r){if(a.hasMark("PSjieying_mark")&&"sha"==e.name)return r+n.countPlayer(function(e){return e.hasSkill("PSjieying")})},maxHandcard:function(e,a){if(e.hasMark("PSjieying_mark"))return a+n.countPlayer(function(e){return e.hasSkill("PSjieying")})}},audio:"drlt_jieying",trigger:{player:"phaseDrawBegin2"},forced:!0,filter:function(e,a){return!e.numFixed&&a.hasMark("PSjieying_mark")&&n.hasPlayer(function(e){return e.hasSkill("PSjieying")})},content:function(){trigger.num+=n.countPlayer(function(e){return e.hasSkill("PSjieying")})},ai:{nokeep:!0,skillTagFilter:function(e){if(!e.hasMark("PSjieying_mark"))return!1}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSshen_ganning:"PS神甘宁",PSjieying:"劫营",PSjieying_info:"回合开始时，若场上没有拥有“营”标记的角色，你获得1个“营”标记；结束阶段，你可以将你的一个“营”标记交给一名角色；有“营”标记的角色摸牌阶段多摸一张牌，出牌阶段使用【杀】的次数上限+1，手牌上限+1。有“营”的其他角色出牌阶段开始时，其移去“营”标记，然后你获得其所有手牌。"},rank:c.epic},PSguanning:{info:{sex:"male",group:"qun",hp:3,maxHp:7,skills:["PSdunshi"],dieAudios:[],trashBin:[]},intro:"由“杯糕萍琪派”设计",skills:{PSdunshi:{audio:"dunshi",enable:["chooseToUse","chooseToRespond"],usable:1,hiddenCard:function(e,n){return!e.getStorage("PSdunshi").includes(n)&&!e.getStat("skill").PSdunshi&&a.inpile.includes(n)},init:function(e,a){e.storage[a]||(e.storage[a]=[[],0])},marktext:"席",mark:!0,intro:{markcount:function(e){return e[1]},content:function(n,r){if(n){var t="<li>";return n[0].length?a.inpile.length===n[0].length?t+="已删除所有牌名":t+=`已删除牌名：${e.translation(n[0])}`:t+="暂无已删除牌名",t+="<br><li>“席”标记数量：",t+=n[1]}}},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];if(!r.storage.PSdunshi[0].includes(l))if("sha"==l)for(var s of(i.push(["基本","","sha"]),a.inpile_nature))i.push(["基本","","sha",s]);else"trick"==e.type(l)?i.push(["锦囊","",l]):"basic"==e.type(l)&&i.push(["基本","",l])}return 0==i.length?t.create.dialog("遁世已无可用牌"):t.create.dialog("遁世",[i,"vcard"])},filter:function(e,a){var n=r.event.getParent();return n.filterCard({name:e.link[2],isCard:!0},a,n)},check:function(e){var a=r.event.player;if(a.countCards("hs",e.link[2])>0)return 0;if("wugu"==e.link[2])return 0;var n=a.getUseValue(e.link[2]);return n>0?n:0},backup:function(e,a){return{audio:"dunshi",filterCard:function(){return!1},popname:!0,viewAs:{name:e[0][2],isCard:!0},selectCard:-1,precontent:function(){a.addTempSkill("PSdunshi_damage"),a.storage.PSdunshi_damage=event.result.card.name}}}},initList:function(n){var t,i=[];if("guozhan"==e.mode())for(var o in t=[],a.characterPack.mode_guozhan)t.push(o);else if(r.connectMode)t=e.charactersOL();else for(var o in t=[],a.character)a.filter.characterDisabled2(o)||a.filter.characterDisabled(o)||t.push(o);for(var o of t)if(0!=o.indexOf("gz_jun"))for(var l of a.character[o][3])if("bolan"!=l){var s=a.skill[l];if(s&&!s.zhuSkill&&!s.dutySkill&&!a.skill.bolan.banned.includes(l)&&!(s.init||s.ai&&(s.ai.combo||s.ai.notemp||s.ai.neg))){var u=a.translate[l+"_info"];u&&-1!=u.indexOf("出牌","受伤","结束")&&i.add(l)}}r.PSdunshi_list=i},ai:{respondSha:!0,respondShan:!0,skillTagFilter:function(e,a,t){if(e.getStat("skill").dunshi)return!1;switch(a){case"respondSha":return"phase"!=r.event.type||e==n.me||e.isUnderControl()||e.isOnline();case"respondShan":return;case"save":return t==e||void 0}},order:2,result:{player:function(a){return"dying"==r.event.type?e.attitude(a,r.event.dying):1}}},subSkill:{backup:{audio:"dunshi",sub:!0},damage:{audio:"dunshi",trigger:{global:"damageBegin2"},forced:!0,charlotte:!0,filter:function(e,a){return e.source==r.currentPhase},onremove:!0,logTarget:"source",content:function(){event.cardname=player.storage.PSdunshi_damage,player.removeSkill("PSdunshi_damage"),event.target=trigger.source,event.videoId=a.status.videoId++;var i=function(e,n,r,i){var o=["防止即将对"+i+"造成的伤害，并令"+e+"获得一个技能描述中包含“出牌/受伤/结束”的技能","从〖遁世〗中删除【"+r+"】并获得一枚“席”","减1点体力上限，然后摸等同于“席”数的牌"],l=t.create.dialog("遁世：请选择两项");l.videoId=n;for(var s=0;s<o.length;s++){var u='<div class="popup text" style="width:calc(100% - 10px);display:inline-block">';u+=o[s],u+="</div>";var c=l.add(u);c.firstChild.addEventListener(a.config.touchscreen?"touchend":"click",t.click.button),c.firstChild.link=s,Object.setPrototypeOf(c,a.element.Button.prototype),l.buttons.add(c.firstChild)}return l};player.isOnline2()&&player.send(i,e.translation(trigger.source),event.videoId,e.translation(event.cardname),e.translation(trigger.player)),event.dialog=i(e.translation(trigger.source),event.videoId,e.translation(event.cardname),e.translation(trigger.player)),(player!=n.me||r.auto)&&(event.dialog.style.display="none");var o=player.chooseButton();for(var l of(o.set("dialog",event.videoId),o.set("forced",!0),o.set("selectButton",2),o.set("ai",function(a){var n=r.event.player;switch(a.link){case 0:return e.attitude(n,r.currentPhase)>0?3:0;case 1:return 1;case 2:var i=n.storage.PSdunshi[1];for(var o of t.selected.buttons)1==o.link&&i++;return i>0&&n.isDamaged()?2:0}}),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),event.links=result.links.sort(),event.links))n.log(player,"选择了","#g【遁世】","的","#y选项"+e.cnNumber(l+1,!0));if(event.links.includes(0)){trigger.cancel(),r.PSdunshi_list||a.skill.PSdunshi.initList();var s=r.PSdunshi_list.filter(function(e){return!target.hasSkill(e,null,null,!1)}).randomGets(4);if(0==s.length)event.goto(3);else{event.videoId=a.status.videoId++;i=function(n,r,i){var o=t.create.dialog("forcebutton");o.videoId=r,o.add("令"+e.translation(i)+"获得一个技能");for(var l=0;l<n.length;l++)o.add('<div class="popup pointerdiv" style="width:80%;display:inline-block"><div class="skill">【'+e.translation(n[l])+"】</div><div>"+a.translate[n[l]+"_info"]+"</div></div>");o.addText(" <br> ")};player.isOnline()?player.send(i,s,event.videoId,target):player==n.me&&i(s,event.videoId,target),player.chooseControl(s).set("ai",function(){var e=r.event.controls;return e.includes("cslilu")?"cslilu":e[0]})}}else event.goto(3);n.broadcastAll("closeDialog",event.videoId),target.addSkills(result.control);var u=player.storage.PSdunshi;event.links.includes(1)&&(u[0].add(event.cardname),u[1]++,player.markSkill("PSdunshi")),event.links.includes(2)&&(player.loseMaxHp(),u[1]>0&&player.draw(u[1]))},sub:!0}}}},sort:u.PScharacter_qun,translate:{PSguanning:"PS管宁",PSdunshi:"遁世",PSdunshi_info:"每回合限一次。你可以视为使用或打出一张即时牌，然后当前回合角色于本回合内下一次造成伤害时，你选择两项：<br/>⒈防止此伤害。系统从技能描述中包含“出牌/受伤/结束”字样的技能中随机选择4个其未拥有的技能，然后你令当前回合角色获得其中一个技能。<br/>⒉从〖遁世〗中删除你本次使用或打出的牌并获得一个“席”。<br/>⒊减1点体力上限并摸X张牌（X为你的“席”数）。"},rank:c.epic},PSzhaoxiang:{info:{sex:"female",group:"shu",hp:4,skills:["refanghun","PSfushi"],dieAudios:["ext:PS武将/audio/die:true"],trashBin:[]},intro:"由“神鬼高达”设计",substitute:[["PSzhaoxiang2",["ext:PS武将/image/character/PSzhaoxiang2.jpg","die:ext:PS武将/audio/die:true"]]],skills:{PSfushi:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"phaseJieshuBegin"},skillAnimation:!0,animationColor:"orange",filter:function(e,a){return a.countMark("fanghun")>=0},characterList:function(){function e(e){return e.replace(/<[^>]+>/g,"")}function n(e=!1){if(e){let e=[];for(let n in a.characterPack)a.characterPack.hasOwnProperty(n)&&e.push(n);return e}{let e=[];for(let n in a.character)a.character.hasOwnProperty(n)&&e.push(n);return e}}function r(n=[]){let r=[];for(let t of n)for(let n in a.characterPack)if(a.characterPack.hasOwnProperty(n)&&(e(a.translate[`${n}_character_config`])===t||a.translate[`${n}_character_config`].includes("extension/")&&a.translate[`${n}_character_config`].includes(t))){r.push(n);break}return r}a.config.extension_PS武将_PScharacters=a.config.extension_PS武将_PScharacters||[],a.config.extension_PS武将_PSremoveCharacters=a.config.extension_PS武将_PSremoveCharacters||[],a.config.extension_PS武将_PSaddCharacter=a.config.extension_PS武将_PSaddCharacter||[],a.config.extension_PS武将_PSremoveCharacter=a.config.extension_PS武将_PSremoveCharacter||[];let t=[],i=[];t=a.config.extension_PS武将_PScharacters.length?r(a.config.extension_PS武将_PScharacters):n(!0);let o=r(a.config.extension_PS武将_PSremoveCharacters);t.removeArray(o);for(let l of t)for(let e in a.characterPack[l])a.characterPack[l].hasOwnProperty(e)&&i.push(e);return i.addArray(a.config.extension_PS武将_PSaddCharacter),i.removeArray(a.config.extension_PS武将_PSremoveCharacter),i.length||(i=n()),i.removeArray(a.skill.PShuashen.banned),i},chooseToFuHan:function(){var i=event.list1,o=event.list2,l=function(i,o){var l=r.event;if(l._result||(l._result={}),l._result.skills=[],n.TLHasExt("十周年")){var s=document.getElementById("dui-controls");s&&s.classList.add("Tlao_confirmdown2")}l.initbg=t.create.div(".Tlao_initbg",document.body),l.initbg.addEventListener(a.config.touchscreen?"touchend":"click",function(){n.TLremoveSkillInfo()},!0);var u=t.create.div(".Tlao_init",l.initbg);u.addEventListener(a.config.touchscreen?"touchend":"click",function(){n.TLremoveSkillInfo()},!0),n.TLHasExt("十周年")||(u.style.transform="translate(-50%,-90%)"),t.create.div(".Tlao_inittishi",u).textContent=l.topic,n.TLCreateStand(player,u,266,1);var c=t.create.div("",u);c.style.cssText='width:586px;height:216px;top:33px;right:60px;positon:"absolute";';for(var g=l.list2.flat(),d=0,h=0;h<l.list1.length;h++){var p=h*(104-4*i.length)+35*(8-i.length)+35;n.TLCreateHead(l.list1[h],c,68,p,12);for(var f=0;f<l.list2[h].length;f++){var S=t.create.div(".Tlao_skillnode",c);(e.info(o[h][f]).limited||e.info(o[h][f]).juexingji)&&S.classList.add("Tlao_skillnodelimit"),S.link=g[d],d++,S.textContent=e.translation(l.list2[h][f]),S.style.left=p-3+"px",S.style.top=84+40*f+"px",S.addEventListener(a.config.touchscreen?"touchend":"click",function(){this.style.animation="initbutton 0.2s forwards",this.addEventListener("animationend",function(){this.style.animation=""}),n.TLremoveSkillInfo(),this.classList.contains("Tlao_initselected")?(this.classList.remove("Tlao_initselected"),l._result.skills.remove(this.link)):this.classList.contains("Tlao_initselected2")?(this.classList.remove("Tlao_initselected2"),l._result.skills.remove(this.link)):(l._result.skills.length<l.total&&(this.classList.contains("Tlao_skillnodelimit")?this.classList.add("initselected2"):this.classList.add("Tlao_initselected"),l._result.skills.push(this.link)),n.TLcreateSkillInfo(this.link,l.initbg))},!0)}}var y=t.create.div("",u);y.style.cssText='width:100%;height:20px;left:0;bottom:0;text-align:center;font-family:"yuanli";font-size:20px;line-height:18px;color:#f1dfcc;filter: drop-shadow(1px 0 0 #664934) drop-shadow(-1px 0 0 #664934) drop-shadow(0 1px 0 #664934) drop-shadow(0 -1px 0 #664934);transform:translateY(220%);letter-spacing:3px;pointer-events:none;',y.textContent="请选择"+e.cnNumber(l.total)+"个武将技能",l.switchToAuto=function(){if(n.TLHasExt("十周年")){var e=document.getElementById("dui-controls");e&&e.classList.remove("Tlao_confirmdown2")}l.initbg.remove(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){if(n.TLHasExt("十周年")){var a=document.getElementById("dui-controls");a&&a.classList.remove("Tlao_confirmdown2")}l.initbg.remove(),l.control.close(),n.resume(),r.imchoosing=!1}),n.pause(),n.countChoose()};event.isMine()?l(i,o):event.isOnline()?(event.player.send(l,i,o),event.player.wait(),n.pause()):function(){r.imchoosing=!1;for(var e=o.flat(),n=0;n<e.length;n++)a.skill[e[n]].ai&&a.skill[e[n]].ai.combo&&e.remove(e[n]);event._result={bool:!0,skills:e.randomGets(event.total)},event.initbg&&event.initbg.close(),event.control&&event.control.close()}();var s=event.result||result;if(s&&s.skills&&s.skills.length)for(var u of s.skills)player.addSkills(u);n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},s.skills)},content:function(){var i;if(player.changeSkin("PSfushi","PSzhaoxiang2"),a.character.PSzhaoxiang.dieAudios=["ext:PS武将/audio/die/PSzhaoxiang2.mp3"],event.num=player.storage.fanghun,player.draw(event.num),player.removeMark("fanghun",player.storage.fanghun),r.characterlist){i=[];for(var o=0;o<r.characterlist.length;o++){var l=r.characterlist[o];a.skill.PSfushi.characterList().includes(l)&&i.push(l)}}else i=r.connectMode?e.charactersOL(function(e){return!a.skill.PSfushi.characterList().includes(e)}):e.gainableCharacters(function(e,n){return a.skill.PSfushi.characterList().includes(n)});var s=n.players.concat(n.dead);for(o=0;o<s.length;o++)i.remove(s[o].name),i.remove(s[o].name1),i.remove(s[o].name2);i.remove("zhaoyun"),i.remove("re_zhaoyun"),i.remove("ol_zhaoyun"),i.remove("JX_zhaoxiang"),i.remove("zhaoxiang"),i.remove("tw_zhaoxiang"),i=i.randomGets(8);var u=[];for(var o of(player.isUnderControl()&&n.swapPlayerAuto(player),i))u.addArray(a.character[o][3]||[]);if(i.length&&u.length){var c=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog(`请选择获得至多${e.cnNumber(3)}个技能`,[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=3)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?c(i,u):event.isOnline()?(event.player.send(c,i,u),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:u.randomGets(3)},event.dialog&&event.dialog.close(),event.control&&event.control.close());var g=event.result||result;if(g&&g.skills&&g.skills.length)for(var o of g.skills)player.addSkills(o);n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},g.skills),player.isMinHp()&&player.recover()}else event.finish()}}},sort:u.PScharacter_shu,translate:{PSzhaoxiang:"PS赵襄",PSfushi:"扶世",PSfushi_info:"结束阶段开始时，你可以移去所有“梅影”标记并摸等量张牌，然后从8张武将牌中选择并获得至多3个技能。若此时你是体力值最低的角色，你回复1点体力。","#ext:PS武将/audio/skill/PSfanghun1":"凝傲雪之梅为魄，英魂长存，独耀山河万古明！","#ext:PS武将/audio/skill/PSfanghun2":"铸凌霜之寒成剑，青锋出鞘，斩尽天下不臣贼！","#ext:PS武将/audio/skill/PSfushi1":"逝者如斯，亘古长流，唯英烈之魂悬北斗而长存！","#ext:PS武将/audio/skill/PSfushi2":"赵氏之女，跪祈诸公勿渡黄泉，暂留人间，佑大汉万年！","#ext:PS武将/audio/die/PSzhaoxiang:die":"世受国恩，今当以身殉国。","#ext:PS武将/audio/skill/PSfanghun_PSzhaoxiang21":"当年明月凝霜刃，此日送尔渡黄泉！","#ext:PS武将/audio/skill/PSfanghun_PSzhaoxiang22":"已识万里乾坤大，何虑千山草木青。","#ext:PS武将/audio/skill/PSfushi_PSzhaoxiang21":"龙凤在侧，五虎在前，天命在汉，既寿永昌！","#ext:PS武将/audio/skill/PSfushi_PSzhaoxiang22":"人言为信，日月为明，言日月为证，佑大汉长明！","#ext:PS武将/audio/die/PSzhaoxiang2:die":"大厦将倾，空余泪两行。"},rank:c.epic},PSlukang:{info:{sex:"male",group:"wu",hp:4,skills:["drlt_qianjie","PSjueyan","drlt_poshi"],clans:["吴郡陆氏"],dieAudios:[],trashBin:[]},intro:"由“待我白衣为卿相”设计",skills:{PSjueyan:{audio:"drlt_jueyan",enable:"phaseUse",usable:1,init:function(e,a){n.changeSkillAudio("PSjizhi",e.name,"rejizhi_lukang")},derivation:"PSjizhi",filter:function(e,a){return a.hasEnabledSlot(1)||a.hasEnabledSlot(2)||a.hasEnabledSlot(5)||a.hasEnabledSlot("horse")},content:function(){switch(player.chooseToDisable(!0).set("ai",function(a,n,r){return r.includes("equip2")?"equip2":r.includes("equip1")&&n.countCards("h",function(a){return"sha"==e.name(a,n)&&n.hasUseTarget(a)})-n.getCardUsable("sha")>1?"equip1":r.includes("equip5")&&n.countCards("h",function(a){return"trick"==e.type2(a,n)&&n.hasUseTarget(a)})>1?"equip5":void 0}),result.control){case"equip1":player.addSkills("drlt_jueyan1");break;case"equip2":player.draw(3),player.addSkills("drlt_jueyan3");break;case"equip3_4":player.addSkills("drlt_jueyan2");break;case"equip5":player.addSkills("PSjizhi")}},ai:{order:13,result:{player:function(a){return a.isDisabled("equip2")?!a.isDisabled("equip1")&&a.countCards("h",function(n){return"sha"==e.name(n,a)&&a.hasValueTarget(n)})-a.getCardUsable("sha")>1||!a.isDisabled("equip5")&&a.countCards("h",function(n){return"trick"==e.type2(n,a)&&a.hasUseTarget(n)})>1?1:-1:1}}}}},sort:u.PScharacter_wu,translate:{PSlukang:"PS陆抗",PSjueyan:"决堰",PSjueyan_info:"出牌阶段限一次，你可以废除一种装备栏，然后执行对应一项：武器栏，你使用【杀】的次数上限+3；防具栏，你摸三张牌，且手牌上限+3；坐骑栏，你使用牌无距离限制；宝物栏，你获得〖集智〗。"},rank:c.rare},PSliru:{info:{sex:"male",group:"qun",hp:3,skills:["PSjuece","remieji","xinfencheng"],dieAudios:["re_liru"],trashBin:[]},intro:"由“欧文哈尔”设计",skills:{PSjuece:{audio:"rejuece",enable:"phaseUse",filter:function(a,r){return!!(r.awakenedSkills.includes("xinfencheng")||r.awakenedSkills.includes("fencheng")||r.awakenedSkills.includes("dcfencheng"))&&r.hasCard(function(a){return"sha"==e.name(a)&&n.hasNature(a,"fire")||"huogong"==e.name(a)},"h")},filterCard:function(a){return"sha"==e.name(a)&&n.hasNature(a,"fire")||"huogong"==e.name(a)},selectCard:1,discard:!0,content:function(){player.awakenedSkills.includes("xinfencheng")&&player.restoreSkill("xinfencheng"),player.awakenedSkills.includes("fencheng")&&player.restoreSkill("fencheng"),player.awakenedSkills.includes("dcfencheng")&&player.restoreSkill("dcfencheng"),n.log(player,"重置了","#g【焚城】")},group:"rejuece"}},sort:u.PScharacter_qun,translate:{PSliru:"PS李儒",PSjuece:"绝策",PSjuece_info:"出牌阶段，你可以弃置一张【火杀】或【火攻】，然后重置技能〖焚城〗。结束阶段，你可以对一名本回合内失去过牌的角色造成1点伤害。"},rank:c.junk},PScaoang:{info:{sex:"male",group:"wei",hp:4,skills:["PSkangkai"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“10万原石”设计",skills:{PSkangkai:{audio:"kaikang",trigger:{global:"useCardToTargeted"},filter:function(a,n){return e.tag(a.card,"damage")>0&&a.target.isIn()},check:function(a,n){return e.attitude(n,a.target)>=0},logTarget:"target",content:function(){player.draw(),player.chooseTarget(1,"选择一名角色，令其将一张牌交给"+e.translation(trigger.target),!0,function(e,a,n){return n!=trigger.target}).ai=function(a){return r.event.aicheck?-e.attitude(player,a):0},result.bool&&result.targets&&result.targets.length&&(event.targets=result.targets,event.targets[0].chooseCard("he",!1,1,"选择交给"+e.translation(trigger.target)+e.cnNumber(1)+"张牌，或失去一点体力").set("ai",function(a){return"e"==e.position(a)?-1:"shan"==a.name?1:"equip"==e.type(a)?.5:0})),result.bool&&result.cards&&result.cards.length?(event.targets[0].give(result.cards,trigger.target),event.card=result.cards[0]):event.targets[0].loseHp(),trigger.target.getCards("h").includes(card)&&"equip"==e.type(card)&&trigger.target.chooseUseTarget(card)},ai:{threaten:1.1},audioname2:{old_yuanshu:"weidi"}}},sort:u.PScharacter_wei,translate:{PScaoang:"PS曹昂",PSkangkai:"慷慨",PSkangkai_info:"当一名角色成为伤害类牌的目标后，你可以摸一张牌。若如此做，你选择一名除其外的角色，除非该角色交一张牌给对方，否则失去一点体力。若交出的是装备牌，该角色可以使用此牌。"},rank:c.rare},PSzuoci:{info:{sex:"male",group:"qun",hp:3,skills:["PShuashen","PSxinsheng"],dieAudios:[],trashBin:[]},filter:function(e){return"guozhan"!=e},intro:"由“九个芒果”设计",replace:["PSzuoci","PSshen_zuoci"],skills:{PShuashen:{unique:!0,audio:"rehuashen",trigger:{global:"phaseBefore",player:["enterGame","phaseBegin","phaseEnd","PShuashen"]},filter:function(e,a,r){return"phase"!=e.name||("phaseBefore"==r?0==n.phaseNumber:a.storage.PShuashen&&a.storage.PShuashen.character.length>0)},direct:!0,content:function(){event.num=1;var i=event.triggername;("phase"!=trigger.name||"phaseBefore"==i&&0==n.phaseNumber)&&(player.logSkill("PShuashen"),a.skill.PShuashen.addHuashens(player,3),event.logged=!0),r.noclearcountdown=!0,event.videoId=a.status.videoId++;var o=player.storage.PShuashen.character.slice(0),l=[];for(var s in player.storage.PShuashen,player.storage.PShuashen.map)l.addArray(player.storage.PShuashen.map[s]);event.cond="out","phaseBegin"==event.triggername&&(event.cond="in"),l.randomSort(),l.sort(function(a,n){return e.skillRank(n,event.cond)-e.skillRank(a,event.cond)}),event.aiSkills=l.slice(),event.aiChoice=l[0];var u="更换技能";if((event.aiChoice==player.storage.PShuashen.current2||e.skillRank(event.aiChoice,event.cond)<1||Math.random()<.3)&&(u="制衡化身"),player.isOnline2()&&player.send(function(e,n){t.create.dialog("是否发动【化身】？",[e,(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]).videoId=n},o,event.videoId),event.dialog=t.create.dialog(e.prompt("PShuashen"),[o,(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]),event.dialog.videoId=event.videoId,event.isMine()||(event.dialog.style.display="none"),!event.logged||event.isMine()||event.isOnline()?player.chooseControl("制衡化身","更换技能","cancel2").set("ai",function(){return r.event.choice}).set("choice",u):event._result={control:"更换技能"},event.control=result.control,"cancel2"==event.control)return player.isOnline2()&&player.send("closeDialog",event.videoId),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose(),event.dialog.close(),void event.finish();event.logged||(player.logSkill("PShuashen"),event.logged=!0);var c=player.chooseButton(!1).set("dialog",event.videoId);"制衡化身"==event.control?(c.set("selectButton",[1,2]),c.set("filterButton",function(e){return!0}),c.set("current",player.storage.PShuashen.current)):(c.set("ai",function(e){return player.storage.PShuashen.map[e.link].includes(r.event.choice)?2.5:1+Math.random()}),c.set("choice",event.aiChoice));var g="制衡化身"==event.control?"选择制衡至多两张化身":`选择要获得的第${e.cnNumber(event.num,!0)}个技能`,d=function(a,n){var r=e.idDialog(a);r&&(r.content.childNodes[0].innerHTML=n)};if(player.isOnline2()?player.send(d,event.videoId,g):event.isMine()&&d(event.videoId,g),!result.bool)return player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose(),void event.finish();if(result.bool&&"更换技能"===event.control){event.card=result.links[0];d=function(a,n){var r=e.idDialog(n);if(r)for(var t=0;t<r.buttons.length;t++)r.buttons[t].link==a?r.buttons[t].classList.add("selectedx"):r.buttons[t].classList.add("unselectable")};player.isOnline2()?player.send(d,event.card,event.videoId):event.isMine()&&d(event.card,event.videoId);var h=player.storage.PShuashen.map[event.card].slice(0).filter(e=>1===event.num||!player.additionalSkills.PShuashen.includes(e));h.push("返回"),player.chooseControl(h).set("choice",event.aiChoice).set("ai",function(){return r.event.choice})}else a.skill.PShuashen.removeHuashen(player,result.links.slice(0)),a.skill.PShuashen.addHuashens(player,result.links.length+1);let p=function(){let a=function(a){var n=e.idDialog(a);if(n)for(var r=0;r<n.buttons.length;r++)n.buttons[r].classList.remove("selectedx"),n.buttons[r].classList.remove("unselectable")};player.isOnline2()?player.send(a,event.videoId):event.isMine()&&a(event.videoId)};if("返回"==result.control)return p(),event._result={control:"更换技能"},void event.goto(1);let f=function(){player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose()};if("制衡化身"==event.control)return f(),void event.finish();{event.num++;var S=result.control;if(2===event.num){player.storage.PShuashen.current2,player.storage.PShuashen.current2=[S],player.removeAdditionalSkill("PShuashen");const a=e.idDialog(event.videoId);a&&a.buttons.forEach(e=>{const a=e.querySelector(".caption>.text");a.innerHTML.includes("✓</span>")&&(a.innerHTML=a.innerHTML.replaceAll('<span style="color:#0a9b43; text-shadow: rgba(0, 0, 0, 0.6) 0 0 2px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, black 0 0 1px">',"").replaceAll("✓</span>",""))})}else player.storage.PShuashen.current2.add(S);const a=e.idDialog(event.videoId);if(a){const n=a.buttons.find(e=>e.link===event.card);if(n){const a=n.querySelector(".caption>.text"),r="["+e.translation(result.control)+"]";a.innerHTML=a.innerHTML.replace(r,`<span style="color:#0a9b43; text-shadow: rgba(0, 0, 0, 0.6) 0 0 2px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, black 0 0 1px">${r}✓</span>`)}}player.additionalSkills.PShuashen&&player.additionalSkills.PShuashen.includes(S)||(player.addAdditionalSkill("PShuashen",S,!0),n.log(player,"获得了技能","#g【"+e.translation(S)+"】"),player.popup(S),player.syncStorage("PShuashen"),player.updateMarks("PShuashen"),event.num<=3?(event._result={control:"更换技能"},p(),event.aiSkills.remove(S),event.aiSkills.length?(event.aiSkills.randomSort(),event.aiSkills.sort(function(a,n){return e.skillRank(n,event.cond)-e.skillRank(a,event.cond)}),event.aiChoice=event.aiSkills[0]):event.aiChoice=S,event.goto(1)):f())}},init:function(e,n){e.storage[n]||(e.storage[n]={character:[],map:{}}),a.skill.PShuashen.player=e},banned:["lisu","sp_xiahoudun","PSxushao","PSsb_xushao","db_PSdaweiwuwang","PSzhaoxiang","PSmeng_liubei","xushao","jsrg_xushao","zhoutai","old_zhoutai","shixie","xin_zhoutai","dc_shixie","old_shixie"],bannedType:[],addHuashen:function(n){if(n.storage.PShuashen){r.characterlist||a.skill.pingjian.initList(),r.characterlist.randomSort();for(let t=0;t<r.characterlist.length;t++){let i=r.characterlist[t];if(!a.skill.PSfushi.characterList().includes(i))continue;if(-1!=i.indexOf("zuoci")||0==i.indexOf("key_")||0==i.indexOf("sp_key_")||a.skill.PShuashen.banned.includes(i)||n.storage.PShuashen.character.includes(i))continue;let o=a.character[i][3].filter(n=>!e.skillCategoriesOf(n).some(e=>a.skill.PShuashen.bannedType.includes(e)));if(o.length)return n.storage.PShuashen.character.push(i),n.storage.PShuashen.map[i]=o,r.characterlist.remove(i),i}}},addHuashens:function(r,t){for(var i=[],o=0;o<t;o++){var l=a.skill.PShuashen.addHuashen(r);l&&i.push(l)}i.length&&(r.syncStorage("PShuashen"),r.updateMarks("PShuashen"),n.log(r,"获得了",e.cnNumber(i.length)+"张","#g化身"),a.skill.PShuashen.drawCharacter(r,i))},removeHuashen:function(a,t){a.storage.PShuashen.character.removeArray(t),r.characterlist.addArray(t),n.log(a,"移去了",e.cnNumber(t.length)+"张","#g化身")},drawCharacter:function(r,t){n.broadcastAll(function(r,t){if(r.isUnderControl(!0)){for(var i=[],o=0;o<t.length;o++){var l="PShuashen_card_"+t[o];a.card[l]={fullimage:!0,image:"character:"+t[o]},a.translate[l]=e.rawName2(t[o]),i.push(n.createCard(l,"",""))}r.$draw(i,"nobroadcast")}},r,t)},$createButton:function(n,r,i,o,l){l=t.create.buttonPresets.character(n,"character",i,o);const s=a.character[n],u=s[3].filter(function(n){return!e.skillCategoriesOf(n).some(e=>a.skill.PShuashen.bannedType.includes(e))});if(u.length){const n=u.map(n=>{const r=a.skill.PShuashen.player;return r.additionalSkills.PShuashen&&r.additionalSkills.PShuashen.includes(n)?`<span style="color:#0a9b43; text-shadow: rgba(0, 0, 0, 0.6) 0 0 2px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, rgba(0, 0, 0, 0.6) 0 0 5px, black 0 0 1px">[${e.translation(n)}]✓</span>`:`[${e.translation(n)}]`}).join("<br>"),r=t.create.caption(`<div class="text" data-nature=${e.groupnature(s[1],"raw")}m style="font-family: ${a.config.name_font||"xinwei"},xinwei">${n}</div>`,l);r.style.left="2px",r.style.bottom="2px"}return l._customintro=function(n,r){const t=l.link,i=e.character(l.link);let o=e.translation(t);if(i){let a;o+=`&nbsp;&nbsp;${e.translation(i[0])}`;const n=e.is.double(t,!0);a=n?n.map(a=>e.translation(a)).join("/"):e.translation(i[1]),o+=`&nbsp;&nbsp;${a}`}n.add(o),a.characterTitle[l.link]&&n.addText(e.colorspan(a.characterTitle[l.link]));for(let l=0;l<u.length;l++)if(a.translate[u[l]+"_info"]){let r=a.translate[u[l]+"_ab"]||e.translation(u[l]).slice(0,2);a.skill[u[l]]&&a.skill[u[l]].nobracket?n.add('<div><div class="skilln">'+e.translation(u[l])+"</div><div>"+e.skillInfoTranslation(u[l])+"</div></div>"):n.add('<div><div class="skill">【'+r+"】</div><div>"+e.skillInfoTranslation(u[l])+"</div></div>"),a.translate[u[l]+"_append"]&&(n._place_text=n.add('<div class="text">'+a.translate[u[l]+"_append"]+"</div>"))}},l},mark:!0,intro:{onunmark:function(e,a){r.characterlist.addArray(e.character),e.character=[]},mark:function(n,r,t){if(r&&r.current&&n.addSmall([[r.current],(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]),r&&r.current2)for(var i=0;i<r.current2.length;i++)n.add('<div><div class="skill">【'+e.translation(a.translate[r.current2[i]+"_ab"]||e.translation(r.current2[i]).slice(0,2))+"】</div><div>"+e.skillInfoTranslation(r.current2[i],t)+"</div></div>");if(!r||!r.character.length)return"没有化身";t.isUnderControl(!0)?n.addSmall([r.character,(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]):n.addText("共有"+e.cnNumber(r.character.length)+"张“化身”")},content:function(a,n){return"共有"+e.cnNumber(a.character.length)+"张“化身”"},markcount:function(e,a){return e&&e.character?e.character.length:0}},group:"PShuashen_change",subSkill:{change:{audio:"rehuashen",enable:"phaseUse",usable:1,async content(i,o,l){r.noclearcountdown=!0,i.videoId=a.status.videoId++;const s=l.storage.PShuashen.character.slice(0);l.isOnline2()&&l.send(function(e,n){t.create.dialog("是否将性别和势力改为与一张“化身牌”相同？",[e,(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]).videoId=n},s,i.videoId),i.dialog=t.create.dialog("是否将性别和势力改为与一张“化身牌”相同？",[s,(e,n,r,t,i)=>a.skill.PShuashen.$createButton(e,n,r,t,i)]),i.dialog.videoId=i.videoId,i.isMine()||(i.dialog.style.display="none");const u=l.chooseButton(!1);u.set("dialog",i.videoId),u.set("filterButton",function(a){const{gender:n,group:r}=e.character(a.link),t=l.sex,i=l.group;return n!==t||r!==i}),u.set("current",l.storage.PShuashen.current),u.set("ai",function(e){const n=a.character[e.link],r=n[0],t=n[1];let i=1;return l.sex!==r&&i++,l.group!==t&&i++,i});const{bool:c,links:g}=await u.forResult();if(l.isOnline2()&&l.send("closeDialog",i.videoId),i.dialog.close(),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose(),c){i.card=g[0];const a=l.storage.PShuashen.current,r=e.character(i.card).sex;l.storage.PShuashen.current=i.card,n.broadcastAll(function(e,a,n){e.tempname.remove(n),e.tempname.add(a),e.sex=r},l,i.card,a,r),l.flashAvatar("PShuashen",i.card),n.log(l,"将性别变为了","#y"+e.translation(r)+"性");let t=e.character(i.card).group;if(e.is.double(i.card)){const{control:a}=await l.chooseControl(e.is.double(name,!0)).set("prompt","请选择你的势力");t=a}await l.changeGroup(t)}},sub:!0}},_priority:0},PSxinsheng:{unique:!0,audio:"rexinsheng",trigger:{player:"damageEnd"},frequent:!0,content:function(){event.num=trigger.num,a.skill.PShuashen.addHuashens(player,1),--event.num>0&&player.hasSkill(event.name)&&!e.is.blocked(event.name,player)?player.chooseBool(e.prompt2("PSxinsheng")).set("frequentSkill",event.name):event.finish(),result.bool&&player.hasSkill("PSxinsheng")&&(player.logSkill("PSxinsheng"),event.goto(1))},_priority:0}},sort:u.PScharacter_qun,translate:{PSzuoci:"PS左慈",PShuashen:"化身",PShuashen_info:"①游戏开始时，你随机获得三张未加入游戏的武将牌（均称为“化身牌”），然后你选择一项：1、制衡化身：弃置至多两张化身牌并获得等量+1张化身牌；2、更换技能：移除上次因化身获得的所有技能（若有），然后重新挑选化身牌上的至多三个技能。准备阶段或回合结束阶段开始时，你可以选择“制衡化身”或“更换技能”。<br/>②出牌阶段限一次，你可以将性别和势力改为与一张“化身牌”相同。",PSxinsheng:"新生",PSxinsheng_info:"当你受到一点伤害后，你可以获得一张“化身牌”。"},rank:c.epic},PSzhoutai:{info:{sex:"male",group:"wu",hp:4,skills:["PSbuqu","PSfenji"],dieAudios:[],trashBin:[]},intro:"由“欧文哈尔”设计",skills:{PSbuqu:{audio:"buqu",audioname:["key_yuri"],trigger:{player:"chooseToUseBefore"},forced:!0,preHidden:!0,filter:function(e,a){return"dying"==e.type&&a.isDying()&&e.dying==a&&!e.getParent()._PSbuqu},content:function(){trigger.getParent()._PSbuqu=!0;var a=e.cards()[0];event.card=a,player.addToExpansion(a,"gain2").gaintag.add("PSbuqu");var n=player.getExpansions("PSbuqu"),r=e.number(a);player.showCards(n,"不屈");for(var t=0;t<n.length;t++)if(n[t]!=a&&e.number(n[t])==r)return void player.loseToDiscardpile(a);trigger.cancel(),trigger.result={bool:!0},player.hp<=0&&player.recoverTo(1)},mod:{maxHandcard:function(e,a){if(e.getExpansions("PSbuqu").length)return a+e.getExpansions("PSbuqu").length},cardUsable:function(e,a,n){if("sha"==e.name&&a.getExpansions("PSbuqu").length)return n+a.getExpansions("PSbuqu").length}},group:"PSbuqu_draw",subSkill:{draw:{audio:"buqu",audioname:["sp_lvmeng"],trigger:{player:"phaseDrawBegin2"},frequent:!0,filter:function(e,a){return!e.numFixed&&a.getExpansions("PSbuqu").length},content:function(){trigger.num+=player.getExpansions("PSbuqu").length},ai:{threaten:1.3},sub:!0}},ai:{save:!0,mingzhi:!0,skillTagFilter:function(e,a,n){if(e!=n)return!1}},intro:{content:"expansion",markcount:"expansion"}},PSfenji:{audio:"fenji",trigger:{global:["gainAfter","loseAfter","loseAsyncAfter"]},direct:!0,filter:function(e,a){if("lose"==e.name)return!("discard"!=e.type||!e.player.isIn())&&((e.discarder||e.getParent(2).player)!=e.player&&!!e.getl(e.player).hs.length);if("gain"==e.name){if(e.giver||"_yongjian_zengyu"==e.getParent().name)return!1;var r=e.getg(e.player);return!!r.length&&n.hasPlayer(function(a){if(a==e.player)return!1;var n=e.getl(a).hs;for(var t of n)if(r.includes(t))return!0;return!1})}if("gain"==e.type){if(e.giver||!e.player||!e.player.isIn())return!1;var t=e.getl(e.player);return n.hasPlayer(function(a){if(a==e.player)return!1;var n=e.getg(a);for(var r of n)if(t.includes(r))return!0})}return"discard"==e.type&&(!!e.discarder&&n.hasPlayer(function(a){return a!=e.discarder&&e.getl(a).hs.length>0}))},content:function(){var a=[];if("gain"==trigger.name){var t=trigger.getg(trigger.player);a.addArray(n.filterPlayer(function(e){if(e==trigger.player)return!1;var a=trigger.getl(e).hs;for(var n of a)if(t.includes(n))return!0;return!1}))}else"loseAsync"==trigger.name&&"discard"==trigger.type?a.addArray(n.filterPlayer(function(e){return e!=trigger.discarder&&trigger.getl(e).hs.length>0})):a.push(trigger.player);event.targets=a.sortBySeat(),event.targets.length||event.finish();var i=a.shift();event.target=i;var o=player.getExpansions("PSbuqu").length?player.getExpansions("PSbuqu").length+2:2;i.isIn()?player.chooseBool(e.prompt("fenji",i),"失去1点体力，令该角色摸"+e.cnNumber(o)+"张牌").set("ai",function(){var a=r.event.getParent();return e.attitude(a.player,a.target)>4}):a.length>0?event.goto(1):event.finish(),result.bool?(player.logSkill("fenji",i),player.loseHp()):a.length>0?event.goto(1):event.finish();o=player.getExpansions("PSbuqu").length?player.getExpansions("PSbuqu").length+2:2;i.draw(o),a.length>0&&event.goto(1)}}},sort:u.PScharacter_wu,translate:{PSzhoutai:"PS周泰",PSbuqu:"不屈",PSbuqu_info:"锁定技，当你处于濒死状态时，你亮出牌堆顶的一张牌并置于你的武将牌上，称之为“创”。若此牌的点数与你武将牌上已有的“创”点数均不同，则你回复至1点体力。若点数相同，则将此牌置入弃牌堆。只要你的武将牌上有“创”，你的手牌上限/摸牌阶段摸牌数/〖奋激〗摸牌数/【杀】使用次数便+X（X为“创”的数量）。",PSfenji:"奋激",PSfenji_info:"当一名角色的手牌不因赠予或交给而被其他角色获得后，或一名角色的手牌被其他角色弃置后，你可以令其摸两张牌。"},dynamicTranslate:{PSfenji:function(a){var n=2;return a.getExpansions("PSbuqu").length&&(n+=a.getExpansions("PSbuqu").length),"当一名角色的手牌不因赠予或交给而被其他角色获得后，或一名角色的手牌被其他角色弃置后，你可以令其摸"+e.cnNumber(n)+"张牌。"}},rank:c.rare},PSerciyuan:{info:{sex:"male",group:"qun",hp:4,skills:["PSzanhe"],dieAudios:["yuantanyuanshang"],trashBin:[]},intro:"由“曙光乘舟访人间”设计",skills:{PSzanhe:{audio:"neifa",trigger:{source:"dieAfter"},direct:!0,mark:!0,init:function(e,a){e.storage[a]||(e.storage[a]=0)},intro:{content:"本轮已杀死#人"},content:function(){player.storage.PSzanhe++},mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+5},selectTarget:function(a,n,r){"sha"==a.name&&-1!=r[1]&&r[1]++,"trick"==e.type(a)&&-1!=r[1]&&(r[1]+=1/0)}},group:["PSzanhe_1","PSzanhe_2","PSzanhe_lose","PSzanhe_add"],subSkill:{1:{trigger:{player:"useCardAfter"},filter:function(e,a){return r.currentPhase==a},direct:!0,content:function(){player.countCards("he")?player.chooseCard("he","是否重铸至多两张牌",[1,2]).set("filterCard",(e,a)=>a.canRecast(e)).set("ai",function(a){return r.event.player,"tao"!=a.name&&"wuxie"!=a.name?1:5-e.value(a)}):event.finish(),result.bool&&(player.recast(result.cards),player.logSkill("PSzanhe"))},sub:!0},2:{trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},direct:!0,filter:function(e,a){if("PSzanhe_2"==e.getParent(2).name)return!1;if(a==r.currentPhase)return!1;if("gain"==e.name&&e.player==a)return!1;var n=e.getl(a);return n&&n.cards2&&n.cards2.length>0},content:function(){player.countCards("he")?player.chooseCard("he","是否重铸至多两张牌",[1,2]).set("filterCard",(e,a)=>a.canRecast(e)).set("ai",function(a){return r.event.player,"tao"!=a.name&&"wuxie"!=a.name?1:5-e.value(a)}):event.finish(),result.bool&&(player.recast(result.cards),player.logSkill("PSzanhe"))},sub:!0},lose:{trigger:{global:"roundStart"},direct:!0,filter:function(e,a){return a.storage.PSzanhe>0},content:function(){player.logSkill("PSzanhe"),player.storage.PSzanhe=0,player.countCards("he")<2?(player.loseHp(),event.finish()):player.chooseBool("暂和:弃置两张牌，或点击取消失去一点体力"),result.bool?player.chooseToDiscard("he",2,!0):player.loseHp()},sub:!0},add:{trigger:{player:"useCard1"},direct:!0,filter:function(r,t){var i=e.info(r.card,!1);return 0!=i.allowMultiple&&("wuzhong"==r.card.name&&!(!r.targets||i.multitarget||!n.hasPlayer(function(e){return!r.targets.includes(e)&&a.filter.targetEnabled2(r.card,t,e)&&a.filter.targetInRange(r.card,t,e)})))},content:function(){n.countPlayer(function(e){return!trigger.targets.includes(e)&&a.filter.targetEnabled2(trigger.card,player,e)&&a.filter.targetInRange(trigger.card,player,e)}),player.chooseTarget("暂和：是否为"+e.translation(trigger.card)+"增加任意个目标？",[1,1/0],function(e,n,t){var i=r.event.getTrigger();e=i.card;return!i.targets.includes(t)&&a.filter.targetEnabled2(e,n,t)&&a.filter.targetInRange(e,n,t)}).set("ai",function(a){var n=r.event.player,t=r.event.getTrigger().card;return e.effect(a,t,n,n)}),result.bool?player==n.me||player.isOnline()||n.delayx():event.finish();var t=result.targets.sortBySeat();player.logSkill("guowu_add",t),trigger.targets.addArray(t)},sub:!0}}}},sort:u.PScharacter_qun,translate:{PSerciyuan:"二次袁",PSzanhe:"暂和",PSzanhe_info:"①你于回合内使用牌或于回合外失去牌后，可以重铸两张牌；<br/>②你每阶段使用杀的次数＋5且目标＋1，你使用普通锦囊牌时目标可以指定任意名角色；<br/>③每轮结束时，若你杀死过其他角色，则你须流失一点体力或弃置两张牌。"},rank:c.rare},PSdahantianzi:{info:{sex:"male",group:"qun",hp:4,skills:["PSshengshi","PSluanshi","PSshanrang"],dieAudios:["liuxie"],isAiForbidden:!0,trashBin:[]},intro:"由“一剑光寒19州”设计",skills:{PSshengshi:{audio:"sphuangen",trigger:{global:"recoverAfter"},forced:!0,filter:function(e,a){return!r.dying.length},content:function(){for(var e=n.filterPlayer(),r=0;r<e.length;r++)e[r].loseHp(),n.delay();(e.sort(a.sort.seat),event.targets=e,event.num=0,player.line(e,"green"),num<event.targets.length)&&(event.targets[num].getCards("he").length?player.discardPlayerCard("he",event.targets[num],!0):event.targets[num].loseHp(),event.num++,event.redo())},ai:{threaten:4}},PSluanshi:{audio:"shiyuan",trigger:{target:"useCardToTarget"},forced:!0,filter:function(a,n){return(!a.card.storage||!a.card.storage.PSluanshi)&&(e.tag(a.card,"damage")>0&&n.isIn())},content:function(){var a=e.cards(3),r=0,t="失去体力";for(var i of(n.cardsGotoOrdering(a),a))r+=i.number;if(n.log(a,"点数和为",r),21!=r&&(t=r>21?"回复体力":"反弹效果"),player.showCards(a,"乱世：点数和为"+r+"，"+e.translation(player)+t),n.delay(2),r>21)player.recover();else if(21==r)player.loseHp();else{n.log(trigger.player);var o=trigger.player,l=trigger.getParent();l.triggeredTargets2.remove(player),l.targets.remove(player),l.targets.push(o)}},ai:{threaten:3}},PSshanrang:{audio:"sphantong",trigger:{player:["dying"]},unique:!0,forced:!0,skillAnimation:!0,animationStr:"禅让",animationColor:"orange",zhuSkill:!0,filter:function(e,a){return a.hasZhuSkill("PSshanrang")},content:function(){player.draw(2);var a=n.countPlayer(function(e){return player!=e&&e.countCards("h")>0});if(0==a?player.chooseTarget("禅让：选择一名角色进行“禅让”仪式",!0,function(e,a,n){return a!=n}).set("ai",function(a){var n=r.event.player;return-e.attitude(n,a)-e.attitude(n,n)}):event.goto(3),result.bool&&(event.target=result.targets[0],event.bool=!0,event.goto(5)),player.chooseTarget("禅让：选择一名角色进行拼点",!0,function(e,a,n){return a.canCompare(n)}).set("ai",function(a){var n=r.event.player,t=-e.attitude(n,a)-e.attitude(n,n),i=((r.event.num-1)/13)**a.countCards("h");return t+=2*i*e.attitude(n,n)+2*(1-i)*e.attitude(n,a)+1}).set("num",a),result.bool&&(event.target=result.targets[0],player.chooseToCompare(event.target)),result.bool||event.bool){var t=event.target;for(var i of["PSshengshi","PSluanshi","PSshanrang"])t.addSkills(i);t.storage.zhuSkill_PSshanrang="PSshanrang",t.identity="zhu",t.setIdentity("zhu"),t.identityShown=!0,n.zhu=t,n.zhu.update(),player.die()}else{var o=n.filterPlayer();for(i=0;i<o.length;i++)o[i].loseHp(),n.delay();player.die()}},ai:{threaten:3}}},sort:u.PScharacter_qun,translate:{PSdahantianzi:"大汉天子",PSshengshi:"盛世",PSshengshi_info:"锁定技，每当有角色回复体力后，若场上没有处于濒死状态的角色，你令每名角色失去一点体力并弃置其一张牌（若其没有牌，则改为其失去一点体力）。",PSluanshi:"乱世",PSluanshi_info:"锁定技，每当你成为伤害类牌的目标后，展示并弃置牌堆顶三张牌，若点数之和：<br/>① 大于21，你恢复一点体力；<br/>②等于21 ，你流失一点体力；<br/>③小于21，你令来源承受此效果。",PSshanrang:"禅让",PSshanrang_info:"主公技，锁定技，当你濒死时摸两张牌并与一名角色拼点，①若你赢则令其成为主公并获得〖盛世、乱世、禅让〗技能且你阵亡；②若你没赢则令全场流失一点体力且你阵亡。（若无法拼点则你选择一名其他角色令其执行效果① ）​"},rank:c.rare},PSnanhualaoxian:{info:{sex:"male",group:"qun",hp:3,skills:["PSyufeng","PStianshu","PSyinshi"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",replace:["PSnanhualaoxian","PSshen_nanhualaoxian"],skills:{PSyufeng:{audio:"yufeng",enable:"phaseUse",usable:2,filter:function(e,a){return n.roundNumber>0},content:function(){event.videoId=a.status.videoId++;var i=function(r,i){var o=["选项一：令一名角色摸五张牌，再将手牌弃置至体力上限数","选项二：选择两名角色调换座次","选项三：摸两张牌","选项四：选择至多三名角色各弃置其两张牌"],l=Math.min(4,n.roundNumber),s=t.create.dialog("御风：请选择一"+(n.roundNumber>1?"至"+e.cnNumber(l):"")+"项");s.videoId=i;for(var u=0;u<o.length;u++){var c='<div class="popup text" style="width:calc(100% - 10px);display:inline-block">';c+=o[u],c+="</div>";var g=s.add(c);g.firstChild.addEventListener(a.config.touchscreen?"touchend":"click",t.click.button),g.firstChild.link=u,Object.setPrototypeOf(g,a.element.Button.prototype),s.buttons.add(g.firstChild)}return s};player.isOnline2()&&player.send(i,player,event.videoId),event.dialog=i(player,event.videoId),(player!=n.me||r.auto)&&(event.dialog.style.display="none");var o=player.chooseButton();for(var l of(o.set("dialog",event.videoId),o.set("forced",!0),o.set("ai",function(t){var i=r.event.player;switch(t.link){case 0:return 2;case 1:return Math.max(.5,i.countCards("hs",function(a){return"sha"==e.name(a)&&i.hasValueTarget(a)})-i.getCardUsable({name:"sha"}))+Math.max.apply(Math,n.filterPlayer(function(e){return e!=i}).map(function(a){return e.damageEffect(a,i,i)}));case 2:return i.needsToDiscard()/4;case 3:return.8*Math.max.apply(Math,n.filterPlayer(function(e){return e!=i&&e.hasCard(n=>a.filter.canBeGained(n,e,i),"hej")}).map(function(a){return e.effect(a,{name:"shunshou_copy"},i,i)}))}}),n.roundNumber>1&&o.set("selectButton",[1,n.roundNumber]),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),result.links.sort(),result.links))n.log(player,"选择了","#g【御风】","的","#y选项"+e.cnNumber(1+l,!0));event.links=result.links;switch(event.count=-1,event.count++,event.links[event.count]){case 0:event.goto(3);break;case 1:event.goto(6);break;case 2:event.goto(8);break;case 3:event.goto(9);break;default:event.finish()}if(player.chooseTarget("御风：令一名角色摸五张牌，再将手牌弃置至其体力上限数",!1).set("ai",function(a){var n=e.attitude(r.event.player,a),t=5-a.countCards("h");return t>=0?(a.hasSkillTag("nogain")&&(n/=6),n>2?Math.sqrt(t+1)*n:n/3):t<-1&&(a.hasSkillTag("nogain")&&(n*=6),n<-2)?-Math.sqrt(1-t)*n:0}),result.bool){var s=result.targets[0];event.target=s,s.draw(5)}else event.goto(2);var u=s.countCards("h")-s.maxHp;if(u>0&&s.chooseToDiscard("h",!0,u),event.goto(2),player.chooseTarget(2,"选择两名角色，交换座次",!1,function(e,a,n){return!0}).set("ai",function(a){var n=r.event.player,t=e.attitude(n,a);return t<0?t-1:t}).set("targetprompt",["",""]),result.targets){var c=result.targets;n.broadcastAll(function(e,a){n.swapSeat(e,a)},c[0],c[1]),event.goto(2)}else event.goto(2);if(player.draw(2),event.goto(2),player.chooseTarget([1,3],"弃置至多三名角色各两张牌",!1,function(e,a,n){return!0}).set("ai",function(a){var n=r.event.player,t=e.attitude(n,a);return t<0?t-1:t}),result.targets){c=result.targets;for(var l of c)l.countCards("he")>0&&player.discardPlayerCard("he",l,[1,2],!0)}else event.finish()},group:"PSyufeng_change",subSkill:{change:{audio:"yufeng",trigger:{player:"changeHp"},prompt:"是否发动【御风】？",content:function(){event.videoId=a.status.videoId++;var i=function(e,n){var r=["选项一：令一名角色摸五张牌，再将手牌弃置至体力上限数","选项二：选择两名角色调换座次","选项三：摸两张牌","选项四：选择至多三名角色各弃置其两张牌"],i=t.create.dialog("御风：请选择一项发动两次");i.videoId=n;for(var o=0;o<r.length;o++){var l='<div class="popup text" style="width:calc(100% - 10px);display:inline-block">';l+=r[o],l+="</div>";var s=i.add(l);s.firstChild.addEventListener(a.config.touchscreen?"touchend":"click",t.click.button),s.firstChild.link=o,Object.setPrototypeOf(s,a.element.Button.prototype),i.buttons.add(s.firstChild)}return i};player.isOnline2()&&player.send(i,player,event.videoId),event.dialog=i(player,event.videoId),(player!=n.me||r.auto)&&(event.dialog.style.display="none");var o=player.chooseButton();for(var l of(o.set("dialog",event.videoId),o.set("forced",!0),o.set("ai",function(t){var i=r.event.player;switch(t.link){case 0:return 2;case 1:return Math.max(.5,i.countCards("hs",function(a){return"sha"==e.name(a)&&i.hasValueTarget(a)})-i.getCardUsable({name:"sha"}))+Math.max.apply(Math,n.filterPlayer(function(e){return e!=i}).map(function(a){return e.damageEffect(a,i,i)}));case 2:return i.needsToDiscard()/4;case 3:return.8*Math.max.apply(Math,n.filterPlayer(function(e){return e!=i&&e.hasCard(n=>a.filter.canBeGained(n,e,i),"hej")}).map(function(a){return e.effect(a,{name:"shunshou_copy"},i,i)}))}}),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),result.links.sort(),result.links))n.log(player,"选择了","#g【御风】","的","#y选项"+e.cnNumber(1+l,!0));event.links=result.links,event.links.sort();switch(event.count=0,event.count++,(event.count>2||!player.isAlive())&&event.finish(),event.links[0]){case 0:event.goto(3);break;case 1:event.goto(6);break;case 2:event.goto(8);break;case 3:event.goto(9);break;default:event.finish()}if(player.chooseTarget("御风：令一名角色摸五张牌，再将手牌弃置至其体力上限数",!1).set("ai",function(a){var n=e.attitude(r.event.player,a),t=5-a.countCards("h");return t>=0?(a.hasSkillTag("nogain")&&(n/=6),n>2?Math.sqrt(t+1)*n:n/3):t<-1&&(a.hasSkillTag("nogain")&&(n*=6),n<-2)?-Math.sqrt(1-t)*n:0}),result.bool){var s=result.targets[0];event.target=s,s.draw(5)}else event.goto(2);var u=s.countCards("h")-s.maxHp;if(u>0&&s.chooseToDiscard("h",!0,u),event.goto(2),player.chooseTarget(2,"选择两名角色，交换座次",!1,function(e,a,n){return!0}).set("ai",function(a){var n=r.event.player,t=e.attitude(n,a);return t<0?t-1:t}).set("targetprompt",["",""]),result.targets){var c=result.targets;n.broadcastAll(function(e,a){n.swapSeat(e,a)},c[0],c[1]),event.goto(2)}else event.goto(2);if(player.draw(2),event.goto(2),player.chooseTarget([1,3],"弃置至多三名角色各两张牌",!1,function(e,a,n){return!0}).set("ai",function(a){var n=r.event.player,t=e.attitude(n,a);return t<0?t-1:t}),result.targets){c=result.targets;for(var l of c)l.countCards("he")>0&&player.discardPlayerCard("he",l,[1,2],!0);event.goto(2)}else event.goto(2)},sub:!0}}},PStianshu:{audio:"tianshu",equipSkill:!1,noHidden:!0,inherit:"taipingyaoshu",derivation:"taipingyaoshu",mod:{maxHandcard:function(a,r){return"guozhan"==e.mode()?r+n.countPlayer(function(e){return e.isFriendOf(a)}):r+n.countGroup()-1}},trigger:{player:"damageBegin4"},filter:function(e,n){return!!a.skill.taipingyaoshu.filter.apply(this,arguments)&&(!n.hasSkillTag("unequip2")&&((!e.source||!e.source.hasSkillTag("unequip",!1,{name:e.card?e.card.name:null,target:n,card:e.card}))&&(!!e.hasNature()||void 0)))},forced:!0,content:function(){trigger.cancel()},ai:{nofire:!0,nothunder:!0,effect:{target:function(a,n,r,t){if(!r.hasSkillTag("unequip2")&&!n.hasSkillTag("unequip",!1,{name:a?a.name:null,target:r,card:a})&&!n.hasSkillTag("unequip_ai",!1,{name:a?a.name:null,target:r,card:a}))return e.tag(a,"natureDamage")?"zerotarget":"tiesuo"==a.name?[0,0]:void 0}}}},PSyinshi:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"phaseBegin"},forced:!0,priority:99,filter:function(e,a){return e.phaseList.length},content:function(){trigger.phaseList=["phaseDraw","phaseUse","phaseDiscard"]}}},sort:u.PScharacter_qun,translate:{PSnanhualaoxian:"PS南华老仙",PSyufeng:"御风",PSyufeng_info:"出牌阶段限两次，你可以选择X项（X为当前游戏轮数）:<br/>1.你可以选择一名角色让其摸5张牌，再将手牌弃置为X（X为其体力上限）。<br/>2.你选择2名角色调换座位。<br/>3.摸两张牌。<br/>4.选择至多3名角色各弃置其2张牌。<br/>当你的体力值变动时，你可令其中一项发动两次。",PStianshu:"天书",PStianshu_info:"锁定技，你的宝物区视为装备【太平要术】。",PSyinshi:"隐士",PSyinshi_info:"锁定技，你只有摸牌阶段、出牌阶段和弃牌阶段。"},rank:c.epic},PSzhangsong:{info:{sex:"male",group:"shu",hp:3,skills:["PSqiangzhi","PSxiantu"],dieAudios:[],trashBin:[]},intro:"由“子夜、night”设计",skills:{PSqiangzhi:{audio:"qiangzhi",trigger:{player:"phaseUseBegin"},direct:!0,filter:function(e,a){return n.hasPlayer(function(e){return e!=a&&e.countCards("h")>0})},subfrequent:["draw"],content:function(){if(player.chooseTarget(e.prompt2("qiangzhi"),function(e,a,n){return n!=a&&n.countCards("h")>0}).set("ai",function(){return Math.random()}),result.bool){var a=result.targets[0];player.logSkill("qiangzhi",a),player.choosePlayerCard(a,"h",!0,"visible")}else event.finish();var r=result.cards[0];player.showCards(r),player.storage.PSqiangzhi_draw=e.type(r,"trick"),n.addVideo("storage",player,["PSqiangzhi_draw",player.storage.PSqiangzhi_draw]),player.addTempSkill("PSqiangzhi_draw","phaseUseEnd")},subSkill:{draw:{trigger:{player:"useCard"},frequent:!0,popup:!1,charlotte:!0,prompt:"是否执行【强识】的效果摸一张牌？",filter:function(a,n){return e.type(a.card,"trick")==n.storage.PSqiangzhi_draw},content:function(){player.draw(),player.logSkill("qiangzhi")},onremove:!0,mark:!0,intro:{content:function(a){return e.translation(a)+"牌"}},sub:!0}}},PSxiantu:{audio:"xiantu1",group:"xiantu2",trigger:{global:"phaseUseBegin"},filter:function(e,a){return e.player!=a},logTarget:"player",check:function(e,a){return!(a.maxHp-a.hp>=2)&&(1!=a.hp&&!(2==a.hp&&a.countCards("h")<2))},content:function(){player.draw(2),player.chooseCard(1,"he",!0,"交给"+e.translation(trigger.player)+"一张牌").set("ai",function(a){return t.selected.cards.length&&a.name==t.selected.cards[0].name?-1:e.tag(a,"damage")||"equip"==e.type(a)?1:0}),player.give(result.cards,trigger.player),player.gainPlayerCard(2,"he",trigger.player,!1,"visible"),trigger.player.addSkill("xiantu4"),trigger.player.storage.xiantu4.push(player)},ai:{threaten:1.1,expose:.3}}},sort:u.PScharacter_shu,translate:{PSzhangsong:"PS张松",PSqiangzhi:"强识",PSqiangzhi_info:"出牌阶段开始时，你可以观看并展示一名其他角色的一张手牌。若如此做，当你于此阶段内使用与此牌类别相同的牌时，你可以摸一张牌。",PSxiantu:"献图",PSxiantu_info:"一名其他角色的出牌阶段开始时，你可以摸两张牌，然后交给其一张牌，再获得其两张牌。若如此做，此阶段结束时，若该角色未于此阶段内杀死过角色，则你失去1点体力。"},rank:c.rare},PSquansun:{info:{sex:"male",group:"wu",hp:4,skills:["PShengzhi","PSnengwan"],dieAudios:["re_sunquan"],isZhugong:!0,trashBin:[]},intro:"由“神鬼高达”设计",skills:{PShengzhi:{audio:"rezhiheng",audioname:["shen_caopi"],enable:"phaseUse",discard:!1,lose:!1,delay:!1,filter:function(e,a){var n=Math.max(1,a.getDamagedHp());return 0!=a.countCards("he")&&!(a.countSkill("PShengzhi")>=n)},content:function(){var a;0==(a=player.countCards("he"))&&event.finish(),player.draw(a),player.chooseToDiscard(a,"he",!0,"衡制：请弃置"+e.cnNumber(a)+"张牌")},ai:{threaten:1,order:15,result:{player:1}}},PSnengwan:{audio:"PShuiwan",trigger:{player:["phaseDrawSkipped","phaseDrawCancelled","phaseUseSkipped","phaseUseCancelled"]},forced:!0,content:function(){var e=["phaseDrawSkipped","phaseDrawCancelled"].includes(event.triggername)?"摸牌阶段":"出牌阶段";n.log(player,"恢复了",e),player[trigger.name]()}}},sort:u.PScharacter_wu,translate:{PSquansun:"PS权孙",PShengzhi:"衡制",PShengzhi_info:"出牌阶段限X次，你可以摸你手牌区和装备区牌数量的牌，然后弃置等量的牌。（X为你已损失的体力值且至少为1）",PSnengwan:"能玩",PSnengwan_info:"锁定技，你的摸牌阶段和出牌阶段阶段不能被跳过。"},rank:c.junk},PSjiesuanjie:{info:{sex:"female",group:"wu",hp:4,skills:["PSzailaiyici"],dieAudios:["zhangxuan"],trashBin:[]},intro:"由“CuberPR”设计",skills:{PSzailaiyici:{audio:"tongli",trigger:{global:"useCard"},prompt2:function(a,n){return"令"+e.translation(a.player)+"的"+e.translation(a.card)+"额外结算"},check:function(a,n){return e.attitude(n,a.player)>0&&!e.tag(a.card,"norepeat")},filter:function(a,n){if("PSzailaiyici"==a.parent.name)return!1;if(!a.targets||!a.card)return!1;var r=e.type(a.card);if("basic"!=r&&"trick"!=r)return!1;if(["shan","wuxie"].includes(e.name(a.card,a.player)))return!1;for(var t=0;t<a.targets.length;t++){if(!a.targets[t].isAlive())return!1;if(!a.player.canUse({name:a.card.name},a.targets[t],!1,!1))return!1}return!0},content:function(){trigger.effectCount++},ai:{threaten:2}}},sort:u.PScharacter_wu,translate:{PSjiesuanjie:"额外结算姐",PSzailaiyici:"再来",PSzailaiyici_info:"一名角色使用即时牌指定第一个目标后，你可令此牌额外结算一次。"},rank:c.epic},PSguanyunchang:{info:{sex:"male",group:"shu",hp:4,skills:["wusheng","PSweizhen"],dieAudios:["re_guanyu"],trashBin:[]},intro:"由“你想去哪儿呢”设计",skills:{PSweizhen:{mod:{targetInRange:function(n,r,t){var i=a.skill.PSweizhen.getInfo(r);if("sha"==n.name&&"red"==e.color(n)&&e.distance(r,t)<=1+i[0])return!0},selectTarget:function(n,r,t){var i=a.skill.PSweizhen.getInfo(r);"sha"==n.name&&"red"==e.color(n)&&-1!=t[1]&&(t[1]+=i[2])},cardUsable:function(n,r,t){var i=a.skill.PSweizhen.getInfo(r);if("sha"==n.name&&("red"==e.color(n)||"none"==e.color(n)))return t+i[3]}},init:function(e){e.storage.PSweizhen||(e.storage.PSweizhen=[0,0,0,0,0])},getInfo:function(e){return e.storage.PSweizhen||(e.storage.PSweizhen=[0,0,0,0,0]),e.storage.PSweizhen},mark:!0,intro:{content:function(e,n){var r=a.skill.PSweizhen.getInfo(n);return'<div class="text center"><span class=thundertext>距离：'+r[0]+"</span>　<span class=firetext>伤害："+r[1]+"</span><br><span class=greentext>目标："+r[2]+"</span>　<span class=bluetext>次数："+r[3]+"</span><br><span class=whitetext>强命："+r[4]+"</span></div>"}},audio:"ext:PS武将/audio/skill:4",trigger:{source:"damageBegin1"},filter:function(a){return a.card&&"sha"==a.card.name&&"red"==e.color(a.card)&&a.notLink()},direct:!0,priority:-1,content:function(){var e=a.skill.PSweizhen.getInfo(r.event.player);trigger.num+=e[1]},ai:{damageBonus:!0},group:["PSweizhen_hit","PSweizhen_add","PSweizhen_chongzhu"],subSkill:{hit:{audio:2,shaRelated:!0,trigger:{player:"useCardToPlayered"},filter:function(n,r){var t=a.skill.PSweizhen.getInfo(r);return!(t[4]<=0)&&(!(!n.card||"sha"!=n.card.name&&"red"!=e.color(n.card))&&r.getHistory("useCard",function(a){return"sha"==e.name(a.card)&&"red"==e.color(a.card)}).length<=t[4])},forced:!0,logTarget:"target",content:function(){trigger.getParent().directHit.add(trigger.target)},ai:{directHit_ai:!0,skillTagFilter:function(n,r,t){var i=a.skill.PSweizhen.getInfo(n);return!(i[4]<=0)&&(!(!event.card||"sha"!=event.card.name&&"red"!=e.color(event.card))&&n.getHistory("useCard",function(a){return"sha"==e.name(a.card)&&"red"==e.color(a.card)}).length<=i[4])}},sub:!0},discard:{audio:2,trigger:{source:"damageAfter"},logTarget:"event.player",prompt2:function(n,t){var i=a.skill.PSweizhen.getInfo(r.event.player);return"弃置"+e.translation(n.player)+"一"+(i[4]>1?"至"+e.cnNumber(i[4]):"")+"张牌"},filter:function(n,t){return!(a.skill.PSweizhen.getInfo(r.event.player)[4]<=0)&&(!(!n.player.isAlive()||0==n.player.countCards("he"))&&(n.card&&"sha"==n.card.name&&"red"==e.color(n.card)))},check:function(a,n){return e.attitude(n,a.player)<=0},content:function(){var e=a.skill.PSweizhen.getInfo(r.event.player);player.discardPlayerCard("he",trigger.player,[1,e[4]],!1)},sub:!0},add:{audio:2,trigger:{player:["phaseZhunbeiBegin","phaseJieshuBegin"],global:"damageSource"},priority:10,direct:!0,filter:function(n,r){return"damage"!=n.name||a.skill.PSweizhen.getInfo(r)!=[5,5,5,5,5]&&(n.card&&"sha"==n.card.name&&"red"==e.color(n.card))},content:function(){event.num=trigger.num,event.num--;var t,i=["距离("+(t=a.skill.PSweizhen.getInfo(r.event.player))[0]+")","伤害("+t[1]+")","目标("+t[2]+")","次数("+t[3]+")","强命("+t[4]+")","cancel2"];(player.chooseControl(i).set("prompt",e.prompt("PSweizhen")).set("prompt2","令〖威震〗中的一个数字+1").set("ai",function(){var t=r.event.player,i=a.skill.PSweizhen.getInfo(t);return i[0]<i[3]&&n.countPlayer(function(a){return e.distance(t,a)<=i[0]})<Math.min(3,n.countPlayer())?0:i[3]<i[1]-1?3:i[1]<5?1:i[0]<5&&n.hasPlayer(function(a){return a!=t&&e.distance(t,a)>i[0]})?0:2}),"cancel2"!=result.control)&&(player.logSkill("PSweizhen"),(t=a.skill.PSweizhen.getInfo(player))[result.index]=Math.min(5,t[result.index]+1),n.log(player,"将",result.control,"数字改为","#y"+t[result.index]),player.markSkill("PSweizhen"));event.num>0&&event.goto(1)},sub:!0},chongzhu:{audio:"danji",enable:"phaseUse",filterCard:(a,n)=>"black"==e.color(a)&&n.canRecast(a),filter:function(a,n){return n.countCards("he",function(a,n){return"black"==e.color(a)})>0},position:"he",selectCard:[1,1/0],prompt:"请选择要重铸的牌",discard:!1,lose:!1,delay:!1,content:function(){player.recast(cards)},sub:!0}}}},sort:u.PScharacter_shu,translate:{PSguanyunchang:"关云长",PSweizhen:"威震",PSweizhen_info:"①你拥有以下效果：<br/>1：使用红色杀的距离+0 ；<br/>2：使用红色杀造成伤害+0；<br/> 3：使用红色杀可以额外指定0名目标；<br/>4：使用红色杀的次数+0；<br/>5：每回合使用第0张红色杀不能被响应。<br/>当一名角色使用红色杀造成一点伤害后，或你的准备阶段/回合结束阶段开始时，你选择上述中的一个数字+1。<br/>②出牌阶段，你可以重铸黑色牌。","#ext:PS武将/audio/skill/PSweizhen1":"狂徒！天下英雄闻我名无不丧胆，可惜我这青龙偃月刀，竟斩你这鼠辈的首级。","#ext:PS武将/audio/skill/PSweizhen2":"我cnm。","#ext:PS武将/audio/skill/PSweizhen3":"狂徒！我这青龙偃月刀竟斩你这鼠辈的首级。","#ext:PS武将/audio/skill/PSweizhen4":"回去吧，你太老了。"},rank:c.epic},PSshen_zhaoyun:{info:{sex:"male",group:"shen",hp:2,skills:["PSjuejing","relonghun"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSjuejing:{mod:{maxHandcard:function(e,a){return 2+a}},audio:"xinjuejing",trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},forced:!0,filter:function(e,a){if("gain"==e.name&&e.player==a)return!1;var n=e.getl(a);return n&&n.hs&&n.hs.length},content:function(){player.draw()}}},sort:u.PScharacter_shen,translate:{PSshen_zhaoyun:"PS神赵云",PSjuejing:"绝境",PSjuejing_info:"锁定技，你的手牌上限+2；当你失去手牌时，你摸一张牌。"},rank:c.legend},PSzhangxuan:{info:{sex:"female",group:"wu",hp:4,skills:["PStongli"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“看透一切的军师”设计",replace:["PSzhangxuan","PSfuzhijie","PSjiesuanjie"],skills:{PStongli:{audio:"tongli",trigger:{player:"useCardToPlayered"},filter:function(a,n){if(!a.isFirstTarget||a.card.storage&&a.card.storage.PStongli)return!1;var r=e.type(a.card);if("basic"!=r&&"trick"!=r)return!1;if(!n.getCards("h").length)return!1;var t=a.getParent("phaseUse");return!(!t||t.player!=n)&&(n.getHistory("useCard",function(e){return e.getParent("phaseUse")==t&&(!e.card.storage||!e.card.storage.PStongli)}).length,n.countCards("h")>0)},prompt2:function(a,n){var r=a.getParent("phaseUse");return n.getHistory("useCard",function(e){return e.getParent("phaseUse")==r&&(!e.card.storage||!e.card.storage.PStongli)}).length,"令"+e.translation(a.card)+"额外结算"+e.cnNumber(n.countCards("h"))+"次"},check:function(a,n){return!e.tag(a.card,"norepeat")},content:function(){var a=player.countCards("h");n.log(trigger.card,"额外结算",e.cnNumber(a),"次"),trigger.getParent().effectCount+=a}}},sort:u.PScharacter_wu,translate:{PSzhangxuan:"PS张嫙",PStongli:"同礼",PStongli_info:"出牌阶段，当你使用即时牌指定第一个目标后，你可令此牌效果额外执行X次（X为你的手牌数）。"},rank:c.legend},PScenhun:{info:{sex:"male",group:"wu",hp:4,skills:["jishe","PSlianhuo"],dieAudios:[],trashBin:[]},intro:"由“欧文哈尔”设计",skills:{PSlianhuo:{audio:"lianhuo",trigger:{player:"damageBegin3"},forced:!0,filter:function(e,a){return a.isLinked()&&e.notLink()&&e.hasNature("fire")},content:function(){var e=n.countPlayer(e=>e.isLinked());trigger.num+=e},group:"PSlianhuo_source",subSkill:{source:{trigger:{global:"damageBegin3"},filter:function(e,a){return e.player!=a&&a.isLinked()&&e.player.isLinked()&&e.hasNature("fire")},direct:!0,content:function(){player.logSkill("PSlianhuo",trigger.player),trigger.player=player},sub:!0}}}},sort:u.PScharacter_wu,translate:{PScenhun:"PS岑昏",PSlianhuo:"链祸",PSlianhuo_info:"锁定技，当你受到火焰伤害时，若你的武将牌处于横置状态且此伤害不为连环伤害，则此伤害+X。(X为处于横置状态的角色数)。你是所有铁索连环伤害的源头。"},rank:c.junk},PSshiniangongzhu:{info:{sex:"male",group:"wei",hp:4,skills:["PSshanjia"],dieAudios:["caoang"],trashBin:[]},intro:'由"Kaesar”设计',skills:{PSshanjia:{group:["PSshanjia_count","PSshanjia_number","PSshanjia_damage"],locked:!1,mod:{aiValue:function(a,n,r){if((a.storage.PSshanjia||0)<3&&"equip"==e.type(n)&&!e.cardtag(n,"gifts"))return r/a.hp}},subSkill:{count:{forced:!0,silent:!0,popup:!1,trigger:{player:"loseEnd"},filter:function(e,a){return e.cards2&&e.cards2.length>0},content:function(){a.skill.PSshanjia.sync(player)},sub:!0},number:{trigger:{source:"damageEnd"},init:function(e){e.storage.PSshanjia_number||(e.storage.PSshanjia_number=0)},forced:!0,filter:function(e,a){return"PSshanjia"==e.parent.parent.parent.name},content:function(){player.storage.PSshanjia_number++,player.markSkill("PSshanjia")},sub:!0},damage:{trigger:{source:"damageBegin1"},filter:function(e){return"PSshanjia"==e.parent.parent.parent.name},direct:!0,priority:-1,content:function(){trigger.num+=player.storage.PSshanjia_number},sub:!0}},audio:"shanjia",trigger:{player:"phaseUseBegin"},intro:{markcount:function(e){return e},content:function(e,a){if(e){var n="<li>";return n+="本局游戏内已失去过"+e+"张装备牌",n+="<br><li>“缮甲”摸牌和伤害数+",n+=a.storage.PSshanjia_number}}},frequent:!0,sync:function(a){for(var n=a.actionHistory,r=0,t=0;t<n.length;t++)for(var i=0;i<n[t].lose.length;i++)"useCard"!=n[t].lose[i].parent.name&&(r+=n[t].lose[i].cards2.filter(function(a){return"equip"==e.type(a,!1)}).length);a.storage.PSshanjia=r,r>0&&a.markSkill("PSshanjia"),a.updateMark("PSshanjia")},content:function(){var n=player.storage.PSshanjia_number;player.draw(3+n),a.skill.PSshanjia.sync(player),(n=3-player.storage.PSshanjia)>0&&(player.chooseToDiscard("he",!0,n).ai=e.disvalue);var r=!0;if(result.cards)for(var t=0;t<result.cards.length;t++)if(["delay"].includes(e.type(result.cards[t],null,"h"==result.cards[t].original&&player))){r=!1;break}if(r&&player.chooseTarget("是否视为使用一张【杀】？").set("filterTarget",function(e,a,n){return a.canUse({name:"sha"},n,!1)}).set("ai",function(a){const n=e.event().player;return e.attitude(n,a)<=0}),result.targets&&result.targets.length>0){var i=result.targets[0];player.addTempSkill("unequip",{player:"shaAfter"}),player.useCard({name:"sha",isCard:!0},i,!1)}},ai:{threaten:3,noe:!0,reverseOrder:!0,skillTagFilter:function(e){if(e.storage.PSshanjia>2)return!1},effect:{target:function(a,n,r){if(n.storage.PSshanjia<3&&"equip"==e.type(a)&&!e.cardtag(a,"gifts"))return[1,3]}}}}},sort:u.PScharacter_wei,translate:{PSshiniangongzhu:"十年公主",PSshanjia:"缮甲",PSshanjia_info:"出牌阶段开始时，你可以摸三张牌，然后弃置3-X张牌(X为你本局游戏内不因使用而失去过的装备牌的数目且至多为3)。若你没有以此法弃置延时锦囊牌，则你可以视为使用了一张无距离限制且不计入出牌阶段使用次数且无视防具的【杀】，若此杀造成伤害，本局游戏“缮甲”摸牌数和伤害+1。"},rank:c.rare},PScaojinyu:{info:{sex:"female",group:"wei",hp:4,skills:["PSyuqi","PSshanshen","PSxianjing"],dieAudios:["ext:PS武将/audio/die:true"],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSyuqi:{audio:"ext:PS武将/audio/skill:2",trigger:{global:"damageEnd"},init:function(e){e.storage.PSyuqi||(e.storage.PSyuqi=[0,3,1,1])},getInfo:function(e){return e.storage.PSyuqi||(e.storage.PSyuqi=[0,3,1,1]),e.storage.PSyuqi},onremove:!0,usable:3,filter:function(n,r){var t=a.skill.PSyuqi.getInfo(r);return n.player.isIn()&&e.distance(r,n.player)<=t[0]},logTarget:"player",content:function(){event.list=a.skill.PSyuqi.getInfo(player);var i=e.cards(event.list[1]);event.cards=i,n.cardsGotoOrdering(i);var o=player.chooseToMove(!0,"隅泣（若对话框显示不完整，可下滑操作）");if(o.set("list",[["牌堆顶的牌",i],["交给"+e.translation(trigger.player)+"（至少一张"+(event.list[2]>1?"，至多"+e.cnNumber(event.list[2])+"张":"")+"）"],["交给自己（至多"+e.cnNumber(event.list[3])+"张）"]]),o.set("filterMove",function(e,n,t){var i=a.skill.PSyuqi.getInfo(r.event.player);return 1==n?t[1].length<i[2]:2!=n||t[2].length<i[3]}),o.set("processAI",function(n){var t,i=n[0][1].slice(0).sort(function(a,n){return e.value(n,"raw")-e.value(a,"raw")}),o=r.event.player,l=r.event.getTrigger().player,s=a.skill.PSyuqi.getInfo(r.event.player),u=i.splice(0,Math.min(s[3],i.length-1));return t=e.attitude(o,l)>0?i.shift():i.pop(),[i,[t],u]}),o.set("filterOk",function(e){return e[1].length>0}),result.bool){var l=result.moved;for(i.removeArray(l[1]),i.removeArray(l[2]);i.length;)t.cardPile.insertBefore(i.pop().fix(),t.cardPile.firstChild);var s=[[trigger.player,l[1]]];l[2].length&&s.push([player,l[2]]),n.loseAsync({gain_list:s,giver:player,animate:"gain2"}).setContent("gaincardMultiple")}},mark:!0,intro:{content:function(e,n){var r=a.skill.PSyuqi.getInfo(n);return'<div class="text center"><span class=thundertext>蓝色：'+r[0]+"</span>　<span class=firetext>红色："+r[1]+"</span><br><span class=greentext>绿色："+r[2]+"</span>　<span class=yellowtext>黄色："+r[3]+"</span></div>"}},ai:{threaten:8.8}},PSshanshen:{audio:"ext:PS武将/audio/skill:2",trigger:{global:"die"},direct:!0,content:function(){event.goon=!player.hasAllHistory("sourceDamage",function(e){return e.player==trigger.player});var r=a.skill.PSyuqi.getInfo(player);if(player.chooseControl("确定","cancel2").set("prompt",e.prompt("PSshanshen")).set("prompt2","令〖隅泣〗中的所有数字+2"+(event.goon?"并回复1点体力":"")).set("ai",function(){return 0}),"cancel2"!=result.control){player.logSkill("PSshanshen",trigger.player);r=a.skill.PSyuqi.getInfo(player);for(var t=0;t<r.length;t++)r[t]+=2;n.log(player,"将〖隅泣〗中的所有数字+","#y2"),player.markSkill("PSyuqi"),event.goon&&player.recover()}}},PSxianjing:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"phaseZhunbeiBegin"},direct:!0,content:function(){var e=a.skill.PSyuqi.getInfo(player);if(player.chooseControl("确定","cancel2").set("prompt","是否令〖隅泣〗中的所有数字+1？").set("ai",function(){return 0}),"cancel2"!=result.control){player.logSkill("PSxianjing");e=a.skill.PSyuqi.getInfo(player);for(var r=0;r<e.length;r++)e[r]++;n.log(player,"将〖隅泣〗中的所有数字+","#y1"),player.markSkill("PSyuqi")}}}},sort:u.PScharacter_wei,translate:{PScaojinyu:"PS曹金玉",PSyuqi:"隅泣",PSyuqi_info:"每回合限三次。当有角色受到伤害后，若你至其的距离不大于<span class=thundertext>0</span>，则你可以观看牌堆顶的<span class=firetext>3</span>张牌。你将其中至多<span class=greentext>1</span>张牌交给受伤角色，然后可以获得剩余牌中的至多<span class=yellowtext>1</span>张牌，并将其余牌以原顺序放回牌堆顶。",PSshanshen:"善身",PSshanshen_info:"当有角色死亡时，你可令你的〖隅泣〗中的所有数字+2。然后若你未对该角色造成过伤害，则你回复1点体力。",PSxianjing:"娴静",PSxianjing_info:"准备阶段，你可令你的〖隅泣〗中的所有数字+1。","#ext:PS武将/audio/skill/PSshanshen1":"人家只想做安安静静的小淑女。","#ext:PS武将/audio/skill/PSshanshen2":"雪花纷飞，独存寒冬。","#ext:PS武将/audio/skill/PSxianjing1":"得父母之爱，享公主之礼遇。","#ext:PS武将/audio/skill/PSxianjing2":"哼，可不要小瞧女孩子啊。","#ext:PS武将/audio/skill/PSyuqi1":"玉儿摔倒了，要阿娘抱抱。","#ext:PS武将/audio/skill/PSyuqi2":"这么漂亮的雪花，为什么只能在寒冬呢。","#ext:PS武将/audio/die/PScaojinyu:die":"娘亲，雪人不怕冷吗？"},rank:c.epic},PSzhaoyun:{info:{sex:"male",group:"shu",hp:5,skills:["longdan","PShuwei"],dieAudios:[],trashBin:[]},intro:"由“不想再说也许可以”设计",replace:["PSzhaoyun","PSqun_zhaoyun"],skills:{PShuwei:{audio:"ext:PS武将/audio/skill:2",trigger:{player:["phaseBefore","changeHp"]},forced:!0,popup:!1,init:function(e){if(!n.online){e.removeAdditionalSkill("PShuwei");var a=[];if(e.hp<=4&&a.push("new_yajiao"),e.hp<=3&&a.push("chongzhen"),e.hp<=2&&a.push("relonghun"),e.hp<=1){var r=4-e.countCards("h");0!=r&&e.logSkill("boss_juejing"),r>0&&e.draw(r),r<0&&e.chooseToDiscard("h",!0,-r),a.push("boss_juejing")}a.length&&e.addAdditionalSkill("PShuwei",a)}},derivation:["new_yajiao","chongzhen","relonghun","boss_juejing"],content:function(){player.removeAdditionalSkill("PShuwei");var e=[];if(player.hp<=4&&(null!=trigger.num&&trigger.num<0&&player.hp-trigger.num>1&&player.logSkill("PShuwei"),e.push("new_yajiao")),player.hp<=3&&e.push("chongzhen"),player.hp<=2&&e.push("relonghun"),player.hp<=1){var a=4-player.countCards("h");0!=a&&player.logSkill("boss_juejing"),a>0&&player.draw(a),a<0&&player.chooseToDiscard("h",!0,-a),e.push("boss_juejing")}e.length&&player.addAdditionalSkill("PShuwei",e)},ai:{maixie:!0,effect:{target:function(a,n,r){if(e.tag(a,"damage")){if(!r.hasFriend())return;if(r.hp>=4)return[0,1]}if(e.tag(a,"recover")&&n.hp>=n.maxHp-1)return[0,0]}}}}},sort:u.PScharacter_shu,translate:{PSzhaoyun:"PS赵云",PShuwei:"虎威",PShuwei_info:"锁定技，若你的体力值：为4或更少，你视为拥有技能〖涯角〗；为3或更少，你视为拥有技能〖冲阵〗；为2或更少，你视为拥有技能〖龙魂〗；为1或更少，你视为拥有技能〖绝境〗。","#ext:PS武将/audio/skill/PShuwei1":"和我一起活着离开此地。","#ext:PS武将/audio/skill/PShuwei2":"让我了结此战。"},rank:c.epic},PScaochun:{info:{sex:"male",group:"wei",hp:4,skills:["PSreshanjia","PSxiaorui"],dieAudios:[],trashBin:[]},intro:"由“你想去哪儿呢”设计",replace:["PSshiniangongzhu","PScaochun"],skills:{PSreshanjia:{locked:!1,audio:"shanjia",trigger:{player:"phaseUseBegin"},frequent:!0,init:function(e){e.storage.PSreshanjia||(e.storage.PSreshanjia=0)},intro:{content:"“缮甲”摸牌数+#"},content:function(){player.draw(3+player.storage.PSreshanjia),player.chooseToDiscard("he",!0,3).ai=e.disvalue;var t=[!1,!1,!1];if(result.cards)for(var i=["basic","trick","equip"],o=0;o<t.length;o++)for(var l=0;l<result.cards.length;l++)if([i[o]].includes(e.type(result.cards[l],"trick","h"==result.cards[l].original&&player))){t[o]=!0;break}if(event.bool=t,n.log(t),event.bool[0]&&player.chooseUseTarget({name:"sha"},"是否视为使用一张【杀】？",!1,"nodistance"),event.bool[1]){i=[];for(var o of a.inpile)"trick"==e.type({name:o})&&a.filter.cardUsable({name:o},player,event.getParent("chooseToUse"))&&player.hasUseTarget({name:o})&&i.push([e.translation(e.type({name:o})),"",o]);i.length&&player.chooseButton(["是否视为使用一张普通锦囊牌？",[i,"vcard"]]).set("ai",function(e){var a=r.event.player,n={name:e.link[2],nature:e.link[3]};return a.getUseValue(n)})}else event.goto(5);if(result&&result.bool&&result.links[0]){var s={name:result.links[0][2],nature:result.links[0][3],isCard:!0,storage:{nowuxie:!0}};player.chooseUseTarget(s,!0)}event.bool[2]&&(player.storage.PSreshanjia++,player.markSkill("PSreshanjia"))},ai:{threaten:3,noe:!0}},PSxiaorui:{audio:"qingxi",enable:"phaseUse",usable:1,selectTarget:1,filterTarget:!0,prompt:"失去一点体力并获得一名角色两张牌，再对其造成一点伤害，若其中有装备牌，你回复一点体力",content:function(){if(player.loseHp(1),target.countCards("he")>0&&player.gainPlayerCard(target,[1,2],"he",!1),target.damage("nocard",1,player),result.cards)for(var a of result.cards)if("equip"==e.type(a)){player.recover();break}},ai:{basic:{order:1},result:{player:function(e){return e.countCards("h")>=e.hp-1||e.hp<3?-1:1}}}}},sort:u.PScharacter_wei,translate:{PScaochun:"PS曹纯",PSreshanjia:"缮甲",PSreshanjia_info:"出牌阶段开始时，你可以摸3张牌,然后弃置3张牌，若弃置的牌包含：基本牌，视为对一名角色使用一张【杀】（无距离限制且不计入次数）；锦囊牌，视为使用一张不能被无懈的普通锦囊牌；装备牌，“缮甲”摸牌数+1。",PSxiaorui:"骁锐",PSxiaorui_info:"出牌阶段限一次，你可以失去一点体力获得一名角色两张牌并对其造成一点伤害，若获得牌中有装备你恢复一点体力。"},rank:c.rare},PScaoshuang:{info:{sex:"male",group:"wei",hp:4,skills:["PStuogu","shanzhuan"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PStuogu:{audio:"tuogu",trigger:{global:"die"},frequent:!0,filter:function(a,n){return a.player.getStockSkills("鸡","你").filter(function(a){return e.info(a)}).length>0},logTarget:"player",content:function(){var r=trigger.player.getStockSkills("太","美").filter(function(a){return e.info(a)});r.push("cancel2"),player.chooseControl(r).set("prompt","选择获得"+e.translation(trigger.player)+"的一个技能").set("forceDie",!0).set("ai",function(){return r.randomGet()}),"cancel2"!=result.control&&(player.storage.PStuogu.push(result.control),player.markSkill("PStuogu"),player.addSkills(result.control),n.broadcastAll(function(e){var r=[e];for(var t of(n.expandSkills(r),r)){var i=a.skill[t];i&&(i.audioname2||(i.audioname2={}),i.audioname2.caoshuang="tuogu")}},result.control))},mark:!0,init:function(e){e.storage.PStuogu||(e.storage.PStuogu=[])},intro:{content:"已获得的托孤技能：$"}}},sort:u.PScharacter_wei,translate:{PScaoshuang:"PS曹爽",PStuogu:"托孤",PStuogu_info:"一名角色死亡时，你可以获得其武将牌上的一个技能。"},rank:c.rare},PSxian_caozhi:{info:{sex:"male",group:"shen",hp:3,skills:["PSluoying","PSjiushi"],dieAudios:["re_caozhi"],trashBin:[]},intro:'由"Kaesar”设计',skills:{PSluoying:{mod:{ignoredHandcard:function(e,a){if(e.hasGaintag("PSluoying"))return!0},cardDiscardable:function(e,a,n){if("phaseDiscard"==n&&e.hasGaintag("PSluoying"))return!1}},onremove:function(e){e.removeGaintag("PSluoying")},audio:"reluoying",trigger:{global:["loseAfter","cardsDiscardAfter"]},filter:function(a,n){switch(a.name){case"lose":for(var r=0;r<a.cards2.length;r++)if("club"==e.suit(a.cards2[r],a.player)&&"d"==e.position(a.cards2[r],!0)&&a.player!=n)return!0;return!1;case"cardsDiscard":var t=a.getParent().relatedEvent;return"d"==e.position(a.cards[0],!0)&&t.player!=n&&"club"==e.suit(a.cards[0])}},forced:!0,content:function(){var a="lose"==trigger.name?trigger.cards2:trigger.cards;a=a.filter(function(a){return"club"==e.suit(a)&&"d"==e.position(a,!0)}),player.gain(a,"gain2").gaintag.add("PSluoying")}},PSjiushi:{trigger:{global:"gameStart",player:"enterGame"},forced:!0,audio:"rejiushi",filter:function(e,a){return!a.hasSkill("jiu")},init:function(e,n){e.hasSkill("jiu")||(e.addSkill("jiu"),e.storage.jiu&&0!=e.storage.jiu||(e.storage.jiu=1),!e.node.jiu&&a.config.jiu_effect&&(e.node.jiu=t.create.div(".playerjiu",e.node.avatar),e.node.jiu2=t.create.div(".playerjiu",e.node.avatar2)))},content:function(){player.addSkill("jiu"),player.storage.jiu&&0!=player.storage.jiu||(player.storage.jiu=1),!player.node.jiu&&a.config.jiu_effect&&(player.node.jiu=t.create.div(".playerjiu",player.node.avatar),player.node.jiu2=t.create.div(".playerjiu",player.node.avatar2))},mod:{cardUsable:function(e,a,n){if("jiu"==e.name)return 1/0}},group:["PSjiushi_maintain","PSjiushi_use"],subSkill:{maintain:{trigger:{global:["useCardAfter","phaseAfter","useCard1"]},lastDo:!0,priority:1,popup:!1,silent:!0,charlotte:!0,filter:function(e,a){return!a.hasSkill("jiu")},content:function(){player.addSkill("jiu"),player.storage.jiu&&0!=player.storage.jiu||(player.storage.jiu=1),!player.node.jiu&&a.config.jiu_effect&&(player.node.jiu=t.create.div(".playerjiu",player.node.avatar),player.node.jiu2=t.create.div(".playerjiu",player.node.avatar2))},sub:!0,forced:!0},use:{audio:"rejiushi",enable:"chooseToUse",locked:!0,filterCard:!0,viewAs:{name:"jiu"},position:"hes",viewAsFilter:function(e){return!!e.countCards("hes")},prompt:"将一张牌当酒使用",check:function(a){return"dying"==r.event.type?1/Math.max(.1,e.value(a)):4-e.value(a)},ai:{threaten:1.5,basic:{useful:function(e,a){return r.event.player.hp>1?0==a?4:1:0==a?7.3:3},value:function(e,a,n){return a.hp>1?0==n?5:1:0==n?7.3:3}},order:function(){return e.order({name:"sha"})+.2},result:{target:function(r,t){if(t&&t.isDying())return 2;if(t&&!t.isPhaseUsing())return 0;if("stone"==a.config.mode&&!r.isMin()&&r.getActCount()+1>=r.actcount)return 0;var i,o=r.getCards("h","sha");if(o.length>1&&(r.getCardUsable("sha")>1||r.countCards("h","zhuge")))return 0;if(o.sort(function(a,n){return e.order(n)-e.order(a)}),o.length){for(var l=0;l<o.length;l++)if(a.filter.filterCard(o[l],t)){i=o[l];break}}else r.hasSha()&&r.needsToDiscard()&&1!=r.countCards("h","hufu")&&(i={name:"sha"});return i&&n.hasPlayer(function(a){return e.attitude(t,a)<0&&t.canUse(i,a,null,!0)&&!a.hasSkillTag("filterDamage",null,{player:r,card:i,jiu:!0})&&e.effect(a,i,t)>0})?1:0}},tag:{save:1,recover:.1}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSxian_caozhi:"仙界曹植",PSluoying:"落英",PSluoying_info:"锁定技：你立即获得任何方式进入弃牌堆的♣牌（自己的牌除外），以此法获得牌不计入手牌上限。",PSjiushi:"酒诗",PSjiushi_info:"锁定技，你永久处于喝酒状态，你可以将一张牌当『酒』使用，你使用『酒』无次数限制"},rank:c.legend},PSsunben:{info:{sex:"male",group:"wu",hp:4,skills:["oljiang","PSbaiban","PSbb_hunzi","olzhiba"],dieAudios:["re_sunben"],isZhugong:!0,trashBin:[]},intro:"由“你想去哪儿呢”设计",replace:["PSqun_sunce","PSsunben"],skills:{PSbaiban:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"damageBegin4"},filter:function(e,a){return 2==a.hp&&e.num<2},forced:!0,content:function(){trigger.cancel()}},PSbb_hunzi:{skillAnimation:!0,animationColor:"wood",audio:"rehunzi",juexingji:!0,derivation:["PSbb_yingzi","PSbb_yinghun"],unique:!0,trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return a.hp<=1&&!a.storage.PSbb_hunzi},forced:!0,content:function(){player.loseMaxHp(),player.addSkills("PSbb_yingzi"),player.addSkills("PSbb_yinghun"),player.removeSkills("PSbaiban"),n.log(player,"获得了技能","#g【英姿】和【英魂】"),n.log(player,"失去了技能","#g【白板】"),player.awakenSkill(event.name),player.storage[event.name]=!0},ai:{threaten:function(e,a){return 1==a.hp?2:.5},maixie:!0,effect:{target:function(a,n,t){if(t.hasFriend())return 1==e.tag(a,"damage")&&2==t.hp&&!t.isTurnedOver()&&r.currentPhase!=t&&e.distance(r.currentPhase,t,"absolute")<=3?[.5,1]:void 0}}}}},sort:u.PScharacter_wu,translate:{PSsunben:"PS孙笨",PSbaiban:"白板",PSbaiban_info:"锁定技，若你的体力值为2时，你防止受到小于2的伤害。",PSbb_hunzi:"魂姿",PSbb_hunzi_info:"觉醒技，准备阶段，若你的体力值为1，你减1点体力上限，并获得技能〖英姿〗和〖英魂〗。"},rank:c.rare},PSduyu:{info:{sex:"male",group:"qun",hp:4,skills:["PSmiewu","PSqiyang"],dieAudios:["sp_duyu"],trashBin:[]},intro:"由“神鬼高达”设计",replace:["PSjin_duyu","PSduyu"],skills:{PSmiewu:{audio:"spmiewu",enable:["chooseToUse","chooseToRespond"],filter:function(n,r){if(r.hasSkill("PSmiewu_failure"))return!1;if(!r.countCards("hse"))return!1;for(var t of a.inpile){var i=e.type(t);if(("basic"==i||"trick"==i||"delay"==i)&&n.filterCard({name:t},r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];if("sha"==l)for(var s of(n.filterCard({name:l},r,n)&&i.push(["基本","","sha"]),a.inpile_nature))n.filterCard({name:l,nature:s},r,n)&&i.push(["基本","","sha",s]);else"trick"==e.type(l)&&n.filterCard({name:l},r,n)?i.push(["锦囊","",l]):"delay"==e.type(l)&&n.filterCard({name:l},r,n)?i.push(["延时锦囊","",l]):"basic"==e.type(l)&&n.filterCard({name:l},r,n)&&i.push(["基本","",l])}return t.create.dialog("灭吴",[i,"vcard"])},filter:function(e,a){return r.event.getParent().filterCard({name:e.link[2]},a,r.event.getParent())},check:function(e){if("phase"!=r.event.getParent().type)return 1;var a=r.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:a.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:!0,audio:"spmiewu",popname:!0,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3]},precontent:function(){n.addTempSkill("PSmiewu_failure")}}},prompt:function(a,n){return"将一张牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},hiddenCard:function(n,r){if(!a.inpile.includes(r))return!1;var t=e.type(r);return("basic"==t||"trick"==t||"delay"==t)&&!n.hasSkill("PSmiewu_failure")&&n.countCards("she")>0},ai:{fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(e){if(!e.countCards("hse")||e.hasSkill("PSmiewu_failure"))return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},group:"PSmiewu_draw",subSkill:{draw:{trigger:{player:["useCardAfter","respondAfter"]},forced:!0,charlotte:!0,popup:!1,filter:function(e,a){return"PSmiewu_backup"==e.skill},content:function(){player.draw()},sub:!0},failure:{sub:!0}}},PSqiyang:{trigger:{player:"gainEnd"},audio:"pkwuku",filter:function(e,a){return r.currentPhase!=a&&"PSmiewu_draw"!=e.getParent(2).name},forced:!0,content:function(){var e=trigger.cards||trigger.cards2;player.discard(e)}}},sort:u.PScharacter_qun,translate:{PSduyu:"PS杜预",PSmiewu:"灭吴",PSmiewu_info:"每回合限一次，你可以将一张牌当做任意一张基本牌或锦囊牌使用或打出，然后你摸一张牌。",PSqiyang:"弃养",PSqiyang_info:"锁定技，你的回合外，若你不因〖灭吴〗获得牌时，弃置之。"},rank:c.rare},PSshen_jiangweix:{info:{sex:"male",group:"shen",hp:3,skills:["PSjiufa","PSkefu","PSwantian"],dieAudios:["shen_jiangwei"],trashBin:[]},intro:"由“我最爱的雨雨”设计",skills:{PSjiufa:{audio:"jiufa",trigger:{player:"useCardToPlayered"},filter:function(e,a){return!(!e.addedTargets&&1==e.targets.length&&e.targets.includes(a))&&(e.targets&&e.targets.length>0)},init:function(e){e.storage.PSjiufa||(e.storage.PSjiufa=0)},mark:!0,marktext:"伐",intro:{name:"九伐",content:"mark"},forced:!0,content:function(){player.storage.PSjiufa++,player.markSkill("PSjiufa"),player.syncStorage("PSjiufa")},group:"PSjiufa_gain",subSkill:{gain:{audio:"jiufa",trigger:{player:["useCardAfter","respondAfter"]},priority:-1,forced:!0,usable:1,filter:function(e,a){return a.storage.PSjiufa>=9},prompt2:"展示牌堆顶九张牌，获得其中较多的同色牌",content:function(){player.storage.PSjiufa-=9,player.markSkill("PSjiufa");var a=e.cards(9);n.cardsGotoOrdering(a),player.showCards(a,"九伐");for(var r=[],t=[],i=0;i<a.length;i++)"red"==e.color(a[i])?r.push(a[i]):t.push(a[i]);event.cards=r.length>t.length?r:t,event.cards.length&&player.gain(event.cards,"gain2")},sub:!0}}},PSkefu:{audio:"tianren",enable:["chooseToRespond","chooseToUse"],filterCard:!0,filter:function(e,a){var n=a.hp;return a.countCards("hes")>=n},selectCard:function(e){return r.event.player.hp},position:"hes",viewAs:{name:"sha",isCard:!0,storage:{PSkefu:!0}},viewAsFilter:function(e){var a=e.hp;if(!e.countCards("hes"<a))return!1},mod:{cardUsable:function(e){if(e.storage&&e.storage.PSkefu)return 1/0}},prompt:function(a,n){var t=r.event.player.hp;return"将"+e.cnNumber(t)+"张牌当【杀】使用或打出"},check:function(a){var n=e.value(a);return"chooseToRespond"==r.event.name?1/Math.max(.1,n):5-n},ai:{skillTagFilter:function(a){if(e.zhu(a,"shouyue")){if(!a.countCards("hes"))return!1}else if(!a.countCards("hes",{color:"red"}))return!1},respondSha:!0,yingbian:function(r,t,i,o){if(e.attitude(o,t)<=0)return 0;var l=0,s=!1;return e.cardtag(r,"yingbian_hit")&&(s=!0,i.filter(function(a){return a.hasShan()&&e.attitude(o,a)<0&&e.damageEffect(a,t,o,e.nature(r))>0})&&(l+=5)),e.cardtag(r,"yingbian_all")&&n.hasPlayer(function(n){return!i.includes(n)&&a.filter.targetEnabled2(r,t,n)&&e.effect(n,r,t,t)>0})&&(l+=5),e.cardtag(r,"yingbian_damage")&&i.filter(function(a){return e.attitude(t,a)<0&&(s||!a.mayHaveShan()||t.hasSkillTag("directHit_ai",!0,{target:a,card:r},!0))&&!a.hasSkillTag("filterDamage",null,{player:t,card:r,jiu:!0})})&&(l+=5),l},canLink:function(e,a,n){return!(!a.isLinked()&&!e.hasSkill("wutiesuolian_skill"))&&(!(a.mayHaveShan()&&!e.hasSkillTag("directHit_ai",!0,{target:a,card:n},!0))&&!(e.hasSkill("jueqing")||e.hasSkill("gangzhi")||a.hasSkill("gangzhi")))},basic:{useful:[5,3,1],value:[5,3,1]},order:function(r,t){return t.hasSkillTag("presha",!0,null,!0)?10:a.linked.includes(e.nature(r))?n.hasPlayer(function(n){return n!=t&&n.isLinked()&&t.canUse(r,n,null,!0)&&e.effect(n,r,t,t)>0&&a.card.sha.ai.canLink(t,n,r)})&&n.countPlayer(function(a){return a.isLinked()&&e.damageEffect(a,t,t,e.nature(r))>0})>1?3.1:3:3.05},result:{target:function(a,n,r,t){var i=!t&&a.hasSkill("jiu")?n.hasSkillTag("filterDamage",null,{player:a,card:r,jiu:!0})?-.5:e.attitude(a,n)>0?-7:-4:-1.5;return t||!n.mayHaveShan()||a.hasSkillTag("directHit_ai",!0,{target:n,card:r},!0)?i:i/1.2}},tag:{respond:1,respondShan:1,damage:function(e){if(!n.hasNature(e,"poison"))return 1},natureDamage:function(e){if(n.hasNature(e))return 1},fireDamage:function(e,a){if(n.hasNature(e,"fire"))return 1},thunderDamage:function(e,a){if(n.hasNature(e,"thunder"))return 1},poisonDamage:function(e,a){if(n.hasNature(e,"poison"))return 1}}},group:["PSkefu_clear","PSkefu_recover"],subSkill:{clear:{trigger:{player:"useCardAfter"},forced:!0,silent:!0,charlotte:!0,filter:function(e,a){return"PSkefu"==e.skill&&0!=e.addCount},content:function(){trigger.addCount=!1,player.stat[player.stat.length-1].card.sha>0&&player.stat[player.stat.length-1].card.sha--},popup:!1,sub:!0},recover:{trigger:{source:"damageAfter"},forced:!0,popup:!1,filter:function(e,a){return e.card&&e.card.storage&&e.card.storage.PSkefu},content:function(){player.hp==player.maxHp?player.gainMaxHp():player.recover()},sub:!0}}},PSwantian:{audio:"pingxiang",enable:"phaseUse",usable:1,filter:function(e,a){return a.maxHp>1},content:function(){var e=player.hp-1,a=player.maxHp-1;e<0&&(e=0),player.loseMaxHp(a),player.draw(e+a)},ai:{order:1.5}}},sort:u.PScharacter_shen,translate:{PSshen_jiangweix:"PS神姜维",PSjiufa:"九伐",PSjiufa_info:"锁定技，当你使用牌指定其他角色时，你获得等同于目标数的“伐”标记。每回合限一次，当你的“伐”不小于九时，你移去九个“伐”并展示牌堆顶的九张牌，获得其中较多的同色牌。",PSkefu:"克复",PSkefu_info:"你可以将X张牌当作不计入次数且无次数限制的【杀】使用或打出（X为你当前体力值），此【杀】造成伤害后你回复一点体力，若不能回复则增加一点体力上限。",PSwantian:"挽天",PSwantian_info:"出牌阶段限一次，你可以将体力上限调整为一，你每以此法失去一点体力或体力上限摸一张牌。"},rank:c.rare},PShs_zhonghui:{info:{sex:"male",group:"wei",hp:4,skills:["PSmn_quanji","PSmn_paiyi"],clans:["颍川钟氏"],dieAudios:["xin_zhonghui"],trashBin:[]},intro:"由“sc蓝晨跃”设计",replace:["PShs_zhonghui","PSzhonghui"],skills:{PSmn_quanji:{group:"PSmn_quanji_phase",audio:"quanji",trigger:{player:"damageEnd"},filter:function(e,a){return e.num>0},frequent:!0,locked:!1,prompt2:"摸两张牌",content:function(){event.count=trigger.num,event.count--,player.draw(2),event.count>0?player.chooseBool(e.prompt("PSmn_quanji"),"摸两张牌").set("frequentSkill","PSmn_quanji"):event.finish(),result.bool&&(player.logSkill("PSmn_quanji"),event.goto(1))},onremove:function(e,a){var n=e.getExpansions("quanji");n.length&&e.loseToDiscardpile(n)},mod:{maxHandcard:function(e,a){return a+e.getExpansions("quanji").length},maxHandcardBase:function(e){return 0}},subSkill:{phase:{audio:"quanji",enable:"phaseUse",filter:function(e,a){return a.countCards("h")},prompt:"将任意张手牌置于武将牌上",selectCard:[1,1/0],filterCard:!0,delay:!1,discard:!1,lose:!1,check:function(a){var n=r.event.player,i=n.needsToDiscard();return!n.getExpansions("quanji").length||i-t.selected.cards.length-(n.getExpansions("quanji").length+t.selected.cards.length)>0?5-e.value(a):-1},content:function(){player.addToExpansion(cards,player,"give").gaintag.add("quanji")},ai:{order:5,result:{player:1}},sub:!0}}},PSmn_paiyi:{enable:"phaseUse",audio:"paiyi",audioname:["re_zhonghui"],filter:function(a,r){var t=n.countPlayer(function(a){return e.distance(a,r)<=1});return!(r.getStat().skill.PSmn_paiyi>=t)&&r.getExpansions("quanji").length>0},chooseButton:{dialog:function(e,a){return t.create.dialog("排异",a.getExpansions("quanji"),"hidden")},backup:function(e,n){return{audio:"paiyi",audioname:["re_zhonghui"],filterTarget:!0,filterCard:function(){return!1},direct:!0,selectCard:-1,card:e[0],delay:!1,content:a.skill.PSmn_paiyi.contentx,ai:{order:10,result:{target:function(e,a){return e!=a?0:e.hasSkill("PSmn_quanji")||e.countCards("h")+2<=e.hp+e.getExpansions("quanji").length?1:0}}}}},prompt:function(){return"请选择〖排异〗的目标"}},contentx:function(){player.logSkill("PSmn_paiyi",target);var e=a.skill.PSmn_paiyi_backup.card;player.loseToDiscardpile(e),target.draw(2),target.countCards("h")>player.countCards("h")&&target.damage()},ai:{order:1,combo:"PSmn_quanji",result:{player:1}}}},sort:u.PScharacter_wei,translate:{PShs_zhonghui:"PS欢杀钟会",PSmn_quanji:"权计",PSmn_quanji_info:"你的手牌上限基数为0。当你受到1点伤害后，你可以摸两张牌。出牌阶段，你可以将任意张手牌置于武将牌上，称为“权”。你的手牌上限+X（X为武将牌上“权”的数量）。",PSmn_paiyi:"排异",PSmn_paiyi_info:"出牌阶段限X次，你可以移去一张“权”并选择一名角色，令其摸两张牌，然后若其手牌数大于你，你对其造成1伤害。（X为场上与你距离不大于1的角色数）",PSmn_paiyi_backup:"排异"},rank:c.rare},PSzhuangbeidashi:{info:{sex:"male",group:"shu",hp:4,skills:["pytianjiang","pyzhuren","xinfu_jingxie1","PSshenzhu"],dieAudios:["puyuan"],trashBin:[]},intro:"由“10万原石”和“遇见鲲啊”设计",skills:{PSshenzhu:{audio:"qiaosi",enable:"phaseUse",filter:function(e,n){for(var r=n.getCards("he"),t=0,i=0;i<r.length;i++){if("equip"==a.card[r[i].name].type&&++t>=2)return!0}},filterCard:function(a){return(!t.selected.cards.length||a.name!=t.selected.cards[0].name)&&"equip"==e.info(a).type},selectCard:2,position:"hes",prompt:"请选择需要合成的两张装备牌，装备类型以先选择的牌为准",check:function(a){return e.value(a)},content:function(){var r=cards[0].name+"_"+cards[1].name,t=e.info(cards[0]),i=e.info(cards[1]);if(!a.card[r]){var o={enable:!0,type:"equip",subtype:e.subtype(cards[0]),vanish:!0,cardimage:t.cardimage||cards[0].name,filterTarget:function(e,a,n){return n==a},selectTarget:-1,modTarget:!0,content:a.element.content.equipCard,legend:!0,source:[cards[0].name,cards[1].name],onEquip:[],onLose:[],skills:[],distance:{},ai:{order:8.9,equipValue:10,useful:2.5,value:function(a,n){var r=0,t=e.info(a),i=n.getEquip(t.subtype);i&&a!=i&&(r=e.value(i,n));var o=t.ai.equipValue||t.ai.basic.equipValue;return"function"==typeof o?o(a,n)-r:o-r},result:{target:function(a,n){return e.equipResult(a,n,r)}}}};for(var l in t.distance)o.distance[l]=t.distance[l];for(var l in i.distance)"number"==typeof o.distance[l]?o.distance[l]+=i.distance[l]:o.distance[l]=i.distance[l];t.skills&&(o.skills=o.skills.concat(t.skills)),i.skills&&(o.skills=o.skills.concat(i.skills)),t.onEquip&&(Array.isArray(t.onEquip)?o.onEquip=o.onEquip.concat(t.onEquip):o.onEquip.push(t.onEquip)),i.onEquip&&(Array.isArray(i.onEquip)?o.onEquip=o.onEquip.concat(i.onEquip):o.onEquip.push(i.onEquip)),t.onLose&&(Array.isArray(t.onLose)?o.onLose=o.onLose.concat(t.onLose):o.onLose.push(t.onLose)),i.onLose&&(Array.isArray(i.onLose)?o.onLose=o.onLose.concat(i.onLose):o.onLose.push(i.onLose)),0==o.onEquip.length&&delete o.onEquip,0==o.onLose.length&&delete o.onLose,a.card[r]=o,a.translate[r]=e.translation(cards[0].name,"skill")+e.translation(cards[1].name,"skill");var s=a.translate[cards[0].name+"_info"];"."!=s[s.length-1]&&"。"!=s[s.length-1]||(s=s.slice(0,s.length-1)),a.translate[r+"_info"]=s+"；"+a.translate[cards[1].name+"_info"];try{n.addVideo("newcard",null,{name:r,translate:a.translate[r],info:a.translate[r+"_info"],card:cards[0].name,legend:!0})}catch(u){console.log(u)}}player.gain(n.createCard({name:r,suit:cards[0].suit,number:cards[0].number}),"gain2")},ai:{order:9.5,result:{player:1}}}},sort:u.PScharacter_shu,translate:{PSzhuangbeidashi:"装备大师",PSshenzhu:"神铸",PSshenzhu_info:"出牌阶段，你可以将两张装备牌合成一张装备牌。"},rank:c.rare},PSboss_lvbu1:{info:{sex:"male",group:"shen",hp:8,skills:["wushuang","PSjingjia1","PSaozhan1","PSbaguan1"],dieAudios:["boss_lvbu1"],isBossAllowed:!0,isBoss:!0,trashBin:[]},intro:"由“神鬼高达”设计",replace:["PSboss_lvbu1","PSboss_lvbu2","PSboss_lvbu3","PSboss_lvbu4"],skills:{PSjingjia1:{derivation:["wushuangfangtianji","shufazijinguan","hongmianbaihuapao","linglongshimandai"],trigger:{global:"phaseBefore",player:"enterGame"},filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},forced:!0,content:function(){var n=["wushuangfangtianji","shufazijinguan"];for(var r of(n.push(["hongmianbaihuapao","linglongshimandai"].randomGet()),n))if(a.inpile.includes(r)){var t=e.cardPile(function(e){return e.name==r});player.equip(t)}for(var i=[],o=1;o<=6;o++)player.isEmpty(o)&&i.push("equip"+o);for(r=0;r<i.length;r++){var l=e.cardPile(function(a){return e.subtype(a)==i[r]&&player.canUse(a,player)});l&&player.equip(l)}},mod:{canBeGained:function(e,a,n){if(n.getCards("e").includes(e))return!1},canBeDiscarded:function(e,a,n){if(n.getCards("e").includes(e))return!1},canBeReplaced:function(e,a){if(a.getCards("e").includes(e))return!1},cardDiscardable:function(e,a){if(a.getCards("e").includes(e))return!1},cardEnabled2:function(e,a){if(a.getCards("e").includes(e))return!1}},group:"PSjingjia1_blocker",subSkill:{blocker:{trigger:{player:["loseBefore","disableEquipBefore"]},forced:!0,filter:function(e,a){return"disableEquip"==e.name||e.cards.some(e=>a.getCards("e").includes(e))},content:function(){"lose"==trigger.name?trigger.cards.removeArray(player.getCards("e")):trigger.slots.removeArray(trigger.slots)},sub:!0,_priority:0}}},PSaozhan1:{forced:!0,group:["PSaozhan1_wuqi","PSaozhan1_fangju","PSaozhan1_zuoji","PSaozhan1_baowu","PSaozhan1_baowu2"],subSkill:{wuqi:{mod:{cardUsable:function(e,a,n){if(a.getEquip(1)&&"sha"==e.name)return n+1}},sub:!0},fangju:{trigger:{player:"damageBegin4"},forced:!0,filter:function(e,a){return a.getEquip(2)&&e.num>1},content:function(){trigger.num=1},sub:!0},zuoji:{trigger:{player:"phaseDrawBegin"},forced:!0,filter:function(e,a){return a.getEquip(3)||a.getEquip(4)||a.getEquip(6)},content:function(){trigger.num++},sub:!0},baowu:{trigger:{player:"phaseJudgeBefore"},forced:!0,filter:function(e,a){return a.getEquip(5)},content:function(){trigger.cancel(),n.log(player,"跳过了判定阶段")},sub:!0},baowu2:{init:function(e){e.isTurnedOver()&&(e.logSkill("PSaozhan1"),e.turnOver())},trigger:{player:"turnOverBefore"},filter:function(e,a){return!a.isTurnedOver()},forced:!0,content:function(){trigger.cancel()},sub:!0}}},PSbaguan1:{trigger:{global:"gameDrawBegin"},forced:!0,popup:!1,silent:!0,content:function(){var e=trigger.num;trigger.num=function(a){return a==player?8:"function"==typeof e?e(a):e}},ai:{threaten:1.3},group:["PSbaguan1_enter","PSbaguan1_phase","PSbaguan1_bianshen"],subSkill:{enter:{trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,priority:100,filter:function(e,r){var t=!1;for(var i of["wushuangfangtianji","shufazijinguan","hongmianbaihuapao","linglongshimandai"])if(!a.inpile.includes(i)){t=!0;break}return 0!=t&&("phase"!=e.name||0==n.phaseNumber)},content:function(){for(var r of["wushuangfangtianji","shufazijinguan","hongmianbaihuapao","linglongshimandai"])if(!a.inpile.includes(r)){var i=n.createCard2(r,a.suit.randomGet(),e.rand(1,13));t.cardPile.insertBefore(i,t.cardPile.childNodes[e.rand(0,t.cardPile.childNodes.length)]),n.log(r,"加入了牌堆"),n.broadcastAll(function(){a.inpile.add(r)})}n.updateRoundNumber()},sub:!0},phase:{trigger:{global:"phaseAfter"},filter:function(e,a){return e.player!=a&&r.currentPhase.next!=a},priority:-1,forced:!0,content:function(){player.insertPhase()},sub:!0},bianshen:{audio:"baonu",skillAnimation:!0,animationStr:"变身",trigger:{global:"roundStart",player:["changeHp","dieBefore"]},filter:function(e,a){return"changeHp"==e.name?a.hp<=a.getDamagedHp():"die"==e.name||n.roundNumber>=2},forced:!0,content:function(){"die"==trigger.name&&trigger.cancel();var e=["暴怒战神","神鬼无前","炼狱修罗"];for(player.chooseControl(e,function(){return e.randomGet()}).set("prompt","请选择一个变身形态："),"暴怒战神"==result.control?a.skill.PSbaguan1.reinitCharacter(player,"PSboss_lvbu1","PSboss_lvbu2",[6,6]):"神鬼无前"==result.control?a.skill.PSbaguan1.reinitCharacter(player,"PSboss_lvbu1","PSboss_lvbu3",[6,6]):a.skill.PSbaguan1.reinitCharacter(player,"PSboss_lvbu1","PSboss_lvbu4",[6,6]),t.clear(),player.isLinked()&&player.link(),player.isTurnedOver()&&player.turnOver(),player.discard(player.getCards("j"));"phaseLoop"!=r.event.name;)r.event=r.event.parent;n.resetSkills(),r.paused=!1,r.event.player=player,r.event.step=0,r.roundStart=player},ai:{effect:{target:function(a,r,t){if((e.tag(a,"damage")||e.tag(a,"loseHp"))&&5==r.hp){if(n.players.length<4)return[0,5];for(var i=0,o=0;o<n.players.length;o++)n.players[o]!=n.me&&1==n.players[o].hp&&i++;if(i>1)return[0,2];if(i&&Math.random()<.7)return[0,1]}}}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSboss_lvbu1:"新最强神话",PSjingjia1:"精甲",PSjingjia1_info:"锁定技，游戏开始时，你将五张对应装备栏的装备牌置入你的装备区；当你即将废除装备区或失去装备区的牌时，取消之。",PSaozhan1:"鏖战",PSaozhan1_info:"锁定技，若你装备区内有：武器牌，你可以多使用一张【杀】；防具牌，你受到的伤害始终为一；坐骑牌，摸牌阶段多摸一张牌；宝物牌，跳过你的判定阶段，且你无法被翻面。",PSbaguan1:"霸关",PSbaguan1_info:"锁定技，你的初始手牌数为8，游戏开始时，你将四张虎牢关专属装备置入牌堆，每名角色回合结束后，你执行一个额外回合，你无法因此连续行动两个回合。当你的体力值不大于已损失体力值/游戏第二轮开始时/你将要阵亡时，终止阵亡结算，选择将武将牌替换为“暴怒战神”、“神鬼无前”或“炼狱修罗”，然后将体力值和体力上限调整为6并立即开始你的回合。","#ext:PS武将/audio/skill/wushuang1":"哼！不自量力。","#ext:PS武将/audio/skill/wushuang2":"纵横沙场，难逢敌手。","#ext:PS武将/audio/skill/wushuang3":"修罗降世,神鬼辟易。","#ext:PS武将/audio/skill/wushuang4":"仰云天降，修罗挥兵。","#ext:PS武将/audio/skill/wushuang5":"尔等营狗之辈，如何配做本将军对手。","#ext:PS武将/audio/skill/wushuang6":"天下武夫万千,皆非吾一合之将。","#ext:PS武将/audio/skill/wushuang7":"画戟一击，五脏俱损。","#ext:PS武将/audio/skill/wushuang8":"尔等凡夫，怎敌吾千钧之力！"},rank:c.legend},PSboss_lvbu2:{info:{sex:"male",group:"shen",hp:6,skills:["wushuang","PSshenwei2","PSshenji2","PSbaguan2"],dieAudios:["boss_lvbu2"],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSshenwei2:{mod:{maxHandcard:function(e,a){return e.maxHp}},audio:"xiuluo",trigger:{player:"phaseJudgeBegin"},charlotte:!0,forced:!0,filter:function(e,a){return a.countCards("j")&&a.countCards("hes")>1},content:function(){player.chooseToDiscard("hes",2,"神威：弃置两张牌并弃置自己判定区的所有牌",!0).set("logSkill","PSshenwei2").ai=function(a){return 6-e.value(a)},result.bool&&player.discard(player.getCards("j"))},group:"PSshenwei2_draw",subSkill:{draw:{audio:"shenwei",trigger:{player:"phaseDrawBegin"},forced:!0,content:function(){trigger.num+=3},sub:!0}}},PSshenji2:{audio:"shenji",enable:"phaseUse",usable:2,filter:function(e,a){return a.countCards("hes")},content:function(){player.chooseToDiscard("hes",!0);var e=["使用【杀】可以额外指定两名目标。","使用【杀】无距离限制，且次数+1。","使用【杀】造成伤害+1。","使用【杀】指定目标时，目标须弃置一张牌。"];player.storage.PSshenji2&&e.remove(player.storage.PSshenji2),player.chooseControl().set("choiceList",e).set("ai",function(){return(4==e.length?[0,1,2,3]:[0,1,2]).randomGet()}).set("prompt","神戟：请选择你要获得的效果"),event.list=e;var a=event.list[result.index];switch(player.storage.PSshenji2=a,a){case"使用【杀】可以额外指定两名目标。":player.addTempSkill("PSshenji2_multi");break;case"使用【杀】无距离限制，且次数+1。":player.addTempSkill("PSshenji2_distance");break;case"使用【杀】造成伤害+1。":player.addTempSkill("PSshenji2_damage");break;default:player.addTempSkill("PSshenji2_discard")}},group:"PSshenji2_clear",subSkill:{clear:{trigger:{player:"phaseUseEnd"},direct:!0,nopup:!0,filter:function(e,a){return a.storage.PSshenji2},content:function(){player.storage.PSshenji2=void 0},sub:!0},multi:{mod:{selectTarget:function(e,a,n){"sha"==e.name&&-1!=n[1]&&(n[1]+=2)}},sub:!0},distance:{mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+1},targetInRange:function(a,n,r,t){if("sha"==e.name(a))return!0}},sub:!0},damage:{trigger:{source:"damageBegin1"},filter:function(e){return e.card&&"sha"==e.card.name},forced:!0,direct:!0,content:function(){trigger.num++},ai:{damageBonus:!0},sub:!0},discard:{trigger:{player:"shaBegin"},filter:function(e,a){return e.target.countCards("he")},forced:!0,check:function(a,n){return e.attitude(n,a.target)<0},logTarget:"target",content:function(){trigger.target.chooseToDiscard("he",1,!0)},sub:!0}}},PSbaguan2:{enable:"phaseUse",filter:function(e,a){return!a.hasSkill("PSbaguan2_clear")},reinitCharacter:(e,a,n,r)=>(e.reinit(a,a,r),e.reinitCharacter(a,n)),content:function(){var e=[];for(var n of["PSshenji2_multi","PSshenji2_distance","PSshenji2_damage","PSshenji2_discard"])player.hasSkill(n)&&e.push(n);if(player.storage.PSjiwu3&&player.storage.PSjiwu3.length>0)for(var r of player.storage.PSjiwu3)e.push(r);event.skills=e;var t=["暴怒战神","神鬼无前","炼狱修罗"];switch(player.name){case"PSboss_lvbu2":t.remove("暴怒战神");break;case"PSboss_lvbu3":t.remove("神鬼无前");break;case"PSboss_lvbu4":t.remove("炼狱修罗")}t.push("cancel2"),player.chooseControl(t,function(){return t.randomGet()}).set("prompt","请选择你要变换的形态：");const i=player.name1.startsWith("PSboss_lvbu")?player.name1:player.name2&&player.name2.startsWith("PSboss_lvbu")?player.name2:player.name1;if("暴怒战神"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu2"):"神鬼无前"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu3"):"炼狱修罗"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu4"):event.finish(),player.logSkill("PSbaguan1_bianshen"),player.addSkill("PSbaguan2_clear"),event.skills.length>0)for(var n of event.skills)player.addTempSkill(n)},group:"PSbaguan2_else",subSkill:{else:{trigger:{player:["phaseZhunbeiBegin","phaseJieshuBegin"]},direct:!0,priority:-1,filter:function(e,a){return!a.hasSkill("PSbaguan2_clear")},content:function(){var e=[];for(var n of["PSshenji2_multi","PSshenji2_distance","PSshenji2_damage","PSshenji2_discard"])player.hasSkill(n)&&e.push(n);if(player.storage.PSjiwu3&&player.storage.PSjiwu3.length>0)for(var r of player.storage.PSjiwu3)e.push(r);event.skills=e;var t=["暴怒战神","神鬼无前","炼狱修罗"];switch(player.name){case"PSboss_lvbu2":t.remove("暴怒战神");break;case"PSboss_lvbu3":t.remove("神鬼无前");break;case"PSboss_lvbu4":t.remove("炼狱修罗")}t.push("cancel2"),player.chooseControl(t,function(){return t.randomGet()}).set("prompt","请选择你要变换的形态：");const i=player.name1.startsWith("PSboss_lvbu")?player.name1:player.name2&&player.name2.startsWith("PSboss_lvbu")?player.name2:player.name1;if("暴怒战神"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu2"):"神鬼无前"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu3"):"炼狱修罗"==result.control?a.skill.PSbaguan1.reinitCharacter(player,i,"PSboss_lvbu4"):event.finish(),player.logSkill("PSbaguan1_bianshen"),player.addSkill("PSbaguan2_clear"),event.skills.length>0)for(var n of event.skills)player.addTempSkill(n)},sub:!0},clear:{direct:!0,charlotte:!0,sub:!0,trigger:{global:"roundStart"},content:function(){player.removeSkill("PSbaguan2_clear")}}}}},sort:u.PScharacter_shen,translate:{PSboss_lvbu2:"新暴怒战神",PSshenwei2:"神威",PSshenwei2_info:"锁定技，判定阶段，若你的判定区有牌，则你须弃置两张牌，然后弃置自己判定区内的所有牌；摸牌阶段，你额外摸三张牌，你的手牌上限为你的体力上限。",PSshenji2:"神戟",PSshenji2_info:"出牌阶段限两次，你可以弃置一张牌，然后获得未拥有的一项效果直到回合结束：<br/>一、使用【杀】可以额外指定两名目标。<br/>二、使用【杀】无距离限制，且次数+1。<br/>三、使用【杀】造成伤害+1。<br/>四、使用【杀】指定目标时，目标须弃置一张牌。",PSbaguan2:"霸关",PSbaguan2_info:"每轮限一次，回合开始阶段/出牌阶段/回合结束阶段可发动，你可以将武将牌替换为“暴怒战神”“神鬼无前”或“炼狱修罗”（三种形态共享次数），〖狂暴〗或由〖神戟〗〖极武〗获得的效果不会因武将牌替换而消失。"},rank:c.legend},PSboss_lvbu3:{info:{sex:"male",group:"shen",hp:6,skills:["wushuang","PSshenqu3","PSjiwu3","PSbaguan2"],dieAudios:["boss_lvbu3"],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSshenqu3:{audio:"shenqu",group:"PSshenqu3_tao",trigger:{global:"phaseZhunbeiBegin"},filter:function(e,a){return a.countCards("h")<=a.maxHp},forced:!0,content:function(){var e=Math.min(2,player.getDamagedHp());player.draw(e+1)},subSkill:{tao:{trigger:{player:"damageAfter"},direct:!0,filter:function(e,a){return!!a.canUse("tao",a,!1)&&(a.hasSkillTag("respondTao")||a.countCards("h","tao")>0)},content:function(){player.chooseToUse({name:"tao"},"神躯：请使用一张桃",!0).logSkill="PSshenqu3"},sub:!0}}},PSjiwu3:{init:function(e){e.addSkill("PSjiwu3_clear"),e.storage.PSjiwu3||(e.storage.PSjiwu3=[])},derivation:["qiangxix","retieji","decadexuanfeng","rewansha"],audio:"jiwu",enable:"phaseUse",usable:2,filter:function(e,a){return 0!=a.countCards("h")&&(!a.hasSkill("qiangxix")||(!a.hasSkill("retieji")||(!a.hasSkill("decadexuanfeng")||!a.hasSkill("rewansha"))))},filterCard:!0,position:"he",check:function(a){return"e"==e.position(a)&&r.event.player.hasSkill("decadexuanfeng")?16-e.value(a):7-e.value(a)},content:function(){var a=[];player.hasSkill("qiangxix")||a.push("qiangxix"),player.hasSkill("retieji")||a.push("retieji"),player.hasSkill("decadexuanfeng")||a.push("decadexuanfeng"),player.hasSkill("rewansha")||a.push("rewansha"),1==a.length?(player.addTempSkill(a[0]),event.finish()):player.chooseControl(a,function(){if(a.includes("decadexuanfeng")&&player.countCards("he",{type:"equip"}))return"decadexuanfeng";if(!player.getStat().skill.qiangxix){if(player.hasSkill("qiangxix")&&player.getEquip(1)&&a.includes("decadexuanfeng"))return"decadexuanfeng";if(a.includes("rewansha")||a.includes("qiangxix"))for(var r=n.filterPlayer(),t=0;t<r.length;t++)if(1==r[t].hp&&e.attitude(player,r[t])<0){if(a.includes("rewansha"))return"rewansha";if(a.includes("qiangxix"))return"qiangxix"}}return a.includes("qiangxix")?"qiangxix":a.includes("rewansha")?"rewansha":a.includes("decadexuanfeng")?"decadexuanfeng":"retieji"}).set("prompt","选择获得一项技能直到回合结束"),player.addTempSkill(result.control),player.storage.PSjiwu3.push(result.control),player.popup(e.translation(result.control))},ai:{order:function(){var a=r.event.player;if(a.countCards("e",{type:"equip"}))return 10;if(!a.getStat().skill.qiangxix){if(a.hasSkill("qiangxix")&&a.getEquip(1)&&!a.hasSkill("decadexuanfeng"))return 10;if(a.hasSkill("rewansha"))return 1;for(var t=n.filterPlayer(),i=0;i<t.length;i++)if(1==t[i].hp&&e.attitude(a,t[i])<0)return 10}return 1},result:{player:function(a){if(a.countCards("e",{type:"equip"}))return 1;if(!a.getStat().skill.qiangxix){if(a.hasSkill("qiangxix")&&a.getEquip(1)&&!a.hasSkill("decadexuanfeng"))return 1;if(!a.hasSkill("rewansha")||!a.hasSkill("qiangxix"))for(var r=n.filterPlayer(),t=0;t<r.length;t++)if(1==r[t].hp&&e.attitude(a,r[t])<0)return 1}return 0}}},subSkill:{clear:{trigger:{player:"phaseAfter"},direct:!0,superCharlotte:!0,popup:!1,filter:function(e,a){return a.storage.PSjiwu3},content:function(){player.storage.PSjiwu3=[]},sub:!0},audio:{trigger:{player:["logSkill","useSkillBegin"]},direct:!0,superCharlotte:!0,popup:!1,filter:function(e,a){return"qiangxix"==e.skill||"rewansha"==e.skill||"retieji"==e.skill||"decadexuanfeng"==e.skill||"wushuang"==e.skill},content:function(){switch(trigger.skill){case"qiangxix":var e=["qiangxix1","qiangxix2"].randomGet();n.playAudio("..","extension","PS武将/audio/skill",e);break;case"rewansha":var a=["rewansha1","rewansha2"].randomGet();n.playAudio("..","extension","PS武将/audio/skill",a);break;case"retieji":n.playAudio("..","extension","PS武将/audio/skill","retieji1");break;case"decadexuanfeng":var r=["decadexuanfeng1","decadexuanfeng2"].randomGet();n.playAudio("..","extension","PS武将/audio/skill",r);break;default:var t=["wushuang1","wushuang2","wushuang3","wushuang4","wushuang5","wushuang6","wushuang7","wushuang8"].randomGet();n.playAudio("..","extension","PS武将/audio/skill",t)}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSboss_lvbu3:"新神鬼无前",PSshenqu3:"神躯",PSshenqu3_info:"锁定技，一名角色准备阶段，若你的手牌数不大于体力上限，你摸X+1张牌（X为你已损失的体力值且至多为2）。当你受到伤害后，若你手牌中有【桃】，则你使用之。",PSjiwu3:"极武",PSjiwu3_info:"出牌阶段限两次，你可以弃置一张牌，然后选择获得【强袭】、【铁骑】、【旋风】、【完杀】中的一项技能直到回合结束。"},rank:c.legend},PSboss_lvbu4:{info:{sex:"male",group:"shen",hp:6,skills:["wushuang","PSkuangbao4","PSshenfen4","PSbaguan2"],dieAudios:["shen_lvbu"],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSkuangbao4:{audio:"baonu",marktext:"💢",superCharlotte:!0,trigger:{source:"damageSource",player:"damageEnd"},forced:!0,init:function(e){e.addMark("PSkuangbao4",2),e.logSkill("PSkuangbao4"),n.log(e,"获得了两枚“暴怒”标记")},filter:function(e,a){return e.num>0&&a.countMark("PSkuangbao4")<6},content:function(){player.addMark("PSkuangbao4",1)},intro:{name:"暴怒",content:"mark"},ai:{combo:"PSshenfen4",maixie:!0,maixie_hp:!0}},PSshenfen4:{audio:"shenfen",enable:"phaseUse",usable:2,filter:function(e,a){return a.hasMark("PSkuangbao4")},content:function(){var t,i=["回复一点体力或令一名其他角色失去一点体力","使用的下一张普通锦囊牌额外指定两名角色（【铁索连环】改为一名，若目标包括自己，则可收回锦囊牌）","摸三张牌并弃置所有其他角色装备区所有牌和4张手牌","所有其他角色受到一点无来源伤害，然后自己获得X个“💢”标记（X为场上已受伤角色数，至多为3）"],o=["一个","两个","三个","四个"];switch((u=player.countMark("PSkuangbao4"))<4&&(i=i.slice(0,u),o=o.slice(0,u)),player.chooseControl(o).set("choiceList",i).set("ai",function(){return e.rand(0,o.length)}).set("prompt","神愤：请选择你要弃置的“💢”标记个数"),result.index){case 0:player.removeMark("PSkuangbao4",1),player.hasMark("PSkuangbao4")?player.markSkill("PSkuangbao4"):player.unmarkSkill("PSkuangbao4"),event.goto(2);break;case 1:player.removeMark("PSkuangbao4",2),player.hasMark("PSkuangbao4")?player.markSkill("PSkuangbao4"):player.unmarkSkill("PSkuangbao4"),player.addSkill("PSshenfen4_use"),event.finish();break;case 2:player.removeMark("PSkuangbao4",3),player.hasMark("PSkuangbao4")?player.markSkill("PSkuangbao4"):player.unmarkSkill("PSkuangbao4"),event.goto(4);break;default:player.removeMark("PSkuangbao4",4),event.goto(6)}player.chooseTarget(1,a.filter.notMe,"神愤：是否令一名角色失去一点体力？或点击“取消”回复一点体力",!1).set("ai",function(a){return-e.attitude(r.event.player,a)/a.hp}),result.bool?result.targets[0].loseHp():player.recover(),event.finish(),player.draw(3),(t=n.filterPlayer(e=>e!=player)).sort(a.sort.seat);for(var l=0;l<t.length;l++){(u=t[l].getCards("e").length)&&player.discardPlayerCard("e",u,t[l],!0)}if(event.targets=t,event.num=0,player.line(t,"green"),u<event.targets.length){var s=event.targets[u].getCards("h");s.length&&(s.length<=4?player.discardPlayerCard("h",s.length,event.targets[u],!0):player.discardPlayerCard("h",4,event.targets[u],!0)),event.num++,event.redo()}else event.finish();(t=n.filterPlayer(e=>e!=player)).sort(a.sort.seat);for(l=0;l<t.length;l++)t[l].damage("nosource");var u=n.countPlayer(e=>e.isDamaged());u=Math.min(3,u),player.addMark("PSkuangbao4",u),player.markSkill("PSkuangbao4")},subSkill:{use:{trigger:{player:"useCard2"},direct:!0,filter:function(a,n){return"trick"==e.type(a.card)},content:function(){player.removeSkill("PSshenfen4_use");var t=!1,i=e.info(trigger.card);if(trigger.targets&&!i.multitarget)for(var o=n.filterPlayer(),l=0;l<o.length;l++)if(a.filter.targetEnabled2(trigger.card,player,o[l])&&!trigger.targets.includes(o[l])){t=!0;break}if(t&&"tiesuo"!=trigger.card.name&&player.chooseTarget("神愤：是否额外指定一至两名"+e.translation(trigger.card)+"的目标？",[1,2],function(e,n,t){var i=r.event;return!i.targets.includes(t)&&a.filter.targetEnabled2(i.card,r.event.player,t)}).set("ai",function(a){var n=r.event.getTrigger(),t=r.event.player;return e.effect(a,n.card,t,t)}).set("targets",trigger.targets).set("card",trigger.card),t&&"tiesuo"==trigger.card.name&&player.chooseTarget("神愤：是否额外指定一名"+e.translation(trigger.card)+"的目标？",1,function(e,n,t){var i=r.event;return!i.targets.includes(t)&&a.filter.targetEnabled2(i.card,r.event.player,t)}).set("ai",function(a){var n=r.event.getTrigger(),t=r.event.player;return e.effect(a,n.card,t,t)}).set("targets",trigger.targets).set("card",trigger.card),result.bool?(event.isMine()||n.delayx(),event.targets=result.targets):event.goto(3),event.targets)for(var s of(player.logSkill("PSshenfen4",event.targets),event.targets))trigger.targets.add(s);trigger.cards&&trigger.cards.length&&trigger.targets.includes(player)&&(player.gain(trigger.cards),player.$gain2(trigger.cards),n.log(player,"收回了",trigger.cards))},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSboss_lvbu4:"新炼狱修罗",PSkuangbao4:"狂暴",PSkuangbao4_info:"锁定技，游戏开始时，你获得两枚“暴怒”标记；当你造成/受到伤害后，你获得1枚“暴怒”标记。（你的“暴怒”标记至多为6）",PSshenfen4:"神愤",PSshenfen4_info:"出牌阶段限两次，你可以弃置一定数量的“狂暴”标记，然后执行一项效果: <br/>一枚：你选择回复一点体力或令一名其他角色失去一点体力<br/>两枚：你使用的下一张非延时锦囊牌可额外指定两名角色为目标(铁锁连环改为增加一个目标)，若该锦囊牌的目标包括自己，你收回此牌<br/>三枚：你摸三张牌并弃置场上所有其他角色四张手牌和装备区内的所有牌<br/>四枚:所有其他角色受到一点无来源伤害，然后你获得X枚“狂暴”标记( X为场上受到伤害的角色数，以此法获得的“狂暴”标记最多为3 )"},rank:c.legend},PSshengui:{info:{sex:"male",group:"shen",hp:6,skills:["wushuang","PSshenqu","PSjiwu"],dieAudios:["boss_lvbu1"],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSshenqu:{audio:"shenqu",group:"PSshenqu2",trigger:{global:"phaseZhunbeiBegin"},filter:function(e,a){return a.countCards("h")<=a.maxHp},frequent:!0,content:function(){player.draw(2)}},PSjiwu:{derivation:["PSmn_qiangxi","sbtieji","decadexuanfeng","rewansha"],audio:"jiwu",enable:"phaseUse",init:function(){},filter:function(e,a){return 0!=a.countCards("h")&&(!a.hasSkill("PSmn_qiangxi")||(!a.hasSkill("sbtieji")||(!a.hasSkill("decadexuanfeng")||!a.hasSkill("rewansha"))))},filterCard:!0,position:"he",check:function(a){return"e"==e.position(a)&&r.event.player.hasSkill("decadexuanfeng")?16-e.value(a):7-e.value(a)},content:function(){var a=[];player.hasSkill("PSmn_qiangxi")||a.push("PSmn_qiangxi"),player.hasSkill("sbtieji")||a.push("sbtieji"),player.hasSkill("decadexuanfeng")||a.push("decadexuanfeng"),player.hasSkill("rewansha")||a.push("rewansha"),1==a.length?(player.addTempSkill(a[0]),event.finish()):player.chooseControl(a,function(){if(a.includes("decadexuanfeng")&&player.countCards("he",{type:"equip"}))return"decadexuanfeng";if(!player.getStat().skill.PSmn_qiangxix){if(player.hasSkill("PSmn_qiangxi")&&player.getEquip(1)&&a.includes("decadexuanfeng"))return"decadexuanfeng";if(a.includes("rewansha")||a.includes("PSmn_qiangxi"))for(var r=n.filterPlayer(),t=0;t<r.length;t++)if(1==r[t].hp&&e.attitude(player,r[t])<0){if(a.includes("rewansha"))return"rewansha";if(a.includes("PSmn_qiangxi"))return"PSmn_qiangxi"}}return a.includes("PSmn_qiangxi")?"PSmn_qiangxi":a.includes("rewansha")?"rewansha":a.includes("decadexuanfeng")?"decadexuanfeng":"sbtieji"}).set("prompt","选择获得一项技能直到回合结束"),player.addTempSkill(result.control),player.popup(e.translation(result.control))},ai:{order:function(){var a=r.event.player;if(a.countCards("e",{type:"equip"}))return 10;if(!a.getStat().skill.PSmn_qiangxix){if(a.hasSkill("PSmn_qiangxi")&&a.getEquip(1)&&!a.hasSkill("decadexuanfeng"))return 10;if(a.hasSkill("rewansha"))return 1;for(var t=n.filterPlayer(),i=0;i<t.length;i++)if(1==t[i].hp&&e.attitude(a,t[i])<0)return 10}return 1},result:{player:function(a){if(a.countCards("e",{type:"equip"}))return 1;if(!a.getStat().skill.PSmn_qiangxix){if(a.hasSkill("PSmn_qiangxi")&&a.getEquip(1)&&!a.hasSkill("decadexuanfeng"))return 1;if(!a.hasSkill("rewansha")||!a.hasSkill("PSmn_qiangxi"))for(var r=n.filterPlayer(),t=0;t<r.length;t++)if(1==r[t].hp&&e.attitude(a,r[t])<0)return 1}return 0}}}},PSmn_qiangxi:{audio:"qiangxi_boss_lvbu3",group:"PSmn_qiangxi_damage",trigger:{global:"damageBegin2"},filter:function(e,a){return e.player!=a&&a.countCards("he",{type:"equip"})>0},direct:!0,content:function(){player.chooseToDiscard("he",e.prompt("PSmn_qiangxi",trigger.player),"弃置一张装备牌并令此伤害+1",function(a){return"equip"==e.type(a)}).set("goon",e.damageEffect(trigger.player,player,player)>0).set("ai",function(a){return r.event.goon?12-e.value(a):0}),result.bool&&trigger.num++},ai:{expose:.25},subSkill:{damage:{audio:"qiangxi_boss_lvbu3",enable:"phaseUse",filter:function(e,a){return n.hasPlayer(function(e){return a.inRange(e)&&!e.hasSkill("PSmn_qiangxi_used")})},filterTarget:function(e,a,n){return a!=n&&(!n.hasSkill("PSmn_qiangxi_used")&&a.inRange(n))},prompt:"失去1点体力并摸一张牌，对一名其他角色造成1点伤害",content:function(){player.loseHp(),player.draw(),target.addTempSkill("PSmn_qiangxi_used"),target.damage()},ai:{order:8.5,result:{target:function(n,r){var t="主"==a.translate[n.identity]||"内"==a.translate[n.identity]||"identity"==e.mode()&&n.hasSkill("olzaowang2")&&"nei"!=a.translate[n.identity];return t&&r.hp-n.hp>1||!t&&n.hp<2&&!n.countCards("hs",{name:["tao","jiu"]})?0:-1}}},sub:!0},used:{charlotte:!0,sub:!0}}},PSshenqu2:{trigger:{player:"damageAfter"},direct:!0,filter:function(e,a){return a.hasSkillTag("respondTao")||a.countCards("h","tao")>0},content:function(){player.chooseToUse({name:"tao"},"神躯：是否使用一张桃？").logSkill="shenqu"}}},sort:u.PScharacter_shen,translate:{PSshengui:"PS神鬼无前",PSshenqu:"神躯",PSshenqu_info:"每名角色的准备阶段，若你的手牌数少于或等于你的体力上限数，你可以摸两张牌；当你受到伤害后，你可以使用一张【桃】。",PSjiwu:"极武",PSjiwu_info:"出牌阶段，你可以弃置一张牌，然后选择获得【强袭】、【铁骑】、【旋风】、【完杀】中的一项技能直到回合结束。",PSmn_qiangxi:"强袭",PSmn_qiangxi_info:"出牌阶段对每名其他角色限一次，你可以失去1点体力并摸一张牌，对你攻击范围内的一名其他角色造成1点伤害；其他角色受到伤害时，你可以弃置一张装备牌并令伤害值+1。"},rank:c.epic},PSzhangrang:{info:{sex:"male",group:"qun",hp:4,skills:["PStaoluan"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PStaoluan:{audio:"taoluan",enable:["chooseToUse","chooseToRespond"],filter:function(n,r){if(!r.countCards("hse"))return!1;for(var t of a.inpile){var i=e.type2(t);if(("basic"==i||"trick"==i)&&n.filterCard({name:t},r,n))return!0}return!1},init:function(e){e.storage.PStaoluan||(e.storage.PStaoluan=[])},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];if(!r.storage.PStaoluan||!r.storage.PStaoluan.includes(l))if("sha"==l)for(var s of(n.filterCard({name:l},r,n)&&i.push(["基本","","sha"]),a.inpile_nature))n.filterCard({name:l,nature:s},r,n)&&i.push(["基本","","sha",s]);else"trick"==e.type2(l)&&n.filterCard({name:l},r,n)?i.push(["锦囊","",l]):"basic"==e.type(l)&&n.filterCard({name:l},r,n)&&i.push(["基本","",l])}return t.create.dialog("滔乱",[i,"vcard"])},filter:function(e,a){return r.event.getParent().filterCard({name:e.link[2]},a,r.event.getParent())},check:function(e){if("phase"!=r.event.getParent().type)return 1;var a=r.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:a.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:!0,audio:"taoluan",popname:!0,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3]},onuse:function(e,a){a.storage.PStaoluan.add(e.card.name)}}},prompt:function(a,n){return"将一张牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},hiddenCard:function(n,r){if(!a.inpile.includes(r))return!1;var t=e.type2(r);return("basic"==t||"trick"==t)&&n.countCards("she")>0},ai:{fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(e){if(!e.countCards("hse"))return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},group:["PStaoluan_draw","PStaoluan_clear"],subSkill:{draw:{trigger:{player:["useCardAfter","respondAfter"]},forced:!0,charlotte:!0,popup:!1,filter:function(e,a){return"PStaoluan_backup"==e.skill},content:function(){player.draw()},sub:!0},clear:{trigger:{global:"phaseJieshuEnd"},forced:!0,charlotte:!0,popup:!1,filter:function(e,a){return a.storage.PStaoluan},content:function(){player.storage.PStaoluan=[]},sub:!0}}}},sort:u.PScharacter_qun,translate:{PSzhangrang:"PS张让",PStaoluan:"滔乱",PStaoluan_info:"每回合每种牌名限一次，你可以将一张牌当做任意一张基本牌或锦囊牌使用或打出，然后你摸一张牌。"},rank:c.epic},PSxizhicai:{info:{sex:"male",group:"wei",hp:3,skills:["tiandu","PSxianfu","PSchouce"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSxianfu:{trigger:{global:["phaseBefore","dieAfter"],player:"enterGame"},forced:!0,filter:function(e,a){return"die"==e.name?!a.storage.PSxianfu_target.length:n.players.length>1&&("phase"!=e.name||0==n.phaseNumber)},audio:"xianfu",content:function(){if(player.chooseTarget("请选择【先辅】的目标",a.skill.PSxianfu_info,!0,function(e,a,n){return!(n==a||a.storage.PSxianfu_target&&a.storage.PSxianfu_target.includes(n))}).set("ai",function(a){var n=e.attitude(r.event.player,a);return n>0?n+1:0==n?Math.random():n}).animate=!1,result.bool){var n=result.targets[0];player.storage.PSxianfu_target||(player.storage.PSxianfu_target=[]),player.storage.PSxianfu_target.push(n),player.addSkill("PSxianfu_target")}},group:["PSxianfu_target","PSxianfu_lose"],subSkill:{target:{audio:"xianfu",charlotte:!0,trigger:{global:["damageEnd","recoverEnd","gainEnd","loseEnd"]},forced:!0,filter:function(e,a){return!(e.player.isDead()||!a.storage.PSxianfu_target||!a.storage.PSxianfu_target.includes(e.player)||e.num<=0)&&("gain"==e.name?"draw"==e.getParent().name:"lose"==e.name?"discard"==e.type:"recover"!=e.name||a.isDamaged())},logTarget:"player",content:function(){var e=trigger.player;e.storage.PSxianfu_mark||(e.storage.PSxianfu_mark=[]),e.storage.PSxianfu_mark.add(player),e.storage.PSxianfu_mark.sortBySeat(),e.markSkill("PSxianfu_mark"),n.delayx(),["damage","recover"].includes(trigger.name)&&player[trigger.name](trigger.num,"nosource"),"gain"==trigger.name&&player.draw(trigger.cards.length),"lose"==trigger.name&&player.chooseToDiscard("he",trigger.cards.length,!0)},onremove:function(e){e.storage.PSxianfu_target&&(n.countPlayer(function(a){e.storage.PSxianfu_target.includes(a)&&a.storage.PSxianfu_mark&&(a.storage.PSxianfu_mark.remove(e),a.storage.PSxianfu_mark.length?a.markSkill("PSxianfu_mark"):a.unmarkSkill("PSxianfu_mark"))}),delete e.storage.PSxianfu_target)},sub:!0},mark:{marktext:"先辅",intro:{name:"先辅",content:"当你受到伤害/回复体力/摸牌/弃牌后，$受到等量的伤害/回复等量的体力/摸等量的牌/弃置等量的牌"},sub:!0},lose:{trigger:{global:"dieBegin"},silent:!0,filter:function(e,a){return e.player==a||a.storage.PSxianfu_target&&a.storage.PSxianfu_target.includes(e.player)},content:function(){player==trigger.player?a.skill.PSxianfu_target.onremove(player):player.storage.PSxianfu_target.remove(trigger.player)},forced:!0,popup:!1,sub:!0}}},PSchouce:{audio:"chouce",trigger:{player:"damageEnd"},content:function(){if(event.num=trigger.num,player.judge(),event.color=result.color,"black"==event.color)n.hasPlayer(function(e){return e.countDiscardableCards(player,"hej")>0})?player.chooseTarget("弃置一名角色区域内的一张牌",function(e,a,n){return n.countDiscardableCards(a,"hej")},!0).set("ai",function(n){var t=r.event.player,i=e.attitude(t,n);return(i=i<0?-Math.sqrt(-i):Math.sqrt(i))*a.card.guohe.ai.result.target(t,n)}):event.finish();else{var t=player.chooseTarget("令一名角色摸一张牌");player.storage.PSxianfu_target&&player.storage.PSxianfu_target.length&&t.set("prompt2","（若目标为"+e.translation(player.storage.PSxianfu_target)+"则改为摸两张牌）"),t.set("ai",function(a){var n=r.event.player,t=e.attitude(n,a)/Math.sqrt(1+a.countCards("h"));return a.hasSkillTag("nogain")&&(t/=10),n.storage.PSxianfu_target&&n.storage.PSxianfu_target.includes(a)?2*t:t})}if(result.bool){var i=result.targets[0];player.line(i,"green"),"black"==event.color?player.discardPlayerCard(i,"hej",!0):player.storage.PSxianfu_target&&player.storage.PSxianfu_target.includes(i)?(i.storage.PSxianfu_mark||(i.storage.PSxianfu_mark=[]),i.storage.PSxianfu_mark.add(player),i.storage.PSxianfu_mark.sortBySeat(),i.markSkill("PSxianfu_mark"),i.draw(2)):i.draw()}--event.num>0?player.chooseBool(e.prompt2("chouce")):event.finish(),result.bool&&(player.logSkill("chouce"),event.goto(1))},ai:{maixie:!0,maixie_hp:!0,effect:{target:function(a,n,r){if(e.tag(a,"damage")){if(n.hasSkillTag("jueqing",!1,r))return[1,-2];if(!r.hasFriend())return;if(r.hp>=4)return[1,1.5*e.tag(a,"damage")];if(3==r.hp)return[1,1*e.tag(a,"damage")];if(2==r.hp)return[1,.5*e.tag(a,"damage")]}}}}}},sort:u.PScharacter_wei,translate:{PSxizhicai:"PS戏志才",PSxianfu:"先辅",PSxianfu_info:"锁定技，游戏开始时，你选择一名其他角色，当其受到伤害/回复体力/摸牌/弃牌后，你受到等量的伤害/回复等量的体力/摸等量的牌/弃置等量的牌。〖先辅〗角色死亡后，你重新选择一名〖先辅〗角色。",PSchouce:"筹策",PSchouce_info:"当你受到1点伤害后，你可以判定，若结果为：黑色，你弃置一名角色区域里的一张牌；红色，你选择一名角色，其摸一张牌，若其是〖先辅〗选择的角色，改为其摸两张牌。"},rank:c.rare},PSxiahoujie:{info:{sex:"male",group:"wei",hp:5,skills:["PSdanda"],dieAudios:[],trashBin:[]},intro:"由“你想去哪儿呢”设计",skills:{PSdanda:{audio:"liedan",trigger:{global:"phaseZhunbeiBegin"},forced:!0,filter:function(e,a){return a!=e.player},logTarget:"player",content:function(){var e=0;player.hp>trigger.player.hp&&e++,player.countCards("h")>trigger.player.countCards("h")&&e++,player.countCards("e")>trigger.player.countCards("e")&&e++,e&&(player.draw(e),3==e&&player.gainMaxHp())}}},sort:u.PScharacter_wei,translate:{PSxiahoujie:"PS夏侯杰",PSdanda:"胆大",PSdanda_info:"锁定技，其他角色的准备阶段，你与其依次比较双方的手牌数，体力值与装备区牌数，你每有一项大于该角色则摸一张牌。 若均大于该角色，你加1点体力上限。"},rank:c.epic},PSqun_sunce:{info:{sex:"male",group:"qun",hp:4,maxHp:5,skills:["PSxiaozhan","PSzengxi"],dieAudios:["re_sunben"],trashBin:[]},intro:"由“咏雪雪”设计",skills:{PSxiaozhan:{audio:"jiang",trigger:{source:"damageEnd"},frequent:!0,filter:function(e,a){return e.card&&"sha"==e.card.name},intro:{name:"骁战",content:"本回合【杀】使用次数+#"},init:function(e){e.storage.PSxiaozhan||(e.storage.PSxiaozhan=0)},content:function(){player.storage.PSxiaozhan+=trigger.num,player.draw(trigger.num),player.addTempSkill("PSxiaozhan_use"),player.markSkill("PSxiaozhan"),player.syncStorage("PSxiaozhan")},group:["PSxiaozhan_clear","PSxiaozhan_kill"],subSkill:{use:{mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+a.storage.PSxiaozhan}},sub:!0},clear:{trigger:{player:"phaseUseEnd"},charlotte:!0,forced:!0,silent:!0,content:function(){player.storage.PSxiaozhan=0},sub:!0,popup:!1},kill:{audio:"jiang",trigger:{source:"dieAfter"},frequent:!0,filter:function(e,a){return a.countCards("h")<a.maxHp},content:function(){player.drawTo(player.maxHp)},sub:!0}}},PSzengxi:{skillAnimation:!0,animationColor:"wood",audio:"hunzi",juexingji:!0,animationStr:"赠玺",derivation:"PShuju",unique:!0,trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return a.countCards("e")>=2&&!a.storage.PSzengxi},forced:!0,content:function(){player.gainMaxHp(),player.recover(),player.awakenSkill(event.name),player.storage[event.name]=!0,player.chooseTarget("赠玺：选择一名其他角色，你交给他装备区所有牌，他交给你一半手牌（向下取整）",1,!0).set("filterTarget",function(e,a,n){return n!=a}).set("ai",function(a){var n=r.event.player;return n.countCards("e")>a.countCards("h")&&e.attitude(n,a)>0?2:n.countCards("e")>a.countCards("h")&&e.attitude(n,a)<=0?-1:n.countCards("e")<a.countCards("h")&&e.attitude(n,a)<=0?3:n.countCards("e")<a.countCards("h")&&e.attitude(n,a)>0?1:0}),result.bool&&(event.target=result.targets[0],player.give(player.getCards("e"),event.target));var a=Math.floor(event.target.countCards("h")/2);event.target.chooseCard(a,!0).set("prompt","赠玺：请将"+e.cnNumber(a)+"张手牌交给"+e.translation(player)),result.cards&&event.target.give(result.cards,player),player.addSkills("PShuju")}},PShuju:{mod:{targetInRange:function(e,a,n,r){return!0}},audio:"reyingzi",audioname2:{PSqun_sunce:"reyingzi_sunce"},enable:"phaseUse",filter:function(e,a){return a.maxHp>0},content:function(){player.isDamaged()&&player.draw(player.maxHp-player.hp),player.loseMaxHp(),player.addTempSkill("PShuju_base")},subSkill:{base:{trigger:{player:"useCard"},forced:!0,filter:function(e,a){return e.baseDamage&&a.getStat().skill.PShuju},content:function(){player.getStat().skill.PShuju>0&&(trigger.baseDamage+=player.getStat().skill.PShuju)},sub:!0}}}},sort:u.PScharacter_qun,translate:{PSqun_sunce:"PS群孙策",PSxiaozhan:"骁战",PSxiaozhan_info:"当你使用【杀】造成伤害后，你摸X张牌且当前回合使用【杀】次数+X（X为此【杀】造成的伤害数），每当你击杀一名角色时你将手牌数摸至体力上限。",PSzengxi:"赠玺",PSzengxi_info:"觉醒技，准备阶段，若你装备区的牌数不少于2，你加一点体力上限并回复一点体力，将装备区的所有牌交给一名其他角色，其将一半手牌（向下取整）交给你，然后你获得技能〖虎踞〗。",PShuju:"虎踞",PShuju_info:"你使用牌无距离限制。出牌阶段，你可以摸等同于自身已损失体力值的牌，然后减一点体力上限，本回合使用牌的伤害基数和回复基数+1。"},rank:c.rare},PSgaoguimingmen:{info:{sex:"male",group:"qun",hp:4,skills:["PSluansha"],dieAudios:["xin_yuanshao"],trashBin:[]},intro:"由“希神文祖华”设计",skills:{PSluansha:{audio:"olxueyi",trigger:{player:"useCardAfter"},forced:!0,filter:function(e,a){return e.targets.length&&!a.hasHistory("sourceDamage",function(a){return a.card==e.card})},content:function(){player.draw(trigger.targets.length)}}},sort:u.PScharacter_qun,translate:{PSgaoguimingmen:"高贵名门",PSluansha:"乱杀",PSluansha_info:"锁定技，当你使用牌结算后，若此牌没有造成伤害，你摸等同于此牌目标数的牌。"},rank:c.rare},PSsishouyige:{info:{sex:"male",group:"qun",hp:4,skills:["PShengce"],dieAudios:[],trashBin:[]},intro:"由“10万原石”设计",skills:{PShengce:{trigger:{player:"phaseZhunbeiBegin"},priority:1,frequent:!0,filter:function(e,a){return!0},content:function(){var a,t=["对一名角色造成两点伤害","令一名角色摸四张牌","令一名角色弃四张牌","获得一名角色两张牌","令一名角色回复两点体力","令一名角色增加两点体力上限"];switch(player.chooseControl().set("choiceList",t).set("ai",function(){var a=t.length-1;return e.rand(0,a)}).set("prompt","衡策：请选择一项"),result.control){case"选项一":event.goto(2);break;case"选项二":event.goto(4);break;case"选项三":event.goto(6);break;case"选项四":event.goto(8);break;case"选项五":event.goto(10);break;default:event.goto(12)}(player.chooseTarget("衡策：对一名角色造成两点伤害",1,!1).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)<0?5:0}),result.targets?(player.line(result.targets[0],"fire"),result.targets[0].damage(2,"nocard",player),n.playSkillAudio("xinfu_langxi"),event.finish()):event.finish(),player.chooseTarget("衡策：令一名角色摸四张牌",1,!1).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)>0?5:0}),result.targets?(player.line(result.targets[0],"green"),result.targets[0].draw(4),n.playSkillAudio("shuliang"),event.finish()):event.finish(),player.chooseTarget("衡策：令一名角色弃四张牌",1,!1).set("filterTarget",function(e,a,n){return n.countCards("he")>0}).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)<0?5:0}),result.targets)?(player.line(result.targets[0],"fire"),(a=result.targets[0]).countCards("he")<=4?a.discard(a.getCards("he")):a.chooseToDiscard(4,!0),n.playSkillAudio("remieji"),event.finish()):event.finish();(player.chooseTarget("衡策：获得一名角色两张牌",1,!1).set("filterTarget",function(e,a,n){return n.countCards("he")>0}).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)<0?5:0}),result.targets)?(player.line(result.targets[0],"fire"),(a=result.targets[0]).countCards("he")<=2?player.gainPlayerCard(a,!0,"he",a.countCards("he")):player.gainPlayerCard(a,2,"he"),n.playSkillAudio("tuxi"),event.finish()):event.finish();player.chooseTarget("衡策：令一名角色回复两点体力",1,!1).set("filterTarget",function(e,a,n){return n.isDamaged()}).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)>0?5:0}),result.targets?(player.line(result.targets[0],"green"),result.targets[0].recover(2),n.playSkillAudio("qingnang"),event.finish()):event.finish(),player.chooseTarget("衡策：令一名角色增加两点体力上限",1,!1).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)>0?5:0}),result.targets?(player.line(result.targets[0],"green"),result.targets[0].gainMaxHp(2),n.playSkillAudio("yongdi"),event.finish()):event.finish()}}},sort:u.PScharacter_qun,translate:{PSsishouyige:"四收益哥",PShengce:"衡策",PShengce_info:"准备阶段，你可以从以下选项中选择一项：<br/> 1.对一名角色造成两点伤害 <br/>2.令一名角色摸四张牌 <br/>3.令一名角色弃四张牌<br/> 4.获得一名角色两张牌 <br/>5.令一名角色恢复两点体力 <br/>6.令一名角色增加两点体力上限"},rank:c.epic},db_PSdaweiwuwang:{info:{sex:"male",group:"wei",hp:4,skills:["PSdwww_zhiheng","PSxiangong","PScuicheng"],dieAudios:["re_sunquan"],doubleGroup:["wei","wu"],trashBin:[]},filter:function(e){return"guozhan"!=e},intro:"由“眼中藏着阿卡丽”设计",skills:{PSdwww_zhiheng:{audio:"rezhiheng",audioname:["shen_caopi"],enable:"phaseUse",usable:1,content:function(){var a=Math.max(player.countCards("h"),1);if(player.draw(a+1),player.chooseToDiscard("he",a,!0),result.cards){for(var n=[!1,!1],r=["trick","equip"],t=0;t<n.length;t++)for(var i=0;i<result.cards.length;i++)if([r[t]].includes(e.type(result.cards[i],"trick","h"==result.cards[i].original&&player))){n[t]=!0;break}1!=n[0]||player.hasSkill("PSdwww_zhiheng_expire")||(delete player.getStat("skill").PSdwww_zhiheng,player.addTempSkill("PSdwww_zhiheng_expire",{player:"phaseUseEnd"})),1!=n[1]||player.hasSkill("PSdwww_zhiheng_range")||player.addTempSkill("PSdwww_zhiheng_range")}},ai:{order:5},subSkill:{range:{mod:{targetInRange:function(e,a,n,r){return!0}},sub:!0},expire:{charlotte:!0,locked:!0,sub:!0}}},PSxiangong:{audio:"PShuiwan",trigger:{player:"loseAfter",global:"loseAsyncAfter"},groupSkill:!0,forced:!0,silent:!0,filter:function(a,r){if(!n.filterPlayer(e=>!e.getExpansions("PSxiangong_cards").length).length)return!1;if("wei"!=r.group)return!1;if("discard"!=a.type)return!1;if("phaseDiscard"==a.getParent(3).name)return!1;var t=a.getl(r);for(var i of t.cards2)if("d"==e.position(i))return!0;return!1},content:function(){if(0==trigger.delay&&n.delay(),player.chooseTarget("将弃置的牌置于一名没有【贡】的角色武将牌上",!0).set("filterTarget",function(e,a,n){return!n.getExpansions("PSxiangong_cards").length}).set("ai",function(a){var n=r.event.player;return-e.attitude(n,a)}),1==result.bool){var a=[],t=result.targets[0],i=trigger.getl(player);for(var o of i.cards2)"d"==e.position(o)&&a.push(o);player.logSkill("PSxiangong",t),t.addSkill("PSxiangong_cards"),t.addToExpansion(player,"give",a).gaintag.add("PSxiangong_cards"),t.storage.xinyingshi_source=player}},group:"PSxiangong_damage",subSkill:{cards:{marktext:"贡",intro:{content:"expansion",markcount:"expansion"},onremove:function(e,a){var n=e.getExpansions(a);n.length&&e.loseToDiscardpile(n)},sub:!0},damage:{trigger:{player:"damageBegin4"},filter:function(e,a){return 0!=e.num&&n.hasPlayer(a=>a.getExpansions("PSxiangong_cards").length>=e.num)},direct:!0,content:function(){if(player.chooseTarget("是否将伤害转移给有“贡”的角色？",!1).set("filterTarget",function(e,a,n){return n.getExpansions("PSxiangong_cards").length>=trigger.num}).set("ai",function(a){var n=r.event.player;return-e.attitude(n,a)}),result.targets){var a=result.targets[0];player.logSkill("PSxiangong",a),event.target=a,trigger.player=a,a.chooseButton(["献贡：请选择你的贡品",a.getExpansions("PSxiangong_cards")],trigger.num,!0)}result.bool&&event.target.gain(result.links,"gain2","log")},sub:!0}},popup:!1},PScuicheng:{skillAnimation:!0,animationColor:"fire",audio:"sbtongye",juexingji:!0,unique:!0,groupSkill:!0,trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return"wu"==a.group&&(a.getAllHistory("useSkill",e=>"PSdwww_zhiheng"==e.skill).length>=3&&a.hasAllHistory("sourceDamage",e=>!0))},forced:!0,content:function(){var i;if(player.recover(),player.draw(),player.awakenSkill("PScuicheng"),r.characterlist){i=[];for(var o=0;o<r.characterlist.length;o++){var l=r.characterlist[o];"wu"==a.character[l][1]&&a.skill.PSfushi.characterList().includes(l)&&i.push(l)}}else i=r.connectMode?e.charactersOL(function(e){return"wu"!=a.character[e][1]&&!a.skill.PSfushi.characterList().includes(e)}):e.gainableCharacters(function(e,n){return"wu"==e[1]&&a.skill.PSfushi.characterList().includes(n)});var s=n.players.concat(n.dead);for(o=0;o<s.length;o++)i.remove(s[o].name),i.remove(s[o].name1),i.remove(s[o].name2);i.remove("WU_sunquan"),i.remove("sunquan"),i.remove("sb_sunquan"),i.remove("PSsunquan"),i.remove("PSquansun"),i.remove("PShw_sunquan"),i=i.randomGets(4);var u=[];for(var o of(player.isUnderControl()&&n.swapPlayerAuto(player),i))u.addArray(a.character[o][3]||[]);if(i.length&&u.length){var c=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog("请选择获得至多三个技能",[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=3)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?c(i,u):event.isOnline()?(event.player.send(c,i,u),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:u.randomGets(3)},event.dialog&&event.dialog.close(),event.control&&event.control.close());var g=event.result||result;if(g&&g.skills&&g.skills.length)for(var o of g.skills)player.addSkills(o);n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},g.skills)}else event.finish()}}},sort:u.PScharacter_db,translate:{db_PSdaweiwuwang:"大魏吴王",PSdwww_zhiheng:"制衡",PSdwww_zhiheng_info:"出牌阶段限一次，你可以摸 X+1张牌，然后弃置 X张牌  ，若你以此法弃置的牌中包含：1．锦囊牌，本回合你可以将制衡修改为出牌阶段限两次；2．装备牌，你本回合使用牌没有距离限制。( x 为你的手牌数且最少为 1)",PSxiangong:"献贡",PSxiangong_info:"魏势力技，锁定技，当你不于弃牌阶段弃置牌时，你将弃置的牌置于一名没有【贡】武将上，称之为【贡】。当你受到伤害时，你选择有【贡】且【贡】数量不小于伤害值的角色，其获得等量的【贡】然后将你此伤害转移给该角色。",PScuicheng:"摧城",PScuicheng_info:"吴势力技，觉醒技，准备阶段开始时，若你本局游戏造成过伤害且发动过至少三次【制衡】，你恢复一点体力并摸一张牌，然后从你已开通的吴势力武将中挑选四名武将，并选择三个技能获得之。"},rank:c.rare},PShw_sunquan:{info:{sex:"male",group:"wu",hp:4,skills:["rezhiheng","PShuiwan","rejiuyuan"],dieAudios:["re_sunquan"],trashBin:[]},intro:"由“你想去哪儿呢”设计<br><br>你说得对，感觉不如界孙权，史诗第一，阴间质检员，在回合中找大制衡拆顺和+1马连卡距离随手打，找难的大制衡找无懈闪桃下的回合拆顺+1马打下去，对爆也是界权优。<br>思权拳，思如泉涌！👊😭👊<br>念权剑，念念不忘!!🗡😭🗡<br>界权掌，生生世世!!!✋😭✋<br>会玩、会玩、会玩！<br>璀璨中的凋零、制衡联合！😊👉👈😊<br>极冻中的炽烈、纵横捭阖！😚👦👧😚<br>虚无中的真言、容我三思！😁👍💪😁<br>冰霜中的独舞、则吴盛可期！😍👼👼😍",skills:{PShuiwan:{audio:"ext:PS武将/audio/skill:3",enable:["chooseToUse","chooseToRespond"],filter:function(n,r){if(r.countCards("hes",function(e){return e.hasGaintag("zhiheng")})<=0)return!1;for(var t of a.inpile){var i=e.type2(t);if(("basic"==i||"trick"==i||"delay"==i)&&n.filterCard({name:t},r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];if("sha"==l)for(var s of(n.filterCard({name:l},r,n)&&i.push(["基本","","sha"]),a.inpile_nature))n.filterCard({name:l,nature:s},r,n)&&i.push(["基本","","sha",s]);else"trick"==e.type2(l)&&n.filterCard({name:l},r,n)?i.push(["锦囊","",l]):"delay"==e.type2(l)&&n.filterCard({name:l},r,n)?i.push(["延时锦囊","",l]):"basic"==e.type(l)&&n.filterCard({name:l},r,n)&&i.push(["基本","",l])}return t.create.dialog("会玩",[i,"vcard"])},filter:function(e,a){return r.event.getParent().filterCard({name:e.link[2]},a,r.event.getParent())},check:function(e){if("phase"!=r.event.getParent().type)return 1;var a=r.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:a.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:function(e,a){return e.hasGaintag("zhiheng")},audio:"PShuiwan",popname:!0,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3]}}},prompt:function(a,n){return"将一张牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},hiddenCard:function(n,r){if(!a.inpile.includes(r))return!1;var t=e.type2(r);return("basic"==t||"trick"==t||"delay"==t)&&n.countCards("hes",function(e){return e.hasGaintag("zhiheng")})>0},ai:{combo:"PShw_zhiheng",fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(e){if(e.countCards("hes",function(e){return e.hasGaintag("zhiheng")})<=0)return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},group:"PShuiwan_tag",subSkill:{tag:{trigger:{player:"gainAfter"},forced:!0,filter:function(e,a){for(var n=["rezhiheng","zhiheng","PSzhiheng","PSzhiheng_else","ymzhiheng","minizhiheng","minirezhiheng","xinzhiheng","sbzhiheng"],r=0;r<n.length;r++)if(e.getParent(2).name==n[r])return!0;return!1},content:function(){player.addGaintag(trigger.cards,"zhiheng")},sub:!0,onremove:function(e){e.removeGaintag("zhiheng")},audioname2:{old_yuanshu:"weidi"}}},audioname2:{old_yuanshu:"weidi"}}},sort:u.PScharacter_wu,translate:{PShw_sunquan:"会玩的孙权",PShuiwan:"会玩",PShuiwan_info:"你可以将〖制衡〗获得的牌当任意基本牌或锦囊牌使用或打出。","#ext:PS武将/audio/skill/PShuiwan1":"多势纷争,须衡平制稳为上。","#ext:PS武将/audio/skill/PShuiwan2":"不急一时，且看时局变化。","#ext:PS武将/audio/skill/PShuiwan3":"多思多谋,筹谋长远。"},rank:c.rare},PSyangbiao:{info:{sex:"male",group:"qun",hp:5,skills:["PSzhaohan","rangjie","PSyizheng"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSzhaohan:{audio:"zhaohan",trigger:{player:"phaseZhunbeiBegin"},forced:!0,content:function(){player.gainMaxHp(),player.recover()}},PSyizheng:{audio:"yizheng",enable:"phaseUse",usable:2,filter:function(e,a){return n.hasPlayer(function(e){return e.hp<=a.hp&&a.canCompare(e)})},filterTarget:function(e,a,n){return n.hp<=a.hp&&a.canCompare(n)},content:function(){player.chooseToCompare(target),result.bool?(target.skip("phaseDraw"),target.addTempSkill("yizheng2",{player:"phaseDrawSkipped"})):(target.loseMaxHp(),target.discard(target.getCards("hej")))},ai:{order:1,result:{target:function(e,a){if(a.skipList.includes("phaseDraw")||a.hasSkill("pingkou"))return 0;var n=e.getCards("h").sort(function(e,a){return a.number-e.number}),r=a.getCards("h").sort(function(e,a){return a.number-e.number});return n.length&&r.length&&n[0].number>r[0].number?-1:0}}}}},sort:u.PScharacter_qun,translate:{PSyangbiao:"PS杨彪",PSzhaohan:"昭汉",PSzhaohan_info:"锁定技，准备阶段，你加一点体力上限并回复一点体力。",PSyizheng:"义争",PSyizheng_info:"出牌阶段限两次，你可以与一名体力值不大于你的角色拼点：若你赢，跳过其下个摸牌阶段；若你没赢，其减一点体力上限并弃置区域内所有牌。"},rank:c.epic},PSguosi:{info:{sex:"male",group:"qun",hp:4,skills:["PStanbei","PSsidao"],dieAudios:[],trashBin:[]},intro:"由“你想去哪儿呢”设计",skills:{PStanbei:{audio:"xinfu_tanbei",enable:"phaseUse",filterTarget:function(e,a,n){return a!=n&&!n.hasSkill("tanbei_effect1")&&!n.hasSkill("tanbei_effect2")},content:function(){if(0==target.countCards("hej")?event._result={index:1}:player.chooseControl().set("choiceList",["随机获得"+e.translation(target)+"区域内的一张牌，然后其本回合内不能再对"+e.translation(target)+"使用牌。","本回合内对"+e.translation(target)+"使用牌没有次数与距离限制。"]).set("ai",function(){return[0,1].randomGet()}),player.addTempSkill("tanbei_effect3"),0==result.index){var a=target.getCards("hej").randomGet();player.gain(a,target,"giveAuto","bySelf"),target.addTempSkill("tanbei_effect2")}else target.addTempSkill("tanbei_effect1")},ai:{order:function(){return[2,4,6,8,10].randomGet()},result:{target:function(e,a){return-2-a.countCards("h")}},threaten:1.1}},PSsidao:{audio:"xinfu_sidao",trigger:{player:"useCardAfter"},filter:function(e,n){if(!n.countCards("hs"))return!1;if("PSsidao"==e.getParent(2).name)return!1;if(!e.targets||!e.targets.length||!e.isPhaseUsing(n))return!1;var r,t=n.getHistory("useCard");if((r=e?t.indexOf(e)-1:t.length-1)<0)return!1;var i=t[r];if(!(i&&i.targets&&i.targets.length&&i.isPhaseUsing(n)))return!1;for(var o=0;o<e.targets.length;o++){for(var l=1,s=0;s<=r&&t[r-s].targets.includes(e.targets[o]);s++)l++;if(i.targets.includes(e.targets[o])&&l%2==0&&a.filter.filterTarget({name:"shunshou"},n,e.targets[o]))return!0}return!1},direct:!0,content:function(){var r=player.getLastUsed(1).targets,t=player.chooseToUse();t.set("targets",n.filterPlayer(function(e){return r.includes(e)&&trigger.targets.includes(e)})),t.set("openskilldialog",e.prompt("PSsidao")+a.translate.PSsidao_info),t.set("norestore",!0),t.set("_backupevent","xinfu_sidaox"),t.set("custom",{add:{},replace:{window:function(){}}}),t.backup("xinfu_sidaox")}}},sort:u.PScharacter_qun,translate:{PSguosi:"PS郭汜",PStanbei:"贪狈",PStanbei_info:"出牌阶段对每名其他角色限一次，你可以指定一个目标角色，选择一项：1. 你随机获得其一个区域的一张牌，此回合不能再对其使用牌；2. 令你此回合对其使用牌没有次数和距离限制。",PSsidao:"伺盗",PSsidao_info:"出牌阶段，当你对一名其他角色每连续使用两张牌后，你可将一张手牌当无距离限制的顺手牵羊对其使用"},rank:c.rare},PSshen_huangzhong:{info:{sex:"male",group:"shen",hp:3,skills:["PSdingjun"],dieAudios:["sb_huangzhong"],trashBin:[]},intro:"由“我最爱的雨雨”设计",skills:{PSdingjun:{shaRelated:!0,audio:"sbliegong",trigger:{player:"useCardToPlayered"},check:function(a,n){return e.attitude(n,a.target)<=0},init:function(e){e.storage.PSdingjun||(e.storage.PSdingjun=0)},intro:{markcount:function(e,a){var n=a.getHistory("useCard",e=>"sha"==e.card.name&&0!=e.addCount).length;return(n=e+1-n)<0&&(n=0),n},content:function(e,a){var n=a.getHistory("useCard",e=>"sha"==e.card.name&&0!=e.addCount).length;return(n=e+1-n)<0&&(n=0),0==n&&a.unmarkSkill("PSdingjun"),"本回合额外使用【杀】次数+"+n}},onremove:function(e){e.unmarkSkill("PSdingjun")},prompt2:function(a){var n=e.suit(a.card),r=e.number(a.card);return"spade"==n?"令"+e.translation(a.card)+"造成伤害+"+r:"club"==n?"本回合额外使用【杀】次数+"+r:"heart"==n?"获得"+e.cnNumber(r)+"点护甲":"diamond"==n?"摸"+e.cnNumber(r)+"张牌":void 0},filter:function(a,n){return"sha"==a.card.name&&(1==a.targets.length&&"none"!=e.suit(a.card)&&null!=e.number(a.card))},preHidden:!0,content:function(){var a=e.suit(trigger.card),n=e.number(trigger.card);switch(a){case"spade":var r=trigger.target.playerid,t=trigger.getParent().customArgs;t[r]||(t[r]={}),"number"!=typeof t[r].extraDamage&&(t[r].extraDamage=0),t[r].extraDamage+=n;break;case"club":player.storage.PSdingjun+=n,player.markSkill("PSdingjun"),player.addTempSkill("PSdingjun_sha",{global:"phaseUseEnd"});break;case"heart":player.changeHujia(n,null,!1);break;default:player.draw(n)}},group:"PSdingjun_clear",subSkill:{sha:{mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+a.storage.PSdingjun}},sub:!0},clear:{trigger:{global:"phaseUseEnd"},direct:!0,charlotte:!0,forced:!0,content:function(){player.storage.PSdingjun&&(player.storage.PSdingjun=0),player.syncStorage("PSdingjun"),player.unmarkSkill("PSdingjun")},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSshen_huangzhong:"PS神黄忠",PSdingjun:"定军",PSdingjun_info:"每当你使用【杀】指定唯一目标时，你根据此【杀】的花色获得以下效果：<br/>黑桃，此【杀】伤害＋X ；<br/>梅花，本回合使用【杀】次数＋X ；<br/>方片，摸X张牌；<br/>红桃，获得X点护甲；<br/>X为此【杀】的点数。"},rank:c.rare},PSshen_guojia:{info:{sex:"male",group:"shen",hp:3,skills:["PShuishi","stianyi","resghuishi"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PShuishi:{audio:"shuishi",enable:"phaseUse",usable:1,frequent:!0,filter:function(e,a){return!0},content:function(){event.cards=[],event.numbers=[],player.judge(function(a){var n=r.event.getParent("PShuishi");return n&&n.numbers&&n.numbers.includes(e.number(a))?0:1}).set("callback",a.skill.PShuishi.callback).judge2=function(e){return!!e.bool};var n=n.filterInD();if(n.length?player.chooseTarget("将"+e.translation(n)+"交给一名角色",!0).set("ai",function(a){var n=r.event.player,t=e.attitude(n,a)/Math.sqrt(1+a.countCards("h"));return a.hasSkillTag("nogain")&&(t/=10),t}):event.finish(),result.bool){var t=result.targets[0];event.target=t,player.line(t,"green"),t.gain(n,"gain2").giver=player}else event.finish();t.isMaxHandcard()&&player.loseMaxHp()},callback:function(){var e=event.getParent(2);event.getParent().orderingCards.remove(event.judgeResult.card),e.cards.push(event.judgeResult.card),event.getParent().result.bool?(e.numbers.push(event.getParent().result.number),player.maxHp<10&&player.gainMaxHp(),player.chooseBool("是否继续发动【慧识】？").set("frequentSkill","PShuishi")):event._result={bool:!1},result.bool&&event.getParent(2).redo()},ai:{order:9,result:{player:1}}}},sort:u.PScharacter_shen,translate:{PSshen_guojia:"PS神郭嘉",PShuishi:"慧识",PShuishi_info:"出牌阶段限一次。你可进行判定牌不置入弃牌堆的判定。若判定结果与本次发动技能时的其他判定结果的点数均不相同，则你加1点体力上限（若你的体力上限不小于10则不加），且可以重复此流程。然后你将所有位于处理区的判定牌交给一名角色。若其手牌数为全场最多，则你减1点体力上限。"},rank:c.rare},PSzhenji:{info:{sex:"female",group:"wei",hp:3,skills:["PSluoshen","PSqingguo"],dieAudios:[],trashBin:[]},intro:"由“人生仁生”设计",skills:{PSluoshen:{audio:"sbluoshen",trigger:{global:"phaseJieshuBegin"},forced:!0,filter:function(e,a){return!0},content:function(){if(trigger.player.chooseToDiscard("hes",2,function(a,n){if("black"!=e.color(a))return!1;if(t.selected.cards.length){var r=e.suit(a,trigger.player);for(var i of t.selected.cards)if(e.suit(i,trigger.player)==r)return!1}return!0}).set("ai",function(a){const n=e.event().player,r=e.event().target;return e.attitude(n,r)>=0?0:10-n.hp-e.value(a)}).set("prompt","洛神：请弃置两张花色不同的黑色牌，否则展示牌堆底三张牌，将其中的黑色牌置于"+e.translation(player)+"武将牌上").set("complexCard",!0).set("target",player),!result.bool){var a=e.bottomCards(3);n.cardsGotoOrdering(a),trigger.player.showCards(a,"洛神");for(var r=[],i=0;i<a.length;i++)"black"==e.color(a[i])&&r.push(a[i]);r.length&&(n.log(player,"将",r,"作为“洛神牌”置于了",player,"武将牌上"),player.loseToSpecial(r,"PSluoshen").visible=!0)}player.markSkill("PSluoshen"),n.delayx()},marktext:"洛神",intro:{mark:function(e,a,n){var r=n.getCards("s",function(e){return e.hasGaintag("PSluoshen")});r&&r.length&&e.addAuto(r)},markcount:function(e,a){return a.countCards("s",function(e){return e.hasGaintag("PSluoshen")})},onunmark:function(e,a){var n=a.getCards("s",function(e){return e.hasGaintag("PSluoshen")});n.length&&a.loseToDiscardpile(n)}}},PSqingguo:{mod:{aiValue:function(a,n,r){if("shan"==e.name(n)||"black"==e.color(n)){var t=a.getCards("hs",function(a){return"shan"==e.name(a)||"black"==e.color(a)});t.sort(function(a,n){return("shan"==e.name(n)?1:2)-("shan"==e.name(a)?1:2)});var i=function(){return t.includes(n)?t.indexOf(n):t.length};return"shan"==e.name(n)?.6*Math.min(r,[6,4,3][Math.min(i(),2)]):Math.max(r,[6.5,4,3][Math.min(i(),2)])}},aiUseful:function(){return a.skill.qingguo.mod.aiValue.apply(this,arguments)}},locked:!1,audio:"ext:PS武将/audio/skill:2",enable:["chooseToRespond","chooseToUse"],filterCard:function(a){return"black"==e.color(a)||a.hasGaintag("PSluoshen")},viewAs:{name:"shan"},viewAsFilter:function(e){if(!e.countCards("s",function(e){return e.hasGaintag("PSluoshen")})&&!e.countCards("hs",{color:"black"}))return!1},position:"hs",prompt:"将一张黑色手牌或洛神牌当闪使用或打出",check:function(){return 1},ai:{order:3,respondShan:!0,skillTagFilter:function(e){if(!e.countCards("s",function(e){return e.hasGaintag("PSluoshen")})&&!e.countCards("hs",{color:"black"}))return!1},effect:{target:function(a,n,r,t){if(e.tag(a,"respondShan")&&t<0)return.6}},basic:{useful:[7,5.1,2],value:[7,5.1,2]},result:{player:1}},group:"PSqingguo_use",subSkill:{use:{trigger:{player:["useCardAfter","respondAfter"]},forced:!0,nopop:!1,filter:function(e,a){return"shan"==e.card.name&&"PSqingguo"==e.skill},content:function(){player.chooseBool("是否将"+e.translation(trigger.cards)+"置于牌堆底？"),result.bool&&(n.log(player,"将",trigger.cards,"置于了牌堆底"),t.cardPile.appendChild(trigger.cards[0]),player.popup(e.cnNumber(0)+"上"+e.cnNumber(1)+"下"),n.delayx())},sub:!0}}}},sort:u.PScharacter_wei,translate:{PSzhenji:"PS甄姬",PSluoshen:"洛神",PSluoshen_info:"锁定技，每名角色回合结束阶段开始时，须选择一项：1.弃置两张花色不同的黑色牌；2.展示牌堆底三张牌，将其中的黑色牌置于你武将牌上，称为“洛神”，你可以将洛神牌如手牌般使用或打出。",PSqingguo:"倾国",PSqingguo_info:"你可以将一张黑色牌或洛神牌当【闪】使用或打出，该【闪】生效后，你可以将之置于牌堆底。","#ext:PS武将/audio/skill/PSqingguo1":"商灵缤兮恭迎,伞盖纷兮若云。","#ext:PS武将/audio/skill/PSqingguo2":"晨张兮细帷,夕茸兮兰櫋。"},rank:c.epic},PSwu_zhangliao:{info:{sex:"male",group:"wei",hp:4,maxHp:6,skills:["PSwu_tuxi","PSwu_zhenzhan"],dieAudios:["re_zhangliao"],trashBin:[]},intro:"由“小男孩_Official”设计",skills:{PSwu_tuxi:{audio:"retuxi",trigger:{player:"phaseDrawBegin2"},direct:!0,preHidden:!0,filter:function(e,a){return e.num>0&&!e.numFixed&&n.hasPlayer(function(e){return e.countCards("he")>0&&a!=e})},gainMultiple:function(){event.delayed=!1,event.num=0,event.cards=[],player.gainPlayerCard(targets[num],event.position,[1,targets.length],!0).set("boolline",!1).set("delay",num==targets.length-1),result.bool&&(event.cards.addArray(result.cards),num==targets.length-1&&(event.delayed=!0)),event.num++,event.num<targets.length&&event.goto(1),event.delayed||n.delay()},content:function(){var t=e.copy(trigger.num);if("guozhan"==e.mode()&&t>2&&(t=2),player.chooseTarget(e.prompt("new_retuxi"),"获得至多"+e.translation(t)+"名角色的各一张手牌，然后少摸等量的牌",[1,t],function(e,a,n){return n.countCards("he")>0&&a!=n},function(a){var n=e.attitude(r.event.player,a);return a.hasSkill("tuntian")?n/10:1-n}).setHiddenSkill("PSwu_tuxi"),result.bool){result.targets.sortBySeat(),player.logSkill("PSwu_tuxi",result.targets);var i=n.createEvent("gainMultiple",!1);i.player=player,i.targets=result.targets,i.position="hej",i.setContent(a.skill.PSwu_tuxi.gainMultiple),trigger.num-=result.targets.length}else event.finish();trigger.num<=0&&n.delay()},ai:{threaten:1.6,expose:.2}},PSwu_zhenzhan:{audio:"ext:PS武将/audio/skill:2",trigger:{global:["useCard2","discardAfter"]},forced:!0,priority:-1,logTarget:"player",filter:function(e,a){return!!e.player.isAlive()&&(e.player!=a&&("discard"==e.name?"phaseDiscard"!=e.getParent(2).name:e.targets.length>1))},content:function(){player.line(trigger.player,"fire");var e="discard"==trigger.name?trigger.cards.length:trigger.targets.length;(e=Math.min(player.getDamagedHp(),e))<=0&&(e=1),trigger.player.damage(e,"nocard",player)}}},sort:u.PScharacter_wei,translate:{PSwu_zhangliao:"PS武张辽",PSwu_zhangliao_prefix:"PS武",PSwu_tuxi:"突袭",PSwu_tuxi_info:"摸牌阶段，你可以少摸任意张牌并获得等量的其他角色区域内等量的牌。",PSwu_zhenzhan:"阵斩",PSwu_zhenzhan_info:"锁定技。其他角色使用多目标的牌指定目标时/于弃牌阶段外弃置牌后，你对其造成X点伤害。（X为此牌目标数/弃置的牌数，且至多为你已损失体力值，至少为1）","#ext:PS武将/audio/skill/PSwu_zhenzhan1":"兵贵神速，随我来。","#ext:PS武将/audio/skill/PSwu_zhenzhan2":"行包围之势，尽数诛之。"},rank:c.epic},PSsunru:{info:{sex:"female",group:"wu",hp:4,skills:["PSyingjian","PSshixin"],isAiForbidden:!0,dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSyingjian:{trigger:{player:["phaseZhunbeiBegin","phaseJudgeBegin","phaseDrawBegin","phaseDiscardBegin","phaseJieshuBegin"]},direct:!0,audio:"qingyi",content:function(){player.chooseUseTarget("###是否发动【影箭】？###视为使用一张没有距离限制的【杀】",{name:"sha",storage:{PSyingjian:!0}},!1,"nodistance").logSkill="yingjian"},ai:{unequip:!0,skillTagFilter:function(e,a,n){if(!(n&&n.card&&n.card.storage&&n.card.storage.PSyingjian))return!1},threaten:function(e,a){return 1.6}},group:"PSyingjian_use",subSkill:{use:{audio:"qingyi",enable:"phaseUse",usable:1,content:function(){player.chooseUseTarget("影箭：视为使用一张没有距离限制的【杀】",{name:"sha",storage:{PSyingjian:!0}},!1,"nodistance").logSkill="yingjian"},ai:{unequip:!0,skillTagFilter:function(e,a,n){if(!(n&&n.card&&n.card.storage&&n.card.storage.PSyingjian))return!1},threaten:function(e,a){return 1.6}},sub:!0}}},PSshixin:{audio:"shixin",trigger:{player:"damageBegin4"},filter:function(e){return!0},forced:!0,content:function(){trigger.hasNature("fire")?trigger.cancel():trigger.num--},ai:{nofire:!0,effect:{target:function(a,n,r,t){if(e.tag(a,"fireDamage"))return"zerotarget"}}},group:"PSshixin_end",subSkill:{end:{trigger:{source:"damageBegin2"},forced:!0,filter:function(e,a){return r.currentPhase==a&&!a.hasSkill("PSshixin_blocker")},content:function(){player.recover(),player.addTempSkill("PSshixin_blocker")},sub:!0},blocker:{charlotte:!0,forced:!0,sub:!0}}}},sort:u.PScharacter_wu,translate:{PSsunru:"PS孙茹",PSyingjian:"影箭",PSyingjian_info:"准备阶段开始时/判定阶段开始时/摸牌阶段开始时/弃牌阶段开始时/结束阶段开始时/出牌阶段限一次，你可以视为使用一张无视防具，无距离限制，不计入次数的【杀】。",PSshixin:"释衅",PSshixin_info:"锁定技，防止你受到火属性伤害，你受到的非火焰伤害-1；你于回合内第一次造成伤害时，回复一点体力。"},rank:c.epic},PSfuzhijie:{info:{sex:"female",group:"wu",hp:4,skills:["PSfuzhi"],dieAudios:["zhangxuan"],trashBin:[]},intro:"由“门刀臣零衣”设计",skills:{PSfuzhi:{audio:"tongli",trigger:{global:"useCardAfter"},filter:function(r,t,i){return"PSfuzhi"!=r.getParent(2).name&&(!(!r.card||0==r.card.length)&&(e.type(r.card),!["shan","wuxie"].includes(r.card.name)&&n.findPlayer2(e=>{var n=a.card[r.card.name];if(n.autoViewAs){if(t.canUse({card:r.card,name:n.autoViewAs},e,!1))return!0}else if(t.canUse(r.card,e,!1))return!0;return!1})))},direct:!0,content:function(){var e=n.createCard2(trigger.card),r=a.card[e.name];r.autoViewAs?player.chooseUseTarget([e],{name:r.autoViewAs},!1):player.chooseUseTarget(e,!1),result.targets&&player.logSkill("PSfuzhi")}}},sort:u.PScharacter_wu,translate:{PSfuzhijie:"复制姐",PSfuzhi:"复制",PSfuzhi_info:"一名角色使用牌结算后，你可以使用同名实体牌。"},rank:c.epic},PSfx_shen_guanyu:{info:{sex:"male",group:"shen",hp:4,skills:["PSshenwu","PShunwu"],dieAudios:["shen_guanyu"],trashBin:[]},intro:"由“绿诗涵”设计",skills:{PSshenwu:{init:function(e){a.card.tao.enable=function(e,a){return a.hasSkill("PSshenwu")?n.hasPlayer(function(e){return e.isDamaged()}):a.hp<a.maxHp},a.card.tao.selectTarget=function(e,a,n){return a.hasSkill("PSshenwu")?1:-1},a.card.tao.filterTarget=function(e,a,n){return(a.hasSkill("PSshenwu")||n==a)&&n.hp<n.maxHp}},mod:{cardname:function(a,n,r){if("heart"==e.suit(a))return"tao"}},ai:{nokeep:!0,basic:{order:function(e,a){return a.hasSkillTag("pretao")?5:2},useful:[6.5,4,3,2],value:[6.5,4,3,2]},result:{target:2,target_use:function(a,t){if(a.hasSkillTag("nokeep",!0,null,!0))return 2;var i=a.needsToDiscard(),o=!1;(i<=0||1==i&&t.hp>=2&&t.countCards("h","tao")<=1)&&(o=!0);var l=e.mode();if(t.hp>=2&&o&&t.hasFriend()){if(t.hp>2||0==i)return 0;if(2==t.hp&&n.hasPlayer(function(a){if(t!=a&&e.attitude(t,a)>=3){if(a.hp<=1)return!0;if(("identity"==l||"versus"==l||"chess"==l)&&"zhu"==a.identity&&a.hp<=2)return!0}}))return 0}if(t.hp<0&&t!=a&&"zhu"!=t.identity)return 0;var s=e.attitude(a,t);if(s<3&&s>=0&&a!=t)return 0;var u=r.event.getTrigger();if("identity"==l&&"fan"==a.identity&&"fan"==t.identity&&(u&&"dying"==u.name&&u.source&&"fan"==u.source.identity&&u.source!=t))return n.countPlayer(function(e){if("fan"==e.identity)return e.countCards("h","tao")})>1&&a==t?2:0;return"identity"==l&&"zhu"==a.identity&&"nei"==t.identity&&u&&"dying"==u.name&&u.source&&"zhong"==u.source.identity||"stone"==l&&t.isMin()&&a!=t&&u&&"dying"==u.name&&a.side==t.side&&u.source!=t.getEnemy()?0:2}},tag:{recover:1}}},PShunwu:{audio:"ext:PS武将/audio/skill:1",trigger:{player:"recoverAfter"},filter:function(e,a){return!a.isDamaged()&&n.dead.length>0},content:function(){if(player.judge(function(e){return["sha","juedou","nanman","wanjian","huogong"].includes(e.name)?10:-10}).judge2=function(e){return 0==e.bool},result.bool||player.chooseTarget("复活一名已死亡角色").set("filterTarget",function(e,a,n){return!n.isAlive()}).set("deadTarget",!0).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)}),result.targets){var a=result.targets[0];a.revive(),a.recoverTo(a.maxHp)}}}},sort:u.PScharacter_shen,translate:{PSfx_shen_guanyu:"羽关神",PSshenwu:"神武",PSshenwu_info:"锁定技，你的♥牌均视为【桃】；你的【桃】可以对其他角色使用。",PShunwu:"魂武",PShunwu_info:"当你回复体力至满状态后，你可以进行一次判定，若结果不为【杀】【决斗】【南蛮入侵】【万箭齐发】【火攻】，你令一名已阵亡的角色复活并回复体力至体力上限。","#ext:PS武将/audio/skill/PShunwu1":"复活吧，我的爱人！"},rank:c.junk},PSpeixiu:{info:{sex:"male",group:"qun",hp:4,skills:["PSxingtu","PSjuezhi"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSxingtu:{init:function(e){a.translate.xingtu1||(a.translate.xingtu1="无次数限制")},audio:"xingtu",trigger:{player:"useCard"},filter:function(a,n){if(n.hasSkill("PSxingtu_disable"))return!1;var r=e.number(a.card),t=n.storage.PSxingtu;return"number"==typeof r&&"number"==typeof t},forced:!0,popup:!1,content:function(){var a,r=e.number(trigger.card),i=player.storage.PSxingtu,o=[0,1,2].randomGet();switch(o){case 0:a=i+"+"+r+"=?";break;case 1:a=i+"-"+r+"=?";break;default:a=i+"*"+r+"=?"}var l=[i+r,i-r,i*r],s=[l[o]+1,l[o],l[o]-1];event.num=l[o],s.randomSort(),s.push("放弃");var u=player.chooseControl(s);u.set("prompt","行图：请回答"+a),u.set("ai",function(){return event.num.toString()}),function(e=3){"number"!=typeof e&&(e=3),t.timer.show(),n.countDown(e,function(){t.timer.hide()})}("尊嘟假嘟"),setTimeout(function(){clearInterval(event.popup),u.controlbars&&u.controlbars.at(-1).click()},3e3),clearInterval(event.popup),result.control==event.num?(player.logSkill("xingtu"),player.draw()):player.addTempSkill("PSxingtu_disable")},mod:{cardUsable:function(a,n){if("card"==e.itemtype(a)){if(a.hasGaintag("xingtu1"))return 1/0}else if(a.isCard&&a.cards&&a.cards.some(e=>e.hasGaintag("xingtu1")))return 1/0},aiOrder:function(a,n,r){if("card"==e.itemtype(n)){if(n.hasGaintag("xingtu1"))return r+5}else if(n.isCard&&n.cards&&n.cards.some(e=>e.hasGaintag("xingtu1")))return r+5}},group:["PSxingtu_record","PSxingtu_tag"],intro:{content:"当前记录：X=#",markcount:()=>{}},subSkill:{record:{audio:"xingtu",trigger:{player:"useCardAfter"},filter:function(a,n){return"number"==typeof e.number(a.card)},forced:!0,content:function(){player.storage.PSxingtu=e.number(trigger.card),player.markSkill("PSxingtu"),n.log(player,"当前记录","#g【行图】","点数为","#y"+e.number(trigger.card)),n.HasExtension&&n.broadcastAll(function(e,a){e.marks.PSxingtu&&(e.marks.PSxingtu.firstChild.innerHTML=(n.HasExtension("十周年UI")?"X=":"")+a)},player,player.storage.PSxingtu)},sub:!0},tag:{trigger:{player:"gainAfter"},forced:!0,filter:function(e,a){return"PSxingtu"==e.getParent(2).name},content:function(){player.addGaintag(trigger.cards,"xingtu1")},sub:!0,onremove:function(e){e.removeGaintag("xingtu1"),delete e.storage.PSxingtu}},disable:{charlotte:!0,sub:!0}}},PSjuezhi:{enable:"phaseUse",audio:"juezhi",filter:function(e,a){return a.countCards("he")>1},filterCard:!0,position:"he",usable:1,prompt:function(){var e=r.event.player;return e.hasSkill("PSxingtu")&&!e.hasSkill("PSxingtu_disable")?"〖行图〗②未失效，是否继续发动技能？"+a.translate.PSjuezhi_info:a.translate.PSjuezhi_info},selectCard:2,check:function(a){return t.selected.cards.length>1?0:4-e.value(a)},content:function(){player.draw(2),player.hasSkill("PSxingtu_disable")&&player.removeSkill("PSxingtu_disable")},ai:{order:1,result:{player:1}}}},sort:u.PScharacter_qun,translate:{PSpeixiu:"PS裴秀",PSxingtu:"行图",PSxingtu_info:"锁定技。①当你使用有点数的牌结算结束后，你将此牌点数记录为X。②当你使用牌时，系统随机给出此牌的点数Y与X的四则运算式子（除法除外），你需要在3秒内选择答案；若答案正确，你摸一张牌，否则此效果本回合失效③你使用②摸到的牌无次数限制。",PSjuezhi:"爵制",PSjuezhi_info:"出牌阶段限一次，你可以弃置两张牌，然后摸两张牌，令〖行图〗②重新生效。"},rank:c.epic},PSshen_liubei:{info:{sex:"male",group:"shen",hp:6,skills:["PSlongnu","PSlb_jieying"],dieAudios:[],trashBin:[]},intro:"由“希神文祖华”设计",skills:{PSlongnu:{mark:!0,locked:!0,zhuanhuanji:!0,marktext:"☯",derivation:["nuzhan","liyong"],init:e=>{null==e.storage.PSlongnu&&e.changeZhuanhuanji("PSlongnu"),a.skill.nuzhan.audioname2||(a.skill.nuzhan.audioname2={}),a.skill.nuzhan.audioname2.PSshen_liubei="wusheng_jsp_guanyu"},intro:{content:function(e,a,n){return 1==a.storage.PSlongnu?"锁定技，出牌阶段开始时，你失去1点体力并摸一张牌，然后本阶段内你视为拥有技能〖怒斩〗，且你的红色手牌均视为火【杀】且无距离限制。":"锁定技，出牌阶段开始时，你减1点体力上限并摸一张牌，然后本阶段内你然后本阶段内你视为拥有技能〖厉勇〗，且你的锦囊牌均视为雷【杀】且无使用次数限制。"}},audio:"nzry_longnu",trigger:{player:"phaseUseBegin"},forced:!0,content:function(){1==player.storage.PSlongnu?player.loseHp():player.loseMaxHp(),player.draw(),1==player.storage.PSlongnu?(player.addTempSkill("PSlongnu_yang","phaseUseAfter"),player.addTempSkill("nuzhan","phaseUseAfter")):(player.addTempSkill("PSlongnu_yin","phaseUseAfter"),player.addTempSkill("liyong","phaseUseAfter")),player.changeZhuanhuanji("PSlongnu")},subSkill:{yang:{mod:{cardname:function(a,n){if("red"==e.color(a))return"sha"},cardnature:function(a,n){if("red"==e.color(a))return"fire"},targetInRange:function(a){if("red"==e.color(a))return!0}},ai:{effect:{target:function(a,n,r,t){if(e.tag(a,"respondSha")&&t<0)return.6}},respondSha:!0},sub:!0},yin:{mod:{cardname:function(e,n){if(["trick","delay"].includes(a.card[e.name].type))return"sha"},cardnature:function(e,n){if(["trick","delay"].includes(a.card[e.name].type))return"thunder"},cardUsable:function(e,a){if("sha"==e.name&&n.hasNature(e,"thunder"))return 1/0}},ai:{effect:{target:function(a,n,r,t){if(e.tag(a,"respondSha")&&t<0)return.6}},respondSha:!0},sub:!0}},ai:{fireAttack:!0,halfneg:!0,threaten:1.05}},PSlb_jieying:{audio:"nzry_jieying",locked:!0,global:"PSlb_jieying_3",ai:{effect:{target:function(e){if("tiesuo"==e.name)return"zeroplayertarget"}}},group:["PSlb_jieying_1","PSlb_jieying_2"],subSkill:{1:{audio:"nzry_jieying",trigger:{player:["linkBefore","enterGame"],global:"phaseBefore"},forced:!0,filter:function(e,a){return"link"==e.name?a.isLinked():("phase"!=e.name||0==n.phaseNumber)&&!a.isLinked()},content:function(){"link"!=trigger.name?player.link(!0):trigger.cancel()},sub:!0},2:{audio:"nzry_jieying",trigger:{player:["changeHp","loseMaxHpAfter"]},direct:!0,content:function(){player.draw(),n.hasPlayer(function(e){return e!=player&&!e.isLinked()})?player.chooseTarget(!0,"请选择【结营】的目标",function(e,a,n){return n!=a&&!n.isLinked()}).ai=function(e){return 1+Math.random()}:event.finish(),result.bool?(player.line(result.targets),player.logSkill("PSlb_jieying"),result.targets[0].link(!0)):event.finish()},sub:!0},3:{mod:{maxHandcard:function(e,a){if(n.countPlayer(function(e){return e.hasSkill("PSlb_jieying")})>0&&e.isLinked())return a+2}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSshen_liubei:"PS神刘备",PSlongnu:"龙怒",PSlongnu_info:"转换技，锁定技，阳：出牌阶段开始时，你失去1点体力并摸一张牌，然后本阶段内你视为拥有技能〖怒斩〗，且你的红色手牌均视为火【杀】且无距离限制。阴：出牌阶段开始时，你减1点体力上限并摸一张牌，然后本阶段内你然后本阶段内你视为拥有技能〖厉勇〗，且你的锦囊牌均视为雷【杀】且无使用次数限制。",PSlb_jieying:"结营",PSlb_jieying_info:"锁定技，游戏开始时或当你的武将牌重置时，你横置；所有已横置的角色手牌上限+2；当你的体力或体力上限变化后，你摸一张牌，然后横置一名其他角色。"},dynamicTranslate:{PSlongnu:function(e){return 1==e.storage.PSlongnu?'转换技，锁定技，<span class="bluetext">阳：出牌阶段开始时，你失去1点体力并摸一张牌，然后本阶段内你视为拥有技能〖怒斩〗，且你的红色手牌均视为火【杀】且无距离限制。</span>阴：出牌阶段开始时，你减1点体力上限并摸一张牌，然后本阶段内你然后本阶段内你视为拥有技能〖厉勇〗，且你的锦囊牌均视为雷【杀】且无使用次数限制。':'转换技，锁定技，阳：出牌阶段开始时，你失去1点体力并摸一张牌，然后本阶段内你视为拥有技能〖怒斩〗，且你的红色手牌均视为火【杀】且无距离限制。<span class="bluetext">阴：出牌阶段开始时，你减1点体力上限并摸一张牌，然后本阶段内你然后本阶段内你视为拥有技能〖厉勇〗，且你的锦囊牌均视为雷【杀】且无使用次数限制。</span>'}},rank:c.rare},PSjin_duyu:{info:{sex:"male",group:"jin",hp:4,skills:["PSsanchen","PSzhaotao","PSpozhu"],dieAudios:["duyu"],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSsanchen:{audio:"sanchen",enable:"phaseUse",usable:3,init:function(e){e.storage.PSsanchen||(e.storage.PSsanchen=0)},content:function(){if(player.draw(3),player.storage.PSsanchen++,n.hasPlayer(e=>e.countCards("h")>0&&e!=player)){if(player.chooseTarget("弃置一名其他角色手牌").set("filterTarget",function(e,a,n){return n!=a&&n.countCards("h")>0}).set("ai",function(a){var n=r.event.player;return-e.attitude(n,a)}),result.bool){var a=result.targets[0];player.logSkill("PSsanchen",a),player.discardPlayerCard(a,[1,1/0],"h",!1,"visible").set("filterButton",function(a){for(var n=0;n<t.selected.buttons.length;n++)if(e.suit(a.link)==e.suit(t.selected.buttons[n].link))return!1;return!0}).set("ai",function(n){return 10-a.hp-e.value(n)}).set("prompt","三陈：弃置"+e.translation(a)+"花色不同的牌").set("complexCard",!0)}}else event.finish()},ai:{order:10}},PSzhaotao:{audio:"zhaotao",forbid:["guozhan"],trigger:{player:"phaseJieshuBegin"},forced:!0,juexingji:!0,skillAnimation:!0,animationColor:"thunder",filter:function(e,a){return a.storage.PSsanchen&&a.storage.PSsanchen>2},content:function(){player.awakenSkill("PSzhaotao"),player.gainMaxHp(),player.recover(),player.isDisabledJudge()||(player.disableJudge(),n.log(player,"废除了判定区")),player.addSkills("PSjin_miewu")},derivation:"PSjin_miewu"},PSpozhu:{audio:"pozhu",enable:"phaseUse",filter:function(e,a){return a.countCards("he")>1},filterCard:function(){return!t.selected.targets.length},position:"he",selectCard:2,complexSelect:!0,complexCard:!0,filterTarget:function(e,a,n){return n!=a},check:function(a){return 6-e.value(a)},content:function(){target.damage("nocard")},ai:{damage:!0,order:2,result:{target:function(a,n){return e.damageEffect(n,a)}},threaten:1.5,expose:.3}},PSjin_miewu:{audio:"spmiewu",trigger:{player:"phaseJudgeBefore"},forced:!0,filter:function(e,a){return a.isDisabledJudge()},content:function(){trigger.cancel();var e=player.phaseDraw();event.next.remove(e),trigger.getParent().next.push(e)},ai:{effect:{target:function(a,n,r){if("delay"==e.type(a))return"zerotarget"}}}}},sort:u.PScharacter_jin,translate:{PSjin_duyu:"PS晋杜预",PSjin_duyu_prefix:"PS晋",PSsanchen:"三陈",PSsanchen_info:"出牌阶段限三次，你可以摸3张牌，然后观看一名其他角色的手牌，从中弃置任意张花色不同的牌。",PSzhaotao:"诏讨",PSzhaotao_info:"觉醒技，结束阶段开始时，若你本局游戏已发动两次以上〖三陈〗，你增加一点体力上限并回复一点体力，废除判定区，然后获得〖灭吴〗。",PSpozhu:"破竹",PSpozhu_info:"出牌阶段，你可以弃置两张牌，对一名其他角色造成一点伤害。",PSjin_miewu:"灭吴",PSjin_miewu_info:"锁定技，若你的判定区已废除，则你的判定阶段视为摸牌阶段。"},rank:c.epic},PSsb_xushao:{info:{sex:"male",group:"qun",hp:4,skills:["PSsb_pingjian"],dieAudios:["xushao"],trashBin:[]},intro:"由“才七乓”设计",skills:{PSsb_pingjian:{audio:"pingjian",trigger:{player:["damageEnd","phaseJieshuBegin"]},initList:function(){var t=[];if(r.connectMode)t=e.charactersOL();else{t=[];for(var i in a.character)a.filter.characterDisabled2(i)||a.filter.characterDisabled(i)||t.push(i)}n.countPlayer2(function(e){t.remove(e.name),t.remove(e.name1),t.remove(e.name2),e.storage.rehuashen&&e.storage.rehuashen.character&&t.removeArray(e.storage.rehuashen.character)}),r.characterlist=t},frequent:!0,chooseToPingJian:function(){var i=event.list1,o=event.list2,l=function(i,o){var l=r.event;if(l._result||(l._result={}),l._result.skills=[],n.TLHasExt("十周年")){var s=document.getElementById("dui-controls");s&&s.classList.add("Tlao_confirmdown2")}l.initbg=t.create.div(".Tlao_initbg",document.body),l.initbg.addEventListener(a.config.touchscreen?"touchend":"click",function(){n.TLremoveSkillInfo()},!0);var u=t.create.div(".Tlao_init",l.initbg);u.addEventListener(a.config.touchscreen?"touchend":"click",function(){n.TLremoveSkillInfo()},!0),n.TLHasExt("十周年")||(u.style.transform="translate(-50%,-90%)"),t.create.div(".Tlao_inittishi",u).textContent=l.topic,n.TLCreateStand(player,u,266,1);var c=t.create.div("",u);c.style.cssText='width:586px;height:216px;top:33px;right:60px;positon:"absolute";';for(var g=l.list2.flat(),d=0,h=0;h<l.list1.length;h++){var p=h*(104-4*i.length)+35*(8-i.length)+35;n.TLCreateHead(l.list1[h],c,68,p,12);for(var f=0;f<l.list2[h].length;f++){var S=t.create.div(".Tlao_skillnode",c);(e.info(o[h][f]).limited||e.info(o[h][f]).juexingji)&&S.classList.add("Tlao_skillnodelimit"),S.link=g[d],d++,S.textContent=e.translation(l.list2[h][f]),S.style.left=p-3+"px",S.style.top=84+40*f+"px",S.addEventListener(a.config.touchscreen?"touchend":"click",function(){this.style.animation="initbutton 0.2s forwards",this.addEventListener("animationend",function(){this.style.animation=""}),n.TLremoveSkillInfo(),this.classList.contains("Tlao_initselected")?(this.classList.remove("Tlao_initselected"),l._result.skills.remove(this.link)):this.classList.contains("Tlao_initselected2")?(this.classList.remove("Tlao_initselected2"),l._result.skills.remove(this.link)):(l._result.skills.length<l.total&&(this.classList.contains("Tlao_skillnodelimit")?this.classList.add("initselected2"):this.classList.add("Tlao_initselected"),l._result.skills.push(this.link)),n.TLcreateSkillInfo(this.link,l.initbg))},!0)}}var y=t.create.div("",u);y.style.cssText='width:100%;height:20px;left:0;bottom:0;text-align:center;font-family:"yuanli";font-size:20px;line-height:18px;color:#f1dfcc;filter: drop-shadow(1px 0 0 #664934) drop-shadow(-1px 0 0 #664934) drop-shadow(0 1px 0 #664934) drop-shadow(0 -1px 0 #664934);transform:translateY(220%);letter-spacing:3px;pointer-events:none;',y.textContent="请选择"+e.cnNumber(l.total)+"个武将技能",l.switchToAuto=function(){if(n.TLHasExt("十周年")){var e=document.getElementById("dui-controls");e&&e.classList.remove("Tlao_confirmdown2")}l.initbg.remove(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){if(n.TLHasExt("十周年")){var a=document.getElementById("dui-controls");a&&a.classList.remove("Tlao_confirmdown2")}l.initbg.remove(),l.control.close(),n.resume(),r.imchoosing=!1}),n.pause(),n.countChoose()};event.isMine()?l(i,o):event.isOnline()?(event.player.send(l,i,o),event.player.wait(),n.pause()):function(){r.imchoosing=!1;for(var e=o.flat(),n=0;n<e.length;n++)a.skill[e[n]].ai&&a.skill[e[n]].ai.combo&&e.remove(e[n]);event._result={bool:!0,skills:e.randomGets(event.total)},event.initbg&&event.initbg.close(),event.control&&event.control.close()}();var s=event.result||result;if(s&&s.skills&&s.skills.length)for(var u of s.skills)"phaseUse"==event.triggername?(player.storage.PSsb_pingjian.add(u),player.addTempSkill(u,"phaseUseEnd"),player.addTempSkill("PSsb_pingjian_temp","phaseUseEnd"),player.storage.PSsb_pingjian_temp||(player.storage.PSsb_pingjian_temp=[]),player.storage.PSsb_pingjian_temp.add(u)):(player.storage.PSsb_pingjian.add(u),player.addTempSkill(u,"damageEnd"==event.triggername?"damageAfter":"phaseJieshu"));n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},s.skills)},content:function(){if(player.storage.PSsb_pingjian||(player.storage.PSsb_pingjian=[]),event._result={bool:!0},result.bool){r.characterlist||a.skill.PSsb_pingjian.initList();var i=[],o=[],l=[];r.characterlist.randomSort();for(var s=event.triggername,u=0;u<r.characterlist.length;u++){var c=r.characterlist[u];if(c&&-1==c.indexOf("zuoci")&&-1==c.indexOf("xushao")){for(var g=a.character[c][3],d=0;d<g.length;d++)if(!player.storage.PSsb_pingjian.includes(g[d]))if(o.includes(g[d])&&a.skill.PSfushi.characterList().includes(c))i.add(c),l[c]||(l[c]=[]),l[c].push(g[d]),o.add(g[d]);else{var h=[g[d]];n.expandSkills(h);for(var p=0;p<h.length;p++){var f=a.skill[h[p]];if(!(!f||!f.trigger||!f.trigger.player||f.silent||f.limited||f.juexingji||f.zhuanhuanji||f.hiddenSkill||f.dutySkill)&&((f.trigger.player==s||Array.isArray(f.trigger.player)&&f.trigger.player.includes(s))&&a.skill.PSfushi.characterList().includes(c))){if(f.init||f.ai&&(f.ai.combo||f.ai.notemp||f.ai.neg))continue;if(f.filter)try{if(!f.filter(trigger,player,s))continue}catch(y){continue}i.add(c),l[c]||(l[c]=[]),l[c].push(g[d]),o.add(g[d]);break}}}if(i.length>5)break}}if(o.length){player.isUnderControl()&&n.swapPlayerAuto(player);var S=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog("请选择发动至多两个技能",[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=2)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?S(i,o):event.isOnline()?(event.player.send(S,i,o),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:o.randomGets(2)},event.dialog&&event.dialog.close(),event.control&&event.control.close())}else event.finish()}else event.finish();if((l=event.result||result)&&l.skills&&l.skills.length)for(var u of l.skills)player.storage.PSsb_pingjian.add(u),player.addTempSkill(u,"damageEnd"==event.triggername?"damageAfter":"phaseJieshu");n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},l.skills),"摸一张牌"!=result.control||player.draw()},group:"PSsb_pingjian_use",phaseUse_special:["xinfu_lingren"],subSkill:{use:{usable:1,sub:!0,audio:"pingjian",enable:"phaseUse",position:"he",content:function(){if(player.storage.PSsb_pingjian||(player.storage.PSsb_pingjian=[]),event._result={bool:!0},result.bool){var i=[],o=[],l=[];r.characterlist||a.skill.PSsb_pingjian.initList(),r.characterlist.randomSort();for(var s=0;s<r.characterlist.length;s++){var u=r.characterlist[s];if(u&&-1==u.indexOf("zuoci")&&-1==u.indexOf("xushao")){for(var c=a.character[u][3],g=0;g<c.length;g++)if(!player.storage.PSsb_pingjian.includes(c[g]))if((o.includes(c[g])||a.skill.PSsb_pingjian.phaseUse_special.includes(c[g]))&&a.skill.PSfushi.characterList().includes(u))i.add(u),l[u]||(l[u]=[]),l[u].push(c[g]),o.add(c[g]);else{var d=[c[g]];n.expandSkills(d);for(var h=0;h<d.length;h++){var p=a.skill[d[h]];if(!(!p||!p.enable||p.viewAs||p.limited||p.juexingji||p.zhuanhuanji||p.hiddenSkill||p.dutySkill)&&(("phaseUse"==p.enable||Array.isArray(p.enable)&&p.enable.includes("phaseUse"))&&a.skill.PSfushi.characterList().includes(u))){if(p.init||p.onChooseToUse||p.ai&&(p.ai.combo||p.ai.notemp||p.ai.neg))continue;if(p.filter)try{if(!p.filter(event.getParent(2),player))continue}catch(S){continue}i.add(u),l[u]||(l[u]=[]),l[u].push(c[g]),o.add(c[g]);break}}}if(i.length>5)break}}if(o.length){player.isUnderControl()&&n.swapPlayerAuto(player);var f=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog("请选择发动至多两个技能",[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=2)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?f(i,o):event.isOnline()?(event.player.send(f,i,o),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:o.randomGets(2)},event.dialog&&event.dialog.close(),event.control&&event.control.close())}else event.finish()}else event.finish();if((l=event.result||result)&&l.skills&&l.skills.length)for(var s of l.skills)player.storage.PSsb_pingjian.add(s),player.addTempSkill(s,"phaseUseEnd"),player.addTempSkill("PSsb_pingjian_temp","phaseUseEnd"),player.storage.PSsb_pingjian_temp||(player.storage.PSsb_pingjian_temp=[]),player.storage.PSsb_pingjian_temp.add(s)},ai:{order:10,result:{player:1}}},temp:{onremove:!0,trigger:{player:["useSkillBegin","useCard1"]},silent:!0,firstDo:!0,filter:function(e,n){var r=a.skill[e.skill];return!!r&&(!!n.storage.PSsb_pingjian_temp&&(!!n.storage.PSsb_pingjian_temp.includes(e.skill)||(!(!n.storage.PSsb_pingjian_temp.includes(r.sourceSkill)&&!n.storage.PSsb_pingjian_temp.includes(r.group))||!(!Array.isArray(r.group)||!r.group.includes(n.storage.PSsb_pingjian_temp[0])&&!r.group.includes(n.storage.PSsb_pingjian_temp[1])))))},content:function(){var e=a.skill[trigger.skill];for(var n of player.storage.PSsb_pingjian_temp){if(Array.isArray(e.group)&&e.group.includes(n)){player.removeSkills(n),player.storage.PSsb_pingjian_temp.remove(n);break}if(e.sourceSkill==n||e.group==n||trigger.skill==n){player.removeSkills(n),player.storage.PSsb_pingjian_temp.remove(n);break}}player.storage.PSsb_pingjian_temp.length||player.removeSkill("PSsb_pingjian_temp")},forced:!0,popup:!1,sub:!0}}}},sort:u.PScharacter_qun,translate:{PSsb_xushao:"PS双倍许劭",PSsb_pingjian:"评荐",PSsb_pingjian_info:"结束阶段开始时/当你受到伤害后/出牌阶段限一次，你可以令系统随机从剩余武将牌堆中检索出6张拥有发动时机为结束阶段开始时/当你受到伤害后/出牌阶段的技能的武将牌。然后你可以选择尝试发动其中2个技能。每个技能每局只能选择一次。（村：受到伤害后不会失去已获得的“评鉴技能”）"},rank:c.epic},PSxushi:{info:{sex:"female",group:"wu",hp:3,skills:["PSwengua","PSfuzhu"],dieAudios:[],trashBin:[]},intro:"由“眼中藏着阿卡丽”设计",skills:{PSwengua:{global:"PSwengua_use",group:["PSwengua_tag","PSwengua_draw"],audio:"wengua",subSkill:{use:{audio:"wengua",enable:"phaseUse",filter:function(e,a){return!a.hasSkill("wengua3")&&(a.countCards("he")&&n.hasPlayer(function(e){return e.hasSkill("PSwengua")}))},log:!1,delay:!1,filterCard:function(e,a){var r=n.filterPlayer(function(e){return e.hasSkill("PSwengua")});return 1!=r.length||r[0]!=a||!a.storage.PSfuzhu},selectCard:function(){var e=r.event.player,a=n.filterPlayer(function(e){return e.hasSkill("PSwengua")});return 1==a.length&&a[0]==e&&e.storage.PSfuzhu?-1:1},discard:!1,lose:!1,position:"he",prompt:function(){var a=r.event.player,t=n.filterPlayer(function(e){return e.hasSkill("PSwengua")});if(1==t.length&&t[0]==a){if(a.storage.PSfuzhu)return;return"将一张牌置于牌堆顶或是牌堆底"}var i="将一张牌交给"+e.translation(t);return t.length>1&&(i+="中的一人"),i},check:function(a){return"sha"==a.name?5:8-e.value(a)},content:function(){var a=n.filterPlayer(function(e){return e.hasSkill("PSwengua")});if(1==a.length?(event.target=a[0],event.goto(2)):a.length>0?player.chooseTarget(!0,"选择【问卦】的目标",function(e,a,n){return r.event.list.includes(n)}).set("list",a).set("ai",function(a){var n=r.event.player;return e.attitude(n,a)}):event.finish(),result.bool&&result.targets.length?event.target=result.targets[0]:event.finish(),event.target?(player.logSkill("PSwengua",event.target),player.addTempSkill("wengua3","phaseUseEnd"),event.card=cards[0],event.target!=player&&player.give(cards,event.target)):event.finish(),delete r.noclearcountdown,n.stopCountChoose(),event.target.storage.PSfuzhu&&event.goto(8),event.target.getCards("he").includes(event.card)?event.target.chooseControlList("问卦","将"+e.translation(event.card)+"置于牌堆顶","将"+e.translation(event.card)+"置于牌堆底",event.target==player,function(){return e.attitude(event.target,player)<0?2:1}):event.finish(),event.index=result.index,0==event.index||1==event.index){var i=event.target.lose(event.card,t.cardPile);0==event.index&&(i.insert_card=!0),n.broadcastAll(function(e){var a=t.create.card();a.classList.add("infohidden"),a.classList.add("infoflip"),e.$throw(a,1e3,"nobroadcast")},event.target)}else event.finish();n.delay(),1==event.index?(n.log(event.target,"将获得的牌置于牌堆底"),1==t.cardPile.childElementCount||player==event.target?player.draw():n.asyncDraw([player,target],null,null)):0==event.index&&(n.log(player,"将获得的牌置于牌堆顶"),1==t.cardPile.childElementCount||player==event.target?player.draw("bottom"):n.asyncDraw([player,target],null,null,!0)),event.finish(),event.target.chooseControl(["从牌堆顶摸牌","从牌堆底摸牌"]).set("ai",()=>"从牌堆顶摸牌"),0==result.index?1==t.cardPile.childElementCount||player==event.target?player.draw():n.asyncDraw([player,target],null,null):1==t.cardPile.childElementCount||player==event.target?player.draw("bottom"):n.asyncDraw([player,target],null,null,!0)},ai:{order:2,threaten:1.5,result:{player:function(a,r){if(r=n.findPlayer(function(e){return e.hasSkill("PSwengua")}))return e.attitude(a,r)}}},sub:!0},tag:{mod:{ignoredHandcard:function(e,a){if(a.storage.PSfuzhu&&e.hasGaintag("wengua"))return!0}},trigger:{player:"gainAfter"},forced:!0,filter:function(e,a){return!!a.storage.PSfuzhu&&("draw"==e.getParent().name&&"PSwengua_use"==e.getParent(2).name)},content:function(){player.addGaintag(trigger.cards,"wengua")},onremove:function(e){e.removeGaintag("wengua")},audioname2:{old_yuanshu:"weidi"},sub:!0},draw:{trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},forced:!0,filter:function(e,a){if(!a.storage.PSfuzhu)return!1;var n=e.getl(a);if(!n||!n.cards2||!n.cards2.length)return!1;if("lose"==e.name){for(var r in e.gaintag_map)if(e.gaintag_map[r].includes("wengua"))return!0;return!1}return a.hasHistory("lose",function(a){if(e!=a.getParent())return!1;for(var n in a.gaintag_map)if(a.gaintag_map[n].includes("wengua"))return!0;return!1})},content:function(){player.draw()},sub:!0}}},PSfuzhu:{audio:"fuzhu",dutySkill:!0,derivation:"PSwengua_1",group:["PSfuzhu_achieve","PSfuzhu_fail"],trigger:{global:"phaseJieshuBegin"},filter:function(e,a){return e.player!=a&&e.player.hasSex("male")&&t.cardPile.childElementCount<=10*a.hp},check:function(a,n){return e.attitude(n,a.player)<0&&e.effect(a.player,{name:"sha"},n,n)>0},logTarget:"player",onWash:function(){return r.event.getParent("PSfuzhu").washed=!1,"remove"},content:function(){event.washed=!1,a.onwash.push(a.skill.PSfuzhu.onWash),event.total=n.players.length+n.dead.length,player.storage.PSfuzhu_target||(player.storage.PSfuzhu_target=trigger.player),event.total--;var r=e.cardPile2(function(e){return"sha"==e.name&&player.canUse(e,trigger.player,!1)});r&&(r.remove(),n.updateRoundNumber(),player.useCard(r,trigger.player,!1)),event.total>0&&!event.washed&&t.cardPile.childElementCount<=10*player.hp&&trigger.player.isIn()&&event.goto(1),a.onwash.remove(a.skill.PSfuzhu.onWash);for(var i=e.cards(t.cardPile.childElementCount+1),o=0;o<i.length;o++)t.cardPile.insertBefore(i[o],t.cardPile.childNodes[e.rand(t.cardPile.childElementCount)]);n.updateRoundNumber()},ai:{threaten:1.5},subSkill:{achieve:{audio:"ext:PS武将/audio/skill:2",trigger:{source:"dieAfter"},forced:!0,skillAnimation:!0,animationColor:"fire",filter:function(e,a){return"PSfuzhu"==e.getParent(5).name&&e.player==a.storage.PSfuzhu_target},content:function(){n.log(player,"成功完成使命"),n.log(player,"升级了〖问卦〗"),player.popup("使命成功","wood"),player.awakenSkill("PSfuzhu"),player.storage.PSfuzhu=!0;var e=0;player.getHistory("sourceDamage",function(a){a.card&&"PSfuzhu"==a.getParent(3).name&&(e+=a.num)}),e=Math.ceil(e/2),player.draw(e)},sub:!0},fail:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"PSfuzhuAfter"},forced:!0,filter:function(e,a){return!0},content:function(){n.log(player,"使命失败"),player.popup("使命失败","fire"),player.awakenSkill("PSfuzhu"),player.isDamaged()?player.recover():player.draw()},sub:!0}}},PSwengua_1:{audio:"wengua"}},sort:u.PScharacter_wu,translate:{PSxushi:"PS徐氏",PSwengua:"问卦",PSwengua_info:"其他角色/你的出牌阶段限一次，其可以交给你一张牌，(若当前回合角色为你，则跳过此步骤)，你可以将此牌/一张牌置于牌堆顶或牌堆底，然后你与其/你从另一端摸一张牌",PSfuzhu:"伏诛",PSfuzhu_info:"使命技。①一名男性角色的结束阶段，若牌堆剩余牌数不大于你体力值的十倍，则你可以依次对其使用牌堆中所有的【杀】（不能超过游戏人数），然后洗牌。②成功：当你因〖伏诛〗①杀死该角色后，你摸Y张牌，然后升级〖问卦〗（Y为你发动〖伏诛〗①造成伤害数的一半，向上取整）。③失败：当你发动〖伏诛〗①没有杀死该角色，你回复一点体力（若体力值已满，则摸一张牌）。",PSwengua_1:"问卦·升级",PSwengua_1_info:"其他角色/你的出牌阶段限一次，其可以交给你一张牌，(若当前回合角色为你，则跳过此步骤)，然后你与其/你从牌堆顶或牌堆底摸一张牌。你的问卦牌不计入手牌上限，当你失去问卦牌时，你摸一张牌。","#ext:PS武将/audio/skill/PSfuzhu_achieve1":"汝等奸贼，何当今日丧命！","#ext:PS武将/audio/skill/PSfuzhu_achieve2":"诛暴灭奸，平夫君之冤。","#ext:PS武将/audio/skill/PSfuzhu_fail1":"未能除贼，愧对夫君。","#ext:PS武将/audio/skill/PSfuzhu_fail2":"计划失策，恐难再有时机。"},dynamicTranslate:{PSwengua:function(e){return e.storage.PSfuzhu?"其他角色/你的出牌阶段限一次，其可以交给你一张牌，(若当前回合角色为你，则跳过此步骤)，然后你与其/你从牌堆顶或牌堆底摸一张牌。你的问卦牌不计入手牌上限，当你失去问卦牌时，你摸一张牌。":"其他角色/你的出牌阶段限一次，其可以交给你一张牌，(若当前回合角色为你，则跳过此步骤)，你可以将此牌/一张牌置于牌堆顶或牌堆底，然后你与其/你从另一端摸一张牌"}},rank:c.rare},PSjiaxu:{info:{sex:"male",group:"qun",hp:3,skills:["PSluanwu","PSwansha","reweimu"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSluanwu:{audio:"luanwu",enable:"phaseUse",usable:1,filterTarget:!0,selectTarget:[1,1/0],multiline:!0,filter:function(e,a){return n.countPlayer(e=>e!=a)>1},content:function(){var e=targets.slice().sortBySeat(target)[1],a={name:"sha",isCard:!0};target.canUse(a,e,!1)&&target.useCard(a,e,!1)},ai:{threaten:3,order:7,result:{target:-1}}},PSwansha:{audio:"ext:PS武将/audio/skill:2",trigger:{global:"dying"},forced:!0,logTarget:function(e,a){return e.player},preHidden:!0,firstDo:!0,filter:function(e,a,n){return r.currentPhase==a&&e.player!=a},content:function(){player.line(trigger.player),trigger.player.die({source:trigger.source}),trigger.player.isAlive()||trigger.cancel(!0)}}},sort:u.PScharacter_qun,translate:{PSjiaxu:"PS贾诩",PSluanwu:"乱武",PSluanwu_info:"出牌阶段限一次。你可以选择至少两名角色，然后每名你选择的角色依次视为对这些角色中与其逆时针座次最近的另一名角色使用一张不计入次数的【杀】。",PSwansha:"完杀",PSwansha_info:"锁定技，你的回合内，除你以外，进入濒死状态的角色立即死亡，且使其进入濒死状态的角色视为杀死其的角色。","#ext:PS武将/audio/skill/PSwansha1":"汝以孤立无援，乖乖领死吧。","#ext:PS武将/audio/skill/PSwansha2":"且看你如何自救。"},rank:c.rare},PSshen_zhangliao:{info:{sex:"male",group:"shen",hp:4,skills:["PSduorui","drlt_zhiti"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSduorui:{audio:"drlt_duorui",trigger:{source:"damageSource"},filter:function(n,r){var t=[],i=[],o=[];i=null!=n.player.name1?a.character[n.player.name1][3]:a.character[n.player.name][3],null!=n.player.name2&&(o=a.character[n.player.name2][3]),i=i.concat(o);for(var l=function(a){var n=e.info(a);return!(!n||n.charlotte||n.hiddenSkill)},s=0;s<i.length;s++)l(i[s])&&t.add(i[s]);for(var s in n.player.disabledSkills)t.includes(s)&&t.remove(s);return r!=n.player&&n.player.isIn()&&t.length&&r.isPhaseUsing()},check:function(e,a){return!0},content:function(){var r=[],t=[],i=[];t=null!=trigger.player.name1?a.character[trigger.player.name1][3]:a.character[trigger.player.name][3],null!=trigger.player.name2&&(i=a.character[trigger.player.name2][3]),t=t.concat(i);for(var o=function(a){var n=e.info(a);return!(!n||n.charlotte||n.hiddenSkill)},l=0;l<t.length;l++)o(t[l])&&r.add(t[l]);for(var l in trigger.player.disabledSkills)r.includes(l)&&r.remove(l);event.skills=r,event.skills.length>1?player.chooseControl(event.skills).set("prompt","请选择禁用"+e.translation(trigger.player)+"的一个技能").set("ai",function(){return event.skills.randomGet()}):1==event.skills.length?event._result={control:event.skills[0]}:event.finish(),trigger.player.storage.PSduorui||(trigger.player.storage.PSduorui=[]),trigger.player.storage.PSduorui.add(result.control),trigger.player.disableSkill("PSduorui_disable",result.control),trigger.player.addTempSkill("PSduorui_disable",{player:"phaseAfter"}),n.log(trigger.player,"的〖",result.control,"〗失效了")},group:"PSduorui_add",subSkill:{add:{enable:"phaseUse",filter:function(e,a){return a.countDisabled()<5},popup:!1,content:function(){player.chooseToDisable().ai=function(e,a,n){return n.includes("equip5")?"equip5":n.randomGet()};var i=[],o=[],l=n.filterPlayer(e=>e!=player);for(var s of l)s.name&&o.add(s.name),s.name2&&o.add(s.name2),s.name3&&o.add(s.name3),i.addArray(s.getStockSkills("无名杀","启动").filter(function(a){return e.info(a)}));var u=[];for(var c of i)player.hasSkill(c)&&u.add(c);if(i.removeArray(u),o.length&&i.length){player.isUnderControl()&&n.swapPlayerAuto(player);var g=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog("请选择获得一个技能",[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=1)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?g(o,i):event.isOnline()?(event.player.send(g,o,i),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:i.randomGets()},event.dialog&&event.dialog.close(),event.control&&event.control.close());var d=event.result||result;if(d&&d.skills&&d.skills.length)for(var c of(player.logSkill("PSduorui"),d.skills))player.addSkills(c);n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},d.skills)}else event.finish()},sub:!0},disable:{onremove:function(e,a){e.enableSkill(a),delete e.storage.PSduorui},locked:!0,mark:!0,marktext:"🔒",charlotte:!0,intro:{content:function(n,r,t){var i=[];for(var o in r.disabledSkills)r.disabledSkills[o].includes(t)&&i.push(o);if(i.length){var l="失效技能：";for(o=0;o<i.length;o++)a.translate[i[o]+"_info"]&&(l+=e.translation(i[o])+"、");return l.slice(0,-1)}}},sub:!0}}}},sort:u.PScharacter_shen,translate:{PSshen_zhangliao:"PS神张辽",PSduorui:"夺锐",PSduorui_info:"出牌阶段，你可以废除一个装备栏，然后获得场上的一个技能。当你于出牌阶段内对一名其他角色造成伤害后，你可以令该角色的一个技能失效直到其回合结束。"},rank:c.legend},PSguanyu:{info:{sex:"male",group:"shu",hp:4,skills:["PSwusheng","PSyijue","PSmashu"],dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",replace:["PSguanyunchang","PSguanyu"],skills:{PSwusheng:{mod:{aiOrder:function(a,n,r){return"card"==e.itemtype(n)&&"sha"==n.name&&"heart"==e.suit(n)?r+.2:"card"==e.itemtype(n)&&"sha"==n.name&&"diamond"==e.suit(n)?r+.1:void 0},targetInRange:function(a){if("diamond"==e.suit(a)&&"sha"==a.name)return!0}},locked:!1,audio:"wusheng_re_guanyu",enable:["chooseToRespond","chooseToUse"],filterCard:function(a,n){return!!e.zhu(n,"shouyue")||"red"==e.color(a)},position:"hes",viewAs:{name:"sha",isCard:!0},viewAsFilter:function(a){if(e.zhu(a,"shouyue")){if(!a.countCards("hes"))return!1}else if(!a.countCards("hes",{color:"red"}))return!1},prompt:"将一张红色牌当杀使用或打出",check:function(a){var n=e.value(a);return"chooseToRespond"==r.event.name?1/Math.max(.1,n):5-n},ai:{respondSha:!0,skillTagFilter:function(a){if(e.zhu(a,"shouyue")){if(!a.countCards("hes"))return!1}else if(!a.countCards("hes",{color:"red"}))return!1},yingbian:function(r,t,i,o){if(e.attitude(o,t)<=0)return 0;var l=0,s=!1;return e.cardtag(r,"yingbian_hit")&&(s=!0,i.filter(function(a){return a.hasShan()&&e.attitude(o,a)<0&&e.damageEffect(a,t,o,e.nature(r))>0})&&(l+=5)),e.cardtag(r,"yingbian_all")&&n.hasPlayer(function(n){return!i.includes(n)&&a.filter.targetEnabled2(r,t,n)&&e.effect(n,r,t,t)>0})&&(l+=5),e.cardtag(r,"yingbian_damage")&&i.filter(function(a){return e.attitude(t,a)<0&&(s||!a.mayHaveShan()||t.hasSkillTag("directHit_ai",!0,{target:a,card:r},!0))&&!a.hasSkillTag("filterDamage",null,{player:t,card:r,jiu:!0})})&&(l+=5),l},canLink:function(e,a,n){return!(!a.isLinked()&&!e.hasSkill("wutiesuolian_skill"))&&(!(a.mayHaveShan()&&!e.hasSkillTag("directHit_ai",!0,{target:a,card:n},!0))&&!(e.hasSkill("jueqing")||e.hasSkill("gangzhi")||a.hasSkill("gangzhi")))},basic:{useful:[5,3,1],value:[5,3,1]},order:function(r,t){return t.hasSkillTag("presha",!0,null,!0)?10:a.linked.includes(e.nature(r))?n.hasPlayer(function(n){return n!=t&&n.isLinked()&&t.canUse(r,n,null,!0)&&e.effect(n,r,t,t)>0&&a.card.sha.ai.canLink(t,n,r)})&&n.countPlayer(function(a){return a.isLinked()&&e.damageEffect(a,t,t,e.nature(r))>0})>1?3.1:3:3.05},result:{target:function(a,n,r,t){var i=!t&&a.hasSkill("jiu")?n.hasSkillTag("filterDamage",null,{player:a,card:r,jiu:!0})?-.5:e.attitude(a,n)>0?-7:-4:-1.5;return t||!n.mayHaveShan()||a.hasSkillTag("directHit_ai",!0,{target:n,card:r},!0)?i:i/1.2}},tag:{respond:1,respondShan:1,damage:function(e){if(!n.hasNature(e,"poison"))return 1},natureDamage:function(e){if(n.hasNature(e))return 1},fireDamage:function(e,a){if(n.hasNature(e,"fire"))return 1},thunderDamage:function(e,a){if(n.hasNature(e,"thunder"))return 1},poisonDamage:function(e,a){if(n.hasNature(e,"poison"))return 1}}},group:"PSwusheng_effect",subSkill:{effect:{trigger:{player:"useCardToPlayered"},forced:!0,filter:function(a,n){return a.card&&"sha"==a.card.name&&("heart"==e.suit(a.card)||"diamond"==e.suit(a.card))&&a.card.isCard},logTarget:"target",content:function(){if("heart"==e.suit(trigger.card)){var a=trigger.target.playerid,n=trigger.getParent().customArgs;n[a]||(n[a]={}),"number"!=typeof n[a].extraDamage&&(n[a].extraDamage=0),n[a].extraDamage++,trigger.getParent().directHit.includes(trigger.target)||("number"==typeof n[a].shanRequired?n[a].shanRequired++:n[a].shanRequired=2)}else{var r=trigger.target;player.gainPlayerCard(r,"he",!0)}},sub:!0}}},PSyijue:{audio:"yijue",enable:"phaseUse",usable:1,position:"he",filterTarget:function(e,a,n){return a!=n&&n.countCards("he")},filter:function(e,a){return a.countCards("he")},filterCard:!0,check:function(a){return 8-e.value(a)},content:function(){target.countCards("he")||event.finish(),player.isUnderControl()&&n.swapPlayerAuto(player);var i=function(i){var o=r.event;i=i||o.player,o._result||(o._result={});var l=t.create.dialog("义绝：请声明牌的类型和花色","forcebutton","hidden");o.dialog=l,l.addText("类型");var s=document.createElement("div");s.classList.add("add-setting"),s.style.margin="0",s.style.width="100%",s.style.position="relative";for(var u=["任意","basic","trick","equip"],c=0;c<u.length;c++){(h=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode")).link=u[c],s.appendChild(h),h.innerHTML="<span>"+e.translation(u[c])+"</span>",h.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link,a=this.parentNode.querySelector(".bluebg");a&&a.classList.remove("bluebg"),this.classList.add("bluebg"),o._result.type=e}})}l.content.appendChild(s),l.addText("花色");var g=document.createElement("div");g.classList.add("add-setting"),g.style.margin="0",g.style.width="100%",g.style.position="relative";var d=["任意"].concat(a.suit);for(c=0;c<d.length;c++){var h=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode"),p=d[c];h.link=p,g.appendChild(h),h.innerHTML="<span>"+e.translation(p)+"</span>",h.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link,a=this.parentNode.querySelector(".bluebg");a&&a.classList.remove("bluebg"),this.classList.add("bluebg"),o._result.suit=e}})}l.content.appendChild(g),l.add("　　"),o.dialog.open(),o.switchToAuto=function(){o._result={bool:!0,type:u.randomGet(),suit:d.randomGet()},o.dialog.close(),o.control.close(),n.resume(),r.imchoosing=!1},o.control=t.create.control("ok",function(e){o._result.bool=!0,o.dialog.close(),o.control.close(),n.resume(),r.imchoosing=!1});for(c=0;c<o.dialog.buttons.length;c++)o.dialog.buttons[c].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?i(player):event.isOnline()?(event.player.send(i,player),event.player.wait(),n.pause()):function(){r.imchoosing=!1;var e=["任意"].concat(["basic","trick","equip"]);event._result={bool:!0,suit:["任意",...a.suit].randomGet(),type:e.randomGet()},event.dialog&&event.dialog.close(),event.control&&event.control.close()}();var o=event.result||result;o.bool&&(o.type&&"任意"!=o.type&&(event.type=o.type),o.suit&&"任意"!=o.suit&&(event.suit=o.suit),n.log(player,"声明了",event.suit||"任意花色","和",event.type||"任意类型"),player.popup(e.translation(event.suit+2||"任意花色")+"<br/>"+e.translation(event.type||"任意类型"),"thunder")),target.hasCard(a=>e.suit(a)==(event.suit||e.suit(a))&&e.type2(a)==(event.type||e.type2(a)),"he")?target.chooseCard(!1,"he",function(a){return e.suit(a)==(event.suit||e.suit(a))&&e.type2(a)==(event.type||e.type2(a))}).set("ai",function(a){var n=r.event.player;return(n.hasShan()||n.hp<3)&&"black"==e.color(a)?.5:Math.max(1,20-e.value(a))}).set("prompt","交给"+e.translation(player)+"一张牌，否则获得负面效果"):event._result={bool:!1},result.bool&&result.cards?(player.gain(result.cards[0],target,"give","bySelf"),target.hp<target.maxHp&&(player.chooseBool("是否让"+e.translation(target)+"回复一点体力？").ai=function(a,n){return e.recoverEffect(target,n,n)>0})):(player.draw(),target.hasSkill("fengyin")||target.addTempSkill("fengyin"),target.addTempSkill("PSyijue_effect"),event.finish()),result.bool&&target.recover()},ai:{result:{target:function(a,n){return a.getCards("h").length<3?0:n.countCards("h")>n.hp+1&&e.recoverEffect(n)>0?1:a.canUse("sha",n)&&(a.countCards("h","sha")||a.countCards("he",{color:"red"}))?-2:-.5}},order:9,directHit_ai:!0,skillTagFilter:function(e,a,n){if(!n.target.hasSkillTag("new_yijue2"))return!1}},subSkill:{effect:{trigger:{player:"damageBegin1"},filter:function(e){return e.source&&e.source==r.currentPhase&&e.card&&"sha"==e.card.name&&e.notLink()},popup:!1,forced:!0,charlotte:!0,content:function(){trigger.num++},mark:!0,mod:{cardEnabled2:function(a){if("h"==e.position(a))return!1}},intro:{content:"不能使用或打出手牌"},sub:!0}}},PSmashu:{mod:{globalFrom:function(e,a,n){return n-1},globalTo:function(e,a,n){return n+1}}}},sort:u.PScharacter_shu,translate:{PSguanyu:"PS关羽",PSwusheng:"武圣",PSwusheng_info:"你可以将一张红色牌当做【杀】使用或打出。你使用的♦杀没有距离限制且可以获得对方一张牌；你使用的♥杀造成伤害+1，且目标需要连续使用两张【闪】才能抵消。",PSyijue:"义绝",PSyijue_info:"出牌阶段限一次，你可以弃置一张牌并令一名有牌的其他角色选择交给你一张由你声明花色和类型的牌。若其选择不交出，你摸一张牌，该角色不能使用或打出牌，非锁定技失效且受到来自你的【杀】伤害+1直到回合结束。否则你可以令其回复一点体力。",PSmashu:"马术",PSmashu_info:"锁定技，你计算与其他角色的距离时-1，其他角色计算与你的距离时+1。"},rank:c.rare},PSshen_zhangfei:{info:{sex:"male",group:"shen",hp:4,skills:["PSshencai","PSxunshi"],dieAudios:[],trashBin:[]},intro:"由“虚幼屎”设计",skills:{PSshencai:{audio:"shencai",enable:"phaseUse",usable:5,filter:function(e,a){var n=a.getStat("skill").PSshencai;return!(n&&n>a.countMark("PSshencai"))},filterTarget:function(e,a,n){return a!=n},onremove:!0,prompt:"选择一名其他角色进行地狱审判",content:function(){target.judge().callback=a.skill.PSshencai.contentx},ai:{order:8,result:{target:-1}},contentx:function(){var n=event.judgeResult.card,r=event.getParent(2).player,t=event.getParent(2).target;"o"==e.position(n,!0)&&r.gain(n,"gain2");var i=[],o=a.skill.PSshencai.getStr(n);for(var l in a.skill.PSshencai.filterx)-1!=o.indexOf(a.skill.PSshencai.filterx[l])&&i.push("PSshencai_"+l);if(i.length){if(t.isIn())for(var l of i)t.addSkill(l),t.addMark(l,1)}else t.isIn()&&(r.gainPlayerCard(t,!0,"hej"),t.addMark("PSshencai_death",1),t.addSkill("PSshencai_death"))},filterx:{losehp:"体力",weapon:"武器",respond:"打出",distance:"距离"},getStr:function(n){var r="",t=n.name;if(a.translate[t+"_info"]&&(a.card[t].type&&a.translate[a.card[t].type]&&(r+=e.translation(a.card[t].type)+"牌|"),e.subtype(t)&&(r+=e.translation(e.subtype(t))+"|"),a.card[t]&&a.card[t].addinfomenu&&(r+=a.card[t].addinfomenu+"|"),"equip1"==e.subtype(t))){var i=!1;if(a.card[n.name]&&a.card[n.name].distance){var o=a.card[n.name].distance;o.attackFrom&&(i=!0,r+="攻击范围："+(1-o.attackFrom)+"|")}i||(r+="攻击范围：1|")}return a.card[t].cardPrompt?r+=a.card[t].cardPrompt(n)+"|":a.translate[t+"_info"]&&(r+=a.translate[t+"_info"]+"|"),a.card[t].yingbian_prompt&&e.is.yingbian(n)&&("function"==typeof a.card[t].yingbian_prompt?r+="应变："+a.card[t].yingbian_prompt(n)+"|":r+="应变："+a.card[t].yingbian_prompt+"|"),r},subSkill:{losehp:{charlotte:!0,marktext:"笞",trigger:{player:"damageEnd"},forced:!0,content:function(){player.loseHp(trigger.num)},ai:{effect:{target:function(a,n,r,t){if(e.tag(a,"damage")&&t<0)return 1.6}}},intro:{name:"神裁 - 体力",name2:"笞",content:"锁定技。当你受到伤害后，你失去等量的体力。",onunmark:!0},sub:!0},weapon:{charlotte:!0,marktext:"杖",trigger:{target:"useCardToTargeted"},forced:!0,filter:function(e,a){return"sha"==e.card.name},content:function(){trigger.directHit.add(player),n.log(player,"不可响应",trigger.card)},intro:{name:"神裁 - 武器",name2:"杖",content:"锁定技。当你成为【杀】的目标后，你不能使用牌响应此【杀】。",onunmark:!0},global:"PSshencai_weapon_ai",sub:!0},ai:{ai:{directHit_ai:!0,skillTagFilter:function(e,a,n){return!(!n||!n.card||"sha"!=n.card.name)&&!(!n.target||!n.target.hasSkill("PSshencai_weapon"))}},sub:!0},respond:{charlotte:!0,marktext:"徒",trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},forced:!0,filter:function(e,n){if(!n.hasCard(function(e){return a.filter.cardDiscardable(e,n,"PSshencai_respond")},"h"))return!1;var r=e.getParent("PSshencai_respond");return(!r||r.player!=n)&&((r=e.getl(n))&&r.hs&&r.hs.length>0)},content:function(){var e=player.getCards("h",function(e){return a.filter.cardDiscardable(e,player,"PSshencai_respond")});e.length>0&&player.discard(e.randomGet())},intro:{name:"神裁 - 打出",name2:"徒",content:"锁定技。当你失去手牌后，你随机弃置一张手牌（不嵌套触发）。",onunmark:!0},sub:!0},distance:{charlotte:!0,marktext:"流",trigger:{player:"phaseJieshuBegin"},forced:!0,content:function(){player.turnOver()},intro:{name:"神裁 - 距离",name2:"流",content:"锁定技。结束阶段开始时，你翻面。",onunmark:!0},sub:!0},death:{charlotte:!0,marktext:"死",mod:{maxHandcard:function(e,a){return a-e.countMark("PSshencai_death")}},trigger:{player:"phaseEnd"},forced:!0,filter:function(e,a){return a.countMark("PSshencai_death")>n.countPlayer()},content:function(){player.die()},intro:{name:"神裁 - 死",name2:"死",content:"锁定技。你的角色手牌上限-#；回合结束时，若场上存活人数小于#，则你死亡。",onunmark:!0},sub:!0}},intro:{content:"发动次数上限+#"}},PSxunshi:{trigger:{player:"useCard2"},forced:!0,direct:!0,priority:-1,filter:function(a,n){return"none"==e.color(a.card)},content:function(){player.countMark("PSshencai")<4&&player.hasSkill("PSshencai",null,null,!1)&&player.addMark("PSshencai",1,!1)},group:"xunshi"}},sort:u.PScharacter_shen,translate:{PSshen_zhangfei:"PS神张飞",PSshencai:"神裁",PSshencai_info:"出牌阶段限一次，你可以令一名其他角色进行判定。你获得此判定牌，然后若此判定牌：包含以下要素中的任意一个，获得对应的效果：{⒈体力：当其受到伤害后，其失去等量的体力、⒉武器：其不能使用牌响应杀、⒊打出：当其失去手牌后，其再随机弃置一张手牌（不嵌套触发）、⒋距离：其的结束阶段开始时，其翻面}；若均不包含，你获得其区域里的一张牌，其获得一枚“死”并获得如下效果：其的角色手牌上限-X、其的回合结束时，若X大于场上存活人数，则其死亡（X为其“死”标记数）。",PSxunshi:"巡使",PSxunshi_info:"锁定技。①你手牌区内所有的多目标锦囊牌均视为花色为none的普【杀】。②你使用颜色为none的牌无距离和次数限制。③当你使用无颜色的牌选择目标后，你令你的〖神裁〗的发动次数上限+1（至多为5），然后可以为此牌增加任意个目标。"},rank:c.rare},PSmeng_liubei:{info:{sex:"male",group:"shu",hp:1,skills:["PStaoyuan","PSshiren"],dieAudios:["re_liubei"],trashBin:[]},intro:"由“遇见鲲啊”设计",skills:{PStaoyuan:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"changeHp"},forced:!0,filter:function(e,a){return e.num<0&&n.hasPlayer(e=>"shu"===e.group)},content:function(){let t=n.countPlayer(e=>"shu"===e.group);event.cards=e.cards(t),player.showCards(event.cards,"桃园");let i=!1;for(var o of event.cards)if("black"!==e.color(o)){i=!0;break}if(event.bool=i,event.bool?player.hp<1&&player.recover(1-player.hp):event.finish(),player.chooseTarget("桃园：选择一名角色，让其挑选武将牌").set("ai",function(a){var n=r.event.player;return e.attitude(n,a)/Math.sqrt(1+a.countCards("h"))}),result.targets){let t,i=result.targets[0];if(r.characterlist){t=[];for(var l=0;l<r.characterlist.length;l++){var s=r.characterlist[l];"shu"==a.character[s][1]&&a.skill.PSfushi.characterList().includes(s)&&t.push(s)}}else t=r.connectMode?e.charactersOL(function(e){return"shu"!=a.character[e][1]&&!a.skill.PSfushi.characterList().includes(e)}):e.gainableCharacters(function(e,n){return"shu"==e[1]&&a.skill.PSfushi.characterList().includes(n)});var u=n.players.concat(n.dead);for(l=0;l<u.length;l++)t.remove(u[l].name),t.remove(u[l].name1),t.remove(u[l].name2);if(!t.length)return void event.finish();i.chooseButton(["桃园：选择获得一张武将牌上的所有技能",[t.randomGets(3),"character"]],!0),event.target=i}else event.finish();if(result.bool){let r=result.links[0];event.target.flashAvatar("PStaoyuan",r),n.log(event.target,"获得了","#y"+e.translation(r),"的所有技能"),event.target.addSkills(a.character[r][3])}}},PSshiren:{mod:{maxHandcard:function(e,a){return a+n.countPlayer(e=>"shu"===e.group)}},audio:"ext:PS武将/audio/skill:2",enable:"phaseUse",usable:1,filter:function(e,a){return n.hasPlayer(function(e){return a.canCompare(e)&&e.inRangeOf(a)})},filterTarget:function(e,a,n){return a.canCompare(n)&&n.inRangeOf(a)},content:()=>{player.chooseToCompare(target),result.bool&&target.changeGroup("shu")},ai:{order:3,result:{player:function(e){var a=e.countCards("h");return a>e.hp?0:1==a?-2:2==a?-1:-.7},target:function(e,a){var n=a.countCards("h");return 1==n?-1:2==n?-.7:-.5}}}}},sort:u.PScharacter_shu,translate:{PSmeng_liubei:"PS梦刘备",PSmeng_liubei_prefix:"PS梦",PStaoyuan:"桃园",PStaoyuan_info:"锁定技，当你体力减少后，你从牌堆顶亮出X张牌，若亮出的牌颜色不全为黑色，则你将体力回复到1，然后你指定一名角色，令其从三张未登场的蜀势力武将牌中选择一名获得上面所有技能。（X为场上蜀势力角色的数量）",PSshiren:"识人",PSshiren_info:"你的手牌上限加X。出牌阶段限制一次，你可以与你攻击范围内的一名角色进行拼点，若你赢，则该角色的势力变为蜀势力。（X为场上蜀势力角色的数量）","#ext:PS武将/audio/skill/PSshiren1":"此战有将军在，方可胜。","#ext:PS武将/audio/skill/PSshiren2":"蜀汉霸业，方需将军出战。","#ext:PS武将/audio/skill/PStaoyuan1":"备，愿结交天下豪杰。","#ext:PS武将/audio/skill/PStaoyuan2":"仁之所至,何吝外物。"},rank:c.epic},PSshen_dengai:{info:{sex:"male",group:"shen",hp:4,skills:["PStuoyu","PSxianjin","PSqijing"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",substitute:[["PSshen_dengai2",["ext:PS武将/image/character/PSshen_dengai2.jpg","die:ext:PS武将/audio/die:true"]]],skills:{PStuoyu:{audio:"dctuoyu",inherit:"dctuoyu",audioname2:{PSshen_dengai2:["ext:PS武将/audio/skill/PStuoyu_PSshen_dengai21","ext:PS武将/audio/skill/PStuoyu_PSshen_dengai22"]},cardIsIgnored:function(e){const a=["dctuoyu_fengtian","dctuoyu_qingqu","dctuoyu_junshan"];for(let n=0;n<a.length;n++)if(e.hasGaintag(a[n]+"_tag"))return!0;return!1},mod:{ignoredHandcard:function(a){if(e.info("PStuoyu").cardIsIgnored(a))return!0},cardDiscardable:function(a,n,r){if("phaseDiscard"==r&&e.info("PStuoyu").cardIsIgnored(a))return!1}},ai:{combo:"PSxianjin"}},PSxianjin:{audio:"dcxianjin",audioname2:{PSshen_dengai2:["ext:PS武将/audio/skill/PSxianjin_PSshen_dengai21","ext:PS武将/audio/skill/PSxianjin_PSshen_dengai22"]},inherit:"dcxianjin",trigger:{global:"roundStart",player:"damageEnd",source:"damageSource"},filter:function(e,a,n){return"roundStart"===n||a.countMark("dcxianjin")%2==0},content:function(){var a=["dctuoyu_fengtian","dctuoyu_qingqu","dctuoyu_junshan"];a.removeArray(player.getStorage("dctuoyu")),a.length?1==a.length?event._result={control:a[0]}:player.chooseControl(a).set("prompt","险进：选择激活一个副区域标签"):player.insertPhase();var r=result.control;r&&(n.log(player,"激活了副区域","#y"+e.translation(r)),player.markAuto("dctuoyu",[r]),player.popup(e.translation(r+"_tag"))),player.draw(player.getStorage("dctuoyu").length)}},PSqijing:{audio:"dcqijing",audioname2:{PSshen_dengai2:["ext:PS武将/audio/skill/PSqijing_PSshen_dengai21","ext:PS武将/audio/skill/PSqijing_PSshen_dengai22"]},trigger:{global:["phaseAfter","phaseCancelled","phaseSkipped"]},filter:function(e,a){return!e.skill&&e.player.next==r.roundStart&&3==a.getStorage("dctuoyu").length},forced:!0,juexingji:!0,skillAnimation:!0,animationColor:"orange",forceDie:!0,priority:-1/0,lastDo:!0,content(){if(player.changeSkin("PSqijing","PSshen_dengai2"),a.character.PSshen_dengai.dieAudios=["ext:PS武将/audio/die/PSshen_dengai2.mp3"],player.awakenSkill("PSqijing"),player.loseMaxHp(),player.addSkills("dccuixin"),n.countPlayer()>2){if(player==trigger.player&&!trigger.skill){var t=trigger.getParent();"phaseLoop"==t.name&&t._isStandardLoop&&(t.player=player.next)}player.chooseTarget("请选择一名要更换座次的角色，将自己移动到该角色的上家位置",function(e,a,n){return n!=a&&n!=a.next},!0).set("ai",function(a){for(var n=r.event.player,t=r.currentPhase.next,i=20,o=0;i>0;){if(i--,t==a)return o;o-=e.attitude(n,t),t=t.next}return o})}else event.finish();if(result.bool){var i=result.targets[0];n.broadcastAll(function(e,a){n.swapSeat(e,a,null,!0)},player,i)}},ai:{combo:"PStuoyu"},_priority:0}},sort:u.PScharacter_shen,translate:{PSshen_dengai:"PS神邓艾",PStuoyu:"拓域",PStuoyu_info:"①锁定技。当你使用拥有对应副区域标签的牌时，你令此牌获得对应效果。丰田：伤害值或回复值+1；清渠：无次数和距离限制；峻山：不可被响应。②出牌阶段开始时和结束时，你给你的手牌分配对应的已激活副区域标签，已分配的手牌不计入手牌上限（每个区域至多五张）。",PSxianjin:"险进",PSxianjin_info:"锁定技，每轮开始时/当你造成或受到2次伤害后，你激活一个副区域，若你区域均已开发，则改为下回合开始前你执行一个回合，然后摸X张牌（X为已开发的副区域数）。",PSqijing:"奇径",PSqijing_info:"觉醒技，每轮结束后，若你的手牌副区域均已开发，你减1体力上限，获得〖摧心〗，然后将座次移动至除你以外的两名相邻角色之间。","#ext:PS武将/audio/skill/PStuoyu_PSshen_dengai21":"巨灵之力盈身，曳金牛于高阙，惊蛟蟒于狂澜。","#ext:PS武将/audio/skill/PStuoyu_PSshen_dengai22":"效五丁开山之旧事，全六合一统于天阙。","#ext:PS武将/audio/skill/PSxianjin_PSshen_dengai21":"敌备险拒我，我行险擒敌，勇者胜也。","#ext:PS武将/audio/skill/PSxianjin_PSshen_dengai22":"鸥鹭擒蚌，必以利喙击其坚甲，而后得脍。","#ext:PS武将/audio/skill/PSqijin_PSshen_dengai21":"世人皆寻已有之平路，独吾愿为开路之先锋。","#ext:PS武将/audio/skill/PSqijin_PSshen_dengai22":"纵尔匿离天之穹、九幽之渊，吾亦擒汝首而还。","#ext:PS武将/audio/skill/cuixin_PSshen_dengai21":"缚咖于颈，镇岳于魂，教汝死灰不燃、万劫不复！","#ext:PS武将/audio/skill/cuixin_PSshen_dengai22":"上军争功，夺三家之士气，击天下之雄兵。","#ext:PS武将/audio/die/PSshen_dengai2:die":"巨灵不屑顾，奈何反被宵小伤。"},rank:c.epic},PSshen_xunyu:{info:{sex:"male",group:"shen",hp:3,skills:["PSlingce","PStianzuo","PSdinghan"],dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSlingce:{audio:"lingce",trigger:{global:"washCard"},forced:!0,content(){var a=e.cards(8);event.cards=a,1==player.storage.PSdinghan?player.chooseCardButton(a,"选择获得至多六张牌",[1,6]):player.chooseCardButton(a,"选择获得的牌名不同的牌",[1,1/0]).set("filterButton",function(a){let n=e.name(a.link);for(var r of t.selected.buttons)if(e.name(r.link)===n)return!1;return!0}),result.bool&&player.gain(result.links,"draw"),n.cardsDiscard(event.cards.removeArray(result.links))}},PStianzuo:{audio:"tianzuo",trigger:{player:["damageEnd","phaseEnd"]},filter:function(e,a){return!!t.discardPile.childNodes.length&&("phase"==e.name||e.num>0)},content:async function(e,a,r){const t="damageEnd"===e.triggername?a.num:1;for(let i=0;i<t;i++)await n.washCard()},group:"PStianzuo_use",subSkill:{use:{audio:"tianzuo",enable:"phaseUse",usable:1,filter:function(e,a){return!!t.discardPile.childNodes.length},content:()=>{n.washCard()},sub:!0}},ai:{maixie:!0,maixie_hp:!0}},PSdinghan:{skillAnimation:!0,animationColor:"fire",derivation:"PSzuoding",audio:"dinghan",juexingji:!0,unique:!0,forced:!0,trigger:{player:"PStianzuoAfter"},filter:(e,a)=>a.getAllHistory("useSkill",e=>["PStianzuo","PStianzuo_use"].includes(e.skill)).length>=3,content:()=>{player.awakenSkill(event.name),player.storage[event.name]=!0,player.gainMaxHp(),player.recover(),player.addSkills("PSzuoding")}},PSzuoding:{audio:"ext:PS武将/audio/skill:2",enable:"phaseUse",usable:3,filterCard:!0,position:"hes",viewAs:{name:"qizhengxiangsheng"},viewAsFilter:function(e){if(!e.countCards("hes"))return!1},prompt:"将一张牌当【奇正相生】使用",check:function(a){return 4-e.value(a)}}},sort:u.PScharacter_shen,translate:{PSshen_xunyu:"PS神荀彧",PSlingce:"灵策",PSlingce_info:"锁定技，当牌堆洗牌时，你观看牌堆顶8张牌，并从中获得牌名不同的牌，剩余的牌进入弃牌堆。",PStianzuo:"天佐",PStianzuo_info:"出牌阶段限一次/当你受到一点伤害后/回合结束时，若弃牌堆有牌，你可以令牌堆洗牌。",PSdinghan:"定汉",PSdinghan_info:"觉醒技，当你本局游戏至少发动过三次〖天佐〗，你增加一点体力上限并回复一点体力，获得技能〖佐定〗，然后将〖灵策〗中“获得牌名不同的牌”修改为“ 获得其中至多六张牌”。",PSzuoding:"佐定",PSzuoding_info:"出牌阶段限三次，你可以将一张牌当【奇正相生】使用。","#ext:PS武将/audio/skill/PSzuoding1":"看我二桃杀三士。","#ext:PS武将/audio/skill/PSzuoding2":"驱邪避恶，佑社稷黎民。"},dynamicTranslate:{PSlingce:function(e){return e.storage.PSdinghan?"锁定技，当牌堆洗牌时，你观看牌堆顶8张牌，并从中获得至多六张牌，剩余的牌进入弃牌堆。":"锁定技，当牌堆洗牌时，你观看牌堆顶8张牌，并从中获得牌名不同的牌，剩余的牌进入弃牌堆。"}},rank:c.epic},PShaozhao:{info:{sex:"male",group:"wei",hp:4,skills:["PSzhengu"],dieAudios:[],trashBin:[]},intro:"由“你想去哪儿呢”设计",skills:{PSzhengu:{audio:"drlt_zhenggu",trigger:{player:"phaseJieshuBegin"},filter:function(e,a){return!a.hasSkill("PSzhengu_mark")||n.hasPlayer(e=>e!=a&&!e.hasSkill("PSzhengu_mark"))},async cost(a,n,r){a.result=await r.chooseTarget(e.prompt2("PSzhengu"),function(e,a,n){return n!==a&&(!a.hasSkill("PSzhengu_mark")||!n.hasSkill("PSzhengu_mark"))}).set("ai",function(a){const n=e.attitude(r,a),t=a.countCards("h")-r.countCards("h");return r.hasSkill("PSzhengu_mark")&&t<=0||a.hasSkill("PSzhengu_mark")&&t<=0?0:n<=0?t>0?t:0:Math.abs(t)}).forResult()},async content(a,r,t){const i=a.targets[0];let o;t.hasSkill("PSzhengu_mark")?o=i:i.hasSkill("PSzhengu_mark")?o=t:({control:o}=await t.chooseControl().set("controls",["自己",i]).set("prompt",`令你或${e.translation(i)}变成“高达”：手牌数始终保持与另一方一致，直到“高达”的回合结束时`).set("target",i).set("ai",function(){const{controls:a,target:n}=e.event(),r=e.attitude(t,n),i=n.countCards("h")-t.countCards("h");return r<=0&&i>0||i>0?a[0]:a[1]}).forResult());const l="自己"===o?t:i,s="自己"===o?i:t;n.log(l,"变成了“高达”！对象是：",s);var u=s.countCards("h")-l.countCards("h");u>0&&l.draw(u),u<0&&l.chooseToDiscard("h",!0,-u),l.storage.PSzhengu_mark=s,l.addTempSkill("PSzhengu_mark",{player:"phaseJieshuBegin"}),l.markSkill("PSzhengu_mark")},subSkill:{mark:{onremove:function(e){e.unmarkSkill("PSzhengu_mark"),delete e.storage.PSzhengu_mark},mark:"character",intro:{content:"已经变成了$的形状"},trigger:{global:["loseAfter","equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},forced:!0,filter:function(e,a){let n=a.storage.PSzhengu_mark;return n&&n.isIn()&&n.isAlive()&&n.countCards("h")!==a.countCards("h")},content:function(){let e=player.storage.PSzhengu_mark,a=e.countCards("h")-player.countCards("h");e.logSkill("PSzhengu",player),e.line(player,"fire"),a>0?player.draw(a):player.chooseToDiscard("h",-a,!0)},sub:!0}}}},sort:u.PScharacter_wei,translate:{PShaozhao:"PS郝昭",PSzhengu:"镇骨",PSzhengu_info:"结束阶段，你可以选择一名其他角色，然后你令你或其成为“高达”（“高达”效果：手牌数始终保持与对方一致，直到下回合结束时。一名角色不能重复成为“高达”）。"},rank:c.rare},PSxuyou:{info:{sex:"male",group:"qun",hp:3,skills:["PSchenglve","PSshicai","nzry_cunmu"],dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSchenglve:{mark:!0,locked:!1,zhuanhuanji:!0,marktext:"☯",intro:{content:function(a,n,r){var t=`出牌阶段限一次，你可以摸${n.storage.PSchenglve?"两":"一"}张牌，然后弃置${n.storage.PSchenglve?"一":"两"}张手牌。若如此做，直到本回合结束，你使用与弃置牌花色相同的牌无距离和次数限制，且当你使用/打出/弃置与弃置牌花色相同的牌后，你摸一张牌`;return n.storage.PSchenglve_effect&&(t+="<br><li>当前花色：",t+=e.translation(n.storage.PSchenglve_effect)),t}},enable:"phaseUse",usable:1,audio:"nzry_chenglve",content:function(){if(1==player.storage.PSchenglve?(player.draw(2),player.chooseToDiscard("h",!0)):(player.draw(),player.chooseToDiscard("h",2,!0)),player.changeZhuanhuanji("PSchenglve"),result.bool){player.storage.PSchenglve_effect=[];for(var a=0;a<result.cards.length;a++)player.storage.PSchenglve_effect.add(e.suit(result.cards[a],player));player.markSkill("PSchenglve"),player.addTempSkill("PSchenglve_effect")}},ai:{order:2.7,result:{player:function(e){return!e.storage.PSchenglve&&e.countCards("h")<3?0:1}}},subSkill:{effect:{mod:{cardUsable:function(a,n){for(var r=n.storage.PSchenglve_effect,t=0;t<r.length;t++)if(r[t]==e.suit(a))return 1/0},targetInRange:function(a,n){for(var r=n.storage.PSchenglve_effect,t=0;t<r.length;t++)if(r[t]==e.suit(a))return!0}},trigger:{player:["useCardAfter","respondAfter","discardAfter"]},forced:!0,filter:function(a,n){return n.storage.PSchenglve_effect.includes(e.suit(a.card))},content:function(){player.draw()},onremove:!0,sub:!0}}},PSshicai:{audio:"nzry_shicai_2",trigger:{player:["useCardAfter"],target:"useCardToTargeted"},filter:function(a,n,r){if("useCardToTargeted"==r&&("equip"!=e.type(a.card)||a.player!=n))return!1;if("useCardAfter"==r&&["equip","delay"].includes(e.type(a.card)))return!1;if(a.cards.filterInD().length<=0)return!1;for(var t=n.getHistory("useCard"),i="useCardAfter"==r?a:a.getParent(),o=0;o<t.length;o++){if(t[o]!=i&&e.name(t[o].card)==e.name(a.card))return!1;if(t[o]==i)return!0}return!1},check:function(a,n){if("equip"==e.type(a.card)){if("equip6"==e.subtype(a.card))return!0;if(e.equipResult(n,a.target,a.card.name)<=0)return!0;var r=n.getUseValue(a.card),t=e.subtype(a.card);return n.countCards("h",function(a){return e.subtype(a)==t&&n.getUseValue(a)>=r})>0}return!0},content:function(){if(event.cards=trigger.cards.filterInD(),event.cards.length>1){var a=player.chooseToMove("恃才：将牌按顺序置于牌堆顶");a.set("list",[["牌堆顶",event.cards]]),a.set("reverse",!(!r.currentPhase||!r.currentPhase.next)&&e.attitude(player,r.currentPhase.next)>0),a.set("processAI",function(a){var n=a[0][1].slice(0);return n.sort(function(a,n){return(r.event.reverse?1:-1)*(e.value(n)-e.value(a))}),[n]})}for(result.bool&&result.moved&&result.moved[0].length&&(cards=result.moved[0].slice(0));cards.length;){var i=cards.pop();"o"==e.position(i,!0)&&(i.fix(),t.cardPile.insertBefore(i,t.cardPile.firstChild),n.log(player,"将",i,"置于牌堆顶"))}n.updateRoundNumber(),player.draw()},ai:{reverseOrder:!0,skillTagFilter:function(a){if(a.getHistory("useCard",function(a){return"equip"==e.type(a.card)}).length>0)return!1},effect:{target:function(a,n,r){if(n==r&&"equip"==e.type(a)&&0==!n.getHistory("useCard",function(a){return"equip"==e.type(a.card)}).length)return[1,3]}},threaten:2.4}}},sort:u.PScharacter_qun,translate:{PSxuyou:"PS许攸",PSchenglve:"成略",PSchenglve_info:"转换技，出牌阶段限一次，阴：你可以摸一张牌，然后弃置两张手牌。阳：你可以摸两张牌，然后弃置一张手牌。若如此做，直到本回合结束，你使用与弃置牌花色相同的牌无距离和次数限制，且当你使用/打出/弃置与弃置牌花色相同的牌后，你摸一张牌。",PSshicai:"恃才",PSshicai_info:"当你使用牌时，若此牌与你本回合使用的牌名均不同，则你可以将此牌置于牌堆顶，然后摸一张牌。"},rank:c.rare},PSshen_sunquan:{info:{sex:"male",group:"shen",hp:4,skills:["PSyuheng","PSdili"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSyuheng:{getList:function(){var t;if(r.characterlist){t=[];for(var i=0;i<r.characterlist.length;i++){var o=r.characterlist[i];"wu"==a.character[o][1]&&a.skill.PSfushi.characterList().includes(o)&&t.push(o)}}else t=r.connectMode?e.charactersOL(function(e){return"wu"!=a.character[e][1]&&!a.skill.PSfushi.characterList().includes(e)}):e.gainableCharacters(function(e){return"wu"==e[1]&&a.skill.PSfushi.characterList().includes(i)});var l=n.players.concat(n.dead);for(i=0;i<l.length;i++)t.remove(l[i].name),t.remove(l[i].name1),t.remove(l[i].name2);var s=[];for(var i of t)s.addArray((a.character[i][3]||[]).filter(function(a){var n=e.info(a);return n&&!n.zhuSkill&&!n.hiddenSkill&&!n.charlotte}));return s},group:"PSyuheng_remove",audio:"yuheng",trigger:{player:"phaseBegin"},filter:function(e,n){return n.hasCard(function(e){return a.filter.cardDiscardable(e,n,"PSyuheng")},"he")},frequent:!0,keepSkill:!0,marktext:"驭衡",intro:{name:"驭衡",content:function(a,n){return`因〖驭衡〗获得的技能：${e.translation(n.additionalSkills.PSyuheng)}`},markcount:function(e,a){return a.additionalSkills.PSyuheng.length}},content:function(){let r=player.getCards("he").reduce(function(a,n){return a.add(e.suit(n,player)),a},[]).length;if(player.chooseToDiscard("he",!1,[1,r],function(a,n){if(!t.selected.cards.length)return!0;var r=e.suit(a,n);for(var i of t.selected.cards)if(e.suit(i,n)==r)return!1;return!0}).set("complexCard",!0).set("ai",function(n){var r=a.skill.PSyuheng.getList();return t.selected.cards.length>=r.length?0:player.hasValueTarget(n)?1/(e.value(n)||.5):5}).set("prompt","驭衡：弃置花色不同的牌获得等量吴势力角色的技能"),result.bool){var i=a.skill.PSyuheng.getList().slice(0);i=i.filter(function(e){return!player.hasSkill(e)}),player.draw(result.cards.length);var o=i.randomGets(Math.min(i.length,result.cards.length));player.additionalSkills.PSyuheng&&player.additionalSkills.PSyuheng.length&&o.addArray(player.additionalSkills.PSyuheng),player.addAdditionalSkill("PSyuheng",o),player.markSkill("PSyuheng"),n.log(player,"获得了以下技能：","#g"+e.translation(o))}},subSkill:{remove:{audio:"yuheng",trigger:{player:"phaseEnd"},filter:function(e,a){return a.additionalSkills.PSyuheng&&a.additionalSkills.PSyuheng.length},frequent:!0,content:function(){let a=player.additionalSkills.PSyuheng;if(event.num=a.length,player.chooseButton(["驭衡：选择失去任意数量个技能，摸等量的牌",[a,"vcard"]],[1,event.num],!1).set("ai",function(e){}),result.bool){let a=result.links.map(e=>e[e.length-1]);n.log(player,"失去了以下技能：","#g"+e.translation(a)),player.draw(a.length),player.removeSkills(a),player.additionalSkills.PSyuheng.length?player.markSkill("PSyuheng"):player.unmarkSkill("PSyuheng")}},sub:!0}}},PSdili:{derivation:["junkshengzhi","junkquandao","junkchigang"],juexingji:!0,audio:"dili",trigger:{global:"phaseBefore",player:["enterGame","loseMaxHpEnd","gainMaxHpEnd","addSkill","removeSkill"]},filter:function(e,a,r){return!("phase"==e.name&&n.phaseNumber>0)&&(a.additionalSkills.PSyuheng&&a.additionalSkills.PSyuheng.length>a.maxHp)},forced:!0,skillAnimation:!0,animationColor:"wood",content:function(){player.awakenSkill("PSdili"),player.removeSkills("PSyuheng"),player.addSkill(a.skill.PSdili.derivation)}}},sort:u.PScharacter_shen,translate:{PSshen_sunquan:"PS神孙权",PSyuheng:"驭衡",PSyuheng_info:"①回合开始时，你可以弃置任意张花色不同的牌，然后摸等量的牌并获得等量吴势力的技能。②回合结束时，你可以选择失去任意个因〖驭衡①〗获得的技能，然后摸等量的牌。",PSdili:"帝力",PSdili_info:"觉醒技，当你因〖驭衡①〗获得的技能数大于你的体力上限时，你失去技能〖驭衡〗，然后获得技能〖圣质〗、〖权道〗、〖持纲〗。"},rank:c.epic},PSshen_dianwei:{info:{sex:"male",group:"shen",hp:4,skills:["PSjuanjia","qiexie","cuijue"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",skills:{PSjuanjia:{audio:"juanjia",trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},content:function(){for(let e=1;e<6;e++)player.hasEnabledSlot(e)&&1!==e&&(player.disableEquip(e),player.expandEquip(1))},_priority:0}},sort:u.PScharacter_shen,translate:{PSshen_dianwei:"PS神典韦",PSjuanjia:"捐甲",PSjuanjia_info:"锁定技，游戏开始时，你废除一个宝物栏、防具栏、攻击马栏和防御马栏，然后获得等量的额外武器栏。"},rank:c.legend},PSlvmeng:{info:{sex:"male",group:"wu",hp:4,skills:["PSbolan"],dieAudios:["re_lvmeng"],trashBin:[]},intro:"由“群弱智（兼群小丑）”设计",skills:{PSbolan:{trigger:{player:["phaseDrawBegin1","phaseZhunbeiBegin"]},forced:!0,derivation:"PSgongxin",mod:{globalFrom:function(e,a,n){return n-e.storage.PSbolan},maxHandcard:function(e,a){return a+e.storage.PSbolan}},filter:function(e,a,n){return"phaseZhunbeiBegin"===n?a.storage.PSbolan>=5:a.hp>0&&!e.numFixed},init:function(e,a){e.storage[a]||(e.storage[a]=0)},marktext:"识",intro:{name:"博览",content:"mark"},content:function(){"phaseZhunbeiBegin"===event.triggername?(player.addSkills("PSgongxin"),n.playSkillAudio("botu")):(trigger.changeToZero(),player.draw(player.hp),player.storage.PSbolan+=Math.max(player.hp-2,0),player.markSkill("PSbolan"),n.playSkillAudio("qinxue"))}},PSgongxin:{mark:!0,locked:!1,zhuanhuanji:!0,marktext:"☯",intro:{content:function(e,a,n){return`出牌阶段限一次，你可以观看一名其他角色的手牌，然后获得其中任意张花色${1==a.storage.PSgongxin?"相同":"不同"}的牌。每以此法获得一张牌，你移去一个“识”。`}},enable:"phaseUse",usable:1,audio:"gongxin",prompt:()=>`观看一名其他角色的手牌，获得其任意张花色${r.event.player.storage.PSgongxin?"相同":"不同"}的牌`,filterTarget:function(e,a,n){return n!=a&&n.countCards("h")},content:function(){event.videoId=a.status.videoId++;var n=target.getCards("h");player.isOnline2()&&player.send(function(e,a){t.create.dialog("攻心",e).videoId=a},n,event.videoId),event.dialog=t.create.dialog("攻心",n),event.dialog.videoId=event.videoId,event.isMine()||(event.dialog.style.display="none"),player.chooseButton([1,1/0]).set("filterButton",function(a){if(!t.selected.buttons.length)return!0;var n=e.suit(a.link);for(var r of t.selected.buttons)if(1==player.storage.PSgongxin){if(e.suit(r.link)!=n)return!1}else if(e.suit(r.link)==n)return!1;return!0}).set("dialog",event.videoId),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),result.bool&&(player.gain(result.links,target,"giveAuto"),player.storage.PSbolan-=Math.min(result.links.length,player.storage.PSbolan),player.storage.PSbolan?player.markSkill("PSbolan"):player.unmarkSkill("PSbolan")),player.changeZhuanhuanji("PSgongxin")},ai:{order:12,expose:.4,result:{target:function(e,a){return-a.countCards("h")}}},group:"PSgongxin_remove",subSkill:{remove:{trigger:{player:"phaseJieshuBegin"},forced:!0,filter:(e,a)=>a.storage.PSbolan<5,content:()=>{player.removeSkills("PSgongxin")}}}}},sort:u.PScharacter_wu,translate:{PSlvmeng:"PS吕蒙",PSbolan:"博览",PSbolan_info:"锁定技,摸牌阶段,你改为摸与你体力值相等的牌，然后你记录本次以此法摸的牌为X，你获得X-2个“识”标记。每有一个“识”，你的手牌上限+1，计算与其他角色的距离-1。准备阶段,若你的“识”不小于5,你获得〖攻心〗。",PSgongxin:"攻心",PSgongxin_info:"转换技,出牌阶段限一次。阳:你可以观看一名其他角色的手牌，然后获得其中任意张花色相同的牌。阴:你可以观看一名其他角色的手牌,然后选择获得其中任意张花色不同的牌。每以此法获得一张牌，你移去一个“识”。结束阶段,若你的“识”小于5，你失去〖攻心〗。"},dynamicTranslate:{PSgongxin:function(e){return 1==e.storage.PSgongxin?'转换技,出牌阶段限一次。<span class="bluetext">阳:你可以观看一名其他角色的手牌，然后获得其中任意张花色相同的牌。</span>阴:你可以观看一名其他角色的手牌,然后选择获得其中任意张花色不同的牌。每以此法获得一张牌，你移去一个“识”。结束阶段,若你的“识”小于5，你失去〖攻心〗。':'转换技,出牌阶段限一次。阳:你可以观看一名其他角色的手牌，然后获得其中任意张花色相同的牌。<span class="bluetext">阴:你可以观看一名其他角色的手牌,然后选择获得其中任意张花色不同的牌。</span>每以此法获得一张牌，你移去一个“识”。结束阶段,若你的“识”小于5，你失去〖攻心〗。'}},rank:c.rare},PSzhonghui:{info:{sex:"male",group:"wei",hp:4,skills:["clanyuzhi","PSquanshu","clanbaozu","PSpaiyi"],clans:["颍川钟氏"],dieAudios:["clan_zhonghui"],trashBin:[]},intro:"由“九个鲨雕”设计",skills:{PSquanshu:{audio:"xinquanji",trigger:{player:"damageEnd",source:"damageSource"},filter:function(e,a){return!0},prompt2:function(a,n){return`摸${e.cnNumber(n.getDamagedHp(!0))}张牌，再将一张牌置于武将牌上`},content:function(){player.draw(player.getDamagedHp(!0));var e=player.getCards("h");if(e.length>0?1==e.length?event._result={bool:!0,cards:e}:player.chooseCard("h",!0,"选择一张牌作为“权”"):event.finish(),result.bool){var a=result.cards;player.addToExpansion(a,player,"give").gaintag.add("PSquanshu")}},intro:{content:"expansion",markcount:"expansion"},onremove:function(e,a){var n=e.getExpansions(a);n.length&&e.loseToDiscardpile(n)},locked:!1,mod:{maxHandcard:function(e,a){return a+e.getExpansions("PSquanshu").length}},ai:{maixie:!0,maixie_hp:!0,effect:{target:function(a,n,r){if(e.tag(a,"damage")){if(n.hasSkillTag("jueqing",!1,r))return[1,-2];if(!r.hasFriend())return;var t=1;if(e.attitude(n,r)>0&&(t=n.needsToDiscard()?.7:.5),r.hp>=4)return[1,2*t];if(3==r.hp)return[1,1.5*t];if(2==r.hp)return[1,.5*t]}}}}},PSpaiyi:{audio:"xinpaiyi",enable:"phaseUse",usable:1,filter:function(e,a){return a.getExpansions("PSquanshu").length>0},chooseButton:{dialog:function(e,a){return t.create.dialog("排异",a.getExpansions("PSquanshu"),"hidden")},backup:function(e,n){return{audio:"xinpaiyi",filterTarget:!0,filterCard:function(){return!1},selectCard:-1,card:e[0],delay:!1,content:a.skill.PSpaiyi.contentx,ai:{order:10,result:{target:function(e,a){return a!=e||e.getExpansions("PSquanshu").length<=1||e.needsToDiscard()&&!e.getEquip("zhuge")&&!e.hasSkill("new_paoxiao")?0:1}}}}},prompt:function(a,n){var r=n.getExpansions("PSquanshu").length-1,t=Math.max(1,r);return`令一名角色摸${e.cnNumber(t)}张牌，然后该角色可以对其他角色造成伤害`}},contentx:function(){var n=a.skill.PSpaiyi_backup.card;player.loseToDiscardpile(n);var t=player.getExpansions("PSquanshu").length,i=Math.max(1,t);if(target.draw(i),target.chooseTarget(!1,[1,i],"对至多"+e.cnNumber(i)+"名角色各造成1点伤害").set("ai",function(a){var n=r.event.player;return e.damageEffect(a,n,n)}),result.bool){var o=result.targets.sortBySeat();for(var l of(target.line(o,"green"),o))l.damage("nocard",target)}},ai:{order:function(e,a){return 1==a.getExpansions("PSquanshu").length?8:1},result:{player:1}},_priority:0}},sort:u.PScharacter_wei,translate:{PSzhonghui:"PS钟会",PSquanshu:"权术",PSquanshu_info:"当你造成或受到伤害后，你可以摸Y张牌，然后将一张手牌置于你的武将牌上，称为“权”，你的手牌上限+Z（Y为你已损失的体力值，Z为“权”的数量）。",PSpaiyi:"排异",PSpaiyi_info:"出牌阶段限一次，你可以移去一张“权”并令一名角色摸Z张牌，然后其对至多Z名角色各造成1点伤害（Z为“权”的数量且至少为1）",PSpaiyi_backup:"权术"},rank:c.epic},PSlibai:{info:{sex:"male",group:"qun",hp:3,skills:["PSjiuxian","PSshixian"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSjiuxian:{audio:"dclbjiuxian",trigger:{player:["useCardAfter","gainAfter"]},forced:!0,filter:function(n,r,t){if(1==a.config.extension_PS武将_PS_pingzeTip){let a=r.getCards("h",e=>!e.hasGaintag("PSshixian_ping")&&!e.hasGaintag("PSshixian_ze")),n=r.getCards("h",n=>a.includes(n)&&"平"==o(e.translation(n.name))),t=a.removeArray(n);r.addGaintag(n,"PSshixian_ping"),r.addGaintag(t,"PSshixian_ze")}else r.removeGaintag("PSshixian_ping"),r.removeGaintag("PSshixian_ze");return"gainAfter"!=t&&("jiu"===n.card.name&&r.hasSkill("PSshixian"))},prompt2:function(e,a){return"令你使用的下一张牌无视条件触发技能〖诗仙〗？"},content:function(){player.addTempSkill("PSjiuxian_ignore","useCardEnd")},group:"dclbjiuxian",subSkill:{ignore:{charlotte:!0,forced:!0,popup:!1}}},PSshixian:{audio:"dcshixian",trigger:{player:"useCard"},intro:{content:function(a,n,r){let t=n.getAllHistory("useCard").at(-1);return`当前记录：${o(e.translation(t.card.name))}`}},locked:!1,filter:function(a,n){if(n.markSkill("PSshixian"),n.marks.PSshixian.firstChild.innerHTML=o(e.translation(a.card.name)),n.markSkill("PSshixian"),n.hasSkill("PSjiuxian_ignore"))return!0;var r=n.getAllHistory("useCard"),t=r.indexOf(a);if(t<1)return!1;var i=r[t-1];return o(e.translation(a.card.name))!==o(e.translation(i.card.name))},filterx:function(a){if(0==a.targets.length)return!1;var n=e.type(a.card);return"basic"==n||"trick"==n},prompt2:function(n,r){return a.skill.PSshixian.filterx(n)?"摸一张牌并令"+e.translation(n.card)+"额外结算一次？":"摸一张牌。"},check:function(n,r){return!a.skill.PSshixian.filterx(n)||!e.tag(n.card,"norepeat")},content:function(){player.draw(),a.skill.PSshixian.filterx(trigger)&&(trigger.effectCount++,n.log(trigger.card,"额外结算一次"))},mod:{aiOrder:function(a,n,r){if("object"==typeof n&&!e.tag(n,"norepeat")){var t=a.getAllHistory("useCard");if(t.length>0){var i=t[t.length-1].card;if(o(e.translation(n.name))!==o(e.translation(i.name)))return r+20}}}},_priority:0}},sort:u.PScharacter_qun,translate:{PSlibai:"PS李白",PSjiuxian:"酒仙",PSjiuxian_info:"①你可以将额定目标数大于1的锦囊牌当做【酒】使用。②你使用【酒】无次数限制。③当你使用【酒】后，你使用的下一张牌无视条件触发技能〖诗仙〗。",PSshixian:"诗仙",PSshixian_info:"当你使用一张牌时，若此牌牌名的最后一个字的平仄声与你于本局游戏使用的上一张牌的不同，则你可以摸一张牌，并令此牌额外结算一次。(以平水韵为标准)",PSshixian_ping:"平",PSshixian_ze:"仄"},rank:c.epic},PSxie_sunquan:{info:{sex:"male",group:"wu",hp:4,skills:["PSzongheng","PSxiqu","PSchengchen"],dieAudios:["re_sunquan"],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSzongheng:{audio:"rezhiheng",audioname:["shen_caopi"],enable:"phaseUse",position:"h",filter:function(n,r){const t=r.getHistory("useSkill",e=>"PSzongheng"==e.skill);if(!t.length)return!0;let i=[],o=a.suit.length;return t.forEach(a=>{a.event.cards.forEach(a=>{i.add(e.suit(a))}),o-=i.length,i=[]}),o>0},complexCard:!0,filterCard:function(a,i,o){if(t.selected.cards.length>1){var l=e.suit(a);if(e.suit(t.selected.cards[0])!=e.suit(t.selected.cards[1])){for(var s of t.selected.cards)if(e.suit(s)==l)return!1}else for(var s of t.selected.cards)if(e.suit(s)!=l)return!1}"string"!=typeof(o=o||r.event)&&(o=o.getParent().name);var u=n.checkMod(a,i,o,"unchanged","cardDiscardable",i);return"unchanged"==u||u},discard:!1,lose:!1,delay:!1,selectCard:[1,1/0],check:function(a){var n=r.event.player;return"h"!=e.position(a)||n.countCards("h","du")||!(n.hp>2)&&n.countCards("h",function(a){return e.value(a)>=8})?6-e.value(a):1},content:function(){player.discard(cards);let e=cards.length>3?1:0;player.draw(e+cards.length)},subSkill:{draw:{trigger:{player:"loseEnd"},silent:!0,filter:function(e,a){if("PSzongheng"!=e.getParent(2).skill&&"jilue_zhiheng"!=e.getParent(2).skill)return!1;if(a.countCards("h"))return!1;for(var n=0;n<e.cards.length;n++)if("h"==e.cards[n].original)return!0;return!1},content:function(){player.addTempSkill("PSzongheng_delay",trigger.getParent(2).skill+"After")},sub:!0,forced:!0,popup:!1,_priority:1},delay:{sub:!0,_priority:0}},ai:{order:1,result:{player:1},threaten:1.55},_priority:0},PSxiqu:{audio:"sbtongye",enable:"phaseUse",limited:!0,charlotte:!0,skillAnimation:!0,animationColor:"gray",filter:function(e,a){return n.hasPlayer(e=>e!=a&&(e.countCards("e")>0||e.countGainableCards(a,"h")>0))},filterTarget:()=>a.filter.notMe,content:function(){player.awakenSkill("PSxiqu");let e=target.getCards("e");target.discard(e),target.countGainableCards(player,"h")>0&&player.gainPlayerCard(target,[1,2],"h",!0)},ai:{order:100,result:{player:100}},mark:!0,intro:{content:"limited"},init:(e,a)=>e.storage[a]=!1,_priority:0},PSchengchen:{audio:"sbzhiheng",skillAnimation:!0,animationColor:"wood",juexingji:!0,unique:!0,derivation:["rezhiheng"],trigger:{source:"dieAfter"},filter:function(e,a){return n.hasPlayer(e=>e!=a&&"wei"==e.group)&&a.countCards("h")>0},forced:!0,content:function(){if(player.removeSkills("PSzongheng"),player.addSkill("rezhiheng"),n.log(player,"失去了技能","#g【纵横】"),n.log(player,"获得了技能","#g【制衡】"),player.awakenSkill(event.name),player.storage[event.name]=!0,player.chooseTarget("将所有手牌交给一名魏势力角色",!0).set("filterTarget",function(e,a,n){return n!=a&&"wei"==n.group}).set("ai",a=>e.attitude(r.event.player,a)),result.bool){let e=player.getCards("h");player.give(e,result.targets[0]),player.changeGroup("wei")}},ai:{order:1,result:{target:function(a,r){if(r.hasSkillTag("nogain"))return 0;if(a.countCards("h")==a.countCards("h","du"))return-1;if(r.hasJudge("lebu"))return 0;if(e.attitude(a,r)>3){var t=e.threaten(r);return a==e.zhu(a)&&a.hp<=2&&a.countCards("h","shan")&&!n.hasPlayer(function(n){return e.attitude(n,a)>3&&n.countCards("h","tao")>0})?0:r.countCards("h")+a.countCards("h")>r.hp+2?.8*t:t}return 0}}},_priority:0}},sort:u.PScharacter_wu,translate:{PSxie_sunquan:"PS屑孙权",PSzongheng:"纵横",PSzongheng_info:"出牌阶段限X次，你可以弃置任意张花色相同或不同的手牌，并摸等量的牌。若弃置的牌大于三张，你多摸一张牌（X为你本回合未以此法弃置的花色数）。",PSxiqu:"袭取",PSxiqu_info:"限定技，出牌阶段，你可以选择一名其他角色，你令其弃置装备区所有牌，且可以获得其至多两张手牌。",PSchengchen:"称臣",PSchengchen_info:"觉醒技，当你杀死一名角色后，你将所有手牌交给一名其他“魏”势力角色，将势力改为“魏”，然后失去技能〖纵横〗，获得技能〖制衡〗。"},rank:c.rare},PSshu_sunshangxiang:{info:{sex:"female",group:"shu",hp:3,skills:["PSliangzhu","PSfanxiang"],dieAudios:["sp_sunshangxiang"],trashBin:[]},intro:"由“九个鲨雕”设计",skills:{PSliangzhu:{audio:"liangzhu",trigger:{global:"recoverAfter"},frequent:!0,filter:function(e,a){return!0},content:function(){player.draw(),player.chooseToDiscard(`是否弃置一张牌令${e.translation(trigger.player)}摸两张牌`,"he",!1,1).set("ai",()=>e.attitude(player,trigger.player)<=0?0:e.disvalue).set("player",r.event.player),result.bool&&(trigger.player.draw(2),player.storage.PSliangzhu||(player.storage.PSliangzhu=[]),player.storage.PSliangzhu.add(trigger.player))},ai:{expose:.1},_priority:0},PSfanxiang:{skillAnimation:!0,animationColor:"fire",audio:"fanxiang",unique:!0,juexingji:!0,forceunique:!0,derivation:"PSxiaoji",trigger:{player:"phaseZhunbeiBegin"},init:function(e){n.changeSkillAudio("PSxiaoji",e.name,"xiaoji_sp_sunshangxiang")},filter:function(e,a){return!a.storage.PSfanxiang&&n.hasPlayer(function(e){return a.storage.PSliangzhu&&a.storage.PSliangzhu.includes(e)&&e.isDamaged()})},forced:!0,content:function(){player.storage.PSfanxiang=!0,player.awakenSkill("PSfanxiang");switch(player.chooseControl().set("prompt","返乡：请选择一项").set("choiceList",["增加一点体力上限并回复一点体力","获得技能〖枭姬〗","背水：失去技能〖良助〗，然后依次执行上述所有选项"]).set("ai",()=>{let e=r.event.player;return e.countCards("h",e=>["jiu","tao"].includes(e))||1!=e.hp?"选项二":"选项三"}),result.index){case 0:player.gainMaxHp(),player.recover();break;case 1:player.addSkills("PSxiaoji");break;case 2:player.removeSkills("PSliangzhu"),player.gainMaxHp(),player.recover(),player.addSkills("PSxiaoji")}},_priority:0}},sort:u.PScharacter_shu,translate:{PSshu_sunshangxiang:"PS孙尚香",PSliangzhu:"良助",PSliangzhu_info:"当一名角色回复体力后，你可以摸一张牌，然后你可以弃置一张牌令其摸两张牌。",PSfanxiang:"返乡",PSfanxiang_info:"觉醒技，准备阶段开始时，若场上有已受伤且你发动过〖良助〗令其摸牌的角色，则你选择一项：1.增加一点体力上限并回复一点体力；2.获得技能〖枭姬〗；3.背水：失去技能〖良助〗，然后依次执行上述所有选项。"},rank:c.rare},PSmenghuo:{info:{sex:"male",group:"shu",hp:4,skills:["PShuoshou","PSxingluan"],dieAudios:["re_menghuo"],trashBin:[]},intro:"由“群弱智（兼群小丑）”设计",skills:{PShuoshou:{audio:"ext:PS武将/audio/skill:2",inherit:"huoshou",trigger:{source:"damageSource"},filter:function(e,a){return e.card&&"nanman"===e.card.name&&e.player.isAlive()&&e.player.isIn()&&e.player.countCards("he")},content:function(){player.gainPlayerCard(trigger.player,1,"he",!0)}},PSxingluan:{audio:"sppanqin",trigger:{global:"useCardAfter"},locked:!0,getNum:function(e,a){let n=0;a.getHistory("sourceDamage",function(a){a.card===e.card&&(n+=a.num)});return Math.max(e.targets.length-n,0)},filter:function(e,n){return"nanman"===e.card.name&&(0!==e.cards.filterInD("od").length&&n.countCards("he")>=a.skill.PSxingluan.getNum(e,n))},prompt2:function(n,r){const t=a.skill.PSxingluan.getNum(n,r);let i=t>0?`弃置${e.cnNumber(t)}张牌，`:"";return i+=`获得 ${e.translation(n.cards)} `,i},content:function(){const e=a.skill.PSxingluan.getNum(trigger,player);e>0&&player.chooseToDiscard("he",e,!0);const n=trigger.cards.filterInD("od");player.gain(n,"gain2")}}},sort:u.PScharacter_shu,translate:{PSmenghuo:"PS孟获",PShuoshou:"祸首",PShuoshou_info:"锁定技。①【南蛮入侵】对你无效。②当其他角色使用【南蛮入侵】指定第一个目标后，你代替其成为此牌的伤害来源。③当你的【南蛮入侵】对一名角色造成伤害后，你可以获得对方一张牌。",PSxingluan:"兴乱",PSxingluan_info:"锁定技，当一张【南蛮入侵】结算完毕后，你可以弃置X张牌，获得这张【南蛮入侵】（X为此【南蛮入侵】的指定目标数-造成伤害数）。","#ext:PS武将/audio/skill/PShuoshou1":"南中王孟获在此！","#ext:PS武将/audio/skill/PShuoshou2":"哈哈！知道南中子弟的厉害了吧！"},rank:c.rare},PSzhugeliang:{info:{sex:"male",group:"shu",hp:3,skills:["PSjiqiao","PShuoji","PSpingnan"],dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSjiqiao:{audio:"ext:PS武将/audio/skill:2",trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},content:function(){["muniu","bagua","zhuge"].forEach(r=>{const t=n.createCard(r,a.suit.randomGet(),e.rand(1,13));player.canUse(t,player)&&player.equip(t)})},group:"PSjiqiao_use",subSkill:{use:{audio:"PSjiqiao",trigger:{global:["logSkill","useSkillBegin"]},forced:!0,filter:function(a,n){return a.skill&&e.info(a.skill).equipSkill&&["muniu_skill","bagua_skill","zhuge_skill"].includes(a.skill)},content:()=>{player.draw()}}}},PShuoji:{audio:"ext:PS武将/audio/skill:2",enable:"phaseUse",usable:3,content:function(){var r=e.cardPile2(function(n){return e.translation(n).includes("火")||a.translate[n.name+"_info"].includes("火")});r?player.gain(r,"gain2"):(n.log(player,"从牌堆中没有检索到带","#y火","字的牌"),player.chat('没有检索到带"火"字的牌'))},ai:{order:10}},PSpingnan:{audio:"ext:PS武将/audio/skill:2",enable:"phaseUse",usable:1,filterTarget:!0,selectTarget:[1,3],multitarget:!0,content:function(){targets.sort(a.sort.seat),targets.forEach(e=>e.damage());const n=targets.filter(e=>e.isAlive()&&e.isIn()&&e!==player&&e.countGainableCards(player,"he")>0);n.length&&player.chooseTarget("平南：是否获得其中一名角色的一张牌？").set("filterTarget",function(e,a,r){return n.includes(r)}).set("ai",function(a){var n=e.attitude(r.event.player,a);return a.hasSkill("tuntian")?n/10:1-n}),result.bool&&result.targets&&player.gainPlayerCard(result.targets[0],1,"he",!0)},ai:{damage:!0,order:8,result:{player:function(a,n){return e.damageEffect(a,a,a)},target:function(a,n){return e.damageEffect(n,a,n)}},threaten:1.5}}},sort:u.PScharacter_shu,translate:{PSzhugeliang:"PS诸葛亮",PSjiqiao:"机巧",PSjiqiao_info:"锁定技，游戏开始时，你将【木牛流马】、【八卦阵】、【诸葛连弩】置入你的对应装备栏。当一名角色触发上述装备效果时，你摸一张牌。",PShuoji:"火计",PShuoji_info:"出牌阶段限三次，你可以从牌堆中检索并获得牌名或描述里带有“火”字的牌。",PSpingnan:"平南",PSpingnan_info:"出牌阶段限一次，你可以对至多三名角色造成1点伤害，然后获得其中一名角色区域内的一张牌。","#ext:PS武将/audio/skill/PShuoji1":"业火炽燃，酬其宿债。","#ext:PS武将/audio/skill/PShuoji2":"水中有火，乃焚敌军。","#ext:PS武将/audio/skill/PSjiqiao1":"天地以下，八重以列。","#ext:PS武将/audio/skill/PSjiqiao2":"随时而行，以正合，以奇胜。","#ext:PS武将/audio/skill/PSpingnan1":"尔等宵小，岂能诈我。","#ext:PS武将/audio/skill/PSpingnan2":"亮，早有成册在胸，主公大可放心。"},rank:c.rare},PSpanzhangmazhong:{info:{sex:"male",group:"wu",hp:4,skills:["PSduodao","PSanjian"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",skills:{PSduodao:{audio:"reduodao",trigger:{player:"damageEnd",target:"useCardToTargeted"},filter:function(e,a,n){return"useCardToTargeted"===n?e.player!==a&&"sha"==e.card.name:e.source&&e.source!==a},direct:!0,check:function(e,a){return 1},content:function(){player.draw();var e="useCardToTargeted"===event.triggername?trigger.player:trigger.source;e&&e.countGainableCards(player,"he")>0&&player.gainPlayerCard(e,1,"he",!1),(!result.bool||result.bool&&"h"!==result.cards[0].original)&&player.draw()},ai:{maixie_defend:!0},_priority:0},PSanjian:{mod:{targetEnabled:function(e,a,n,r){if(0===a.getEquips(1).length&&"sha"==e.name)return!1}},audio:"reanjian",trigger:{player:"useCardToPlayered"},forced:!0,filter:function(e,a){return"sha"==e.card.name&&!e.target.getEquips(1).length},logTarget:"target",content:function(){trigger.directHit.add(trigger.target);var e=trigger.customArgs,a=trigger.target.playerid;e[a]||(e[a]={}),e[a].extraDamage||(e[a].extraDamage=0),e[a].extraDamage++}}},sort:u.PScharacter_wu,translate:{PSpanzhangmazhong:"PS潘璋马忠",PSduodao:"夺刀",PSduodao_info:"当你受到其他角色的伤害后或成为其他角色杀的目标时，你可以摸一张牌并获得伤害来源／该角色的一张牌。若未从其手牌区获得牌则你额外摸一张牌。",PSanjian:"暗箭",PSanjian_info:"锁定技，武器栏没有牌的角色不能对你使用【杀】，不可响应你使用的【杀】，且受到你的【杀】伤害+1。"},rank:c.rare},PSlingcao:{info:{sex:"male",group:"wu",hp:4,skills:["PSdujin","PSgudan"],dieAudios:[],trashBin:[]},intro:"由“九个鲨雕”设计",skills:{PSdujin:{audio:"dujin",trigger:{player:"phaseDrawBegin2"},forced:!0,filter:function(e,a){return!e.numFixed},content:function(){trigger.num+=Math.max(1,player.countCards("e"))},mod:{maxHandcard:function(e,a){return a+Math.max(1,e.countCards("e"))}}},PSgudan:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"damageBegin4",target:"useCardToTargeted"},forced:!0,filter:function(a,n,r){if("useCardToTargeted"===r)return"trick"===e.type2(a.card)&&"black"===e.color(a.card)&&1===a.targets.length&&a.targets[0]===n;if(!a.source||a.source===n)return!1;let t=a.cards?a.cards[0]:a.card;return"card"!=e.itemtype(t)||"h"!==t.original},content:function(){"damageBegin4"===event.triggername?(trigger.num++,event.finish()):player.chooseToDiscard("he",1).ai=function(a){return 6-e.value(a)},result.bool||player.loseHp()}}},sort:u.PScharacter_wu,translate:{PSlingcao:"PS凌操",PSdujin:"独进",PSdujin_info:"锁定技，摸牌阶段你额外摸X张牌，你的手牌上限+X（X为你装备区里的装备牌数量且至少为1）。",PSgudan:"孤胆",PSgudan_info:"锁定技，当你受到其他角色造成的伤害时，若此伤害不为手牌造成的伤害，此伤害+1；当你成为黑色锦囊牌的唯一目标时，你须弃置一张牌或者失去一点体力。","#ext:PS武将/audio/skill/PSgudan1":"愿效忠勇，敢为先锋。","#ext:PS武将/audio/skill/PSgudan2":"进军江夏，独破贼兵！"},rank:c.rare},PSliubei:{info:{sex:"male",group:"shu",hp:4,skills:["PSrende","rejijiang"],isZhugong:!0,dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",replace:["PSliubei","PSmeng_liubei"],skills:{PSrende:{audio:"ext:PS武将/audio/skill:2",enable:"phaseUse",filter:function(e,a){return n.hasPlayer(function(e){return e.countCards("h")&&!e.hasSkill("PSrende_used")})},filterTarget:function(e,a,n){return!!t.selected.targets.length||!n.hasSkill("PSrende_used")&&n.countCards("h")},targetprompt:["交出牌","获得牌"],selectTarget:2,multitarget:!0,content:function(){if(targets[0].addTempSkill("PSrende_used","phaseUseEnd"),targets[0].chooseCard("h",!0,[1,targets[0].countCards("h")],"选择交给"+e.translation(targets[1])+"至少一张牌").set("ai",a=>r.event.attitude?0:7-e.value(a)).set("attitude",e.attitude(targets[0],targets[1])<0),result.bool&&result.cards&&result.cards.length&&(targets[0].give(result.cards,targets[1]),result.cards.length>=2)){let e=n.createEvent("chooseToUse");e.player=targets[0],e.setContent(a.skill.PSrende.chooseToUse)}},chooseToUse:function(){var t=[];for(var i of(a.filter.cardUsable({name:"sha"},player,event.getParent("chooseToUse"))&&n.hasPlayer(function(e){return player.canUse("sha",e)})&&t.push(["基本","","sha"]),a.inpile_nature))a.filter.cardUsable({name:"sha",nature:i},player,event.getParent("chooseToUse"))&&n.hasPlayer(function(e){return player.canUse({name:"sha",nature:i},e)})&&t.push(["基本","","sha",i]);if(a.filter.cardUsable({name:"tao"},player,event.getParent("chooseToUse"))&&n.hasPlayer(function(e){return player.canUse("tao",e)})&&t.push(["基本","","tao"]),a.filter.cardUsable({name:"jiu"},player,event.getParent("chooseToUse"))&&n.hasPlayer(function(e){return player.canUse("jiu",e)})&&t.push(["基本","","jiu"]),t.length?player.chooseButton(["是否视为使用一张基本牌？",[t,"vcard"]]).set("ai",function(a){var t=r.event.player,i={name:a.link[2],nature:a.link[3],isCard:!0};return"tao"==i.name?1==t.hp||2==t.hp&&!t.hasShan()||t.needsToDiscard()?5:1:"sha"==i.name?n.hasPlayer(function(a){return t.canUse(i,a)&&e.effect(a,i,t,t)>0})?"fire"==i.nature?2.95:"thunder"==i.nature||"ice"==i.nature?2.92:2.9:0:"jiu"==i.name?.5:0}):event.finish(),result&&result.bool&&result.links[0]){var o={name:result.links[0][2],nature:result.links[0][3]};player.chooseUseTarget(o,!0)}},ai:{order:8,result:{target:function(e,a){return 0==t.selected.targets.length?-1:1.2},player:1.1},expose:.4,threaten:3},subSkill:{used:{charlotte:!0,silent:!0,nopup:!0}},_priority:0}},sort:u.PScharacter_shu,translate:{PSliubei:"PS刘备",PSrende:"仁德",PSrende_info:"出牌阶段，你可以令一名角色将至少一张手牌交给由你指定的其他角色，然后本阶段你不能再对该角色发动〖仁德〗；若其交出的牌不少于两张，其可以视为使用一张基本牌。","#ext:PS武将/audio/skill/PSrende1":"仁义感民，德彰天下。","#ext:PS武将/audio/skill/PSrende2":"曹魏倚天时，孙吴居地利，唯吾占人和。"},rank:c.rare},PScaoren:{info:{sex:"male",group:"wei",hp:2,maxHp:5,skills:["PSjushou","PSbianzhen"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",skills:{PSjushou:{audio:"xinjushou",trigger:{global:"phaseBegin"},filter:function(n,r,t){if(r.isTurnedOver())return!1;for(var i of a.inpile){if("trick"===e.type(i)&&a.filter.cardUsable({name:i},r,n.getParent("chooseToUse"))&&r.hasUseTarget({name:i}))return!0}return!0},content(){var n=[];for(var t of a.inpile)"trick"===e.type(t)&&a.filter.cardUsable({name:t},player,event.getParent("chooseToUse"))&&player.hasUseTarget({name:t})&&n.push(["锦囊","",t]);if(n.length?player.chooseButton(["据守：视为使用一张锦囊牌",[n,"vcard"]]).set("ai",function(e){var a=r.event.player,n={name:e.link[2],nature:e.link[3]};return"phase"!=event.type?1:["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(n.name)?0:a.getUseValue({name:n.name})}):event.finish(),result&&result.bool&&result.links[0]){player.turnOver();var i={name:result.links[0][2],nature:result.links[0][3]};player.chooseUseTarget(i,!0)}},group:["PSjushou_turnOver","PSjushou_chooseUse"],subSkill:{chooseUse:{audio:"xinjushou",enable:"chooseToUse",filter:function(n,r){if(r.isTurnedOver())return!1;for(var t of a.inpile){if("trick"===e.type(t)&&n.filterCard({name:t},r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];"trick"==e.type(l)&&n.filterCard({name:l},r,n)&&i.push(["锦囊","",l])}return t.create.dialog("据守",[i,"vcard"])},filter:function(e,a){return r.event.getParent().filterCard({name:e.link[2]},a,r.event.getParent())},check:function(e){if("phase"!=r.event.getParent().type)return 1;var a=r.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:a.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{audio:"xinjushou",popname:!0,filterCard:!1,selectCard:0,check:function(a){return 8-e.value(a)},viewAs:{name:a[0][2],nature:a[0][3]},precontent:function(){n.turnOver()}}},prompt:function(a,n){return"请选择"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"的目标"}},hiddenCard:function(n,r){return!!a.inpile.includes(r)&&(!n.isTurnedOver()&&"trick"==e.type(r))},ai:{fireAttack:!0,skillTagFilter:function(e){if(!e.countCards("he"))return!1},order:1,result:{player:function(e){return 1}}}},turnOver:{audio:"xinjushou",trigger:{player:"turnOverEnd"},direct:!0,filter:(e,n)=>n.hasCard(function(e){return a.filter.cardDiscardable(e,n,"PSjushou_turnOver")},"he"),content(){if(player.chooseToDiscard("he",1,e.prompt("PSjushou_turnOver"),"当你翻面时，你可以弃置一张牌，然后选择回血或者移动场上的牌").set("ai",function(a){return r.event.goon?6-e.value(a):0}),result.bool){let e=player.isDamaged()?["回复一点体力"]:[];if(player.canMoveCard()&&e.push("移动场上一张牌"),!e.length)return void event.finish();2===e.length?player.chooseControl(e,!0).set("ai",function(){return!player.countCards("h",e=>["jiu","tao"].includes(e))&&player.hp<=2?"回复一点体力":player.canMoveCard(!0)?"移动场上一张牌":"回复一点体力"}):event._result={bool:!0,control:e[0],index:0}}result.control&&"cancel2"!==result.control&&("回复一点体力"===result.control?player.recover():player.moveCard(!0))}}},ai:{maixie:!0,maixie_hp:!0,result:{effect:function(a,n,r){if(e.tag(a,"damage")){if(n.hasSkillTag("jueqing",!1,r))return[1,-2];if(!r.hasFriend())return;var t=1;if(e.attitude(n,r)>0&&(t=n.needsToDiscard()?.7:.5),r.maxHp-r.countCards("h")>=3)return[1,2*t];if(r.maxHp-r.countCards("h")===2)return[1,1.5*t];if(r.maxHp-r.countCards("h")<2)return[1,.5*t]}}},threaten:.6}},PSbianzhen:{audio:"kuiwei",trigger:{player:"damageEnd"},forced:!0,content:function(){let e=player.countCards("h"),a=player.maxHp;e<=a&&player.draw(a),e>=a&&player.draw(),player.isTurnedOver()&&player.turnOver()}}},sort:u.PScharacter_wei,translate:{PScaoren:"PS曹仁",PSjushou:"据守",PSjushou_info:"一名角色回合开始时或当你需要使用非延时锦囊牌时，若你的武将牌正面朝上，你可以翻面并视为你使用一张你需要的非延时锦囊牌。当你翻面后，你可以弃置一张牌然后选择：1．回复一点体力：2．移动场上一张牌。",PSbianzhen:"变阵",PSbianzhen_info:"锁定技，当你受到伤害后，若你的手牌数：不大于X，你摸X张牌；不小于X，你摸1张牌（X为你的体力上限）。然后若你的武将牌背面朝上，你翻面。"},rank:c.rare},PSzhangfei:{info:{sex:"male",group:"shu",hp:4,skills:["PSrepaoxiao","PSliyong"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSrepaoxiao:{audio:"paoxiao_re_zhangfei",firstDo:!0,trigger:{player:["useCard1","useCard","respond"]},forced:!0,shaRelated:!0,filter:(a,n,r)=>"useCard1"===r?!a.audioed&&"sha"==a.card.name&&n.countUsed("sha",!0)>1&&"phase"==a.getParent().type:!(!a.cards.length||"sha"!==a.card.name||a.cards.length&&!["o","d"].includes(e.position(a.cards[0])))&&("respond"===r?1===n.getHistory("respond",e=>"sha"===e.card.name).length:1===n.getHistory("useCard",e=>"sha"===e.card.name).length),async content(e,a,n){a.audioed=!0,("useCard"===e.triggername&&1===n.getHistory("useCard",e=>"sha"===e.card.name).length||1===n.getHistory("respond",e=>"sha"===e.card.name).length)&&n.gain(a.cards,"gain2")},mod:{cardUsable:function(e,a,n){if("sha"==e.name)return 1/0},targetInRange:function(e,a,n){if("sha"==e.name&&a.getEquips(1).length>0)return!0}},ai:{unequip:!0,skillTagFilter:function(a,n,r){return!!e.zhu(a,"shouyue")&&!(!r||"sha"!=r.name)}},_priority:0},PSliyong:{audio:"liyong",trigger:{player:["shaMiss","useCardToPlayered"],source:"damageSource"},forced:!0,direct:!0,shaRelated:!0,filter:function(a,n,r){switch(r){case shaMiss:return!0;case useCardToPlayered:return a.card&&"sha"===e.name(a.card);case damageSource:return a.card&&"sha"==a.card.name&&a.player!=n&&a.player.isIn()&&a.player.isAlive()}},init:function(e,a){e.storage[a]||(e.storage[a]=[])},intro:{content:function(e,a){return e.join("")},markcount:function(e,a){return e.length}},content:function(){switch(event.triggername){case shaMiss:player.getHistory("custom").push({PSliyong_effect:!0});break;case useCardToPlayered:if(player.logSkill(event.name),player.markSkill(event.name),player.getHistory("useCard",e=>"sha"===e.card.name).length>1){player.storage[event.name].add("加伤！");var e=trigger.target.playerid,a=trigger.getParent().customArgs;a[e]||(a[e]={}),"number"!=typeof a[e].extraDamage&&(a[e].extraDamage=0),a[e].extraDamage++}player.hasHistory("custom",e=>e.PSliyong_effect)&&trigger.isFirstTarget&&(player.storage[event.name].add("强命！"),trigger.getParent().directHit.addArray(n.players));break;case damageSource:player.storage[event.name].add("铁骑！"),trigger.player.addTempSkill("fengyin")}},group:"PSliyong_draw",subSkill:{draw:{audio:"liyong",trigger:{global:"phaseEnd"},filter:function(e,a,n){return a.storage.PSliyong&&a.storage.PSliyong.length>0},forced:!0,content:function(){const e=player.storage.PSliyong.length;player.storage.PSliyong=[],player.unmarkSkill("PSliyong"),player.draw(e)}}},ai:{ignoreSkill:!0,directHit_ai:!0,skillTagFilter:function(n,r,t){return"directHit_ai"==r?e.attitude(n,t.target)<=0:!(!t||t.isLink||!t.card||"sha"!=t.card.name)&&(!(!t.target||e.attitude(n,t.target)>=0)&&(!(!t.skill||!a.skill[t.skill]||a.skill[t.skill].charlotte||e.is.locked(t.skill)||!t.target.getSkills(!0,!1).includes(t.skill))&&void 0))}}}},sort:u.PScharacter_shu,translate:{PSzhangfei:"PS张飞",PSrepaoxiao:"咆哮",PSrepaoxiao_info:"锁定技。①你使用【杀】无次数限制。②若你的装备区内有武器牌，则你使用【杀】无距离限制。③当你于一回合内首次使用或打出【杀】时，你收回此【杀】对应的实体牌。",PSliyong:"厉勇",PSliyong_info:"锁定技。<br>①当你使用【杀】指定目标后，若你本回合使用过的【杀】：被响应过，此【杀】不可被响应；数量不为1，此【杀】对其造成伤害+1。<br>②当你使用【杀】对一名其他角色造成伤害后，其本回合非锁定技失效。<br>③一名角色回合结束时，若你本回合使用过的【杀】因〖厉勇〗触发了{强命/加伤/铁骑}效果，你摸X张牌（X为触发的项数）。"},rank:c.rare},PSreluxun:{info:{sex:"male",group:"wu",hp:3,skills:["PSreqianxun","PSrelianying"],clans:["吴郡陆氏"],dieAudios:["re_luxun"],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSreqianxun:{audio:"reqianxun",trigger:{target:"useCardToBegin",player:"judgeBefore"},filter:function(a,n){return 0!=n.countCards("h")&&("phaseJudge"==a.getParent().name||"judge"!=a.name&&(!(a.targets&&a.targets.length>1)&&(!(!a.card||"trick"!=e.type(a.card)||a.player==n)||void 0)))},content:function(){var e=player.getCards("h");player.loseToSpecial(e,"PSreqianxun").visible=!1,player.markSkill("PSreqianxun"),player.addSkill("PSreqianxun_gain")},marktext:"谦",intro:{mark:function(a,r,t){var i=t.getCards("s",function(e){return e.hasGaintag("PSreqianxun")});if(i&&i.length){if(t!=n.me&&!t.isUnderControl())return"共有"+e.cnNumber(i.length)+"张牌";a.addAuto(i)}},markcount:function(e,a){return a.getCards("s",function(e){return e.hasGaintag("PSreqianxun")}).length},onunmark:function(e,a){var r=a.getCards("s",function(e){return e.hasGaintag("PSreqianxun")});r.length&&(a.lose(r,t.discardPile),a.$throw(r,1e3),n.log(r,"进入了弃牌堆"))}},ai:{effect:function(a,n,r){if(r.hasFriend()&&n!=r){var t=e.type(a),i=r.countCards();if("trick"==t){if(!e.tag(a,"multitarget")||e.info(a).singleCard)return e.tag(a,"damage")&&(i<3||r.hp<=2)?.8:[1,i]}else if("delay"==t)return[.5,.5]}}},_priority:0,subSkill:{gain:{trigger:{global:"phaseEnd"},forced:!0,audio:!1,content:function(){var e=player.getCards("s",function(e){return e.hasGaintag("PSreqianxun")});e.length&&player.gain(e,"draw"),n.delay(),player.unmarkSkill("PSreqianxun"),player.removeSkill("PSreqianxun_gain")},_priority:0}}},PSrelianying:{audio:"relianying",trigger:{player:"loseAfter",global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},direct:!0,filter:function(e,a){if(a.countCards("h"))return!1;var n=e.getl(a);return n&&n.hs&&n.hs.length},content:function(){var a=trigger.getl(player).hs.length;player.chooseTarget(e.prompt("relianying"),"令至多"+e.cnNumber(a)+"名角色各摸一张牌",[1,a]).ai=function(a){var n=r.event.player;return n==a?e.attitude(n,a)+10:e.attitude(n,a)},result.bool?(player.logSkill("PSrelianying",result.targets),n.asyncDraw(result.targets)):event.finish(),n.delay()},ai:{threaten:.8,effect:{target:function(e){if("guohe"==e.name||"liuxinghuoyu"==e.name)return.5}},noh:!0},_priority:0,group:"PSrelianying_else",subSkill:{else:{trigger:{player:["useCardEnd","respondEnd"]},direct:!0,content:function(){player.chooseBool(`是否弃置${r.currentPhase===player?"":e.translation(r.currentPhase)+"的"}一张手牌，然后摸一张牌`).set("ai",function(){return 1}),result.bool&&(r.currentPhase===player?player.chooseToDiscard("h",!0):player.discardPlayerCard(r.currentPhase,"h",!0),player.draw())}}}}},sort:u.PScharacter_wu,translate:{PSreluxun:"PS界陆逊",PSreluxun_prefix:"PS界",PSreqianxun:"谦逊",PSreqianxun_info:"每当一张延时类锦囊牌或其他角色使用的普通锦囊牌生效时，若你是此牌的唯一目标，你可以将所有手牌置于你的武将牌上，你可以如手牌般使用或打出以此法置于武将牌上的牌。若如此做，此回合结束时，你获得你武将牌上的所有牌。",PSrelianying:"连营",PSrelianying_info:"①当你失去最后的手牌时，你可以令至多X名角色各摸一张牌（X为你此次失去的手牌数）。<br>②当你使用或打出牌后，你可以弃置当前回合角色一张手牌，然后摸一张牌。"},rank:c.rare},PSxurong:{info:{sex:"male",group:"qun",hp:4,skills:["PSxionghuo","PSshajue"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSxionghuo:{audio:"xinfu_xionghuo",enable:"phaseUse",filter:function(e,a){return a.countMark("PSxionghuo")>0},filterTarget:function(e,a,n){return a!=n},content:function(){player.removeMark("PSxionghuo",1),target.addMark("PSxionghuo",1)},ai:{order:11,result:{target:function(a,r){return(a.countMark("PSxionghuo")>=2||!n.hasPlayer(function(n){return n!=a&&e.attitude(a,n)<0&&n.hasMark("PSxionghuo")}))&&a.countCards("h",function(n){return e.tag(n,"damage")&&a.canUse(n,r,null,!0)&&a.getUseValue(n)>0&&e.effect_use(r,n,a)>0&&r.hasSkillTag("filterDamage",null,{player:a,card:n})})?3/Math.max(1,r.hp):!a.hasUnknown()&&n.countPlayer(function(n){return e.attitude(a,n)<0})<=1||a.countMark("PSxionghuo")>=2?-1:0}},effect:{player:function(a,n,r){if(n!=r&&e.tag(a,"damage")&&r&&r.hasMark("PSxionghuo")&&!r.hasSkillTag("filterDamage",null,{player:n,card:a}))return[1,0,1,-2]}},threaten:1.6},marktext:"戾",intro:{name:"暴戾",content:"mark"},group:["PSxionghuo_init","PSxionghuo_damage","PSxionghuo_effect"],subSkill:{init:{audio:"xinfu_xionghuo",trigger:{global:"phaseBefore",player:"enterGame"},filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},forced:!0,locked:!1,content:function(){player.addMark("PSxionghuo",3)},sub:!0,_priority:0},damage:{audio:"xinfu_xionghuo",trigger:{source:"damageBegin1"},filter:function(e,a){return e.player.countMark("PSxionghuo")>0&&e.player!=a},forced:!0,locked:!1,logTarget:"player",content:function(){trigger.num+=trigger.player.countMark("PSxionghuo")},sub:!0,_priority:0},effect:{audio:"xinfu_xionghuo",trigger:{global:"phaseUseBegin"},filter:function(e,a){return e.player.countMark("PSxionghuo")>0&&e.player!=a},line:!1,forced:!0,locked:!1,logTarget:"player",content:function(){const e=trigger.player.countMark("PSxionghuo");trigger.player.removeMark("PSxionghuo",e);const a=[0,1,2].randomGets(Math.min(e,3));for(let n=0;n<a.length;n++)switch(a[n]){case 0:player.line(trigger.player,"fire"),trigger.player.damage("fire"),trigger.player.addTempSkill("PSxionghuo_disable"),trigger.player.markAuto("PSxionghuo_disable",[player]);break;case 1:player.line(trigger.player,"water"),trigger.player.loseHp(),trigger.player.addMark("PSxionghuo_low",1,!1),trigger.player.addTempSkill("PSxionghuo_low");break;case 2:player.line(trigger.player,"green");var r=trigger.player.getCards("h").randomGet(),t=trigger.player.getCards("e").randomGet(),i=[];r&&i.push(r),t&&i.push(t),i.length&&player.gain(i,trigger.player,"giveAuto","bySelf")}n.delay()},sub:!0,_priority:0},disable:{mod:{playerEnabled:function(e,a,n){if("sha"==e.name&&a.getStorage("PSxionghuo_disable").includes(n))return!1}},charlotte:!0,onremove:!0,mark:!0,marktext:"禁",intro:{content:"不能对$使用【杀】"},sub:!0,_priority:0},low:{mod:{maxHandcard:function(e,a){return a-e.countMark("PSxionghuo_low")}},charlotte:!0,onremove:!0,mark:!0,marktext:"减",intro:{content:"手牌上限-#"},sub:!0,_priority:0}},_priority:0},PSshajue:{audio:"xinfu_shajue",trigger:{global:"dying"},filter:function(e,a){return e.player!=a},forced:!0,content:function(){player.addMark("PSxionghuo",1),trigger.player.hp<0&&"cards"==e.itemtype(trigger.parent.cards)&&"o"==e.position(trigger.parent.cards[0],!0)&&player.gain(trigger.parent.cards,"gain2")},_priority:0}},sort:u.PScharacter_qun,translate:{PSxurong:"PS徐荣",PSxionghuo:"凶镬",PSxionghuo_info:"游戏开始时，你获得3个“暴戾”标记。出牌阶段，你可以交给一名其他角色一个“暴戾”标记。当你对有“暴戾”标记的其他角色造成伤害时，此伤害+X。有“暴戾”标记的其他角色的出牌阶段开始时，其移去所有“暴戾”标记并随机执行X项：1.受到1点火焰伤害且本回合不能对你使用【杀】；2.失去1点体力且本回合手牌上限-1；3.你随机获得其一张手牌和一张装备区的牌。（X为目标角色的“暴戾”标记数）",PSshajue:"杀绝",PSshajue_info:"锁定技，其他角色进入濒死状态时，你获得一个“暴戾”标记。然后若其体力值小于0，你获得使其进入濒死状态的牌。"},rank:c.rare},PSlifeng:{info:{sex:"male",group:"shu",hp:3,skills:["PStunchu","PSshuliang"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PStunchu:{audio:"tunchu",trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},onremove:function(e,a){var n=e.getExpansions(a);n.length&&e.loseToDiscardpile(n)},intro:{markcount:"expansion",content:"expansion"},content:function(){player.draw(2);var a=player.getCards("h");a.length&&(a.length<=2?event._result={bool:!0,cards:a}:player.chooseCard("h",2,!0,"选择两张手牌作为“粮”").set("ai",function(a){return 5-e.value(a)})),result.bool&&result.cards&&result.cards.length&&player.addToExpansion(result.cards,player,"giveAuto").gaintag.add("PStunchu")},ai:{threaten:3},group:["PStunchu_draw","PStunchu_choose"],subSkill:{draw:{audio:"tunchu",trigger:{player:"phaseDrawBegin2"},forced:!0,preHidden:!0,filter:function(e,a){return!e.numFixed&&a.getExpansions("PStunchu").length},content:function(){trigger.num+=player.getExpansions("PStunchu").length},mod:{maxHandcard:function(e,a){return a+e.getExpansions("PStunchu").length}},sub:!0},choose:{audio:"tunchu",trigger:{player:"phaseDrawEnd"},forced:!0,popup:!1,filter:function(e,a){return a.getExpansions("PStunchu").length<=Math.min(a.maxHp,3)&&a.countCards("h")},content:function(){const a=Math.min(player.maxHp,3);player.chooseCard("h",[1,a],!1,`屯储：是否选择至多${e.cnNumber(a)}张手牌作为“粮”`).set("ai",function(a){return 5-e.value(a)}),result.bool&&result.cards&&result.cards.length&&player.addToExpansion(result.cards,player,"giveAuto").gaintag.add("PStunchu")},sub:!0}}},PSshuliang:{audio:"shuliang",trigger:{global:"phaseJieshuBegin"},direct:!0,filter:function(e,a){return a.getExpansions("PStunchu").length>0&&e.player.countCards("h")<e.player.getHandcardLimit()&&e.player.isIn()},content:function(){var a=e.attitude(player,trigger.player)>0;player.chooseCardButton(e.prompt("PSshuliang",trigger.player),player.getExpansions("PStunchu")).set("ai",function(){return r.event.goon?1:0}).set("goon",a),result.bool&&(player.logSkill("PSshuliang",trigger.player),player.loseToDiscardpile(result.links),trigger.player.draw(2))},ai:{combo:"PStunchu"},_priority:0}},sort:u.PScharacter_shu,translate:{PSlifeng:"PS李丰",PStunchu:"屯储",PStunchu_info:"①锁定技，游戏开始时，你摸两张牌，然后将两张手牌置于武将牌上，称为「粮」；<br/>②摸牌阶段，你额外摸X张牌，你的手牌上限+X（X为你的「粮」数）；<br/>③摸牌阶段结束时，若你的“粮”数不大于Y，你可以将至多Y张手牌置于武将牌上（Y为你的体力上限，且至多为3）。",PSshuliang:"输粮",PSshuliang_info:"一名角色的结束阶段开始时，若其手牌数少于手牌上限，你可以移去一张「粮」，然后该角色摸两张牌。"},rank:c.rare},PSchenshi:{info:{sex:"male",group:"shu",hp:4,skills:["PSqingbei"],dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSqingbei:{audio:"qingbei",trigger:{global:"roundStart"},direct:!0,content:function(){if(player.chooseButton(['###擎北：是否选择任意种花色？###<div class="text center">本轮你使用牌后，若此牌的花色与你以此法选择花色均不相同，你摸X张牌，否则你须弃置X张牌（X为你本轮以此法选择的花色数）</div>',[a.suit.map(e=>["","","lukai_"+e]),"vcard"]],[1,4]).set("ai",a=>{var n=r.event.player,i=a.link[2].slice(6),o=n.getCards("hs",{suit:i}).map(a=>e.value(a)+n.getUseValue(a)/3).reduce((e,a)=>e+a,0);return o>10&&t.selected.buttons.length>0||o>6&&2==t.selected.buttons.length||3==t.selected.buttons.length?-1:1+1/o}),result.bool){var n=result.links.map(e=>e[2].slice(6));player.logSkill("PSqingbei"),player.addTempSkill("PSqingbei_effect","roundStart"),player.setStorage("PSqingbei_effect",n),player.markSkill("PSqingbei_effect")}},ai:{threaten:2.3},subSkill:{effect:{audio:"qingbei",trigger:{player:"useCardAfter"},charlotte:!0,onremove:!0,forced:!0,filter:function(e,a){return a.getStorage("PSqingbei_effect").length},content:function(){const a=e.suit(trigger.card);player.getStorage("PSqingbei_effect").includes(a)?player.chooseToDiscard("hes",!0,player.getStorage("PSqingbei_effect").length):player.draw(player.getStorage("PSqingbei_effect").length)},mark:!0,intro:{content:a=>`本轮内使用非${e.translation(a)}花色的牌后，摸${e.cnNumber(a.length)}张牌；<br>使用${e.translation(a)}花色的牌后，弃置${e.cnNumber(a.length)}张牌。`},ai:{effect:{player:function(a,n,r){const t=n.getStorage("PSqingbei_effect").length;return n.getStorage("PSqingbei_effect").includes(e.suit(a))?[1,-t]:[1,t]}}},sub:!0,_priority:0}},_priority:0}},sort:u.PScharacter_shu,translate:{PSchenshi:"PS陈式",PSqingbei:"擎北",PSqingbei_info:"一轮游戏开始时，你可以选择任意种花色。然后你本轮使用牌后，若此牌的花色与你以此法选择花色均不相同，你摸X张牌，否则你须弃置X张牌（X为你本轮以此法选择过的花色数）。"},rank:c.epic},PSben_sunben:{info:{sex:"male",group:"wu",hp:3,skills:["jiang","PShunzi","zhiba"],dieAudios:["sunce"],trashBin:[]},intro:"由“九个芒果”设计",skills:{PShunzi:{audio:"rehunzi",trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return!a.storage.PShunzi},skillAnimation:!0,animationColor:"wood",juexingji:!0,derivation:["reyingzi","gzyinghun","PSduwu","PSchoushang","PShuaiji","PSchanhuo"],unique:!0,forced:!0,content:function(){player.gainMaxHp(),player.addSkills("reyingzi"),player.addSkills("gzyinghun"),player.addSkills("PSduwu"),player.awakenSkill(event.name),player.storage[event.name]=!0},_priority:1},PSduwu:{audio:"rehunzi",trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return!a.storage.PSduwu&&!a.getHistory("useSkill",e=>"PShunzi"===e.skill).length},skillAnimation:!0,animationColor:"wood",juexingji:!0,derivation:["dushi","yaowu","PSchoushang"],unique:!0,forced:!0,content:function(){player.gainMaxHp(),player.addSkills("dushi"),player.addSkills("yaowu"),player.addSkills("PSchoushang"),player.awakenSkill(event.name),player.storage[event.name]=!0},_priority:1},PSchoushang:{audio:"rehunzi",trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return!a.storage.PSchoushang&&!a.getHistory("useSkill",e=>"PSduwu"===e.skill).length},skillAnimation:!0,animationColor:"wood",juexingji:!0,derivation:["chouhai","ranshang","PShuaiji"],unique:!0,forced:!0,content:function(){player.gainMaxHp(),player.addSkills("chouhai"),player.addSkills("ranshang"),player.addSkills("PShuaiji"),player.awakenSkill(event.name),player.storage[event.name]=!0},_priority:1},PShuaiji:{audio:"rehunzi",trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return!a.storage.PShuaiji&&!a.getHistory("useSkill",e=>"PSchoushang"===e.skill).length},skillAnimation:!0,animationColor:"wood",juexingji:!0,derivation:["benghuai","tongji","PSchanhuo"],unique:!0,forced:!0,content:function(){player.gainMaxHp(),player.addSkills("benghuai"),player.addSkills("tongji"),player.addSkills("PSchanhuo"),player.awakenSkill(event.name),player.storage[event.name]=!0},_priority:1},PSchanhuo:{audio:"rehunzi",trigger:{player:"phaseZhunbeiBegin"},filter:function(e,a){return!a.storage.PSchanhuo&&!a.getHistory("useSkill",e=>"PShuaiji"===e.skill).length},skillAnimation:!0,animationColor:"wood",juexingji:!0,derivation:["chanyuan","lianhuo"],unique:!0,forced:!0,content:function(){player.gainMaxHp(),player.addSkills("chanyuan"),player.addSkills("lianhuo"),player.awakenSkill(event.name),player.storage[event.name]=!0},_priority:1}},sort:u.PScharacter_wu,translate:{PSben_sunben:"PS笨孙笨",PShunzi:"魂姿",PShunzi_info:"觉醒技，准备阶段，你加一点体力上限，并获得技能〖英姿〗、〖英魂〗和〖毒武〗。",PSduwu:"毒武",PSduwu_info:"觉醒技，准备阶段，若你于此回合没有发动技能〖魂姿〗，你加一点体力上限，并获得技能〖毒逝〗、〖耀武〗和〖仇殇〗。",PSchoushang:"仇殇",PSchoushang_info:"觉醒技，准备阶段，若你于此回合没有发动技能〖毒武〗，你加一点体力上限，并获得技能〖仇海〗、〖燃殇〗和〖坏疾〗。",PShuaiji:"坏疾",PShuaiji_info:"觉醒技，准备阶段，若你于此回合没有发动技能〖仇殇〗，你加一点体力上限，并获得技能〖崩坏〗、〖同疾〗和〖缠祸〗。",PSchanhuo:"缠祸",PSchanhuo_info:"觉醒技，准备阶段，若你于此回合没有发动技能〖坏疾〗，你加一点体力上限，并获得技能〖缠怨〗和〖链祸〗。"},rank:c.junk},PSqun_zhaoyun:{info:{sex:"male",group:"qun",hp:4,skills:["PSlongwei","PSqiangshu"],dieAudios:["zhaoyun"],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSlongwei:{audio:"chongzhen",trigger:{player:"useCardToPlayer",target:"useCardToTarget"},filter:function(e,a,n){const r="useCardToPlayer"===n?e.target:e.player;return"sha"==e.card.name&&r&&r.countDiscardableCards(a,"he")>0},shaRelated:!0,logTarget:function(e,a){return"useCardToPlayer"===e.name?e.target:e.player},content:function(){const a="useCardToPlayer"===event.triggername?trigger.target:trigger.player;player.discardPlayerCard(a,1,"he",!0),result.bool&&result.cards&&result.cards.length&&e.color(trigger.card)===e.color(result.cards[0])&&["o","d"].includes(e.position(result.cards[0]))&&player.gain(result.cards,"gain2")},ai:{effect:{player:function(a,n,r){if("sha"===e.name(a))return r.countDiscardableCards(n,"he")>0?[1,1.75]:[1,1]},target:function(a,n,r){if("sha"===e.name(a))return n.countDiscardableCards(r,"he")>0?[1,-.5]:[1,1]}}}},PSqiangshu:{audio:"ollongdan",enable:["chooseToUse","chooseToRespond"],usable:1,viewAs:{name:"sha",storage:{PSqiangshu:!0}},filterCard:!0,position:"hes",filter:function(e,a){return a.countCards("hes")},check:function(a){return 6-e.value(a)&&e.cardNameLength(a)>1},precontent:function(){event.getParent().addCount=!1},mod:{targetInRange:function(e){if(e.storage&&e.storage.PSqiangshu)return!0},selectTarget:function(n,r,t){if("sha"==n.name&&n.storage&&n.storage.PSqiangshu&&-1!=t[1])try{t[1]=e.cardNameLength(n.cards.length?n.cards[0]:n)}catch(i){t[1]=a.translate[(n.cards.length?n.cards[0]:n).name].length}}},ai:{order:()=>e.order({name:"sha"})+.2,result:{player:1,target:function(a,n,t,i){let o=-1.5,l=1.35,s=1;if(i){let a=r.event.getTempCache("sha_result","eff");return"object"!=typeof a||a.card!==e.translation(t)?o:a.odds<1.35&&a.bool?1.35*a.eff:a.odds*a.eff}return(a.hasSkill("jiu")||a.hasSkillTag("damageBonus",!0,{target:n,card:t}))&&(n.hasSkillTag("filterDamage",null,{player:a,card:t,jiu:!0})?o=-.5:(s=2,o=e.attitude(a,n)>0?-7:-4)),a.hasSkillTag("directHit_ai",!0,{target:n,card:t},!0)||(l-=.7*n.mayHaveShan(a,"use",n.getCards(e=>e.hasGaintag("sha_notshan")),"odds")),r.event.putTempCache("sha_result","eff",{bool:n.hp>s&&e.attitude(a,n)>0,card:e.translation(t),eff:o,odds:l}),l*o}},yingbian:function(r,t,i,o){if(e.attitude(o,t)<=0)return 0;var l=0,s=!1;return e.cardtag(r,"yingbian_hit")&&(s=!0,i.some(a=>a.mayHaveShan(o,"use",a.getCards(e=>e.hasGaintag("sha_notshan")))&&e.attitude(o,a)<0&&e.damageEffect(a,t,o,e.natureList(r))>0)&&(l+=5)),e.cardtag(r,"yingbian_add")&&n.hasPlayer(function(n){return!i.includes(n)&&a.filter.targetEnabled2(r,t,n)&&e.effect(n,r,t,t)>0})&&(l+=5),e.cardtag(r,"yingbian_damage")&&i.some(a=>e.attitude(t,a)<0&&(s||!a.mayHaveShan(o,"use",a.getCards(e=>e.hasGaintag("sha_notshan")))||t.hasSkillTag("directHit_ai",!0,{target:a,card:r},!0))&&!a.hasSkillTag("filterDamage",null,{player:t,card:r,jiu:!0}))&&(l+=5),l},canLink:function(e,a,n){return!(!a.isLinked()&&!e.hasSkill("wutiesuolian_skill"))&&!(e.hasSkill("jueqing")||e.hasSkill("gangzhi")||a.hasSkill("gangzhi"))},basic:{useful:[5,3,1],value:[5,3,1]},tag:{respond:1,respondShan:1,damage:function(e){if(!n.hasNature(e,"poison"))return 1},natureDamage:function(e){if(n.hasNature(e,"linked"))return 1},fireDamage:function(e,a){if(n.hasNature(e,"fire"))return 1},thunderDamage:function(e,a){if(n.hasNature(e,"thunder"))return 1},poisonDamage:function(e,a){if(n.hasNature(e,"poison"))return 1}}},_priority:0}},sort:u.PScharacter_qun,translate:{PSqun_zhaoyun:"PS群赵云",PSlongwei:"龙威",PSlongwei_info:"当你使用杀指定目标或成为杀的目标时，你可以弃置对方的一张牌，若弃置牌的颜色与该杀的颜色相同，你获得之。",PSqiangshu:"枪术",PSqiangshu_info:"每回合限一次，你可以将一张牌当【杀】使用或打出（无距离限制且不计入次数），你以此法使用的【杀】额定目标数为X（X为此牌的牌名数）。"},rank:c.rare},PSxuzhu:{info:{sex:"male",group:"wei",hp:4,skills:["PSluoyi","PShanzhan"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSluoyi:{enable:"phaseUse",audio:"luoyi",usable:2,viewAsFilter:function(e){return[1,2,3,4,5].some(a=>e.hasEnabledSlot(a))},viewAs:{name:"juedou",isCard:!0},filterCard:()=>!1,selectCard:-1,precontent:function(){player.chooseToDisable().set("ai",function(e,a,n){return n.includes("equip5")?"equip5":n.randomGet()}),player.when({source:"damageBegin2",player:"useCardEnd"}).filter(e=>"useCard"==e.name||"PSluoyi"===e.getParent().skill&&player.countCards("e")<=e.player.countCards("e")).then(()=>{"useCardEnd"!==event.triggername&&trigger.num++})},ai:{order:function(){return e.order({name:"juedou"})-.5},wuxie:function(a,r,t,i,o){return t===n.me&&e.attitude(i,t._trueMe||t)>0||o*e.attitude(i,a)*e.effect(a,r,t,a)>=0?0:void 0},basic:{order:5,useful:1,value:5.5},result:{target:-1.5,player:function(a,n,r){if(a.hasSkillTag("directHit_ai",!0,{target:n,card:r},!0))return 0;if(e.damageEffect(n,a,n)>0&&e.attitude(a,n)>0&&e.attitude(n,a)>0)return 0;var t=n.getCards("h","sha"),i=a.getCards("h","sha");if(t.length>i.length+1)return-2;var o=n.getCards("h");return o.length>2&&0==i.length&&o[0].number<6||o.length>3&&0==i.length||t.length>i.length&&(!i.length||t[0].number>i[0].number)?-2:-.5}},tag:{respond:2,respondSha:2,damage:1}}},PShanzhan:{audio:"reluoyi",trigger:{global:"dying"},usable:1,check:()=>!0,content:async function(a,n,r){if(r.countDiscardableCards(r,"hes")>0){const{result:a}=await r.chooseToDiscard([1,2],"hes","是否弃置至多两张牌，恢复等量的装备栏？",!1).set("ai",e.disvalue);if(a.cards&&a.cards.length){const e=a.cards.length;if(e>=r.countDisabledSlot()){for(let e=1;e<=5;e++){let a="equip"+e,n=r.disabledSlots[a];if("number"==typeof n&&0!==n)for(let t=0;t<n;t++)await r.enableEquip(e)}r.enableEquip(a.control)}else for(let a=0;a<e;a++)await r.chooseToEnable()}}r.drawTo(4)}}},sort:u.PScharacter_wei,translate:{PSxuzhu:"PS许褚",PSluoyi:"裸衣",PSluoyi_info:"出牌阶段限两次，你可以废除一个装备栏，视为使用一张【决斗】。当你以此法使用【决斗】对其他角色造成伤害时，若你装备区的牌数不大于目标角色，此伤害+1。",PShanzhan:"酣战",PShanzhan_info:"每回合限一次，当一名角色进入濒死状态时，你可以弃置至多两张牌，恢复等量的装备栏，然后你将手牌摸至4张。"},rank:c.epic},PSgongsunzan:{info:{sex:"male",group:"qun",hp:4,skills:["PSdangkou","PSbaima"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSdangkou:{audio:"dcqiaomeng",enable:"phaseUse",filter:function(e,a){return a.countCards("hes")>0&&!a.hasSkill("PSdangkou_used")},async content(e,n,r){const{control:t}=await r.chooseControl(["失去体力","回复体力","cancel2"]).set("ai",function(){return r.hp>r.getDamagedHp()?"失去体力":"回复体力"}).set("prompt",a.translate.PSdangkou_info).forResult();"cancel2"!==t&&(r.addTempSkill("PSdangkou_used"),"失去体力"===t?(await r.loseHp(),await r.gainMaxHp(),await r.chooseUseTarget("sha","是否使用一张【杀】？",!1)):(await r.recover(),await r.loseMaxHp(),await r.draw(2)))},subSkill:{used:{charlotte:!0,forced:!0,popup:!1}},ai:{order:8,result:{player:1}},_priority:0},PSbaima:{audio:"reyicong",trigger:{player:"changeHp"},forced:!0,locked:!0,content:function(){},mod:{globalFrom:function(e,a,n){return n-Math.max(e.hp,1)},globalTo:function(e,a,n){return n+Math.max(a.getDamagedHp(),1)}},ai:{threaten:.8},_priority:0}},sort:u.PScharacter_qun,translate:{PSgongsunzan:"PS公孙瓒",PSdangkou:"荡寇",PSdangkou_info:"出牌阶段限一次，你可以选择一项：1.失去一点体力并增加一点体力上限，然后视为使用一张【杀】（不计入使用次数）；2.回复一点体力并减一点体力上限，然后摸两张牌。",PSbaima:"白马",PSbaima_info:"锁定技，你计算与其他角色距离时-X，其他角色计算与你的距离时+Y（X为你的体力值，Y为你已损失的体力值，至少为1）。"},rank:c.rare},PSdongzhuo:{info:{sex:"male",group:"qun",hp:8,skills:["PSlingbao","PSjiuchi","PSzongyu","olbaonue"],isZhugong:!0,dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSlingbao:{audio:"starweilin",trigger:{player:"useCard"},check:function(a,n){return e.value(a.card)>4},prompt2:function(a,n){return`令${e.translation(a.card)}额外结算一次`},filter:function(a,n){if(!["club","spade"].includes(e.suit(a.card)))return!1;var r=n.getLastUsed(1);if(!r||!r.card)return!1;if(!n.isPhaseUsing())return!1;var t=r.getParent("phaseUse");return!(!t||"phaseUse"!=t.name||t.player!=n)&&e.suit(r.card)===e.suit(a.card)},usable:1,content:function(){trigger.effectCount++}},PSjiuchi:{mod:{cardUsable:function(e,a,n){if("jiu"==e.name)return 1/0}},audio:"oljiuchi",enable:"chooseToUse",filterCard:function(a){return"spade"==e.suit(a)},viewAs:{name:"jiu"},position:"hes",viewAsFilter:function(a){return a.hasCard(a=>"spade"==e.suit(a),"hs")},prompt:"将一张黑桃牌当酒使用",check:function(t,i){if(i&&i==t.player)return!0;if("dying"==r.event.type)return 1;var o=(i=r.event.player).getCards("hs",function(a){return a!=t&&"sha"==e.name(a,i)});if(!o.length)return-1;if(o.length>1&&(i.getCardUsable("sha")>1||i.countCards("hs","zhuge")))return 0;o.sort(function(a,n){return e.order(n)-e.order(a)});var l=!1;if(o.length)for(var s=0;s<o.length;s++)if(o[s]!=t&&a.filter.filterCard(o[s],i)){l=o[s];break}return l&&n.hasPlayer(function(a){return e.attitude(i,a)<0&&!a.hasShan()&&a.hp+a.countCards("h",{name:["tao","jiu"]})>1+(i.storage.jiu||0)&&i.canUse(l,a,!0,!0)&&!a.hasSkillTag("filterDamage",null,{player:i,card:l,jiu:!0})&&e.effect(a,l,i)>0})?4-e.value(t):-1},ai:{threaten:1.5,basic:{useful:(e,a)=>r.event.player.hp>1?0===a?4:1:0===a?7.3:3,value:(e,a,n)=>a.hp>1?0===n?5:1:0===n?7.3:3},order:()=>{if(r.event.dying)return 9;let a=e.order({name:"sha"});return a>0?a+.2:0},result:{target:(r,i,o)=>{if(i&&i.isDying())return 2;if(!i||i._jiu_temp||!i.isPhaseUsing())return 0;let l=i.getCardUsable("sha");if(!l||"stone"===a.config.mode&&!r.isMin()&&r.getActCount()+1>=r.actcount||!i.mayHaveSha(r,"use",o))return 0;let s,u={order:0};i.getCards("hs",a=>"sha"===e.name(a)&&!t.selected.cards.includes(a)&&(s=e.order(a,i),!(s<u.order)&&(s>u.order&&(u={order:s}),void(u[a.cardid]={card:a,target:null,eff:0})))),delete u.order;for(let t in u)if(a.filter.filterCard(u[t].card,i)&&(n.filterPlayer(a=>!(e.attitude(i,a)>=0||!i.canUse(u[t].card,a,null,!0)||a.hasSkillTag("filterDamage",null,{player:i,card:u[t].card,jiu:!0}))&&(s=e.effect(a,u[t].card,i,r),s<=u[t].eff||(u[t].target=a,u[t].eff=s),!1)),u[t].target&&(i.hasSkillTag("directHit_ai",!0,{target:u[t].target,card:t},!0)||1===l&&(i.needsToDiscard()>Math.max(0,3-i.hp)||!u[t].target.mayHaveShan(r,"use",u[t].target.getCards(e=>e.hasGaintag("sha_notshan")))))))return delete i._jiu_temp,1;return delete i._jiu_temp,0}},tag:{save:1,recover:.1}},_priority:0},PSzongyu:{audio:"roulin",trigger:{global:"damageEnd"},forced:!0,filter:function(e,a){return e.player.isIn()&&e.player!==a&&"female"===e.player.sex&&e.player.countCards("he")},logTarget:"player",content:function(){player.gainPlayerCard(trigger.player,1,"he",!0)},group:"PSzongyu_lose",subSkill:{lose:{audio:"benghuai",trigger:{player:"phaseJieshuBegin"},forced:!0,filter:function(e,a){return n.hasPlayer(function(e){return"female"===e.sex})},content(){player.chooseControl("baonue_hp","baonue_maxHp",function(e,a){return a.hp==a.maxHp?"baonue_hp":a.hp<a.maxHp-1||a.hp<=2?"baonue_maxHp":"baonue_hp"}).set("prompt","纵欲：失去1点体力或减1点体力上限"),"baonue_hp"==result.control?player.loseHp():player.loseMaxHp(!0)}}}}},sort:u.PScharacter_qun,translate:{PSdongzhuo:"PS董卓",PSlingbao:"凌暴",PSlingbao_info:"每阶段限一次，当你于出牌阶段内使用♣或♠牌时，若此牌花色与你于此阶段使用的上一张牌花色相同，你可以令此牌额外结算一次。",PSjiuchi:"酒池",PSjiuchi_info:"你可以将一张♠牌当【酒】 使用，你使用【酒】无次数限制。",PSzongyu:"纵欲",PSzongyu_info:"锁定技，①当一名女性角色受到伤害后，你获得其一张牌。②结束阶段，若场上有存活的女性角色，你须减一点体力或体力上限。"},rank:c.rare},PShuangzhong:{info:{sex:"male",group:"shu",hp:4,skills:["PSxujin"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSxujin:{getUseNumber:function(e){const a=e.storage.PSxujin||0;return n.getGlobalHistory("useCard").length-a},getSuitNumber:function(r){const t=[];return n.getGlobalHistory("useCard",n=>{a.suit.includes(e.suit(n.card))&&t.add(e.suit(n.card))}),r?e.translation(t):t.length},mod:{targetInRange:function(e,n,r){if("sha"==e.name&&a.skill.PSxujin.getUseNumber(n)>=1)return!0}},mark:!0,intro:{content:function(e,n){let r="<li>本回合已使用花色：";return r+=a.skill.PSxujin.getSuitNumber(!0),r+="<br><li>本回合已使用花色数：",r+=a.skill.PSxujin.getSuitNumber(),r+="<br><li>本回合“蓄劲”计数：",r+=a.skill.PSxujin.getUseNumber(n),r},markcount:function(e,a){return a.storage.PSxujin?n.getGlobalHistory("useCard").length-a.storage.PSxujin:n.getGlobalHistory("useCard").length}},audio:"xinliegong",trigger:{player:"useCardToPlayered",global:["phaseEnd","useCard"]},forced:!0,lastDo:!0,filter:function(n,r,t){return"phaseEnd"===t||"useCard"===t?(r.markSkill("PSxujin"),"phaseEnd"===t&&delete r.storage.PSxujin,!1):"sha"===e.name(n.card)&&a.skill.PSxujin.getUseNumber(r)>=2},content:function(){trigger.getParent().directHit.addArray(n.players),n.log(trigger.card,"不可被响应"),player.when({source:"damageBegin2"}).filter(e=>e.getParent(2)===trigger.getParent()&&a.skill.PSxujin.getUseNumber(player)>=3&&e.card===trigger.card).then(()=>{trigger.num+=a.skill.PSxujin.getSuitNumber()-1,n.log(trigger.card,"造成伤害+",a.skill.PSxujin.getSuitNumber())}),player.when("useCardAfter").filter(n=>"sha"===e.name(n.card)&&a.skill.PSxujin.getUseNumber(player)>=4).then(()=>{player.drawTo(player.maxHp),player.storage.PSxujin=a.skill.PSxujin.getUseNumber(player)})},ai:{directHit_ai:!0,skillTagFilter:function(e,n,r){return!(!(r&&r.card&&r.target)||"sha"!=r.card.name&&a.skill.PSxujin.getUseNumber(e)>=2)}},sub:!0,_priority:0}},sort:u.PScharacter_shu,translate:{PShuangzhong:"PS黄忠",PSxujin:"蓄劲",PSxujin_info:"锁定技，若X：<br>不小于1，你使用【杀】无距离限制；<br>不小于2，你使用【杀】不可被响应；<br>不小于3，你使用【杀】造成伤害+Y。<br>当你使用【杀】结算后，若X不小于4，你将手牌摸至体力上限，记录Z为此时本回合使用过的牌数，然后本回合X修改为本回合使用过的牌数-Z。 (X为本回合使用过的牌数，Y为本回合使用过的花色数-1)"},rank:c.rare},PSshen_simayi:{info:{sex:"male",group:"shen",hp:4,skills:["PSrenjie","PSbaiyin"],dieAudios:[],trashBin:[]},intro:"由“九个芒果”设计",skills:{PSrenjie:{mod:{aiOrder:(e,n,r)=>r<=0||"object"!=typeof n||!e.isPhaseUsing()?r:a.skill.PSrenjie.derivation.filter(a=>!e.hasSkill(a)).length?0:void 0},audio:"renjie2",trigger:{player:["damageEnd","loseAfter"],global:"loseAsyncAfter"},init:function(e,a){n.changeSkillAudio("reguicai",e.name,"jilue_guicai"),n.changeSkillAudio("PSfangzhu",e.name,"jilue_fangzhu"),n.changeSkillAudio("PSjizhi",e.name,"jilue_jizhi"),n.changeSkillAudio("PSzhiheng",e.name,"jilue_zhiheng"),n.changeSkillAudio("PSwansha",e.name,"wansha_shen_simayi")},derivation:["reguicai","PSfangzhu","PSjizhi","PSzhiheng","PSwansha"],forced:!0,notemp:!0,filter(e,n,r){if(!a.skill.PSrenjie.derivation.filter(e=>!n.hasSkill(e)).length)return!1;if("damageEnd"===r)return e.num>0;if("discard"!=e.type||!1===e.getlx)return!1;var t=e.getParent("phaseDiscard"),i=e.getl(n);return t&&i&&"phaseDiscard"==t.name&&t.player==n&&i.cards2&&i.cards2.length>0},async content(n,r,t){const i="damageEnd"===n.triggername?r.num:r.getl(t).cards2.length,o=a.skill.PSrenjie.derivation.filter(e=>!t.hasSkill(e));if(i>=o.length)return void t.addSkills(o);const l=o.map((a,n)=>[n,e.translation(a)+"："+e.translation(a+"_info")]),{result:{links:s}}=await t.chooseButton([`忍戒：请选择获得${e.cnNumber(i)}个技能`,[l,"textbutton"]]).set("dialog",n.videoId).set("forced",!0).set("selectButton",i).set("ai",function(e){return 1+Math.random()});t.addSkills(s.map(e=>(t.popup(o[e]),o[e])))},intro:{name2:"忍",content:"mark"},ai:{maixie:!0,maixie_hp:!0,effect:{target:function(a,n,r){return n.hasSkillTag("jueqing",!1,r)?[1,-2]:e.tag(a,"damage")?r.hp==r.maxHp?r.hasSkill("PSjilue")?[.7,1]:[0,1]:.7:void 0}}},_priority:0},PSbaiyin:{skillAnimation:"epic",animationColor:"thunder",juexingji:!0,trigger:{player:"changeSkillsAfter"},forced:!0,unique:!0,audio:"sbaiyin",derivation:"lianpo",filter:(e,n)=>a.skill.PSrenjie.derivation.every(e=>n.hasSkill(e))&&"PSrenjie"===e.getParent(2).skill,content:async function(e,a,n){n.awakenSkill("PSbaiyin"),n.loseMaxHp(),await n.removeSkills("PSrenjie"),await n.addSkills("lianpo")},_priority:0,ai:{combo:"PSrenjie"}}},sort:u.PScharacter_shen,translate:{PSshen_simayi:"PS神司马懿",PSrenjie:"忍戒",PSrenjie_info:"锁定技，当你受到1点伤害后/于弃牌阶段内每弃置一张牌后，你选择获得{〖鬼才〗、〖放逐〗、〖集智〗、〖制衡〗、〖完杀〗}中的一个技能。",PSbaiyin:"拜印",PSbaiyin_info:"觉醒技，当你因〖忍戒〗获得技能后，若你拥有〖忍戒〗的所有衍生技，你减1点体力上限，失去技能〖忍戒〗，然后获得〖连破〗。"},rank:c.epic},PSyue_caiwenji:{info:{sex:"female",group:"qun",hp:3,skills:["PSshuangjia","dcbeifen"],dieAudios:[],trashBin:[]},intro:"由“神鬼高达”设计",skills:{PSshuangjia:{audio:"dcshuangjia",trigger:{global:"phaseBefore",player:["enterGame","gainBegin"]},forced:!0,filter:function(e,a){return("phase"!==e.name||0===n.phaseNumber)&&"dcbeifen"!=e.getParent(2).skill},content:function(){if("gainBegin"!==event.triggername){var e=player.getCards("h");player.addGaintag(e,"dcshuangjia_tag")}else trigger.gaintag.add("dcshuangjia_tag")},sub:!0,onremove:function(e){e.removeGaintag("dcshuangjia_tag")},mod:{ignoredHandcard:function(e,a){if(e.hasGaintag("dcshuangjia_tag"))return!0},cardDiscardable:function(e,a,n){if("phaseDiscard"==n&&e.hasGaintag("dcshuangjia_tag"))return!1},globalTo:function(e,a,n){return n+Math.min(5,a.countCards("h",e=>e.hasGaintag("dcshuangjia_tag")))}},_priority:0}},sort:u.PScharacter_qun,translate:{PSyue_caiwenji:"PS乐蔡文姬",PSyue_caiwenji_prefix:"PS乐",PSshuangjia:"霜笳",PSshuangjia_info:"锁定技。①游戏开始时/当你不因〖悲愤〗而获得牌时，你将你的手牌/这些牌标记为“胡笳”。②你的“胡笳”牌不计入手牌上限。③其他角色至你的距离+X（X为你的“胡笳”数且至多为5）。"},rank:c.epic},PScaopi:{info:{sex:"male",group:"wei",hp:3,skills:["PSfangzhu","PSxingshang","songwei"],dieAudios:["re_caopi"],isZhugong:!0,trashBin:[]},intro:"由“九个芒果”设计",skills:{PSfangzhu:{mod:{targetEnabled:function(e,a,n,t){if(n.isTurnedOver()!==a.isTurnedOver()&&r.currentPhase===a)return!1}},audio:"refangzhu",trigger:{player:"damageEnd"},direct:!0,content:function(){if(player.chooseTarget(e.prompt2("PSfangzhu"),function(e,a,n){return!0}).ai=function(a){return a.hasSkillTag("noturn")?0:(r.event.player,0==e.attitude(r.event.player,a)?0:e.attitude(r.event.player,a)>0?a.classList.contains("turnedover")?1e3-a.countCards("h"):-1:a.hp<=1?1e3:1+a.countCards("h"))},result.bool){player.logSkill("PSfangzhu",result.targets),event.target=result.targets[0];const a=["摸牌翻面","弃牌扣血"];player.chooseControl(a,function(e,a){return r.event.choice}).set("choice",e.attitude(player,event.target)>0||event.target.hp>1?a[0]:a[1]).set("prompt",`放逐：令${e.translation(event.target)}执行一项`)}else event.finish();result.control&&("摸牌翻面"===result.control?(event.target.draw(),event.target.turnOver()):(event.target.countDiscardableCards(event.target,"he")>0&&event.target.chooseToDiscard("he",1,!0).set("ai",function(a){return 6-e.value(a)}),event.target.loseHp()))},ai:{maixie:!0,maixie_hp:!0,effect:{target:function(a,r,t){if(e.tag(a,"damage")){if(r.hasSkillTag("jueqing",!1,t))return[1,-1.5];if(t.hp<=1)return;if(!t.hasFriend())return;for(var i=!1,o=!1,l=n.filterPlayer(),s=0;s<l.length;s++)e.attitude(t,l[s])<0&&!l[s].isTurnedOver()&&(i=!0),e.attitude(t,l[s])>0&&l[s].isTurnedOver()&&(i=!0,o=!0);if(e.attitude(r,t)>0&&!i)return;if(o||t.hp==t.maxHp)return[.5,1];if(t.hp>1)return[1,.5]}}}},_priority:0},PSxingshang:{audio:"rexingshang",trigger:{global:["die","turnOverAfter"]},filter:function(e,a){return!0},direct:!0,forced:!0,content:function(){if(player.logSkill(event.name,trigger.player),"turnOverAfter"===event.triggername)return n.asyncDraw([player,trigger.player]),void event.finish();player.recover();var a=["视为受到过伤害"];trigger.player.countCards("he")&&a.push("获得牌"),a.push("cancel2"),player.chooseControl(a).set("prompt",e.prompt2("PSxingshang")).set("ai",function(){return 2==a.length?a[0]:e.value(trigger.player.getCards("he"))>8?a[1]:a[0]}),"cancel2"!=result.control&&("获得牌"==result.control?(event.togain=trigger.player.getCards("he"),player.gain(event.togain,trigger.player,"giveAuto","bySelf")):player.damage("nosource","unreal"))},_priority:0}},sort:u.PScharacter_wei,translate:{PScaopi:"PS曹丕",PSfangzhu:"放逐",PSfangzhu_info:"①当你受到伤害后，你可以令一名角色：1.摸一张牌并将武将牌翻面；2.失去一点体力并弃置一张牌。②翻面状态与你不同的角色，在其回合内不能对你使用牌。",PSxingshang:"行殇",PSxingshang_info:"锁定技。①当一名角色翻面后，你与其各摸一张牌。②当一名角色死亡时，你回复一点体力并选择一项：1.视为受到过一点伤害；2.获得其所有牌。"},rank:c.rare},PScaoying:{info:{sex:"female",group:"wei",hp:4,skills:["PSlingren","PSfujian"],dieAudios:[],trashBin:[]},intro:"由“九个鲨雕”设计",skills:{PSlingren:{audio:"xinfu_lingren",trigger:{global:"useCardToTargeted"},filter:(e,a)=>e.player===a&&1===a.getHistory("useCard",a=>a.targets.includes(e.target)).length,direct:!0,init:function(e,a){e.storage.PSlingren_damage||(e.storage.PSlingren_damage=[]),e.storage.PSlingren_multi||(e.storage.PSlingren_multi=[])},content(){player.logSkill("PSlingren",event.target);var r=trigger.target;if(event.target=r,event.choice={basic:!1,trick:!1,equip:!1},player.chooseButton([`凌人：是否猜测${e.translation(r)}有哪些类别的手牌`,[["basic","trick","equip"],"vcard"]],[0,3],!1).set("ai",function(e){switch(e.link[2]){case"basic":var a=.95;return r.countCards("h",{type:["basic"]})||(a=.05),r.countCards("h")||(a=0),Math.random()<a;case"trick":a=.9;return r.countCards("h",{type:["trick","delay"]})||(a=.1),r.countCards("h")||(a=0),Math.random()<a;case"equip":a=.75;return r.countCards("h",{type:["equip"]})||(a=.25),r.countCards("h")||(a=0),Math.random()<a}}),result.bool){var t=result.links.map(e=>e[2]);event.isMine()||event.isOnline()||n.delayx(),event.num=0,["basic","trick","equip"].forEach(a=>{t.includes(a)==r.countCards("h",n=>e.type2(n,r)===a)>0&&event.num++})}else event.finish();player.popup("猜对"+e.cnNumber(event.num)+"项"),n.log(player,"猜对了"+e.cnNumber(event.num)+"项");const i=event.num;if(i>=0&&player.draw(2),i>=1&&(player.addTempSkill("PSlingren_damage"),player.storage.PSlingren_damage.push(r)),i>=2&&(player.addTempSkill("PSlingren_multi",{global:"roundStart"}),player.storage.PSlingren_multi.push(r)),i>=3){const e=a.skill[event.name].getSkill(player);if(void 0!==e){const a=["lingren_xingshang","lingren_jianxiong"].randomGet();n.changeSkillAudio(e,player.name,a),player.popup(e),player.addTempSkill(e,{player:"phaseBegin"})}}},getSkill:function(n){var t,i=[];const o=[];if("guozhan"==e.mode())for(var l in t=[],a.characterPack.mode_guozhan)t.push(l);else if(r.connectMode)t=e.charactersOL();else for(var l in t=[],a.character)a.filter.characterDisabled2(l)||a.filter.characterDisabled(l)||t.push(l);for(var l of t=t.filter(e=>a.character[e][4].includes("zhu")&&"wei"===a.character[e][1]))if(0!=l.indexOf("gz_jun"))for(var s of a.character[l][3]){var u=a.skill[s];u&&!o.includes(s)&&(u.ai&&(u.ai.combo||u.ai.notemp||u.ai.neg)||n.hasSkill(s)||i.push(s))}return i.randomGet()},subSkill:{damage:{trigger:{source:"damageBegin1"},direct:!0,popup:!1,onremove:function(e,a){e.storage.PSlingren_damage=[]},filter:function(e,a){return a.storage.PSlingren_damage&&a.storage.PSlingren_damage.includes(e.player)},async content(a,n,t){const{result:{control:i}}=await t.chooseControl(["令此伤害+1","令此伤害-1","cancel2"]).set("prompt",`凌人：是否改变对${e.translation(n.player)}造成的伤害？`).set("ai",function(){const a=e.attitude(r.event.player,n.player);return 0==a?"cancel2":a>0?"令此伤害-1":"令此伤害+1"});"令此伤害+1"===i?n.num++:"令此伤害-1"===i&&n.num--}},multi:{trigger:{global:"roundStart"},forced:!0,popup:!1,onremove:function(e,a){e.storage.PSlingren_multi=[]}}}},PSfujian:{audio:"xinfu_fujian",trigger:{player:"phaseJieshuBegin"},filter:function(e,a){return n.hasPlayer(function(e){return 0!==e.countCards("h")&&e!==a})},locked:!0,async content(a,t,i){let o=(i.storage.PSlingren_multi||[]).slice(0).remove(i);const l=n.filterPlayer(e=>{return 0!==(a=e).countCards("h")&&i.storage.PSlingren_multi&&!i.storage.PSlingren_multi.includes(a)&&a!==i;var a});if(1===l.length)o.addArray(l);else if(l.length>1){const{result:{targets:a}}=await i.chooseTarget(function(e,a,n){return l.includes(n)},!0).set("ai",function(a){return e.attitude(r.event.player,a)<0?100:1});o.addArray(a)}o=o.filter(e=>e.isAlive()&&e.isIn()).sortBySeat();for(let r of o){const a=Math.abs(i.hp-r.hp)||1;var s=r.getCards("h").randomGets(a);i.line(r);var u=[e.translation(r)+"的部分手牌",s];n.log(i,"观看了",r,"的部分手牌"),await i.chooseControl("ok").set("dialog",u)}},_priority:0}},sort:u.PScharacter_wei,translate:{PScaoying:"PS曹婴",PSlingren:"凌人",PSlingren_info:"当一名角色于本回合首次成为你使用牌的目标后，你可以猜测其手牌构成，若猜对：<br>至少0项，你摸两张牌；<br>至少1项，本回合你对其造成伤害时，你可以令此伤害+1或-1；<br>至少2项，直到下一轮开始时，你发动〖伏间〗额外指定其为目标；<br>至少3项，你随机获得魏势力主公武将牌上的一个技能，直到你的回合开始。",PSfujian:"伏间",PSfujian_info:"锁定技，结束阶段开始时，你可以观看一名其他角色的随机X张手牌（X为你与其的体力之差且至少为1）。"},rank:c.epic},PSdian_huanggai:{info:{sex:"male",group:"wu",hp:4,skills:["kurou","PSshiming"],dieAudios:["huanggai"],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSshiming:{audio:"sbkurou",trigger:{player:"dying"},usable:1,forced:!0,init:function(e){n.changeSkillAudio("xinfu_qinguo",e.name,"zhaxiang"),n.changeSkillAudio("xinfu_qinguo_recover",e.name,"zhaxiang"),n.changeSkillAudio("new_repaoxiao",e.name,"sbzhaxiang"),n.changeSkillAudio("buqu",e.name,"rekurou")},derivation:["xinfu_qinguo","new_repaoxiao","buqu"],filter:function(e,a){return a.maxHp>1},content:function(){for(var e of(player.loseMaxHp(),player.recover(),a.skill.PSshiming.derivation))if(!player.hasSkill(e,null,null,!1)){player.popup(e),player.addSkills(e);break}}}},sort:u.PScharacter_wu,translate:{PSdian_huanggai:"PS经典黄盖",PSdian_huanggai_prefix:"PS经典",PSshiming:"拾命",PSshiming_info:"锁定技，每回合限一次，当你进入濒死状态时，若你的体力上限大于1，你减1点体力上限并回复一点体力，获得第一个你未拥有的技能:〖勤国〗、〖咆哮〗、〖不屈〗。"},rank:c.legend},PSliaohua:{info:{sex:"male",group:"shu",hp:5,maxHp:6,skills:["PSdangxian","PSfuli"],dieAudios:["xin_liaohua"],trashBin:[]},intro:"由“mento last”设计",skills:{PSdangxian:{audio:"dangxian_re_liaohua1",trigger:{player:"phaseBegin"},forced:!0,content:function(){trigger.phaseList.splice(trigger.num,0,"phaseDraw|xindangxian","phaseUse|xindangxian")},group:["PSdangxian_rewrite","PSdangxian_end"],subSkill:{rewrite:{trigger:{player:["phaseDrawBegin","phaseUseBegin"]},forced:!0,popup:!1,filter:function(e,a){return!0},content(){var a=e.cardPile2(function(e){return"sha"==e.name});a&&(player.gain(a,"gain2").gaintag=["PSdangxian"]),n.updateRoundNumber()},mod:{ignoredHandcard:function(e,a){if(e.hasGaintag("PSdangxian"))return!0},cardDiscardable:function(e,a,n){if("phaseDiscard"==n&&e.hasGaintag("PSdangxian"))return!1}}},end:{audio:"dangxian_re_liaohua1",trigger:{player:"phaseEnd"},forced:!0,popup:!1,filter:function(e,a){return a.countCards("h",e=>e.hasGaintag("PSdangxian"))>0},async content(a,n,r){const t=r.getCards("h",e=>e.hasGaintag("PSdangxian"));await r.discard(t),await r.loseHp(t.length);const i=e.inpileVCardList(a=>{if("trick"!=a[0])return!1;var n=a[2];return e.tag({name:n},"damage")>0&&r.hasUseTarget({name:n,isCard:!0})});if(i.length){const{result:{bool:a,links:n}}=await r.chooseButton(["当先：视为使用一张伤害类锦囊牌",[i,"vcard"]],!0).set("ai",a=>e.player().getUseValue({name:a.link[2]}));if(a){var o=n[0][2];r.chooseUseTarget({name:o,isCard:!0},!0,!1).logSkill="PSdangxian"}}}}}},PSfuli:{skillAnimation:!0,animationColor:"soil",audio:"refuli",enable:"chooseToUse",filter:function(e,a){return"dying"==e.type&&(a==e.dying&&(!(a.maxHp<=1)&&!a.hasSkill("PSfuli_used")))},async content(e,r,t){await t.loseMaxHp();const i=t.getCards("h",e=>e.hasGaintag("PSdangxian"));i.length&&await t.discard(i),await t.recoverTo(t.maxHp),t.addTempSkill("PSfuli_used","roundStart");const o=n.createEvent("chooseToAddSkill");o.player=t,o.setContent(a.skill.PSfuli.chooseToAddSkill),t.isTurnedOver()||await t.turnOver()},chooseToAddSkill(){var i;if(r.characterlist){i=[];for(var o=0;o<r.characterlist.length;o++){var l=r.characterlist[o];i.push(l)}}else i=r.connectMode?e.charactersOL(function(e){return!0}):e.gainableCharacters(function(e){return!0});var s=n.players.concat(n.dead);for(o=0;o<s.length;o++)i.remove(s[o].name),i.remove(s[o].name1),i.remove(s[o].name2);i=i.randomGets(5);var u=[];for(var o of i)u.addArray((a.character[o][3]||[]).filter(function(a){var n=e.info(a);return n&&!n.charlotte}));if(i.length&&u.length){player.isUnderControl()&&n.swapPlayerAuto(player);var c=function(i,o){var l=r.event;l._result||(l._result={}),l._result.skills=[];var s=l._result.skills,u=t.create.dialog("请选择获得一个技能",[i,"character"],"hidden");l.dialog=u;var c=document.createElement("div");c.classList.add("add-setting"),c.style.margin="0",c.style.width="100%",c.style.position="relative";for(var g=0;g<o.length;g++){var d=t.create.div(".shadowed.reduce_radius.pointerdiv.tdnode");d.link=o[g],c.appendChild(d),d.innerHTML="<span>"+e.translation(o[g])+"</span>",d.addEventListener(a.config.touchscreen?"touchend":"click",function(){if(!r.dragged&&!r.justdragged){r.tempNoButton=!0,setTimeout(function(){r.tempNoButton=!1},500);var e=this.link;if(this.classList.contains("bluebg"))this.classList.remove("bluebg"),s.remove(e);else{if(s.length>=1)return;s.add(e),this.classList.add("bluebg")}}})}u.content.appendChild(c),u.add("　　"),u.open(),l.switchToAuto=function(){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1},l.control=t.create.control("ok",function(e){l.dialog.close(),l.control.close(),n.resume(),r.imchoosing=!1});for(g=0;g<l.dialog.buttons.length;g++)l.dialog.buttons[g].classList.add("selectable");n.pause(),n.countChoose()};event.isMine()?c(i,u):event.isOnline()?(event.player.send(c,i,u),event.player.wait(),n.pause()):(r.imchoosing=!1,event._result={bool:!0,skills:u.randomGets(1)},event.dialog&&event.dialog.close(),event.control&&event.control.close());var g=event.result||result;g.skills&&g.skills.length&&(player.popup(g.skills),player.addSkills(g.skills))}else event.result={bool:!1,skills:[]}},subSkill:{used:{locked:!0,charlotte:!0}},ai:{save:!0,skillTagFilter:function(e,a,n){return e==n&&e.maxHp>1},result:{player:10},threaten:function(e,a){if(!a.storage.fuli)return.9}},_priority:0}},sort:u.PScharacter_shu,translate:{PSliaohua:"PS廖化",PSdangxian:"当先",PSdangxian_info:"锁定技，回合开始时，你执行一个额外的摸牌阶段和出牌阶段。摸牌阶段和出牌阶段开始时，你从牌堆中获得一张不计入手牌上限【杀】并记录之。结束阶段，若你有“当先”记录过的杀，弃置之并失去X点体力，然后视为使用一张伤害类锦囊牌。（X为“当先“记录过的杀的数量）",PSfuli:"伏枥",PSfuli_info:"每轮限一次，当你处于濒死状态时，你可以减一点体力上限并弃置“当先”记录过的【杀】，再将体力回复至体力上限，然后随机抽取五张武将牌并获得其中一个技能。最后若你的武将牌正面朝上，你翻面。"},rank:c.rare},PSquyi:{info:{sex:"male",group:"qun",hp:4,skills:["PSjiaozi","PSfuqi"],dieAudios:[],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSjiaozi:{audio:"jiaozi",trigger:{player:"damageBegin3",source:"damageBegin1"},forced:!0,filter:function(e,a){if(!e.source)return!1;const n=e.source===a?e.player:e.source;return a.countCards("h")>=n.countCards("h")},content:function(){trigger.num++},ai:{presha:!0},group:"PSjiaozi_else",subSkill:{else:{audio:"jiaozi",trigger:{player:["phaseBegin","phaseDiscardBegin"]},forced:!0,content(){const e=n.countPlayer(e=>e.hp<=player.hp);"phaseBegin"===event.triggername?player.draw(e):player.chooseToDiscard("he",e,!0)}}},_priority:0},PSfuqi:{audio:"fuqi",forced:!0,trigger:{player:"useCard"},filter:function(a,r){return a.card&&("trick"==e.type(a.card)||"basic"==e.type(a.card)&&!["shan","tao","jiu","du"].includes(a.card.name))&&n.hasPlayer(function(a){return a!=r&&e.distance(a,r)<=1})},content:function(){trigger.directHit.addArray(n.filterPlayer(function(a){return a!=player&&e.distance(a,player)<=1}))},ai:{directHit_ai:!0,skillTagFilter:function(a,n,r){return e.distance(r.target,a)<=1}},mod:{globalFrom:function(a,n,r){if(e.distance(n,a)<=1)return-1/0}},_priority:0}},sort:u.PScharacter_qun,translate:{PSquyi:"PS麴义",PSjiaozi:"骄恣",PSjiaozi_info:"锁定技。①当你造成或受到伤害时，若你的手牌数不小于对方，此伤害+1。②回合开始时/弃牌阶段开始时，你摸/弃置X张牌（X为场上体力值不大于你的角色数）。",PSfuqi:"伏骑",PSfuqi_info:"锁定技。①当你使用牌时，你令所有与你距离为1的其他角色不能使用或打出牌响应此牌。②你与所有与你距离为1的角色的距离视为1。"},rank:c.rare},PSmachao:{info:{sex:"male",group:"shu",hp:4,skills:["PStieji","PScema"],dieAudios:["sb_machao"],trashBin:[]},intro:"由“九个芒果”设计",replace:["PSmachao","PSqun_machao"],skills:{PStieji:{audio:"sbtieji",trigger:{player:"useCardToPlayered"},logTarget:"target",filter:function(e,a){return a!=e.target&&"sha"==e.card.name&&e.target.isIn()},check:function(a,n){return e.attitude(n,a.target)<0},content:function(){var a=trigger.target;if(event.target=a,a.hasSkill("fengyin")||a.addTempSkill("fengyin"),trigger.directHit.add(a),player.hasHistory("custom",e=>e.PStieji_target===a))event.finish();else{if(player.chooseToDuiben(a).set("title","谋弈").set("namelist",["出阵迎战","拱卫中军","直取敌营","扰阵疲敌"]).set("ai",a=>{var n=e.event().getParent().player,r=e.event().getParent().target;return r.countCards("he")||"db_def2"!=a.link[2]?!r.countCards("he")&&e.attitude(r,n)<=0&&"db_atk1"==a.link[2]?10:1+Math.random():10}).set("translationList",[`以防止${e.translation(player)}摸两张牌`,`以防止${e.translation(player)}获得你的牌`,`若成功，你获得${e.translation(a)}的一张牌`,"若成功，你摸两张牌"]),result.bool)a.addTempSkill("fengyin",{player:"phaseEnd"}),player.addTempSkill("PStieji_mark"),player.addMark("PStieji_mark",1,!1),"db_def1"==result.player?player.gainPlayerCard(a,"he",!0):player.draw(2);else{event.choice=result.player;const n="db_def1"===event.choice?"摸两张牌":`获得${e.translation(a)}的一张牌`;player.chooseBool(`是否${n}？然后你本回合对${e.translation(a)}发动〖铁骑〗时不能与其进行谋弈`).set("ai",(e,a)=>{if(!a.isPhaseUsing())return!0;const n=e.getParent("chooseToUse");return!(n&&"phaseUse"===n.getParent().name&&n.filterCard({name:"sha"},a,n)&&a.countCards("hs","sha"))&&r.event.canGain}).set("canGain","db_def1"===result.player||"db_def2"===result.player&&a.countDiscardableCards(player,"he")>0)}event.choice&&result.bool&&result.confirm&&(player.getHistory("custom").push({PStieji_target:a}),"db_def1"===event.choice?player.draw(2):player.gainPlayerCard(a,"he",!0))}},shaRelated:!0,ai:{ignoreSkill:!0,skillTagFilter:function(n,r,t){return"directHit_ai"==r?e.attitude(n,t.target)<=0:!(!t||t.isLink||!t.card||"sha"!=t.card.name)&&(!(!t.target||e.attitude(n,t.target)>=0)&&(!(!t.skill||!a.skill[t.skill]||a.skill[t.skill].charlotte||e.is.locked(t.skill)||!t.target.getSkills(!0,!1).includes(t.skill))&&void 0))},directHit_ai:!0},subSkill:{true1:{audio:!0,sub:!0,_priority:0},true2:{audio:!0,sub:!0,_priority:0},false:{audio:!0,sub:!0,_priority:0},mark:{mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+a.countMark("PStieji_mark")}},charlotte:!0,onremove:!0,_priority:0}},audioname2:{PSshengui:"retieji_boss_lvbu3"},_priority:0},PScema:{mod:{globalFrom:function(e,a,n){return n-1}},enable:["chooseToRespond","chooseToUse"],filterCard:function(a,n){return"equip3"==e.subtype(a)||"equip4"==e.subtype(a)||"equip6"==e.subtype(a)},position:"hes",viewAs:{name:"sha"},shaRelated:!0,locked:!0,viewAsFilter(a){if(!a.countCards("hes",a=>"equip3"==e.subtype(a)||"equip4"==e.subtype(a)||"equip6"==e.subtype(a)))return!1},prompt:"将一张坐骑牌当杀使用或打出",check:function(a){const n=e.value(a);return"chooseToRespond"==r.event.name?1/Math.max(.1,n):5-n},precontent(){player.when("useCard1").assign({firstDo:!0}).filter(e=>"PScema"===e.skill&&"sha"===e.card.name).then(()=>{trigger.baseDamage=2})},ai:{skillTagFilter(a){if(!a.countCards("hes",a=>"equip3"==e.subtype(a)||"equip4"==e.subtype(a)||"equip6"==e.subtype(a)))return!1},respondSha:!0,yingbian:function(r,t,i,o){if(e.attitude(o,t)<=0)return 0;var l=0,s=!1;return e.cardtag(r,"yingbian_hit")&&(s=!0,i.some(a=>a.mayHaveShan(o,"use",a.getCards("h",e=>e.hasGaintag("sha_notshan")))&&e.attitude(o,a)<0&&e.damageEffect(a,t,o,e.natureList(r))>0)&&(l+=5)),e.cardtag(r,"yingbian_add")&&n.hasPlayer(function(n){return!i.includes(n)&&a.filter.targetEnabled2(r,t,n)&&e.effect(n,r,t,t)>0})&&(l+=5),e.cardtag(r,"yingbian_damage")&&i.some(a=>e.attitude(t,a)<0&&(s||!a.mayHaveShan(o,"use",a.getCards("h",e=>e.hasGaintag("sha_notshan")))||t.hasSkillTag("directHit_ai",!0,{target:a,card:r},!0))&&!a.hasSkillTag("filterDamage",null,{player:t,card:r,jiu:!0}))&&(l+=5),l},canLink:function(e,a,n){return!(!a.isLinked()&&!e.hasSkill("wutiesuolian_skill"))&&!(e.hasSkill("jueqing")||e.hasSkill("gangzhi")||a.hasSkill("gangzhi"))},basic:{useful:[5,3,1],value:[5,3,1]},order:function(r,t){return t.hasSkillTag("presha",!0,null,!0)?10:"object"==typeof r&&n.hasNature(r,"linked")?n.hasPlayer(function(n){return n!=t&&a.card.sha.ai.canLink(t,n,r)&&t.canUse(r,n,null,!0)&&e.effect(n,r,t,t)>0})&&n.countPlayer(function(a){return a.isLinked()&&e.damageEffect(a,t,t,e.nature(r))>0})>1?3.1:3:3.05},result:{target:function(a,n,t,i){let o=-1.5,l=1.35,s=1;if(i){let a=r.event.getTempCache("sha_result","eff");return"object"!=typeof a||a.card!==e.translation(t)?o:a.odds<1.35&&a.bool?1.35*a.eff:a.odds*a.eff}return(a.hasSkill("jiu")||a.hasSkillTag("damageBonus",!0,{target:n,card:t}))&&(n.hasSkillTag("filterDamage",null,{player:a,card:t,jiu:!0})?o=-.5:(s=2,o=e.attitude(a,n)>0?-7:-4)),a.hasSkillTag("directHit_ai",!0,{target:n,card:t},!0)||(l-=.7*n.mayHaveShan(a,"use",n.getCards("h",e=>e.hasGaintag("sha_notshan")),"odds")),r.event.putTempCache("sha_result","eff",{bool:n.hp>s&&e.attitude(a,n)>0,card:e.translation(t),eff:o,odds:l}),l*o}},tag:{respond:1,respondShan:1,damage:function(e){if(!n.hasNature(e,"poison"))return 2},natureDamage:function(e){if(n.hasNature(e,"linked"))return 2},fireDamage:function(e,a){if(n.hasNature(e,"fire"))return 2},thunderDamage:function(e,a){if(n.hasNature(e,"thunder"))return 2},poisonDamage:function(e,a){if(n.hasNature(e,"poison"))return 2}}},_priority:0}},sort:u.PScharacter_shu,translate:{PSmachao:"PS马超",PStieji:"铁骑",PStieji_info:"当你使用【杀】指定其他角色为目标后，你可以令目标角色不能响应此【杀】，且其非锁定技失效直到回合结束。然后你与其进行谋弈。<br>若你赢，你本回合使用的【杀】次数上限+1，且其非锁定技失效的效果延续至其回合结束。然后你选择的选项为:“直取敌营”，则你获得其一张牌:“扰阵疲敌”，你摸两张牌。<br>若你没赢，你可以执行你选择的另一项，若如此做，你本回合对其发动此技能时不能与其进行谋弈。",PScema:"策马",PScema_info:"锁定技，你计算与其他角色的距离时-1，你可以将一张坐骑牌当作伤害基数为2的【杀】使用或打出。"},rank:c.epic},PSqun_machao:{info:{sex:"male",group:"qun",hp:4,skills:["PSzhuiming","PSjinge"],dieAudios:["sp_machao"],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSzhuiming:{audio:"ol_shichou",trigger:{player:"useCardToPlayer"},shaRelated:!0,filter:function(a,n){return"sha"==a.card.name&&1===e.distance(n,a.target)},check:function(a,n){return e.attitude(n,a.target)<=0},content(){const a=trigger.target;event.target=a;var n=["选项一"],t=[`令${e.translation(trigger.card)}无视你的防具、对你造成伤害+1，且你不能响应`,`你获得${e.translation(trigger.cards)}，然后${e.translation(player)}获得你两张牌`];if(a.countGainableCards(player,"he")?n.push("选项二"):t[1]='<span style="opacity:0.5; ">'+t[1]+"</span>",1===n.length?event._result={control:"选项一",index:0}:a.chooseControl(n).set("prompt","追命：请选择一项").set("choiceList",t).set("ai",()=>{const a=r.event.targetx,n=r.event.playerx;return a.hasSkillTag("maixie")&&a.hp>2||e.damageEffect(a,n,a)>=0?0:1}).set("targetx",a).set("playerx",player),result.control)switch(result.index){case 0:player.markAuto("PSzhuiming",event.target),player.when("useCardToPlayered").then(()=>{delete player.storage.PSzhuiming}),trigger.getParent().directHit.add(event.target);var i=event.target.playerid,o=trigger.getParent().customArgs;o[i]||(o[i]={}),"number"!=typeof o[i].extraDamage&&(o[i].extraDamage=0),o[i].extraDamage++;break;case 1:trigger.cards.length&&["o","d"].includes(e.position(trigger.cards[0]))&&event.target.gain(trigger.cards,"gain2"),player.gainPlayerCard(event.target,"he",2,!0)}},ai:{unequip:!0,skillTagFilter:function(e,a,n){if("unequip"==a&&n&&n.card&&"sha"===n.card.name&&n.target&&e.storage.PSzhuiming&&e.storage.PSzhuiming.includes(n.target))return!1}}},PSjinge:{mod:{globalFrom:function(e,a,n){return n-2},cardname:function(a,n,r){if(2===e.cardNameLength({name:a.name}))return"sha"},cardUsable:function(a,n,r){if(a.cards&&1===a.cards.length&&"sha"===e.name(a)&&2===e.cardNameLength({name:a.cards[0].name}))return 1/0}},trigger:{player:"useCard1"},forced:!0,silent:!0,charlotte:!0,filter:function(a,n){return!(!a.card.cards||1!==a.card.cards.length||!1===a.addCount)&&("sha"===e.name(a.card)&&2===e.cardNameLength(a.card.cards[0]))},content:function(){trigger.addCount=!1,player.stat[player.stat.length-1].card.sha>0&&player.stat[player.stat.length-1].card.sha--},popup:!1,sub:!0,_priority:1}},sort:u.PScharacter_qun,translate:{PSqun_machao:"PS群马超",PSzhuiming:"追命",PSzhuiming_info:"当你使用【杀】指定距离为1的目标时，你可以令目标角色选择一项：1.此【杀】令其防具无效、不可响应且对其造成伤害+1；2.其获得此【杀】对应的实体牌，然后你获得其两张牌。",PSjinge:"金戈",PSjinge_info:"锁定技，你计算与其他角色的距离时-2。你的牌名数为2的牌均视为不计入次数且无次数限制【杀】。"},rank:c.rare},PSluji:{info:{sex:"male",group:"wu",hp:3,skills:["PShuaiju","nzry_yili","PSzhenglun"],clans:["吴郡陆氏"],dieAudios:[],trashBin:[]},intro:"由“九个鲨雕”设计",skills:{PShuaiju:{marktext:"橘",intro:{name:"怀橘",name2:"橘",content:"当前有#个“橘”"},onremove:function(){n.players.forEach(e=>{e.hasMark("nzry_huaiju")&&e.removeMark("nzry_huaiju",e.countMark("nzry_huaiju"))})},audio:"nzry_huaiju",trigger:{global:"phaseBefore",player:"enterGame"},forced:!0,filter:function(e,a){return"phase"!=e.name||0==n.phaseNumber},content:function(){player.addMark("nzry_huaiju",3),player.addSkill("PShuaiju_ai")},group:["PShuaiju_effect"],subSkill:{effect:{audio:"nzry_huaiju",trigger:{global:["damageBegin4","drawBegin"]},forced:!0,filter:function(e,a){return e.player.hasMark("nzry_huaiju")},content:function(){player.line(trigger.player,"green"),"damage"==trigger.name?(trigger.cancel(),trigger.player.removeMark("nzry_huaiju",1)):trigger.num+=trigger.player.countMark("nzry_huaiju")},_priority:0},ai:{charlotte:!0,ai:{filterDamage:!0,skillTagFilter:function(e,a,r){return!!e.hasMark("nzry_huaiju")&&(!!n.hasPlayer(function(e){return e.hasSkill("PShuaiju_effect")})&&(!(r&&r.player&&r.player.hasSkillTag("jueqing",!1,e))&&void 0))}},_priority:0}},_priority:0},PSzhenglun:{audio:"nzry_zhenglun",trigger:{player:"phaseDrawBefore"},filter:function(e,a){return!0},check:function(e,a){return a.countCards("h")>=2||a.skipList.includes("phaseUse")},content:function(){trigger.cancel(),player.addMark("nzry_huaiju",1)},ai:{combo:"PShuaiju"},_priority:0}},sort:u.PScharacter_wu,translate:{PSluji:"PS陆绩",PShuaiju:"怀橘",PShuaiju_info:"锁定技，游戏开始时，你获得3个“橘”标记。（有“橘”的角色受到伤害时，防止此伤害，然后移去一个“橘”；有“橘”的角色摸牌时额外摸其拥有的“橘”标记数张牌）",PSzhenglun:"整论",PSzhenglun_info:"你可以跳过摸牌阶段然后获得一个“橘”。"},rank:c.epic},PSluxun:{info:{sex:"male",group:"wu",hp:3,skills:["PSqianxun","PSlianying"],clans:["吴郡陆氏"],dieAudios:[],trashBin:[]},intro:"由“希霞”设计",replace:["PSluxun","PSreluxun"],skills:{PSqianxun:{mod:{targetEnabled:function(a,n,r,t){if("shunshou"==a.name||"delay"===e.type(a)||"guohe"==a.name)return!1}},audio:2,_priority:0},PSlianying:{audio:"lianying",trigger:{player:["useCard","respond"]},frequent:!0,getSuitsLength:function(n){const r=[];for(let t=0;t<n.getCards().length;t++){const i=e.suit(n.getCards()[t],n);if(a.suit.includes(i)&&!r.includes(i)&&(r.add(i),a.suit.length===r.length))break}return r.length},filter:function(e,n){return 4-a.skill.PSlianying.getSuitsLength(n)>0},content:function(){player.draw(4-a.skill.PSlianying.getSuitsLength(player))}}},sort:u.PScharacter_wu,translate:{PSluxun:"PS陆逊",PSqianxun:"谦逊",PSqianxun_info:"锁定技，你不能成为【过河拆桥】、【顺手牵羊】和延时锦囊牌的目标。",PSlianying:"连营",PSlianying_info:"当你使用或打出牌时，你可以摸X张牌（X为4-你的手牌花色数）。"},rank:c.rare},PSlvbu:{info:{sex:"male",group:"qun",hp:5,skills:["PSwushuang","PSbaifu","PSpanshi"],dieAudios:[],trashBin:[]},skills:{PSwushuang:{audio:"wushuang",locked:!0,derivation:"wushuangfangtianji",group:["PSwushuang_wushuangfangtianji","wushuang1","wushuang2"],subSkill:{wushuangfangtianji:{nobracket:!0,equipSkill:!0,trigger:{source:"damageSource"},filter:function(e,n){return!(!n.hasEmptySlot(1)||!a.card.wushuangfangtianji)&&a.skill.wushuangfangtianji_skill.filter(e,n)},direct:!0,locked:!1,content:function(){var n=["摸一张牌"];if((t=trigger.player).hasCard(function(e){return a.filter.canBeDiscarded(e,player,t)},"he")&&n.push("弃置"+e.translation(t)+"的一张牌"),player.chooseControl("cancel2").set("choiceList",n).set("prompt",e.prompt("wushuangfangtianji_skill")).set("ai",function(){var n=r.event.player,t=r.event.getTrigger().player;return t.hasCard(function(e){return a.filter.canBeDiscarded(e,n,t)},"he")&&e.effect(t,{name:"guohe_copy2"},n,n)>e.effect(n,{name:"draw"},n,n)?1:0}),"cancel2"!=result.control)if(0==result.index)player.logSkill("wushuangfangtianji_skill"),player.draw();else{var t=trigger.player;player.logSkill("wushuangfangtianji_skill",t),player.discardPlayerCard(t,"he",!0)}},mod:{attackRange:function(e,n){if(a.card.wushuangfangtianji&&e.hasEmptySlot(1))return n-a.card.wushuangfangtianji.distance.attackFrom}},sub:!0,_priority:-25}},_priority:0},PSbaifu:{audio:"ext:PS武将/audio/skill:2",trigger:{source:"damageBegin1"},logTarget:"player",log:!1,check:function(a,r){const t=n.findPlayer(e=>e.storage.PSbaifu_yifu&&e.storage.PSbaifu_yifu.includes(r));return!(t&&e.attitude(r,t)>0)},filter:function(e,a){return e.player!==a&&(!e.player.storage.PSbaifu_yifu||!e.player.storage.PSbaifu_yifu.includes(a))},async content(e,a,r){const t=n.filterPlayer(e=>e.storage.PSbaifu_yifu&&e.storage.PSbaifu_yifu.includes(r));if(t.length)for(let n=0;n<t.length;n++)await t[n].damage("nocard"),t[n].storage.PSbaifu_yifu.remove(r),t[n].markAuto("PSbaifu_yifu");a.player.hasSkill("PSbaifu_yifu")||a.player.addSkill("PSbaifu_yifu"),a.player.storage.PSbaifu_yifu.add(r),a.player.markAuto("PSbaifu_yifu"),r.gainPlayerCard(a.player,"he",!0),n.playAudio("..","extension","PS武将/audio/skill",["PSbaifu1","PSbaifu2"].randomGet()),a.cancel()},subSkill:{yifu:{intro:{content:function(a,n){return n.storage.PSbaifu_yifu.reduce((a,n)=>a+`我儿${e.translation(n)}天下无双！<br>`,"")},markcount:function(e,a){return e.length}},onremove:!0,init:function(e,a){e.storage[a]||(e.storage[a]=[])}}},_priority:0},PSpanshi:{audio:"ext:PS武将/audio/skill:2",trigger:{source:"damageBegin1",global:"useCardBefore"},direct:!0,forced:!0,filter:function(a,n,r){return!(!a.player.storage.PSbaifu_yifu||!a.player.storage.PSbaifu_yifu.includes(n))&&("damageBegin1"===r||!a.player.hasHistory("custom",e=>e.PSpanshi_use)&&(!(!a.targets||1===a.targets.length&&a.targets[0]===n)&&(!a.player.hasHistory("useCard",a=>e.tag(a.card,"damage")>0)&&e.tag(a.card,"damage")>0)))},logTarget:(e,a)=>"damage"===e.name?e.player:a,content:function(){"damageBegin1"===event.triggername?(trigger.num++,player.when({source:"dieBegin"}).filter((e,a)=>e.player.storage.PSbaifu_yifu&&e.player.storage.PSbaifu_yifu.includes(a)).then(()=>{n.playAudio("..","extension","PS武将/audio/die",["PSpanshi_kill1","PSpanshi_kill2"].randomGet())}),n.playAudio("..","extension","PS武将/audio/skill",["PSpanshi1","PSpanshi2"].randomGet())):(trigger.player.getHistory("custom").push({PSpanshi_use:!0}),trigger.targets.remove(player),trigger.targets.every(e=>player.canUse(trigger.card,e,!0,!0))&&(trigger.player=player,n.playAudio("..","extension","PS武将/audio/skill",["PSpanshi_use1","PSpanshi_use2"].randomGet()),trigger.noai=!0,n.delay(.5)))}}},sort:u.PScharacter_qun,translate:{PSlvbu:"PS吕布",PSwushuang:"无双",PSwushuang_info:"锁定技。①若你有空置的武器栏，则视为你装备【无双方天戟】。②当你使用【杀】或【决斗】指定目标后，你令此牌需要依次使用或打出两张【闪】或【杀】响应。",PSbaifu:"拜父",PSbaifu_info:"当你对一名其他角色A造成伤害时，若其不是“义父”，你可以防止此伤害。若如此做，你对场上的“义父”B造成一点伤害并移去B的“义父”标记，然后你获得A的一张牌并令A获得“义父”标记。",PSpanshi:"叛弑",PSpanshi_info:"锁定技。①当“义父”于一回合内首次使用伤害类牌前，若你不是此牌的唯一目标，此牌的目标排除你。然后若你满足使用此牌的合法性，你成为此牌的使用者。②当你对“义父”造成伤害时，此伤害+1。","#ext:PS武将/audio/skill/PSpanshi_use1":"赴汤蹈火，在所不辞。","#ext:PS武将/audio/skill/PSpanshi_use2":"相助义父，共图大业。","#ext:PS武将/audio/skill/PSpanshi1":"老贼，我与你势不两立！","#ext:PS武将/audio/skill/PSpanshi2":"我堂堂大丈夫，安肯为汝之义子！","#ext:PS武将/audio/skill/PSpanshi_kill1":"奉先我儿，为何如此啊！","#ext:PS武将/audio/skill/PSpanshi_kill2":"奉先，何故变心？"},rank:c.rare},PSshen_zuoci:{info:{sex:"male",group:"shen",hp:3,skills:["PSshen_huashen","PSshen_jihun","PSshen_xinsheng"],dieAudios:["ext:PS武将/audio/die:true"],trashBin:[]},intro:"由“九个夜白”设计",substitute:[],skills:{PSshen_huashen:{unique:!0,audio:"ext:PS武将/audio/skill:2",trigger:{global:"phaseBefore",player:["enterGame","phaseAfter","PSshen_huashen"]},filter:function(e,a,r){return!a.storage.PSshen_huashen.invalid&&("phase"!==e.name||("phaseBefore"==r?0==n.phaseNumber||e.player===a:a.storage.PSshen_huashen&&a.storage.PSshen_huashen.character.length>0))},direct:!0,content:function(){var i=event.triggername;("phase"!=trigger.name||"phaseBefore"==i&&0==n.phaseNumber)&&(player.logSkill("PSshen_huashen"),a.skill.PSshen_huashen.addHuashens(player,2),event.logged=!0),r.noclearcountdown=!0,event.videoId=a.status.videoId++;var o=player.storage.PSshen_huashen.character.slice(0);player.isOnline2()&&player.send(function(e,n){t.create.dialog('###是否发动【化身】？###<div class="text center">选择一张“魂”作为你的表象武将</div>',[e,(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]).videoId=n},o,event.videoId),event.dialog=t.create.dialog('###是否发动【化身】？###<div class="text center">选择一张“魂”作为你的表象武将</div>',[o,(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]),event.dialog.videoId=event.videoId,event.isMine()||(event.dialog.style.display="none"),event.logged||(player.logSkill("PSshen_huashen"),event.logged=!0);var l=player.chooseButton(!1).set("dialog",event.videoId);if(l.set("filterButton",function(e){return e.link!=r.event.current}),l.set("current",player.storage.PSshen_huashen.current),l.set("ai",function(e){const n=a.rank.rarity;return n.legend.includes(e.link)?4:n.epic.includes(e.link)?3:n.rare.includes(e.link)?2:1}),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose(),result.bool){event.card=result.links[0];const r=player.storage.PSshen_huashen.current;player.storage.PSshen_huashen.current=event.card,"PSshen_zuoci"===player.name2?player.name2:player.name,player.changeSkin("PSshen_huashen",event.card),n.broadcastAll(function(e,n,r){e.tempname.remove(r),e.tempname.add(n),e.sex=a.character[event.card][0]},player,event.card,r),n.log(player,"将性别变为了","#y"+e.translation(a.character[event.card][0])+"性"),player.changeGroup(a.character[event.card][1]),n.log(player,"将","#y"+e.translation(event.card),"作为了表象武将");const t=e.character(event.card,3).filter(function(n){return!e.skillCategoriesOf(n).some(e=>a.skill.PSshen_huashen.bannedType.includes(e))});t.length?(player.storage.PSshen_huashen.current2,player.storage.PSshen_huashen.current2=t,player.addAdditionalSkills("PSshen_huashen",t),player.syncStorage("PSshen_huashen"),player.updateMarks("PSshen_huashen")):player.removeAdditionalSkill("PSshen_huashen")}},group:"PSshen_huashen_use",subSkill:{use:{audio:"PSshen_huashen",enable:"chooseToUse",filter:function(n,r){if(!r.storage.PSshen_huashen.invalid||!r.storage.PSshen_huashen.character.length)return!1;for(var t of a.inpile){var i=e.type2(t);if(("basic"==i||"trick"==i)&&!r.hasHistory("custom",e=>e.PSshen_huashen_use&&e.card&&e.card.name===t)&&n.filterCard(e.autoViewAs({name:t},"unsure"),r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){const t=function(a){return!r.hasHistory("custom",n=>n.PSshen_huashen_use&&n.card&&e.name(n.card)===a)};var l=a.inpile[o];if("sha"==l)for(var s of(n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)&&t(l)&&i.push(["基本","","sha"]),a.inpile_nature))n.filterCard(e.autoViewAs({name:l,nature:s},"unsure"),r,n)&&i.push(["基本","","sha",s]);else"trick"==e.type(l)&&t(l)&&n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)?i.push(["锦囊","",l]):"basic"==e.type(l)&&t(l)&&n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)&&i.push(["基本","",l])}return t.create.dialog("化身",[i,"vcard"])},check:function(e){if("phase"!=r.event.getParent().type)return 1;var a=r.event.player;return["wugu","zhulu_card","yiyi","lulitongxin","lianjunshengyan","diaohulishan"].includes(e.link[2])?0:a.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(e,r){return{filterCard:()=>!1,selectCard:-1,audio:"PSshen_huashen",popname:!0,viewAs:{name:e[0][2],nature:e[0][3],isCard:!0},onuse:function(e,r){const t=n.createEvent("chooseHuashenCharacter");t.player=r,t.links=e,t.setContent(a.skill.PSshen_huashen_use.chooseHuashenCharacter)}}},prompt:function(a,n){return"将一张牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},chooseHuashenCharacter:function(){event.links,r.noclearcountdown=!0,event.videoId=a.status.videoId++;var i=player.storage.PSshen_huashen.character.slice(0);if(player.isOnline2()&&player.send(function(e,n){t.create.dialog('###是否发动【化身】？###<div class="text center">选择展示一张武将牌上的“魂”并将其置入剩余武将牌堆</div>',[e,(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]).videoId=n},i,event.videoId),event.dialog=t.create.dialog('###是否发动【化身】？###<div class="text center">选择展示一张武将牌上的“魂”并将其置入剩余武将牌堆</div>',[i,(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]),event.dialog.videoId=event.videoId,event.isMine()||(event.dialog.style.display="none"),player.chooseButton(!0).set("dialog",event.videoId).set("ai",function(e){return 1}),player.isOnline2()&&player.send("closeDialog",event.videoId),event.dialog.close(),delete r.noclearcountdown,r.noclearcountdown||n.stopCountChoose(),result.bool){player.getHistory("custom").push({card:event.links.card,PSshen_huashen_use:!0});const r="huashen_card_"+result.links[0];a.card[r]={fullimage:!0,image:"character:"+result.links[0]},a.translate[r]=e.rawName2(result.links[0]),player.showCards(n.createCard(r,"","")),a.skill.PSshen_huashen.removeHuashen(player,result.links.slice(0)),player.syncStorage("PSshen_huashen"),player.updateMarks("PSshen_huashen")}},hiddenCard:function(n,r){if(!a.inpile.includes(r))return!1;var t=e.type2(r);return("basic"==t||"trick"==t)&&n.storage.PSshen_huashen.character.length&&n.storage.PSshen_huashen.invalid},ai:{combo:"PSshen_jihun",fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(e){if(!e.storage.PSshen_huashen.character.length||!e.storage.PSshen_huashen.invalid)return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},_priority:0}},init:function(a,r){a.storage[r]||(a.storage[r]={character:[],map:{}}),a.flashAvatar=()=>{},a.setAvatar=()=>{},a.setAvatarQueue=()=>{},a.setBackgroundImage=()=>{},a.when("dieBegin").then(()=>{const r=a.name?a.name:a.name1;if(r){const t=e.character(r,0),i=e.character(r,1);a.sex!=t&&(n.broadcastAll((e,a)=>{e.sex=a},a,t),a.changeSkin("PSshen_huashen","PSshen_zuoci"),n.log(a,"将性别变为了","#y"+e.translation(t)+"性")),a.group!=i&&a.changeGroup(i)}})},banned:["lisu","sp_xiahoudun","xushao","jsrg_xushao","zhoutai","old_zhoutai","shixie","xin_zhoutai","dc_shixie","old_shixie"],bannedType:["主公技","隐匿技"],addHuashen:function(n){if(n.storage.PSshen_huashen){r.characterlist||a.skill.pingjian.initList(),r.characterlist.randomSort();for(let t=0;t<r.characterlist.length;t++){let i=r.characterlist[t];if(-1!=i.indexOf("zuoci")||0==i.indexOf("key_")||0==i.indexOf("sp_key_")||a.skill.PSshen_huashen.banned.includes(i)||n.storage.PSshen_huashen.character.includes(i))continue;let o=a.character[i][3].filter(n=>!e.skillCategoriesOf(n).some(e=>a.skill.PSshen_huashen.bannedType.includes(e)));if(o.length)return n.storage.PSshen_huashen.character.push(i),n.storage.PSshen_huashen.map[i]=o,r.characterlist.remove(i),i}}},addHuashens:function(r,t){for(var i=[],o=0;o<t;o++){var l=a.skill.PSshen_huashen.addHuashen(r);l&&i.push(l)}i.length&&(r.syncStorage("PSshen_huashen"),r.updateMarks("PSshen_huashen"),n.log(r,"获得了",e.cnNumber(i.length)+"张","#g魂"),a.skill.PSshen_huashen.drawCharacter(r,i))},removeHuashen:function(a,t){a.storage.PSshen_huashen.character.removeArray(t),r.characterlist.addArray(t),n.log(a,"移去了",e.cnNumber(t.length)+"张","#g魂")},drawCharacter:function(r,t){n.broadcastAll(function(r,t){if(r.isUnderControl(!0)){for(var i=[],o=0;o<t.length;o++){var l="huashen_card_"+t[o];a.card[l]={fullimage:!0,image:"character:"+t[o]},a.translate[l]=e.rawName2(t[o]),i.push(n.createCard(l,"",""))}r.$draw(i,"nobroadcast")}},r,t)},$createButton:function(n,r,i,o,l){l=t.create.buttonPresets.character(n,"character",i,o);const s=a.character[n],u=s[3].filter(function(n){return!e.skillCategoriesOf(n).some(e=>a.skill.PSshen_huashen.bannedType.includes(e))});if(u.length){const n=u.map(a=>`[${e.translation(a)}]`).join("<br>"),r=t.create.caption(`<div class="text" data-nature=${e.groupnature(s[1],"raw")}m style="font-family: ${a.config.name_font||"xinwei"},xinwei">${n}</div>`,l);r.style.left="2px",r.style.bottom="2px"}return l._customintro=function(n,r){const t=l.link,i=e.character(l.link);let o=e.translation(t);if(i){let a;o+=`&nbsp;&nbsp;${e.translation(i[0])}`;const n=e.is.double(t,!0);a=n?n.map(a=>e.translation(a)).join("/"):e.translation(i[1]),o+=`&nbsp;&nbsp;${a}`}n.add(o),a.characterTitle[l.link]&&n.addText(e.colorspan(a.characterTitle[l.link]));for(let l=0;l<u.length;l++)if(a.translate[u[l]+"_info"]){let r=a.translate[u[l]+"_ab"]||e.translation(u[l]).slice(0,2);a.skill[u[l]]&&a.skill[u[l]].nobracket?n.add('<div><div class="skilln">'+e.translation(u[l])+"</div><div>"+e.skillInfoTranslation(u[l])+"</div></div>"):n.add('<div><div class="skill">【'+r+"】</div><div>"+e.skillInfoTranslation(u[l])+"</div></div>"),a.translate[u[l]+"_append"]&&(n._place_text=n.add('<div class="text">'+a.translate[u[l]+"_append"]+"</div>"))}},l},mark:!0,intro:{onunmark:function(e,a){r.characterlist.addArray(e.character),e.character=[]},mark:function(n,r,t){if(r&&r.current&&n.addSmall([[r.current],(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]),r&&r.current2)for(var i=0;i<r.current2.length;i++)n.add('<div><div class="skill">【'+e.translation(a.translate[r.current2[i]+"_ab"]||e.translation(r.current2[i]).slice(0,2))+"】</div><div>"+e.skillInfoTranslation(r.current2[i],t)+"</div></div>");if(!r||!r.character.length)return"没有化身";t.isUnderControl(!0)?n.addSmall([r.character,(e,n,r,t,i)=>a.skill.PSshen_huashen.$createButton(e,n,r,t,i)]):n.addText("共有"+e.cnNumber(r.character.length)+"张“化身”")},content:function(a,n){return"共有"+e.cnNumber(a.character.length)+"张“化身”"},markcount:function(e,a){return e&&e.character?e.character.length:0}},_priority:0},PSshen_jihun:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"damageEnd",global:"dyingAfter"},frequent:!0,filter:function(e,a,n){return!!a.hasSkill("PSshen_huashen")&&("dyingAfter"===n?e.player!==a&&e.player.isAlive()&&!a.storage.PSshen_huashen.dyingAfter:!a.storage.PSshen_huashen.damage)},content:function(){a.skill.PSshen_huashen.addHuashens(player,1)}},PSshen_xinsheng:{audio:"ext:PS武将/audio/skill:2",trigger:{player:"dieBefore"},forced:!0,filter:function(e,a){if(a.maxHp<=0)return!1;const n=a.storage&&a.storage.PSshen_huashen;return!!n&&(!n.invalid||!n.damage||!n.dyingAfter)},async content(a,r,t){const i=[],o=["将表象角色置入剩余武将牌堆，并变为本体武将","删去〖汲魂〗第一个获得“魂”的途径（当你受到伤害后）","删去〖汲魂〗第二个获得“魂”的途径（其他角色脱离濒死后）"],l=t.storage.PSshen_huashen;let s;switch(!l.invalid&&l.current?i.push("选项一"):o[0]='<span style="opacity:0.5; ">'+o[0]+"</span>",l.damage?o[1]='<span style="opacity:0.5; ">'+o[1]+"</span>":i.push("选项二"),l.dyingAfter?o[2]='<span style="opacity:0.5; ">'+o[2]+"</span>":i.push("选项三"),1===i.length?s=i[0]:i.length>1&&({control:s}=await t.chooseControl(i).set("prompt","新生：请选择一项").set("choiceList",o).set("ai",()=>i.length-1).forResult()),s){case"选项一":t.storage.PSshen_huashen.invalid=!0;const a=t.name?t.name:t.name1;if(a){const r=e.character(a,0),i=e.character(a,1);t.sex!=r&&(n.broadcastAll((e,a)=>{e.sex=a},t,r),n.log(t,"将性别变为了","#y"+e.translation(r)+"性")),t.group!=i&&await t.changeGroup(i)}t.changeSkin("PSshen_huashen","PSshen_zuoci"),t.additionalSkills.PSshen_huashen&&t.additionalSkills.PSshen_huashen.length&&await t.removeAdditionalSkills("PSshen_huashen"),n.log(t,"移去了表象武将","#y"+e.translation(t.storage.PSshen_huashen.current)),delete t.storage.PSshen_huashen.current,delete t.storage.PSshen_huashen.current2;break;case"选项二":t.storage.PSshen_huashen.damage=!0;break;case"选项三":t.storage.PSshen_huashen.dyingAfter=!0}await t.recoverTo(!l.disable+!l.damage+!l.dyingAfter+1),r.cancel()}}},sort:u.PScharacter_shen,translate:{PSshen_zuoci:"PS神左慈",PSshen_huashen:"化身",PSshen_huashen_info:"游戏开始时，你将剩余武将牌堆的两张牌置于武将牌上，称为“魂”，然后你可将一张“魂”作为你的表象武将展示；若表象角色未阵亡，则回合开始前或回合结束后，你可以用一张其他“魂”替换表象角色；若表象角色已阵亡，你可以展示一张武将牌上的“魂”并将其置入剩余武将牌堆，视为使用一张本回合内未以此法使用过的基本牌或普通锦囊牌。",PSshen_jihun:"汲魂",PSshen_jihun_info:"当[你受到伤害后]，或[其他角色脱离濒死状态后]，你可以将剩余武将牌堆的一张牌置于武将牌上，称为“魂”",PSshen_xinsheng:"新生",PSshen_xinsheng_info:"锁定技，当你即将阵亡时，你须选择一项：①将表象角色置入剩余武将牌堆，并变为本体武将；②删去〖汲魂〗第一个获得“魂”的途径；③删去〖汲魂〗第二个获得“魂”的途径。然后终止阵亡结算并回复体力至剩余选项数+1。","#ext:PS武将/audio/skill/PSshen_huashen1":"性本如空，化身万千。","#ext:PS武将/audio/skill/PSshen_huashen2":"一念思量，化身无数。","#ext:PS武将/audio/skill/PSshen_jihun1":"人死其魂，复归于气，汲其气修吾身。","#ext:PS武将/audio/skill/PSshen_jihun2":"人有三魂，汲命魂，则敌休命。","#ext:PS武将/audio/skill/PSshen_xinsheng1":"新生之犊，无求其故。","#ext:PS武将/audio/skill/PSshen_xinsheng2":"醍醐灌顶，如临新生。","#ext:PS武将/audio/die/PSshen_zuoci:die":"道家不入轮回。"},dynamicTranslate:{PSshen_jihun:function(e){let a="你受到伤害后",n="其他角色脱离濒死状态后";return e.storage.PSshen_huashen?.damage&&(a=`<del>${a}</del>`),e.storage.PSshen_huashen?.dyingAfter&&(n=`<del>${n}</del>`),`当[${a}]，或[${n}]，你可以将剩余武将牌堆的一张牌置于武将牌上，称为“魂”。`}},rank:c.epic},PSreyuanshu:{info:{sex:"male",group:"qun",hp:4,skills:["PSshelian","PSjixi"],dieAudios:["re_yuanshu"],trashBin:[]},intro:"由“九个陈皮”设计",skills:{PSshelian:{audio:"xinyongsi",enable:"phaseUse",usable:1,filterCard:!0,selectCard:[1,1/0],discard:!1,lose:!1,delay:!1,position:"h",complexCard:!0,check:function(a){var n=r.event.player;if(4===s(t.selected.cards,n))return 0;for(var i=0;i<t.selected.cards.length;i++)if(e.suit(a)==e.suit(t.selected.cards[i]))return 0;return 1},filter:function(e,a){return a.countCards("h")>0},content(){player.showCards(cards,e.translation(player)+"展示了部分手牌");const a=Array.from({length:8},(e,a)=>(a+1).toString()),n=s(cards,player);if(player.chooseControl(a).set("prompt","请选择要亮出牌堆顶的牌数").set("ai",()=>r.event.choice).set("choice",n-2+(player.awakenedSkills.includes("PSjixi")&&n>2)),result.control){event.cardsx=e.cards(+result.control);const a=s(cards,player)>s(event.cardsx),n=`花色数${a?'<span class="greentext">小于</span>':'<span class="firetext">不小于</span>'}${e.translation(player)}展示的手牌花色数`;player.showCards(event.cardsx,n),a?player.draw(event.cardsx.length):player.loseHp()}},ai:{order:10,result:{player:function(e){return s(e.getCards(),e)<=1?-1:1}}}},PSjixi:{derivation:"rewangzun",audio:"weidi",trigger:{player:"phaseJieshuBegin"},forced:!0,filter:function(e,a){if(a.phaseNumber<3)return!1;for(var n=0,t=a.actionHistory.length-1;t>=0;t--)if(a.actionHistory[t].isMe){if(r.globalHistory[t].changeHp.some(e=>e.player==a&&"loseHp"==e.getParent().name&&"PSshelian"==e.getParent(2).name))return!1;if(++n>=3)break}return!0},skillAnimation:!0,animationColor:"gray",unique:!0,juexingji:!0,content:function(){player.awakenSkill("PSjixi"),player.gainMaxHp(),player.recover();var t="摸两张牌",i=e.mode(),o="选项一";if("identity"==i||"versus"==i&&"four"==r.mode){var l=[],s=e.zhu(player);if(s&&s!=player&&s.skills)for(var u=0;u<s.skills.length;u++)a.skill[s.skills[u]]&&a.skill[s.skills[u]].zhuSkill&&l.push(s.skills[u]);l.length&&(t+="并获得技能"+e.translation(l),event.list=l,o="选项二")}player.chooseControl(function(e,a){return r.event.choice}).set("choiceList",["获得技能〖妄尊〗",t]).set("choice",o),"选项一"==result.control?player.addSkills("rewangzun"):(player.draw(2),event.list&&(player.addSkills(event.list),n.broadcastAll(function(e){for(var r of(n.expandSkills(e),e)){var t=a.skill[r];t&&(t.audioname2||(t.audioname2={}),t.audioname2.old_yuanshu="weidi")}},event.list)))},_priority:0}},sort:u.PScharacter_qun,translate:{PSreyuanshu:"PS袁术",PSshelian:"奢敛",PSshelian_info:"出牌阶段限一次，你可以展示至少1张手牌，然后亮出牌堆顶至多8张牌，对比其中的花色数：若展示牌的花色数大于亮出牌的花色数，你摸X张牌（X为此次亮出的牌数）；否则，你失去一点体力。",PSjixi:"觊玺",PSjixi_info:"觉醒技，结束阶段，若你连续三回合没有因〖奢敛〗而失去过体力，则你增加1点体力上限并回复1点体力，然后选择一项：获得技能〖妄尊〗：摸两张牌并获得当前主公的主公技。"},rank:c.rare},PSwenyang:{info:{sex:"male",group:"wei",hp:5,skills:["PSlvli","PSchoujue"],dieAudios:[],trashBin:[]},intro:"由“一顿七只屑狐狸”设计",skills:{PSlvli:{audio:"lvli",trigger:{player:"damageEnd",source:"damageSource"},filter:function(e,a,n){if("damageEnd"==n&&!a.storage.PSbeishui)return!1;var r=a.getStat().skill;return r.PSlvli||(r.PSlvli=0),!(r.PSlvli>0&&!a.storage.PSchoujue)&&(a.hp!=a.countCards("h")&&!(a.hp<a.countCards("h")&&a.isHealthy()))},content:function(){player.getStat().skill.PSlvli++;var e=player.hp-player.countCards("h");e>0?player.draw(e):player.recover(-e)},_priority:0},PSchoujue:{audio:"choujue",derivation:["PSbeishui","PSqingjiao"],trigger:{global:"phaseAfter"},skillAnimation:!0,animationColor:"water",unique:!0,juexingji:!0,forced:!0,init:function(e,a){e.storage[a]||(e.storage[a]=!1)},filter:function(e,a){return!a.storage.PSchoujue&&a.maxHp>4},content:function(){player.awakenSkill("PSchoujue"),player.storage.PSchoujue=!0,player.addSkills("PSbeishui")},_priority:0},PSbeishui:{trigger:{player:"phaseZhunbeiBegin"},audio:"beishui",skillAnimation:"epic",animationColor:"thunder",unique:!0,juexingji:!0,forced:!0,init:function(e,a){e.storage[a]||(e.storage[a]=!1)},filter:function(e,a){return!a.storage.PSbeishui&&a.hp>=3},content:function(){player.awakenSkill("PSbeishui"),player.storage.PSbeishui=!0,player.addSkills("PSqingjiao")},_priority:0},PSqingjiao:{audio:"qingjiao",trigger:{player:"phaseDrawBegin2"},forced:!0,preHidden:!0,filter:function(e,a){return!e.numFixed},content:function(){trigger.num+=2},mod:{cardUsable:function(e,a,n){if("sha"==e.name)return n+1},targetInRange:function(e){if("sha"==e.name)return!0}},ai:{threaten:1.5,unequip:!0,unequip_ai:!0,skillTagFilter:function(e,a,n){return!(!n||"sha"!=n.name)}}}},sort:u.PScharacter_wei,translate:{PSwenyang:"PS文鸯",PSlvli:"膂力",PSlvli_info:"每回合限一次，当你造成伤害后，你可以将手牌摸至与体力值相同或将体力回复至与手牌数相同。",PSchoujue:"仇决",PSchoujue_info:"觉醒技，每个回合结束时，若你的体力上限大于4，你获得技能〖背水〗，然后删去〖膂力〗描述中的“每回合限一次。",PSbeishui:"背水",PSbeishui_info:"觉醒技，准备阶段，若你的体力值不小于3，你获得〖清剿〗，然后将〖膂力〗改为受到伤害后也可以发动。",PSqingjiao:"清剿",PSqingjiao_info:"摸牌阶段，你可以多摸两张牌，且你本回合可以额外使用一张【杀】。你使用的【杀】无距离限制且无视防具。"},dynamicTranslate:{PSlvli:function(e){return`${e.storage.PSchoujue?"":"每回合限一次，"}当你造成${e.storage.PSbeishui?"或受到":""}伤害后，你可以将手牌摸至与体力值相同或将体力回复至与手牌数相同。`}},rank:c.rare},PSzhongyan:{info:{sex:"female",group:"jin",hp:3,skills:["PSrebolan","PSguangu","clanbaozu"],clans:["颍川钟氏"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",skills:{PSrebolan:{audio:"bolan",banned:["kotomi_chuanxiang"],global:"PSrebolan_g",initList:function(n){var t,i=[];if("guozhan"==e.mode())for(var o in t=[],a.characterPack.mode_guozhan)a.character[o]&&t.push(o);else if(r.connectMode)t=e.charactersOL();else for(var o in t=[],a.character)a.filter.characterDisabled2(o)||a.filter.characterDisabled(o)||t.push(o);for(var o of t)if(0!=o.indexOf("gz_jun"))for(var l of a.character[o][3])if("PSrebolan"!=l){var s=a.skill[l];if(!(!s||s.juexingji||s.hiddenSkill||s.zhuSkill||s.dutySkill||s.chargeSkill||a.skill.PSrebolan.banned.includes(l)||s.init||s.ai&&(s.ai.combo||s.ai.notemp||s.ai.neg))){var u=a.translate[l+"_info"];u&&-1!=u.indexOf("出牌阶段")&&i.add(l)}}n.storage.PSrebolan=i},enable:"phaseUse",usable:2,async content(n,t,i){if(!i.isIn())return;i.storage.PSrebolan||a.skill.PSrebolan.initList(i);const o=i.storage.PSrebolan.randomGets(6);if(!o.length)return;const{control:l}=await i.chooseControl(o).set("choiceList",o.map(function(n){return'<div class="skill">【'+e.translation(a.translate[n+"_ab"]||e.translation(n).slice(0,2))+"】</div><div>"+e.skillInfoTranslation(n,i)+"</div>"})).set("displayIndex",!1).set("prompt","博览：请选择你要获得的技能").set("ai",()=>r.event.controls.slice().sort((a,n)=>e.skillRank(n,"in")-e.skillRank(a,"in"))[0]).forResult(),{bool:s,targets:u}=await i.chooseTarget(`令一名角色获得【${e.translation(l)}】直到其回合结束`,function(e,a,n){return!0}).set("ai",function(a){return e.attitude(r.event.player,a)>0}).forResult();s&&(u[0].addTempSkills(l,{player:"phaseEnd"}),u[0].popup(l))},ai:{threaten:.9},subSkill:{g:{audio:"bolan",forceaudio:!0,enable:"phaseUse",usable:1,prompt:"出牌阶段限一次。你可以令一名有〖博览〗的角色从六个描述中包含“出牌阶段”的技能中选择一个，你获得此技能直到此阶段结束。",filter:function(e,a){return n.hasPlayer(function(e){return e!=a&&e.hasSkill("PSrebolan")})},filterTarget:function(e,a,n){return a!=n&&n.hasSkill("PSrebolan")},selectTarget:function(){return 1==n.countPlayer(e=>a.skill.PSrebolan_g.filterTarget(null,r.event.player,e))?-1:1},content:function(){if(player.loseHp(),target.isIn()&&player.isIn()){target.storage.PSrebolan||a.skill.PSrebolan.initList(target);var n=target.storage.PSrebolan.randomGets(6);if(!n.length)return void event.finish();target.chooseControl(n).set("choiceList",n.map(function(n){return'<div class="skill">【'+e.translation(a.translate[n+"_ab"]||e.translation(n).slice(0,2))+"】</div><div>"+e.skillInfoTranslation(n,player)+"</div>"})).set("displayIndex",!1).set("prompt","博览：请选择令"+e.translation(player)+"获得的技能").set("ai",()=>r.event.controls.slice().sort((a,n)=>(e.skillRank(n,"in")-e.skillRank(a,"in"))*e.attitude(r.event.player,r.event.getParent().player))[0])}else event.finish();target.line(player),player.addTempSkills(result.control,"phaseUseEnd"),player.popup(result.control)},ai:{order:function(r,t){if(t.hp>=5||t.countCards("h")>=10)return 10;var i=n.filterPlayer(e=>a.skill.PSrebolan_g.filterTarget(null,t,e));for(var o of i)if(e.attitude(o,t)>0)return 10;return 4},result:{player:function(a,n){if(a.hasUnknown())return a.hp+a.countCards("h")/4-5>0?1:0;var r=a.countCards("h","tao");return a.hp+r>4?4+e.attitude(a,n):a.hp+r>3?e.attitude(a,n)-2:0}}},sub:!0,_priority:0}},_priority:0},PSguangu:{audio:"clanguangu",trigger:{global:["useSkillAfter","logSkill"]},usable:1,filter(a,r){if(r.hp<=0)return!1;if("player"!=a.type)return!1;var t=a.sourceSkill||a.skill;if(e.info(t).charlotte)return!1;var i=e.skillInfoTranslation(t,a.player);if(!i)return!1;var o=i.match(/“?出牌阶段/g);return!(!o||o.every(e=>"出牌阶段"!=e))&&n.hasPlayer(e=>e.countCards("h"))},check:function(e,a){return!0},async cost(a,n,t){const i=parseInt(t.hp)||1;a.result=await t.chooseTarget(e.prompt("PSguangu"),`观看一名角色至多${e.cnNumber(i)}张牌`,function(e,a,n){return n.countCards("h")}).set("ai",function(a){const n=e.attitude(r.event.player,a);return 1+Math.abs(n)-n}).forResult()},async content(a,n,i){const o=a.targets[0],l=parseInt(i.hp)||1,{cards:s}=await i.choosePlayerCard(o,"h",!0,[1,l]).set("prompt",`观骨：观看${e.translation(o)}的至多${e.cnNumber(l)}张牌`).set("ai",e=>t.selected.buttons.length>=r.event.num?0:Math.random()).set("num",l).forResult();a.getParent().viewedCount=s.length;const u=e.cards(l),{moved:c}=await i.chooseToMove("观骨：与牌堆顶交换任意牌").set("list",[["牌堆顶",u],[`${e.translation(o)}的手牌`,s]]).set("filterMove",function(a,n){function t(a){setTimeout(()=>{try{if(!a||!a.node)return;const n=a.link,t=e.owner(n)===o&&r.event.moved[0].includes(n);a.node.gaintag.innerHTML=t?"被交换":e.owner(n)===o?"未被交换":""}catch(n){console.log(n)}},0)}return t(a),t(n),"number"!=typeof n}).set("processAI",function(a){const n=r.event.player,t=r.event.target,i=a[0][1].concat(a[1][1]).sort(function(a,r){return e.attitude(n,t)>=0?e.useful(a)-e.useful(r):e.useful(r)-e.useful(a)});return[i.splice(0,r.event.num),i]}).set("target",o).set("num",l).forResult(),g=c[0].slice(),d=c[1].slice();g.removeArray(u),d.removeArray(s),g.length&&await o.lose(g,t.cardPile),d.length&&await o.gain(d,"draw");const h=s.filter(e=>!c[1].includes(e)&&i.hasUseTarget(e,null,!1));if(!h.length)return;const{bool:p,links:f}=await i.chooseButton(["观骨：是否使用其中一张被交换的手牌？",h]).set("filterButton",e=>!0).set("ai",a=>e.useful(a.link)).forResult();if(p){const a=f[0],n={name:e.name(a,e.owner(a)),nature:e.nature(a,e.owner(a)),cards:[a]},t=i.chooseUseTarget(n,[a],!0,!1).set("oncard",e=>{const a=r.event.getParent().owner;a&&a.$throw(e.cards)});a.name===n.name&&e.is.sameNature(a,n,!0)&&(t.viewAs=!1);const o=e.owner(a);o!=i&&"h"==e.position(a)&&(t.throw=!1,t.set("owner",o))}},_priority:0}},sort:u.PScharacter_jin,translate:{PSzhongyan:"PS钟琰",PSrebolan:"博览",PSrebolan_info:"出牌阶段限两次，你可以从六个含有“出牌阶段”的技能中选择一个技能，令场上一名角色获得之直到其下回合结束。其他角色的出牌阶段限一次，其可以失去1点体力，令你从六个含有“出牌阶段”的技能中选择一个，其获得此技能直到此阶段结束。",PSguangu:"观骨",PSguangu_info:"每名角色每回合限一次，当一名角色发动“出牌阶段”的技能后，你可以观看一名角色至多X张手牌，你可以将这些牌与牌顶堆的X张牌交换。若如此做，你可以使用其中一张被交换的手牌。（X为你体力值）"},rank:c.epic},PSshen_nanhualaoxian:{info:{sex:"male",group:"shen",hp:3,skills:["PSnandou","PSbeidou","PSwuji","PSdaogu"],dieAudios:["ext:PS武将/audio/die:true"],trashBin:[]},intro:"由“mento last”设计",skills:{PSnandou:{audio:"ext:PS武将/audio/skill:2",enable:["chooseToUse","chooseToRespond"],limited:!0,skillAnimation:!0,animationColor:"fire",onremove:!0,filter:function(n,r){if(!r.countCards("hse",a=>"basic"===e.type(a)))return!1;for(var t of a.inpile){if("trick"==e.type2(t)&&n.filterCard(e.autoViewAs({name:t},"unsure"),r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];"trick"==e.type2(l)&&n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)&&i.push(["锦囊","",l])}return t.create.dialog("南斗",[i,"vcard"])},check:function(e){return"phase"!=r.event.getParent().type?1:r.event.player.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:(a,n)=>"basic"==e.type(a,n),popname:!0,log:!1,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3]},precontent:function(){n.logSkill("PSnandou"),n.storage.PSdaogu_nandou||n.awakenSkill("PSnandou")}}},prompt:function(a,n){return"将一张基本牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},hiddenCard:function(n,r){return!!a.inpile.includes(r)&&("trick"==e.type2(r)&&n.countCards("hse",a=>"basic"===e.type(a))>0)},ai:{fireAttack:!0,skillTagFilter:function(a){if(!a.countCards("hse",a=>"basic"===e.type(a)))return!1},order:1,result:{player:function(e){return 1}}},_priority:0},PSbeidou:{audio:"ext:PS武将/audio/skill:2",enable:["chooseToUse","chooseToRespond"],limited:!0,skillAnimation:!0,animationColor:"water",onremove:!0,filter:function(n,r){if(!r.countCards("hse",a=>"equip"===e.type(a)))return!1;for(var t of a.inpile){if("basic"==e.type(t)&&n.filterCard(e.autoViewAs({name:t},"unsure"),r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];if("sha"==l)for(var s of(n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)&&i.push(["基本","","sha"]),a.inpile_nature))n.filterCard(e.autoViewAs({name:l,nature:s},"unsure"),r,n)&&i.push(["基本","","sha",s]);else"basic"==e.type(l)&&n.filterCard(e.autoViewAs({name:l},"unsure"),r,n)&&i.push(["基本","",l])}return t.create.dialog("北斗",[i,"vcard"])},check:function(e){return"phase"!=r.event.getParent().type?1:r.event.player.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:(a,n)=>"equip"==e.type(a,n),popname:!0,log:!1,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3]},precontent:function(){n.logSkill("PSbeidou"),n.storage.PSdaogu_beidou||n.awakenSkill("PSbeidou")}}},prompt:function(a,n){return"将一张装备牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用"}},hiddenCard:function(n,r){return!!a.inpile.includes(r)&&("basic"==e.type2(r)&&n.countCards("hse",a=>"equip"===e.type(a))>0)},ai:{fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(a){if(!a.countCards("hse",a=>"equip"===e.type(a)))return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},_priority:0},PSwuji:{audio:"ext:PS武将/audio/skill:2",enable:["chooseToUse","chooseToRespond"],filter:function(n,r){if(!r.countCards("hse",a=>"trick"===e.type2(a)))return!1;for(var t of a.inpile){if("basic"==e.type(t)&&n.filterCard(e.autoViewAs({name:t},"unsure"),r,n))return!0}return!1},chooseButton:{dialog:function(n,r){for(var i=[],o=0;o<a.inpile.length;o++){var l=a.inpile[o];const t=e.autoViewAs({name:l},"unsure");if(t.storage.PSwuji=!0,"sha"==l)for(var s of(n.filterCard(t,r,n)&&i.push(["基本","","sha"]),a.inpile_nature)){const a=e.autoViewAs({name:l,nature:s},"unsure");a.storage.PSwuji=!0,n.filterCard(a,r,n)&&i.push(["基本","","sha",s])}else"basic"==e.type(l)&&n.filterCard(t,r,n)&&i.push(["基本","",l])}return t.create.dialog("武吉",[i,"vcard"])},check:function(e){return"phase"!=r.event.getParent().type?1:r.event.player.getUseValue({name:e.link[2],nature:e.link[3]})},backup:function(a,n){return{filterCard:(a,n)=>"trick"==e.type2(a,n),popname:!0,log:!1,check:function(a){return 8-e.value(a)},position:"hse",viewAs:{name:a[0][2],nature:a[0][3],storage:{PSwuji:!0}},precontent:function(){n.logSkill("PSwuji")}}},prompt:function(a,n){return"将一张锦囊牌当做"+(e.translation(a[0][3])||"")+e.translation(a[0][2])+"使用（无次数限制）"}},hiddenCard:function(n,r){return!!a.inpile.includes(r)&&("basic"==e.type2(r)&&n.countCards("hse",a=>"trick"===e.type2(a))>0)},ai:{fireAttack:!0,respondSha:!0,respondShan:!0,skillTagFilter:function(a){if(!a.countCards("hse",a=>"trick"===e.type2(a)))return!1},order:1,result:{player:function(a){return r.event.dying?e.attitude(a,r.event.dying):1}}},mod:{cardUsable:function(e,a,n){if(e.storage&&e.storage.PSwuji)return 1/0}},_priority:0},PSdaogu:{audio:"ext:PS武将/audio/skill:2",trigger:{player:["logSkill","useSkillAfter"]},forced:!0,init:function(e){e.storage.PSdaogu_count||(e.storage.PSdaogu_count=3)},filter(e,a){const n=a.storage.PSdaogu_count;if("PSdaogu"===e.skill)return!1;const r=a.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_")&&"PSdaogu"!==e);return!!r.includes(e.skill)&&a.getAllHistory("useSkill",e=>r.includes(e.skill)).length%n===0},getResetableSkills(a){const r=a.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_"));n.expandSkills(r);const t=[],i=["used","round","block","blocker"];for(const n of r){var o=e.info(n);for(var l of("PSnandou"!==n||a.storage.PSdaogu_nandou||t.add(n),"PSbeidou"!==n||a.storage.PSdaogu_beidou||t.add(n),"number"==typeof o.usable&&(a.hasSkill("counttrigger")&&a.storage.counttrigger[n]&&a.storage.counttrigger[n]>=1&&t.add(n),"number"==typeof e.skillCount(n)&&e.skillCount(n)>=1&&t.add(n)),o.round&&a.storage[n+"_roundcount"]&&t.add(n),a.storage[`temp_ban_${n}`]&&t.add(n),Object.keys(a.disabledSkills).includes(n)&&t.add(n),a.awakenedSkills.includes(n)&&t.add(n),i))a.hasSkill(n+"_"+l)&&t.add(n)}return t},resetSkill:function(a,r){const t=e.info(r),i=["used","round","block","blocker"];for(var o of("number"==typeof t.usable&&(a.hasSkill("counttrigger")&&a.storage.counttrigger[r]&&a.storage.counttrigger[r]>=1&&delete a.storage.counttrigger[r],"number"==typeof e.skillCount(r)&&e.skillCount(r)>=1&&delete a.getStat("skill")[r]),t.round&&a.storage[r+"_roundcount"]&&delete a.storage[r+"_roundcount"],a.storage[`temp_ban_${r}`]&&delete a.storage[`temp_ban_${r}`],Object.keys(a.disabledSkills).includes(r)&&a.enableSkill(r),a.awakenedSkills.includes(r)&&a.restoreSkill(r),i))a.hasSkill(r+"_"+o)&&a.removeSkill(r+"_"+o);const l="【"+e.translation(r)+"】、";"PSnandou"===r&&(a.storage.PSdaogu_nandou=!0),"PSbeidou"===r&&(a.storage.PSdaogu_beidou=!0),n.log(a,"重置了技能","#g"+l)},async content(r,t,i){const o=[`失去你的一个技能，然后令〖道骨〗描述中【】内的数子-1（当前数字：${i.storage.PSdaogu_count}）`,"重置或恢复场上的一个技能（若为〖南斗〗或〖北斗〗，则改为重置并失去限定技标签）","随机获得场上的一个技能，直到本回合结束"],l=["选项一","选项二","选项三"],s=a.skill[r.name].getResetableSkills,u=a.skill[r.name].resetSkill;let c;if(n.players.every(e=>0===s(e).length)&&(l.remove("选项二"),o[1]='<span style="opacity:0.5; ">'+o[1]+"</span>"),n.players.flatMap(e=>e.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_"))).every(e=>i.hasSkill(e))&&(l.remove("选项三"),o[2]='<span style="opacity:0.5; ">'+o[2]+"</span>"),1===l.length)c=l[0];else{if(!(l.length>1))return;({control:c}=await i.chooseControl(l).set("choiceList",o).set("ai",()=>i.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_"))>=3?"选项一":i.storage.PSdaogu_nandou&&i.storage.PSdaogu_beidou||!l.includes("选项二")?l.at(-1):"选项二").forResult())}switch(i.logSkill(r.name),c){case"选项一":{const{control:a}=await i.chooseControl(i.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_"))).set("ai",()=>e.event().controls.slice().remove("PSdaogu").randomGet()).set("prompt","请选择要失去的技能").forResult();await i.removeSkills(a),i.storage.PSdaogu_count>1&&i.storage.PSdaogu_count--;break}case"选项二":{const{targets:a}=await i.chooseTarget("请选择要重置或恢复技能的角色",!0).set("filterTarget",(e,a,n)=>s(n).length>0).set("ai",a=>{const n=e.attitude(i,a);return n<=0?0:n}).forResult(),n=a[0],{control:r}=await i.chooseControl(n.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_")).filter(e=>s(i).includes(e))).set("ai",()=>e.event().controls.randomGet()).set("prompt","请选择要重置或恢复技能").forResult();u(n,r);break}case"选项三":{const e=n.players.flatMap(e=>e.getSkills(!0,!1,!1).filter(e=>!e.startsWith("player_when_"))).filter(e=>!i.hasSkill(e)).randomGet();i.addTempSkills(e,{player:"phaseEnd"}).set("$handle",(e,a,n,r)=>{e.popup(a[0])})}}}}},sort:u.PScharacter_shen,translate:{PSshen_nanhualaoxian:"PS神南华老仙",PSnandou:"南斗",PSnandou_info:"限定技，你可以将一张基本牌当作锦囊牌使用。",PSbeidou:"北斗",PSbeidou_info:"限定技，你可以将一张装备牌当作基本牌使用。",PSwuji:"武吉",PSwuji_info:"你可以将一张锦囊牌当作无次数限制的基本牌使用。",PSdaogu:"道骨",PSdaogu_info:"锁定技，你每发动过【3】次技能（〖道骨〗除外），你选择一项：1、失去你的一个技能，然后将〖道骨〗描述中【】内的数字减1（至少为1）。2、重置或恢复场上的一个技能（若为〖南斗〗或〖北斗〗，则改为重置并失去限定技标签）。3、随机获得场上的一个技能，直到你下回合结束。","#ext:PS武将/audio/skill/PSnandou1":"道冲而用之或不盈，似万物之宗。","#ext:PS武将/audio/skill/PSnandou2":"修行无有，而外其形骸。","#ext:PS武将/audio/skill/PSbeidou1":"阳气施化，阴气结成，成化相合。","#ext:PS武将/audio/skill/PSbeidou2":"以有穷之姿，通无穷之变。","#ext:PS武将/audio/skill/PSwuji1":"此经所书晦涩难明，吾偶有所悟，愿为君陈之。","#ext:PS武将/audio/skill/PSwuji2":"大音希声，大象无形，天理难明，以经合之。","#ext:PS武将/audio/skill/PSdaogu1":"含气求道，祸福难料，且与阁下共参之。","#ext:PS武将/audio/skill/PSdaogu2":"蕴气修德，其理易现，容吾为君讲解一二。","#ext:PS武将/audio/die/PSshen_nanhualaoxian:die":"吾以天地为棺椁，以日月为连壁。"},dynamicTranslate:{PSdaogu:function(e){return`锁定技，你每发动过【${e.storage.PSdaogu_count}】次技能（〖道骨〗除外），你选择一项：1、失去你的一个技能，然后将〖道骨〗描述中【】内的数字减1（至少为1）。2、重置或恢复场上的一个技能（若为〖南斗〗或〖北斗〗，则改为重置并失去限定技标签）。3、随机获得场上的一个技能，直到你下回合结束。`}},rank:c.rare},PShr_caocao:{info:{sex:"male",group:"wei",hp:4,skills:["PSfaxiao"],dieAudios:["sb_caocao"],trashBin:[]},intro:"由“九个夜白”设计",skills:{PSfaxiao:{trigger:{player:["loseAfter","damageEnd"],global:["equipAfter","addJudgeAfter","gainAfter","loseAsyncAfter","addToExpansionAfter"]},frequent:!0,preHidden:!0,zhuanhuanji:!0,mark:!0,marktext:"☯",intro:{mark:function(n,r,t){if(!r)return"当你受到伤害后，或当你于回合外失去牌后，你可以念一句文本包含“哼”、“呵”、“哈”的台词（随机三个自选其一）。";{const r=t.storage.PSfaxiao_pending;r&&(n.addText(`当你受到伤害后，或当你于回合外失去牌后，你获得技能〖${e.translation(r)}〗。若已获得该技能，则：若因伤害触发，则对所有其他角色各造成一点伤害，否则弃置所有其他角色各一张牌。`,!1),n.add('<div><div class="skill">【'+e.translation(a.translate[r+"_ab"]||e.translation(r).slice(0,2))+"】</div><div>"+e.skillInfoTranslation(r,t)+"</div></div>"))}}},onremove:function(e){delete e.storage.PSfaxiao,delete e.storage.PSfaxiao_pending},filter:function(e,a,n){if("damageEnd"===n)return e.num>0;if(a==r.currentPhase)return!1;if("gain"==e.name&&e.player==a)return!1;const t=e.getl(a);return t&&t.cards2&&t.cards2.length>0},async content(e,r,t){if(t.changeZhuanhuanji("PSfaxiao"),t.storage.PSfaxiao){const e=a.skill.PSfaxiao.getMap(),r=Object.keys(e);if(r.length>0){const a=r.randomGet(),i=n.parseSkillTextMap(a,e[a]);t.storage.PSfaxiao_pending=a;for(let e of i)if(e.text&&/[哼呵哈]/.test(e.text)){t.chat(e.text),n.broadcastAll(e=>n.playAudio(e),e.file);break}}}else{n.broadcastAll(e=>n.playAudio(e),"../extension/PS武将/audio/skill/PSfaxiao");const a=t.storage.PSfaxiao_pending;if(a){if(t.hasSkill(a,null,!1)){const a=n.filterPlayer(e=>e!=t).sortBySeat();if("damageEnd"===e.triggername){t.line(a,"fire");for(let e of a)e.isIn()&&await e.damage()}else{t.line(a,"thunder");for(let e of a)e.isIn()&&await t.discardPlayerCard("he",e,!0)}}else await t.addAdditionalSkills("PSfaxiao",a,!0),t.popup(a,"fire");delete t.storage.PSfaxiao_pending}else n.log(t,"没有技能可获得")}},getMap(){if(!r.PSfaxiao_map){let a;r.PSfaxiao_map={},a=r.connectMode?e.charactersOL():e.gainableCharacters(),a.forEach(a=>{if("PShr_caocao"!==a){e.character(a,3).forEach(t=>{const i=e.info(t);if(!i||i.ai&&i.ai.combo)return;const o=n.parseSkillText(t,a);t in r.PSfaxiao_map||o.some(e=>/[哼呵哈]/.test(e))&&(r.PSfaxiao_map[t]=a)})}})}return r.PSfaxiao_map}}},sort:u.PScharacter_wei,translate:{PShr_caocao:"华容曹操",PSfaxiao:"发笑",PSfaxiao_info:"转换技，当你受到伤害后，或当你于回合外失去牌后，阳：你可以念一句文本包含“哼”、“呵”、“哈”的台词（随机三个自选其一）；阴：你获得你上一次所念的台词所属的技能。若已获得该技能，则：若因伤害触发，则对所有其他角色各造成一点伤害，否则弃置所有其他角色各一张牌。","#ext:PS武将/audio/skill/PSfaxiao":"单笑周瑜无谋，诸葛亮少智。"},dynamicTranslate:{PSfaxiao:function(e){return e.storage.PSfaxiao?'转换技，当你受到伤害后，或当你于回合外失去牌后，阳：你可以念一句文本包含“哼”、“呵”、“哈”的台词（随机三个自选其一）；<span class="bluetext">阴：你获得你上一次所念的台词所属的技能。若已获得该技能，则：若因伤害触发，则对所有其他角色各造成一点伤害，否则弃置所有其他角色各一张牌。</span>':'转换技，当你受到伤害后，或当你于回合外失去牌后，<span class="bluetext">阳：你可以念一句文本包含“哼”、“呵”、“哈”的台词（随机三个自选其一）；</span>阴：你获得你上一次所念的台词所属的技能。若已获得该技能，则：若因伤害触发，则对所有其他角色各造成一点伤害，否则弃置所有其他角色各一张牌。'}},rank:c.epic},PSshenpei:{info:{sex:"male",group:"qun",hp:3,skills:["PSshouye","PSliezhi"],dieAudios:[],trashBin:[]},intro:"由“mento last”设计",skills:{PSshouye:{audio:"shouye",trigger:{global:"roundStart"},derivation:"PSxieshou",direct:!0,async content(n,t,i){await i.addTempSkills("PSxieshou",{global:"roundStart"});const{targets:o,bool:l}=await i.chooseTarget("是否令一名其他角色也获得技能〖协守〗？",a.filter.notMe).set("ai",function(a){var n=e.attitude(r.event.player,a);return n<=0?0:n}).forResult();if(l){const e=o[0];i.logSkill("PSshouye",e),await e.addTempSkills("PSxieshou",{global:"roundStart"})}else i.logSkill("PSshouye")},group:"PSshouye_onremove",subSkill:{onremove:{trigger:{global:"changeSkillsBegin"},forced:!0,filter:function(e,a){return e.removeSkill.includes("PSxieshou")},content:async function(e,a,n){await a.player.recover()}}}},PSliezhi:{audio:"liezhi",trigger:{player:["phaseBegin","phaseEnd"]},filter:function(e,a){return a.countDiscardableCards(a,"h")>0&&a.hasUseTarget("wanjian")},check(a,r){const t=r.getFriends(),i=n.filterPlayer(e=>e!==r).removeArray(t);if(t.length>i.length)return!1;if(t.some(e=>e.getHp(!0)<=1))return!1;const o=r.getDiscardableCards(r,"h",a=>"basic"===e.type(a)).length,l=r.getDiscardableCards(r,"h",a=>"trick"===e.type2(a)).length,s=r.getDiscardableCards(r,"h",a=>"equip"===e.type(a)).length,u=Math.min(o,l,s);return r.hasSkill("PSxieshou")?u<=i.length+r.hp+1:u<=i.length+1},async content(a,n,r){await r.chooseUseTarget("wanjian",!0);const t=[],i=r.getDiscardableCards(r,"h",a=>"basic"===e.type(a)),o=r.getDiscardableCards(r,"h",a=>"trick"===e.type2(a)),l=r.getDiscardableCards(r,"h",a=>"equip"===e.type(a));o.length&&t.push("trick"),l.length&&t.push("equip"),i.length&&t.push("basic");const s=new Map([["trick",o],["equip",l],["basic",i]]);let u;1===t.length?u=t[0]:({control:u}=await r.chooseControl(t).set("ai",()=>{let a=e.event().controls.slice();return a.sort((e,a)=>{s.get(e).length,s.get(a).length}),a[0]}).set("prompt","烈直：请弃置一种类型的所有手牌").forResult()),await r.discard(s.get(u))}},PSxieshou:{audio:"beizhan",mod:{targetEnabled:function(e,a,n,r){if("juedou"==e.name)return!1},cardEnabled:function(e){if("juedou"==e.name)return!1}},locked:!0,trigger:{player:"loseAfter",global:"loseAsyncAfter"},filter:function(a,n,r){if("discard"==a.type&&!1!==a.getlx){var t=a.getl(n);if(!t||!t.hs||!t.hs.length)return!1;for(var i=0;i<t.hs.length;i++)if("d"==e.position(t.hs[i]))return!0;return!1}},async cost(a,n,r){const t=[],i=n.getl(r);for(let u=0;u<i.hs.length;u++)"d"==e.position(i.hs[u],!0)&&t.push(i.hs[u]);const o=Math.min(r.getHp(!0),t.length),{bool:l,links:s}=await r.chooseCardButton(`协守：是否将其中至多${e.cnNumber(o)}张牌交给同势力或拥有〖协守〗的角色`,!1,t,[1,o]).set("ai",function(e){return 1}).forResult();a.result={bool:l,cards:s}},async content(a,n,r){const t=a.cards,{targets:i}=await r.chooseTarget("请选择获得牌的角色",!0).set("filterTarget",function(e,a,n){return n.hasSkill("PSxieshou")||n.group===a.group}).set("ai",function(a){return e.attitude(e.event().player,a)}).forResult();if(i.length){const e=i[0];r===e?e.gain(t,"gain2"):r.give(t,e,"giveAuto")}},group:"PSxieshou_else",subSkill:{else:{audio:"beizhan",trigger:{player:["useCardEnd","respondEnd"]},filter:(a,r,t)=>!!n.hasPlayer(e=>e.hasSkill("PSxieshou")&&e!==r)&&("respondEnd"===t||a.card&&["shan","wuxie"].includes(e.name(a.card))),async cost(a,n,r){a.result=await r.chooseTarget("协守：是否令一名拥有〖协守〗的其他角色摸一张牌？").set("filterTarget",function(e,a,n){return n.hasSkill("PSxieshou")&&n!==a}).set("ai",function(a){return e.attitude(e.event().player,a)}).forResult()},content:async function(e,a,n){const r=e.targets[0];await r.draw()}}}}},sort:u.PScharacter_qun,translate:{PSshenpei:"PS审配",PSshouye:"守邺",PSshouye_info:"每一轮开始时，你获得技能〖协守〗并且可以令一名角色获得技能〖协守〗直到下一轮开始。当一名角色失去技能〖协守〗时，其恢复一点体力。",PSliezhi:"烈直",PSliezhi_info:"回合开始时或回合结束时，你可以视为使用一张【万箭齐发】，并弃置一种类型的所有手牌。",PSxieshou:"协守",PSxieshou_info:"锁定技，你不能成为【决斗】的目标且不能使用【决斗】。当你响应牌后，你可以令一名拥有技能〖协守〗的其他角色摸一张牌；当你弃置手牌后，你可以将其中至多X张弃置牌交给给同势力或拥有〖协守〗的角色（X为你的体力值）。"},rank:c.rare}},{character:h,characterFilter:p,characterIntro:f,characterReplace:S,characterSubstitute:y,translate:P,dynamicTranslate:m,rank:{junk:k,rare:v,epic:b,legend:_},skill:x,characterSort:w}=i(g,d);await n.import("character",function(){return{name:g.name,character:h,characterFilter:p,characterIntro:f,characterReplace:S,characterSubstitute:y,translate:P,dynamicTranslate:m,skill:x,characterTitle:{},perfectPair:{},card:{},characterSort:w}}),l(()=>{a.rank.rarity.junk.addArray(k||[]),a.rank.rarity.rare.addArray(v||[]),a.rank.rarity.epic.addArray(b||[]),a.rank.rarity.legend.addArray(_||[])});
//# sourceMappingURL=index.js.map
